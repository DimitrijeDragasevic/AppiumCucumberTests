"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _chai = _interopRequireDefault(require("chai"));

var _chaiAsPromised = _interopRequireDefault(require("chai-as-promised"));

var _2 = _interopRequireWildcard(require("../.."));

var _imageElement = require("../../lib/basedriver/image-element");

var _protocol = require("../../lib/protocol/protocol");

var _sinon = _interopRequireDefault(require("sinon"));

_chai.default.should();

_chai.default.use(_chaiAsPromised.default);

const defRect = {
  x: 100,
  y: 110,
  width: 50,
  height: 25
};
const defTemplate = 'iVBORasdf';
describe('ImageElement', function () {
  const driver = new _2.default();
  describe('.size', function () {
    it('should return the width and height of the image el', function () {
      const el = new _2.ImageElement(defTemplate, defRect);
      el.size.should.eql({
        width: defRect.width,
        height: defRect.height
      });
    });
  });
  describe('.location', function () {
    it('should return the location of the image el', function () {
      const el = new _2.ImageElement(defTemplate, defRect);
      el.location.should.eql({
        x: defRect.x,
        y: defRect.y
      });
    });
  });
  describe('.center', function () {
    it('should return the center location of the image el', function () {
      const el = new _2.ImageElement(defTemplate, defRect);
      el.center.should.eql({
        x: defRect.x + defRect.width / 2,
        y: defRect.y + defRect.height / 2
      });
    });
  });
  describe('.asElement', function () {
    it('should get the webdriver object representation of the element', function () {
      const el = new _2.ImageElement(defTemplate, defRect);
      el.asElement('ELEMENT').ELEMENT.should.match(/^appium-image-el/);
    });
  });
  describe('.equals', function () {
    it('should say two image elements with same rect are equal', function () {
      const el1 = new _2.ImageElement('foo', defRect);
      const el2 = new _2.ImageElement('bar', defRect);
      el1.equals(el2).should.be.true;
      el2.equals(el1).should.be.true;
    });
    it('should say two image elements with different rect are not equal', function () {
      const el1 = new _2.ImageElement(defTemplate, (0, _objectSpread2.default)({}, defRect, {
        x: 0
      }));
      const el2 = new _2.ImageElement(defTemplate, defRect);
      el1.equals(el2).should.be.false;
      el2.equals(el1).should.be.false;
    });
  });
  describe('.click', function () {
    it('should reject an invalid tap strategy', async function () {
      const d = new _2.default();
      const el = new _2.ImageElement(defTemplate, defRect);
      await d.settings.update({
        imageElementTapStrategy: 'bad'
      });
      await el.click(d).should.eventually.be.rejectedWith(/Incorrect imageElementTapStrategy/);
    });
    it('should try to check for image element staleness, and throw if stale', async function () {
      const d = new _2.default();

      _sinon.default.stub(d, 'findByImage').throws();

      const el = new _2.ImageElement(defTemplate, defRect);
      await d.settings.update({
        checkForImageElementStaleness: true,
        autoUpdateImageElementPosition: false
      });
      await el.click(d).should.eventually.be.rejectedWith(/no longer attached/);
      await d.settings.update({
        checkForImageElementStaleness: false,
        autoUpdateImageElementPosition: true
      });
      await el.click(d).should.eventually.be.rejectedWith(/no longer attached/);
    });
    it('should auto-update element position if requested', async function () {
      const d = new _2.default();
      d.performActions = _lodash.default.noop;

      _sinon.default.stub(d, 'performActions');

      const el = new _2.ImageElement(defTemplate, defRect);
      const newRect = (0, _objectSpread2.default)({}, defRect, {
        x: defRect.x + 10,
        y: defRect.y + 5
      });
      const elPos2 = new _2.ImageElement(defTemplate, newRect);

      _sinon.default.stub(d, 'findByImage').returns(elPos2);

      await d.settings.update({
        autoUpdateImageElementPosition: true
      });
      el.rect.should.not.eql(newRect);
      await el.click(d);
      el.rect.should.eql(newRect);
    });
    it('should tap the center of an element using w3c actions by default', async function () {
      const d = new _2.default();
      d.performActions = _lodash.default.noop;

      const actionStub = _sinon.default.stub(d, 'performActions');

      const el = new _2.ImageElement(defTemplate, defRect);
      await d.settings.update({
        checkForImageElementStaleness: false
      });
      await el.click(d);
      const pointerMoveAction = actionStub.args[0][0][0].actions[0];
      pointerMoveAction.x.should.equal(el.center.x);
      pointerMoveAction.y.should.equal(el.center.y);
    });
    it('should fall back to touchactions if w3c actions do not exist on driver', async function () {
      const d = new _2.default();
      d.performTouch = _lodash.default.noop;

      const actionStub = _sinon.default.stub(d, 'performTouch');

      const el = new _2.ImageElement(defTemplate, defRect);
      await d.settings.update({
        checkForImageElementStaleness: false
      });
      await el.click(d);
      const action = actionStub.args[0][0][0].options;
      action.x.should.equal(el.center.x);
      action.y.should.equal(el.center.y);
    });
    it('should use touchactions if requested', async function () {
      const d = new _2.default();
      d.performActions = _lodash.default.noop;

      const w3cStub = _sinon.default.stub(d, 'performActions');

      d.performTouch = _lodash.default.noop;

      const touchStub = _sinon.default.stub(d, 'performTouch');

      const el = new _2.ImageElement(defTemplate, defRect);
      await d.settings.update({
        checkForImageElementStaleness: false,
        imageElementTapStrategy: 'touchActions'
      });
      await el.click(d);
      const action = touchStub.args[0][0][0].options;
      action.x.should.equal(el.center.x);
      action.y.should.equal(el.center.y);
      w3cStub.callCount.should.eql(0);
    });
    it('should throw if driver does not implement any type of action', async function () {
      const d = new _2.default();
      const el = new _2.ImageElement(defTemplate, defRect);
      await d.settings.update({
        checkForImageElementStaleness: false
      });
      await el.click(d).should.eventually.be.rejectedWith(/did not implement/);
    });
  });
  describe('#execute', function () {
    const imgEl = new _2.ImageElement(defTemplate, defRect);

    const clickStub = _sinon.default.stub(imgEl, 'click');

    before(function () {
      driver._imgElCache.set(imgEl.id, imgEl);

      clickStub.returns(true);
    });
    after(function () {
      driver._imgElCache.reset();

      clickStub.restore();
    });
    it('should reject executions on elements not in the cache', async function () {
      await _2.ImageElement.execute(driver, 'click', 'appium-image-element-foo').should.eventually.be.rejectedWith(/element could not be located/);
    });
    it('should reject executions for unsupported commands', async function () {
      await _2.ImageElement.execute(driver, 'foobar', imgEl.id).should.eventually.be.rejectedWith(/not yet been implemented/);
    });
    it('should get displayed status of element', async function () {
      await _2.ImageElement.execute(driver, 'elementDisplayed', imgEl.id).should.eventually.be.true;
    });
    it('should get size of element', async function () {
      await _2.ImageElement.execute(driver, 'getSize', imgEl.id).should.eventually.eql({
        width: defRect.width,
        height: defRect.height
      });
    });
    it('should get location of element', async function () {
      await _2.ImageElement.execute(driver, 'getLocation', imgEl.id).should.eventually.eql({
        x: defRect.x,
        y: defRect.y
      });
    });
    it('should get location in view of element', async function () {
      await _2.ImageElement.execute(driver, 'getLocation', imgEl.id).should.eventually.eql({
        x: defRect.x,
        y: defRect.y
      });
    });
    it('should get rect of element', async function () {
      await _2.ImageElement.execute(driver, 'getElementRect', imgEl.id).should.eventually.eql(defRect);
    });
    it('should click element', async function () {
      await _2.ImageElement.execute(driver, 'click', imgEl.id).should.eventually.be.true;
    });
  });
});
describe('image element LRU cache', function () {
  it('should accept and cache image elements', function () {
    const el1 = new _2.ImageElement(defTemplate, defRect);
    const el2 = new _2.ImageElement(defTemplate, defRect);
    const cache = (0, _imageElement.makeImageElementCache)();
    cache.set(el1.id, el1);
    el1.equals(cache.get(el1.id)).should.be.true;
    _lodash.default.isUndefined(cache.get(el2.id)).should.be.true;
    cache.has(el1.id).should.be.true;
    cache.has(el2.id).should.be.false;
  });
  it('once cache reaches max size, should eject image elements', function () {
    const el1 = new _2.ImageElement(defTemplate, defRect);
    const el2 = new _2.ImageElement(defTemplate, defRect);
    const cache = (0, _imageElement.makeImageElementCache)(defTemplate.length + 1);
    cache.set(el1.id, el1);
    cache.has(el1.id).should.be.true;
    cache.set(el2.id, el2);
    cache.has(el2.id).should.be.true;
    cache.has(el1.id).should.be.false;
  });
});
describe('getImgElFromArgs', function () {
  it('should return the image element id from json obj in args', function () {
    const imgEl = `${_protocol.IMAGE_ELEMENT_PREFIX}foo`;
    const args = [1, 'foo', imgEl];
    (0, _imageElement.getImgElFromArgs)(args).should.eql(imgEl);
  });
  it('should not return anything if image element id not in args', function () {
    const args = [1, 'foo'];
    _lodash.default.isUndefined((0, _imageElement.getImgElFromArgs)(args)).should.be.true;
  });
  it('should not find image element id in anything but prefix', function () {
    const notImgEl = `foo${_protocol.IMAGE_ELEMENT_PREFIX}`;
    const args = [1, 'foo', notImgEl];
    _lodash.default.isUndefined((0, _imageElement.getImgElFromArgs)(args)).should.be.true;
  });
});require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvYmFzZWRyaXZlci9pbWFnZS1lbGVtZW50LXNwZWNzLmpzIl0sIm5hbWVzIjpbImNoYWkiLCJzaG91bGQiLCJ1c2UiLCJjaGFpQXNQcm9taXNlZCIsImRlZlJlY3QiLCJ4IiwieSIsIndpZHRoIiwiaGVpZ2h0IiwiZGVmVGVtcGxhdGUiLCJkZXNjcmliZSIsImRyaXZlciIsIkJhc2VEcml2ZXIiLCJpdCIsImVsIiwiSW1hZ2VFbGVtZW50Iiwic2l6ZSIsImVxbCIsImxvY2F0aW9uIiwiY2VudGVyIiwiYXNFbGVtZW50IiwiRUxFTUVOVCIsIm1hdGNoIiwiZWwxIiwiZWwyIiwiZXF1YWxzIiwiYmUiLCJ0cnVlIiwiZmFsc2UiLCJkIiwic2V0dGluZ3MiLCJ1cGRhdGUiLCJpbWFnZUVsZW1lbnRUYXBTdHJhdGVneSIsImNsaWNrIiwiZXZlbnR1YWxseSIsInJlamVjdGVkV2l0aCIsInNpbm9uIiwic3R1YiIsInRocm93cyIsImNoZWNrRm9ySW1hZ2VFbGVtZW50U3RhbGVuZXNzIiwiYXV0b1VwZGF0ZUltYWdlRWxlbWVudFBvc2l0aW9uIiwicGVyZm9ybUFjdGlvbnMiLCJfIiwibm9vcCIsIm5ld1JlY3QiLCJlbFBvczIiLCJyZXR1cm5zIiwicmVjdCIsIm5vdCIsImFjdGlvblN0dWIiLCJwb2ludGVyTW92ZUFjdGlvbiIsImFyZ3MiLCJhY3Rpb25zIiwiZXF1YWwiLCJwZXJmb3JtVG91Y2giLCJhY3Rpb24iLCJvcHRpb25zIiwidzNjU3R1YiIsInRvdWNoU3R1YiIsImNhbGxDb3VudCIsImltZ0VsIiwiY2xpY2tTdHViIiwiYmVmb3JlIiwiX2ltZ0VsQ2FjaGUiLCJzZXQiLCJpZCIsImFmdGVyIiwicmVzZXQiLCJyZXN0b3JlIiwiZXhlY3V0ZSIsImNhY2hlIiwiZ2V0IiwiaXNVbmRlZmluZWQiLCJoYXMiLCJsZW5ndGgiLCJJTUFHRV9FTEVNRU5UX1BSRUZJWCIsIm5vdEltZ0VsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FB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S0FBSixDQUFiO0FBQ0FULG9CQUFFOEIsV0FBRixDQUFjLG9DQUFpQnJCLElBQWpCLENBQWQsRUFBc0NsRCxNQUF0QyxDQUE2Q3lCLEVBQTdDLENBQWdEQyxJQUFoRDtBQUNELEdBSEMsQ0FBRjtBQUlBZCxFQUFBQSxFQUFFLENBQUMseURBQUQsRUFBNEQsWUFBWTtBQUN4RSxVQUFNK0QsUUFBUSxHQUFJLE1BQUtELDhCQUFxQixFQUE1QztBQUNBLFVBQU14QixJQUFJLEdBQUcsQ0FBQyxDQUFELEVBQUksS0FBSixFQUFXeUIsUUFBWCxDQUFiO0FBQ0FsQyxvQkFBRThCLFdBQUYsQ0FBYyxvQ0FBaUJyQixJQUFqQixDQUFkLEVBQXNDbEQsTUFBdEMsQ0FBNkN5QixFQUE3QyxDQUFnREMsSUFBaEQ7QUFDRCxHQUpDLENBQUY7QUFLRCxDQWZPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgY2hhaUFzUHJvbWlzZWQgZnJvbSAnY2hhaS1hcy1wcm9taXNlZCc7XG5pbXBvcnQgQmFzZURyaXZlciwgeyBJbWFnZUVsZW1lbnQgfSBmcm9tICcuLi8uLic7XG5pbXBvcnQgeyBtYWtlSW1hZ2VFbGVtZW50Q2FjaGUsIGdldEltZ0VsRnJvbUFyZ3MgfSBmcm9tICcuLi8uLi9saWIvYmFzZWRyaXZlci9pbWFnZS1lbGVtZW50JztcbmltcG9ydCB7IElNQUdFX0VMRU1FTlRfUFJFRklYIH0gZnJvbSAnLi4vLi4vbGliL3Byb3RvY29sL3Byb3RvY29sJztcbmltcG9ydCBzaW5vbiBmcm9tICdzaW5vbic7XG5cblxuY2hhaS5zaG91bGQoKTtcbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcblxuXG5jb25zdCBkZWZSZWN0ID0ge3g6IDEwMCwgeTogMTEwLCB3aWR0aDogNTAsIGhlaWdodDogMjV9O1xuY29uc3QgZGVmVGVtcGxhdGUgPSAnaVZCT1Jhc2RmJztcblxuZGVzY3JpYmUoJ0ltYWdlRWxlbWVudCcsIGZ1bmN0aW9uICgpIHtcbiAgY29uc3QgZHJpdmVyID0gbmV3IEJhc2VEcml2ZXIoKTtcblxuICBkZXNjcmliZSgnLnNpemUnLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdGhlIHdpZHRoIGFuZCBoZWlnaHQgb2YgdGhlIGltYWdlIGVsJywgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgZWwgPSBuZXcgSW1hZ2VFbGVtZW50KGRlZlRlbXBsYXRlLCBkZWZSZWN0KTtcbiAgICAgIGVsLnNpemUuc2hvdWxkLmVxbCh7d2lkdGg6IGRlZlJlY3Qud2lkdGgsIGhlaWdodDogZGVmUmVjdC5oZWlnaHR9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJy5sb2NhdGlvbicsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiB0aGUgbG9jYXRpb24gb2YgdGhlIGltYWdlIGVsJywgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgZWwgPSBuZXcgSW1hZ2VFbGVtZW50KGRlZlRlbXBsYXRlLCBkZWZSZWN0KTtcbiAgICAgIGVsLmxvY2F0aW9uLnNob3VsZC5lcWwoe3g6IGRlZlJlY3QueCwgeTogZGVmUmVjdC55fSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCcuY2VudGVyJywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHRoZSBjZW50ZXIgbG9jYXRpb24gb2YgdGhlIGltYWdlIGVsJywgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgZWwgPSBuZXcgSW1hZ2VFbGVtZW50KGRlZlRlbXBsYXRlLCBkZWZSZWN0KTtcbiAgICAgIGVsLmNlbnRlci5zaG91bGQuZXFsKHtcbiAgICAgICAgeDogZGVmUmVjdC54ICsgZGVmUmVjdC53aWR0aCAvIDIsXG4gICAgICAgIHk6IGRlZlJlY3QueSArIGRlZlJlY3QuaGVpZ2h0IC8gMlxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCcuYXNFbGVtZW50JywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgZ2V0IHRoZSB3ZWJkcml2ZXIgb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSBlbGVtZW50JywgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgZWwgPSBuZXcgSW1hZ2VFbGVtZW50KGRlZlRlbXBsYXRlLCBkZWZSZWN0KTtcbiAgICAgIGVsLmFzRWxlbWVudCgnRUxFTUVOVCcpLkVMRU1FTlQuc2hvdWxkLm1hdGNoKC9eYXBwaXVtLWltYWdlLWVsLyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCcuZXF1YWxzJywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgc2F5IHR3byBpbWFnZSBlbGVtZW50cyB3aXRoIHNhbWUgcmVjdCBhcmUgZXF1YWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBlbDEgPSBuZXcgSW1hZ2VFbGVtZW50KCdmb28nLCBkZWZSZWN0KTtcbiAgICAgIGNvbnN0IGVsMiA9IG5ldyBJbWFnZUVsZW1lbnQoJ2JhcicsIGRlZlJlY3QpO1xuICAgICAgZWwxLmVxdWFscyhlbDIpLnNob3VsZC5iZS50cnVlO1xuICAgICAgZWwyLmVxdWFscyhlbDEpLnNob3VsZC5iZS50cnVlO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgc2F5IHR3byBpbWFnZSBlbGVtZW50cyB3aXRoIGRpZmZlcmVudCByZWN0IGFyZSBub3QgZXF1YWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBlbDEgPSBuZXcgSW1hZ2VFbGVtZW50KGRlZlRlbXBsYXRlLCB7Li4uZGVmUmVjdCwgeDogMH0pO1xuICAgICAgY29uc3QgZWwyID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgICBlbDEuZXF1YWxzKGVsMikuc2hvdWxkLmJlLmZhbHNlO1xuICAgICAgZWwyLmVxdWFscyhlbDEpLnNob3VsZC5iZS5mYWxzZTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJy5jbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIHJlamVjdCBhbiBpbnZhbGlkIHRhcCBzdHJhdGVneScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGQgPSBuZXcgQmFzZURyaXZlcigpO1xuICAgICAgY29uc3QgZWwgPSBuZXcgSW1hZ2VFbGVtZW50KGRlZlRlbXBsYXRlLCBkZWZSZWN0KTtcbiAgICAgIGF3YWl0IGQuc2V0dGluZ3MudXBkYXRlKHtpbWFnZUVsZW1lbnRUYXBTdHJhdGVneTogJ2JhZCd9KTtcbiAgICAgIGF3YWl0IGVsLmNsaWNrKGQpLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aCgvSW5jb3JyZWN0IGltYWdlRWxlbWVudFRhcFN0cmF0ZWd5Lyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB0cnkgdG8gY2hlY2sgZm9yIGltYWdlIGVsZW1lbnQgc3RhbGVuZXNzLCBhbmQgdGhyb3cgaWYgc3RhbGUnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBkID0gbmV3IEJhc2VEcml2ZXIoKTtcbiAgICAgIHNpbm9uLnN0dWIoZCwgJ2ZpbmRCeUltYWdlJykudGhyb3dzKCk7XG4gICAgICBjb25zdCBlbCA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QpO1xuICAgICAgLy8gd2UgbmVlZCB0byBjaGVjayBmb3Igc3RhbGVuZXNzIGlmIGV4cGxpY2l0bHkgcmVxdWVzdGVkIHRvIGRvIHNvXG4gICAgICBhd2FpdCBkLnNldHRpbmdzLnVwZGF0ZSh7XG4gICAgICAgIGNoZWNrRm9ySW1hZ2VFbGVtZW50U3RhbGVuZXNzOiB0cnVlLFxuICAgICAgICBhdXRvVXBkYXRlSW1hZ2VFbGVtZW50UG9zaXRpb246IGZhbHNlXG4gICAgICB9KTtcbiAgICAgIGF3YWl0IGVsLmNsaWNrKGQpLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aCgvbm8gbG9uZ2VyIGF0dGFjaGVkLyk7XG5cbiAgICAgIC8vIGFuZCBhbHNvIGlmIHdlIGFyZSB1cGRhdGluZyB0aGUgZWxlbWVudCBwb3NpdGlvblxuICAgICAgYXdhaXQgZC5zZXR0aW5ncy51cGRhdGUoe1xuICAgICAgICBjaGVja0ZvckltYWdlRWxlbWVudFN0YWxlbmVzczogZmFsc2UsXG4gICAgICAgIGF1dG9VcGRhdGVJbWFnZUVsZW1lbnRQb3NpdGlvbjogdHJ1ZVxuICAgICAgfSk7XG4gICAgICBhd2FpdCBlbC5jbGljayhkKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoL25vIGxvbmdlciBhdHRhY2hlZC8pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgYXV0by11cGRhdGUgZWxlbWVudCBwb3NpdGlvbiBpZiByZXF1ZXN0ZWQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBkID0gbmV3IEJhc2VEcml2ZXIoKTtcbiAgICAgIGQucGVyZm9ybUFjdGlvbnMgPSBfLm5vb3A7XG4gICAgICBzaW5vbi5zdHViKGQsICdwZXJmb3JtQWN0aW9ucycpO1xuICAgICAgY29uc3QgZWwgPSBuZXcgSW1hZ2VFbGVtZW50KGRlZlRlbXBsYXRlLCBkZWZSZWN0KTtcbiAgICAgIGNvbnN0IG5ld1JlY3QgPSB7Li4uZGVmUmVjdCwgeDogZGVmUmVjdC54ICsgMTAsIHk6IGRlZlJlY3QueSArIDV9O1xuICAgICAgY29uc3QgZWxQb3MyID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgbmV3UmVjdCk7XG4gICAgICBzaW5vbi5zdHViKGQsICdmaW5kQnlJbWFnZScpLnJldHVybnMoZWxQb3MyKTtcbiAgICAgIGF3YWl0IGQuc2V0dGluZ3MudXBkYXRlKHtcbiAgICAgICAgYXV0b1VwZGF0ZUltYWdlRWxlbWVudFBvc2l0aW9uOiB0cnVlLFxuICAgICAgfSk7XG4gICAgICBlbC5yZWN0LnNob3VsZC5ub3QuZXFsKG5ld1JlY3QpO1xuICAgICAgYXdhaXQgZWwuY2xpY2soZCk7XG4gICAgICBlbC5yZWN0LnNob3VsZC5lcWwobmV3UmVjdCk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB0YXAgdGhlIGNlbnRlciBvZiBhbiBlbGVtZW50IHVzaW5nIHczYyBhY3Rpb25zIGJ5IGRlZmF1bHQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBkID0gbmV3IEJhc2VEcml2ZXIoKTtcbiAgICAgIGQucGVyZm9ybUFjdGlvbnMgPSBfLm5vb3A7XG4gICAgICBjb25zdCBhY3Rpb25TdHViID0gc2lub24uc3R1YihkLCAncGVyZm9ybUFjdGlvbnMnKTtcbiAgICAgIGNvbnN0IGVsID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgICAvLyBza2lwIHRoZSBzdGFsZW5lc3MgY2hlY2sgZm9yIHRoaXMgdGVzdFxuICAgICAgYXdhaXQgZC5zZXR0aW5ncy51cGRhdGUoe1xuICAgICAgICBjaGVja0ZvckltYWdlRWxlbWVudFN0YWxlbmVzczogZmFsc2UsXG4gICAgICB9KTtcbiAgICAgIGF3YWl0IGVsLmNsaWNrKGQpO1xuICAgICAgY29uc3QgcG9pbnRlck1vdmVBY3Rpb24gPSBhY3Rpb25TdHViLmFyZ3NbMF1bMF1bMF0uYWN0aW9uc1swXTtcbiAgICAgIHBvaW50ZXJNb3ZlQWN0aW9uLnguc2hvdWxkLmVxdWFsKGVsLmNlbnRlci54KTtcbiAgICAgIHBvaW50ZXJNb3ZlQWN0aW9uLnkuc2hvdWxkLmVxdWFsKGVsLmNlbnRlci55KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGZhbGwgYmFjayB0byB0b3VjaGFjdGlvbnMgaWYgdzNjIGFjdGlvbnMgZG8gbm90IGV4aXN0IG9uIGRyaXZlcicsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGQgPSBuZXcgQmFzZURyaXZlcigpO1xuICAgICAgZC5wZXJmb3JtVG91Y2ggPSBfLm5vb3A7XG4gICAgICBjb25zdCBhY3Rpb25TdHViID0gc2lub24uc3R1YihkLCAncGVyZm9ybVRvdWNoJyk7XG4gICAgICBjb25zdCBlbCA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QpO1xuICAgICAgLy8gc2tpcCB0aGUgc3RhbGVuZXNzIGNoZWNrIGZvciB0aGlzIHRlc3RcbiAgICAgIGF3YWl0IGQuc2V0dGluZ3MudXBkYXRlKHtcbiAgICAgICAgY2hlY2tGb3JJbWFnZUVsZW1lbnRTdGFsZW5lc3M6IGZhbHNlLFxuICAgICAgfSk7XG4gICAgICBhd2FpdCBlbC5jbGljayhkKTtcbiAgICAgIGNvbnN0IGFjdGlvbiA9IGFjdGlvblN0dWIuYXJnc1swXVswXVswXS5vcHRpb25zO1xuICAgICAgYWN0aW9uLnguc2hvdWxkLmVxdWFsKGVsLmNlbnRlci54KTtcbiAgICAgIGFjdGlvbi55LnNob3VsZC5lcXVhbChlbC5jZW50ZXIueSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB1c2UgdG91Y2hhY3Rpb25zIGlmIHJlcXVlc3RlZCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGQgPSBuZXcgQmFzZURyaXZlcigpO1xuICAgICAgZC5wZXJmb3JtQWN0aW9ucyA9IF8ubm9vcDtcbiAgICAgIGNvbnN0IHczY1N0dWIgPSBzaW5vbi5zdHViKGQsICdwZXJmb3JtQWN0aW9ucycpO1xuICAgICAgZC5wZXJmb3JtVG91Y2ggPSBfLm5vb3A7XG4gICAgICBjb25zdCB0b3VjaFN0dWIgPSBzaW5vbi5zdHViKGQsICdwZXJmb3JtVG91Y2gnKTtcbiAgICAgIGNvbnN0IGVsID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgICAvLyBza2lwIHRoZSBzdGFsZW5lc3MgY2hlY2sgZm9yIHRoaXMgdGVzdFxuICAgICAgYXdhaXQgZC5zZXR0aW5ncy51cGRhdGUoe1xuICAgICAgICBjaGVja0ZvckltYWdlRWxlbWVudFN0YWxlbmVzczogZmFsc2UsXG4gICAgICAgIGltYWdlRWxlbWVudFRhcFN0cmF0ZWd5OiAndG91Y2hBY3Rpb25zJyxcbiAgICAgIH0pO1xuICAgICAgYXdhaXQgZWwuY2xpY2soZCk7XG4gICAgICBjb25zdCBhY3Rpb24gPSB0b3VjaFN0dWIuYXJnc1swXVswXVswXS5vcHRpb25zO1xuICAgICAgYWN0aW9uLnguc2hvdWxkLmVxdWFsKGVsLmNlbnRlci54KTtcbiAgICAgIGFjdGlvbi55LnNob3VsZC5lcXVhbChlbC5jZW50ZXIueSk7XG4gICAgICB3M2NTdHViLmNhbGxDb3VudC5zaG91bGQuZXFsKDApO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgdGhyb3cgaWYgZHJpdmVyIGRvZXMgbm90IGltcGxlbWVudCBhbnkgdHlwZSBvZiBhY3Rpb24nLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBkID0gbmV3IEJhc2VEcml2ZXIoKTtcbiAgICAgIGNvbnN0IGVsID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgICAvLyBza2lwIHRoZSBzdGFsZW5lc3MgY2hlY2sgZm9yIHRoaXMgdGVzdFxuICAgICAgYXdhaXQgZC5zZXR0aW5ncy51cGRhdGUoe1xuICAgICAgICBjaGVja0ZvckltYWdlRWxlbWVudFN0YWxlbmVzczogZmFsc2UsXG4gICAgICB9KTtcbiAgICAgIGF3YWl0IGVsLmNsaWNrKGQpLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aCgvZGlkIG5vdCBpbXBsZW1lbnQvKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJyNleGVjdXRlJywgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IGltZ0VsID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgY29uc3QgY2xpY2tTdHViID0gc2lub24uc3R1YihpbWdFbCwgJ2NsaWNrJyk7XG5cbiAgICBiZWZvcmUoZnVuY3Rpb24gKCkge1xuICAgICAgZHJpdmVyLl9pbWdFbENhY2hlLnNldChpbWdFbC5pZCwgaW1nRWwpO1xuICAgICAgY2xpY2tTdHViLnJldHVybnModHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBhZnRlcihmdW5jdGlvbiAoKSB7XG4gICAgICBkcml2ZXIuX2ltZ0VsQ2FjaGUucmVzZXQoKTtcbiAgICAgIGNsaWNrU3R1Yi5yZXN0b3JlKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBleGVjdXRpb25zIG9uIGVsZW1lbnRzIG5vdCBpbiB0aGUgY2FjaGUnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBhd2FpdCBJbWFnZUVsZW1lbnQuZXhlY3V0ZShkcml2ZXIsICdjbGljaycsICdhcHBpdW0taW1hZ2UtZWxlbWVudC1mb28nKVxuICAgICAgICAuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWRXaXRoKC9lbGVtZW50IGNvdWxkIG5vdCBiZSBsb2NhdGVkLyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCByZWplY3QgZXhlY3V0aW9ucyBmb3IgdW5zdXBwb3J0ZWQgY29tbWFuZHMnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBhd2FpdCBJbWFnZUVsZW1lbnQuZXhlY3V0ZShkcml2ZXIsICdmb29iYXInLCBpbWdFbC5pZClcbiAgICAgICAgLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aCgvbm90IHlldCBiZWVuIGltcGxlbWVudGVkLyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBnZXQgZGlzcGxheWVkIHN0YXR1cyBvZiBlbGVtZW50JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgYXdhaXQgSW1hZ2VFbGVtZW50LmV4ZWN1dGUoZHJpdmVyLCAnZWxlbWVudERpc3BsYXllZCcsIGltZ0VsLmlkKVxuICAgICAgICAuc2hvdWxkLmV2ZW50dWFsbHkuYmUudHJ1ZTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGdldCBzaXplIG9mIGVsZW1lbnQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBhd2FpdCBJbWFnZUVsZW1lbnQuZXhlY3V0ZShkcml2ZXIsICdnZXRTaXplJywgaW1nRWwuaWQpXG4gICAgICAgIC5zaG91bGQuZXZlbnR1YWxseS5lcWwoe3dpZHRoOiBkZWZSZWN0LndpZHRoLCBoZWlnaHQ6IGRlZlJlY3QuaGVpZ2h0fSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBnZXQgbG9jYXRpb24gb2YgZWxlbWVudCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGF3YWl0IEltYWdlRWxlbWVudC5leGVjdXRlKGRyaXZlciwgJ2dldExvY2F0aW9uJywgaW1nRWwuaWQpXG4gICAgICAgIC5zaG91bGQuZXZlbnR1YWxseS5lcWwoe3g6IGRlZlJlY3QueCwgeTogZGVmUmVjdC55fSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBnZXQgbG9jYXRpb24gaW4gdmlldyBvZiBlbGVtZW50JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgYXdhaXQgSW1hZ2VFbGVtZW50LmV4ZWN1dGUoZHJpdmVyLCAnZ2V0TG9jYXRpb24nLCBpbWdFbC5pZClcbiAgICAgICAgLnNob3VsZC5ldmVudHVhbGx5LmVxbCh7eDogZGVmUmVjdC54LCB5OiBkZWZSZWN0Lnl9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGdldCByZWN0IG9mIGVsZW1lbnQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBhd2FpdCBJbWFnZUVsZW1lbnQuZXhlY3V0ZShkcml2ZXIsICdnZXRFbGVtZW50UmVjdCcsIGltZ0VsLmlkKVxuICAgICAgICAuc2hvdWxkLmV2ZW50dWFsbHkuZXFsKGRlZlJlY3QpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgY2xpY2sgZWxlbWVudCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGF3YWl0IEltYWdlRWxlbWVudC5leGVjdXRlKGRyaXZlciwgJ2NsaWNrJywgaW1nRWwuaWQpXG4gICAgICAgIC5zaG91bGQuZXZlbnR1YWxseS5iZS50cnVlO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnaW1hZ2UgZWxlbWVudCBMUlUgY2FjaGUnLCBmdW5jdGlvbiAoKSB7XG4gIGl0KCdzaG91bGQgYWNjZXB0IGFuZCBjYWNoZSBpbWFnZSBlbGVtZW50cycsIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBlbDEgPSBuZXcgSW1hZ2VFbGVtZW50KGRlZlRlbXBsYXRlLCBkZWZSZWN0KTtcbiAgICBjb25zdCBlbDIgPSBuZXcgSW1hZ2VFbGVtZW50KGRlZlRlbXBsYXRlLCBkZWZSZWN0KTtcbiAgICBjb25zdCBjYWNoZSA9IG1ha2VJbWFnZUVsZW1lbnRDYWNoZSgpO1xuICAgIGNhY2hlLnNldChlbDEuaWQsIGVsMSk7XG4gICAgZWwxLmVxdWFscyhjYWNoZS5nZXQoZWwxLmlkKSkuc2hvdWxkLmJlLnRydWU7XG4gICAgXy5pc1VuZGVmaW5lZChjYWNoZS5nZXQoZWwyLmlkKSkuc2hvdWxkLmJlLnRydWU7XG4gICAgY2FjaGUuaGFzKGVsMS5pZCkuc2hvdWxkLmJlLnRydWU7XG4gICAgY2FjaGUuaGFzKGVsMi5pZCkuc2hvdWxkLmJlLmZhbHNlO1xuICB9KTtcbiAgaXQoJ29uY2UgY2FjaGUgcmVhY2hlcyBtYXggc2l6ZSwgc2hvdWxkIGVqZWN0IGltYWdlIGVsZW1lbnRzJywgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IGVsMSA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QpO1xuICAgIGNvbnN0IGVsMiA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QpO1xuICAgIGNvbnN0IGNhY2hlID0gbWFrZUltYWdlRWxlbWVudENhY2hlKGRlZlRlbXBsYXRlLmxlbmd0aCArIDEpO1xuICAgIGNhY2hlLnNldChlbDEuaWQsIGVsMSk7XG4gICAgY2FjaGUuaGFzKGVsMS5pZCkuc2hvdWxkLmJlLnRydWU7XG4gICAgY2FjaGUuc2V0KGVsMi5pZCwgZWwyKTtcbiAgICBjYWNoZS5oYXMoZWwyLmlkKS5zaG91bGQuYmUudHJ1ZTtcbiAgICBjYWNoZS5oYXMoZWwxLmlkKS5zaG91bGQuYmUuZmFsc2U7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdnZXRJbWdFbEZyb21BcmdzJywgZnVuY3Rpb24gKCkge1xuICBpdCgnc2hvdWxkIHJldHVybiB0aGUgaW1hZ2UgZWxlbWVudCBpZCBmcm9tIGpzb24gb2JqIGluIGFyZ3MnLCBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgaW1nRWwgPSBgJHtJTUFHRV9FTEVNRU5UX1BSRUZJWH1mb29gO1xuICAgIGNvbnN0IGFyZ3MgPSBbMSwgJ2ZvbycsIGltZ0VsXTtcbiAgICBnZXRJbWdFbEZyb21BcmdzKGFyZ3MpLnNob3VsZC5lcWwoaW1nRWwpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBub3QgcmV0dXJuIGFueXRoaW5nIGlmIGltYWdlIGVsZW1lbnQgaWQgbm90IGluIGFyZ3MnLCBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgYXJncyA9IFsxLCAnZm9vJ107XG4gICAgXy5pc1VuZGVmaW5lZChnZXRJbWdFbEZyb21BcmdzKGFyZ3MpKS5zaG91bGQuYmUudHJ1ZTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgbm90IGZpbmQgaW1hZ2UgZWxlbWVudCBpZCBpbiBhbnl0aGluZyBidXQgcHJlZml4JywgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IG5vdEltZ0VsID0gYGZvbyR7SU1BR0VfRUxFTUVOVF9QUkVGSVh9YDtcbiAgICBjb25zdCBhcmdzID0gWzEsICdmb28nLCBub3RJbWdFbF07XG4gICAgXy5pc1VuZGVmaW5lZChnZXRJbWdFbEZyb21BcmdzKGFyZ3MpKS5zaG91bGQuYmUudHJ1ZTtcbiAgfSk7XG59KTtcbiJdLCJmaWxlIjoidGVzdC9iYXNlZHJpdmVyL2ltYWdlLWVsZW1lbnQtc3BlY3MuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
