"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _teen_process = require("teen_process");

var _logger = _interopRequireDefault(require("../logger.js"));

var _helpers = require("../helpers.js");

var _appiumSupport = require("appium-support");

var _lodash = _interopRequireDefault(require("lodash"));

var _path = _interopRequireDefault(require("path"));

var _xmldom = _interopRequireDefault(require("xmldom"));

var _xpath = _interopRequireDefault(require("xpath"));

var _shellQuote = require("shell-quote");

let manifestMethods = {};

manifestMethods.processFromManifest = function () {
  var _processFromManifest = (0, _asyncToGenerator2.default)(function* (localApk) {
    yield this.initAapt();

    _logger.default.info('Retrieving process from manifest');

    let args = ['dump', 'xmltree', localApk, 'AndroidManifest.xml'];

    let _ref = yield (0, _teen_process.exec)(this.binaries.aapt, args),
        stdout = _ref.stdout;

    let result = null;
    let lines = stdout.split('\n');
    let applicationRegex = new RegExp(/\s+E: application \(line=\d+\).*/);
    let applicationFound = false;
    let attributeRegex = new RegExp(/\s+A: .+/);
    let processRegex = new RegExp(/\s+A: android:process\(0x01010011\)="([^"]+).*"/);
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = lines[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        let line = _step.value;

        if (!applicationFound) {
          if (applicationRegex.test(line)) {
            applicationFound = true;
          }
        } else {
          let notAttribute = !attributeRegex.test(line);

          if (notAttribute) {
            break;
          }

          let process = processRegex.exec(line);

          if (process && process.length > 1) {
            result = process[1];

            if (result.length > 15) {
              result = result.substr(result.length - 15);
            }

            break;
          }
        }
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator.return != null) {
          _iterator.return();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }

    return result;
  });

  return function processFromManifest(_x) {
    return _processFromManifest.apply(this, arguments);
  };
}();

function extractApkInfoWithApkTools(_x2, _x3, _x4, _x5) {
  return _extractApkInfoWithApkTools.apply(this, arguments);
}

function _extractApkInfoWithApkTools() {
  _extractApkInfoWithApkTools = (0, _asyncToGenerator2.default)(function* (localApk, aaptPath, jarPath, tmpRoot) {
    _logger.default.info('Extracting package and launch activity from manifest');

    let args = ['dump', 'badging', localApk];
    let stdout = (yield (0, _teen_process.exec)(aaptPath, args)).stdout;
    let apkPackage = new RegExp(/package: name='([^']+)'/g).exec(stdout);

    if (!apkPackage || apkPackage.length < 2) {
      throw new Error(`Cannot parse package name from ` + `'${_lodash.default.join([aaptPath, 'dump', 'badging', '"' + localApk + '"'], ' ')}' command  output`);
    }

    apkPackage = apkPackage[1];
    let apkActivity = new RegExp(/launchable-activity: name='([^']+)'/g).exec(stdout);

    if (apkActivity && apkActivity.length >= 2) {
      apkActivity = apkActivity[1];
      return {
        apkPackage,
        apkActivity
      };
    }

    let outputPath = _path.default.resolve(tmpRoot, apkPackage);

    let getLaunchActivity = ['-jar', jarPath, 'printLaunchActivity', localApk, outputPath];
    const output = yield (0, _teen_process.exec)('java', getLaunchActivity);

    if (output.stderr) {
      throw new Error(`Cannot parse launchActivity from manifest: ${output.stderr}`);
    }

    stdout = output.stdout;
    let act = new RegExp(/Launch activity parsed:([^']+)/g).exec(stdout);

    if (act && act.length >= 2) {
      apkActivity = act[1];
      return {
        apkPackage,
        apkActivity
      };
    }

    throw new Error(`Cannot parse main activity name from '${stdout}' command  output`);
  });
  return _extractApkInfoWithApkTools.apply(this, arguments);
}

function extractApkInfoWithApkanalyzer(_x6, _x7) {
  return _extractApkInfoWithApkanalyzer.apply(this, arguments);
}

function _extractApkInfoWithApkanalyzer() {
  _extractApkInfoWithApkanalyzer = (0, _asyncToGenerator2.default)(function* (localApk, apkanalyzerPath) {
    const args = ['-h', 'manifest', 'print', localApk];

    _logger.default.debug(`Starting '${apkanalyzerPath}' with args ${JSON.stringify(args)}`);

    const manifestXml = (yield (0, _teen_process.exec)(apkanalyzerPath, args, {
      shell: true,
      cwd: _path.default.dirname(apkanalyzerPath)
    })).stdout;
    const doc = new _xmldom.default.DOMParser().parseFromString(manifestXml);

    const apkPackageAttribute = _xpath.default.select1('//manifest/@package', doc);

    if (!apkPackageAttribute) {
      throw new Error(`Cannot parse package name from ${manifestXml}`);
    }

    const apkPackage = apkPackageAttribute.value;

    const apkActivityAttribute = _xpath.default.select1("//application/*[starts-with(name(), 'activity') " + "and .//action[@*[local-name()='name' and .='android.intent.action.MAIN']] " + "and .//category[@*[local-name()='name' and .='android.intent.category.LAUNCHER']]]" + "/@*[local-name()='name']", doc);

    if (!apkActivityAttribute) {
      throw new Error(`Cannot parse main activity name from ${manifestXml}`);
    }

    const apkActivity = apkActivityAttribute.value;
    return {
      apkPackage,
      apkActivity
    };
  });
  return _extractApkInfoWithApkanalyzer.apply(this, arguments);
}

manifestMethods.packageAndLaunchActivityFromManifest = function () {
  var _packageAndLaunchActivityFromManifest = (0, _asyncToGenerator2.default)(function* (appPath) {
    var _this = this;

    if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
      appPath = yield this.extractBaseApk(appPath);
    }

    const apkInfoGetters = [(0, _asyncToGenerator2.default)(function* () {
      const apkanalyzerPath = yield (0, _helpers.getApkanalyzerForOs)(_this);
      return yield extractApkInfoWithApkanalyzer(appPath, apkanalyzerPath);
    }), (0, _asyncToGenerator2.default)(function* () {
      yield _this.initAapt();
      return yield extractApkInfoWithApkTools(appPath, _this.binaries.aapt, _this.jars['appium_apk_tools.jar'], _this.tmpDir);
    })];
    let savedError;

    for (var _i = 0; _i < apkInfoGetters.length; _i++) {
      const infoGetter = apkInfoGetters[_i];

      try {
        const _ref4 = yield infoGetter(),
              apkPackage = _ref4.apkPackage,
              apkActivity = _ref4.apkActivity;

        _logger.default.info(`Package name: '${apkPackage}'`);

        _logger.default.info(`Main activity name: '${apkActivity}'`);

        return {
          apkPackage,
          apkActivity
        };
      } catch (e) {
        if (infoGetter !== _lodash.default.last(apkInfoGetters)) {
          _logger.default.info(`Using the alternative activity name detection method because of: ${e.message}`);
        }

        savedError = e;
      }
    }

    throw new Error(`packageAndLaunchActivityFromManifest failed. Original error: ${savedError.message}` + (savedError.stderr ? `; StdErr: ${savedError.stderr}` : ''));
  });

  return function packageAndLaunchActivityFromManifest(_x8) {
    return _packageAndLaunchActivityFromManifest.apply(this, arguments);
  };
}();

manifestMethods.targetSdkVersionFromManifest = function () {
  var _targetSdkVersionFromManifest = (0, _asyncToGenerator2.default)(function* (appPath) {
    yield this.initAapt();

    if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
      appPath = yield this.extractBaseApk(appPath);
    }

    _logger.default.info('Extracting package and launch activity from manifest');

    let args = ['dump', 'badging', appPath];
    let output;

    try {
      let _ref5 = yield (0, _teen_process.exec)(this.binaries.aapt, args),
          stdout = _ref5.stdout;

      output = stdout;
    } catch (e) {
      throw new Error(`fetching targetSdkVersion from local APK failed. Original error: ${e.message}`);
    }

    let targetSdkVersion = new RegExp(/targetSdkVersion:'([^']+)'/g).exec(output);

    if (!targetSdkVersion) {
      throw new Error(`targetSdkVersion is not specified in the application.`);
    }

    return parseInt(targetSdkVersion[1], 10);
  });

  return function targetSdkVersionFromManifest(_x9) {
    return _targetSdkVersionFromManifest.apply(this, arguments);
  };
}();

manifestMethods.targetSdkVersionUsingPKG = function () {
  var _targetSdkVersionUsingPKG = (0, _asyncToGenerator2.default)(function* (pkg, cmdOutput = null) {
    let stdout = cmdOutput || (yield this.shell(['dumpsys', 'package', pkg]));
    let targetSdkVersion = new RegExp(/targetSdk=([^\s\s]+)/g).exec(stdout);

    if (targetSdkVersion && targetSdkVersion.length >= 2) {
      targetSdkVersion = targetSdkVersion[1];
    } else {
      targetSdkVersion = 0;
    }

    return parseInt(targetSdkVersion, 10);
  });

  return function targetSdkVersionUsingPKG(_x10) {
    return _targetSdkVersionUsingPKG.apply(this, arguments);
  };
}();

manifestMethods.compileManifest = function () {
  var _compileManifest = (0, _asyncToGenerator2.default)(function* (manifest, manifestPackage, targetPackage) {
    const _ref6 = yield (0, _helpers.getAndroidPlatformAndPath)(),
          platform = _ref6.platform,
          platformPath = _ref6.platformPath;

    if (!platform) {
      throw new Error('Cannot compile the manifest. The required platform does not exist (API level >= 17)');
    }

    const resultPath = `${manifest}.apk`;
    const args = ['package', '-M', manifest, '--rename-manifest-package', manifestPackage, '--rename-instrumentation-target-package', targetPackage, '-I', _path.default.resolve(platformPath, 'android.jar'), '-F', resultPath, '-f'];

    try {
      yield this.initAapt();

      _logger.default.debug(`Compiling the manifest: ${this.binaries.aapt} ${(0, _shellQuote.quote)(args)}`);

      yield (0, _teen_process.exec)(this.binaries.aapt, args);

      _logger.default.debug(`Compiled the manifest at '${resultPath}'`);
    } catch (err) {
      throw new Error(`Cannot compile the manifest. Original error: ${err.message}`);
    }
  });

  return function compileManifest(_x11, _x12, _x13) {
    return _compileManifest.apply(this, arguments);
  };
}();

manifestMethods.insertManifest = function () {
  var _insertManifest = (0, _asyncToGenerator2.default)(function* (manifest, srcApk, dstApk) {
    _logger.default.debug(`Inserting manifest, src: ${srcApk} dst: ${dstApk}`);

    yield this.initAapt();
    yield (0, _helpers.unzipFile)(`${manifest}.apk`);
    yield _appiumSupport.fs.copyFile(srcApk, dstApk);

    _logger.default.debug('Testing new tmp apk');

    yield _appiumSupport.zip.assertValidZip(dstApk);

    _logger.default.debug('Moving manifest');

    try {
      yield (0, _teen_process.exec)(this.binaries.aapt, ['remove', dstApk, _path.default.basename(manifest)]);
    } catch (ign) {}

    yield (0, _teen_process.exec)(this.binaries.aapt, ['add', dstApk, _path.default.basename(manifest)], {
      cwd: _path.default.dirname(manifest)
    });

    _logger.default.debug('Inserted manifest.');
  });

  return function insertManifest(_x14, _x15, _x16) {
    return _insertManifest.apply(this, arguments);
  };
}();

manifestMethods.hasInternetPermissionFromManifest = function () {
  var _hasInternetPermissionFromManifest = (0, _asyncToGenerator2.default)(function* (appPath) {
    yield this.initAapt();

    if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
      appPath = yield this.extractBaseApk(appPath);
    }

    _logger.default.debug(`Checking if '${appPath}' requires internet access permission in the manifest`);

    try {
      let _ref7 = yield (0, _teen_process.exec)(this.binaries.aapt, ['dump', 'badging', appPath]),
          stdout = _ref7.stdout;

      return new RegExp(/uses-permission:.*'android.permission.INTERNET'/).test(stdout);
    } catch (e) {
      throw new Error(`Cannot check if '${appPath}' requires internet access permission. ` + `Original error: ${e.message}`);
    }
  });

  return function hasInternetPermissionFromManifest(_x17) {
    return _hasInternetPermissionFromManifest.apply(this, arguments);
  };
}();

manifestMethods.printManifestFromApk = function () {
  var _printManifestFromApk = (0, _asyncToGenerator2.default)(function* (appPath, logLevel = 'debug') {
    yield this.initAapt();

    if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
      appPath = yield this.extractBaseApk(appPath);
    }

    _logger.default[logLevel](`Extracting the manifest from '${appPath}'`);

    let out = false;

    const _ref8 = yield (0, _teen_process.exec)(this.binaries.aapt, ['l', '-a', appPath]),
          stdout = _ref8.stdout;

    var _iteratorNormalCompletion2 = true;
    var _didIteratorError2 = false;
    var _iteratorError2 = undefined;

    try {
      for (var _iterator2 = stdout.split('\n')[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
        const line = _step2.value;

        if (!out && line.includes('Android manifest:')) {
          out = true;
        }

        if (out) {
          _logger.default[logLevel](line);
        }
      }
    } catch (err) {
      _didIteratorError2 = true;
      _iteratorError2 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion2 && _iterator2.return != null) {
          _iterator2.return();
        }
      } finally {
        if (_didIteratorError2) {
          throw _iteratorError2;
        }
      }
    }
  });

  return function printManifestFromApk(_x18) {
    return _printManifestFromApk.apply(this, arguments);
  };
}();

var _default = manifestMethods;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi90b29scy9hbmRyb2lkLW1hbmlmZXN0LmpzIl0sIm5hbWVzIjpbIm1hbmlmZXN0TWV0aG9kcyIsInByb2Nlc3NGcm9tTWFuaWZlc3QiLCJsb2NhbEFwayIsImluaXRBYXB0IiwibG9nIiwiaW5mbyIsImFyZ3MiLCJiaW5hcmllcyIsImFhcHQiLCJzdGRvdXQiLCJyZXN1bHQiLCJsaW5lcyIsInNwbGl0IiwiYXBwbGljYXRpb25SZWdleCIsIlJlZ0V4cCIsImFwcGxpY2F0aW9uRm91bmQiLCJhdHRyaWJ1dGVSZWdleCIsInByb2Nlc3NSZWdleCIsImxpbmUiLCJ0ZXN0Iiwibm90QXR0cmlidXRlIiwicHJvY2VzcyIsImV4ZWMiLCJsZW5ndGgiLCJzdWJzdHIiLCJleHRyYWN0QXBrSW5mb1dpdGhBcGtUb29scyIsImFhcHRQYXRoIiwiamFyUGF0aCIsInRtcFJvb3QiLCJhcGtQYWNrYWdlIiwiRXJyb3IiLCJfIiwiam9pbiIsImFwa0FjdGl2aXR5Iiwib3V0cHV0UGF0aCIsInBhdGgiLCJyZXNvbHZlIiwiZ2V0TGF1bmNoQWN0aXZpdHkiLCJvdXRwdXQiLCJzdGRlcnIiLCJhY3QiLCJleHRyYWN0QXBrSW5mb1dpdGhBcGthbmFseXplciIsImFwa2FuYWx5emVyUGF0aCIsImRlYnVnIiwiSlNPTiIsInN0cmluZ2lmeSIsIm1hbmlmZXN0WG1sIiwic2hlbGwiLCJjd2QiLCJkaXJuYW1lIiwiZG9jIiwieG1sZG9tIiwiRE9NUGFyc2VyIiwicGFyc2VGcm9tU3RyaW5nIiwiYXBrUGFja2FnZUF0dHJpYnV0ZSIsInhwYXRoIiwic2VsZWN0MSIsInZhbHVlIiwiYXBrQWN0aXZpdHlBdHRyaWJ1dGUiLCJwYWNrYWdlQW5kTGF1bmNoQWN0aXZpdHlGcm9tTWFuaWZlc3QiLCJhcHBQYXRoIiwiZW5kc1dpdGgiLCJBUEtTX0VYVEVOU0lPTiIsImV4dHJhY3RCYXNlQXBrIiwiYXBrSW5mb0dldHRlcnMiLCJqYXJzIiwidG1wRGlyIiwic2F2ZWRFcnJvciIsImluZm9HZXR0ZXIiLCJlIiwibGFzdCIsIm1lc3NhZ2UiLCJ0YXJnZXRTZGtWZXJzaW9uRnJvbU1hbmlmZXN0IiwidGFyZ2V0U2RrVmVyc2lvbiIsInBhcnNlSW50IiwidGFyZ2V0U2RrVmVyc2lvblVzaW5nUEtHIiwicGtnIiwiY21kT3V0cHV0IiwiY29tcGlsZU1hbmlmZXN0IiwibWFuaWZlc3QiLCJtYW5pZmVzdFBhY2thZ2UiLCJ0YXJnZXRQYWNrYWdlIiwicGxhdGZvcm0iLCJwbGF0Zm9ybVBhdGgiLCJyZXN1bHRQYXRoIiwiZXJyIiwiaW5zZXJ0TWFuaWZlc3QiLCJzcmNBcGsiLCJkc3RBcGsiLCJmcyIsImNvcHlGaWxlIiwiemlwIiwiYXNzZXJ0VmFsaWRaaXAiLCJiYXNlbmFtZSIsImlnbiIsImhhc0ludGVybmV0UGVybWlzc2lvbkZyb21NYW5pZmVzdCIsInByaW50TWFuaWZlc3RGcm9tQXBrIiwibG9nTGV2ZWwiLCJvdXQiLCJpbmNsdWRlcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFHQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxJQUFJQSxlQUFlLEdBQUcsRUFBdEI7O0FBTUFBLGVBQWUsQ0FBQ0MsbUJBQWhCO0FBQUEsNkRBQXNDLFdBQW9DQyxRQUFwQyxFQUE4QztBQUNsRixVQUFNLEtBQUtDLFFBQUwsRUFBTjs7QUFDQUMsb0JBQUlDLElBQUosQ0FBUyxrQ0FBVDs7QUFDQSxRQUFJQyxJQUFJLEdBQUcsQ0FBQyxNQUFELEVBQVMsU0FBVCxFQUFvQkosUUFBcEIsRUFBOEIscUJBQTlCLENBQVg7O0FBSGtGLHFCQUk3RCx3QkFBSyxLQUFLSyxRQUFMLENBQWNDLElBQW5CLEVBQXlCRixJQUF6QixDQUo2RDtBQUFBLFFBSTdFRyxNQUo2RSxRQUk3RUEsTUFKNkU7O0FBS2xGLFFBQUlDLE1BQU0sR0FBRyxJQUFiO0FBQ0EsUUFBSUMsS0FBSyxHQUFHRixNQUFNLENBQUNHLEtBQVAsQ0FBYSxJQUFiLENBQVo7QUFDQSxRQUFJQyxnQkFB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QUFBLDhEQUF1QyxXQUFxQ3BDLE9BQXJDLEVBQThDcUMsUUFBUSxHQUFHLE9BQXpELEVBQWtFO0FBQ3ZHLFVBQU0sS0FBSzlGLFFBQUwsRUFBTjs7QUFFQSxRQUFJeUQsT0FBTyxDQUFDQyxRQUFSLENBQWlCQyx1QkFBakIsQ0FBSixFQUFzQztBQUNwQ0YsTUFBQUEsT0FBTyxTQUFTLEtBQUtHLGNBQUwsQ0FBb0JILE9BQXBCLENBQWhCO0FBQ0Q7O0FBRUR4RCxvQkFBSTZGLFFBQUosRUFBZSxpQ0FBZ0NyQyxPQUFRLEdBQXZEOztBQUNBLFFBQUlzQyxHQUFHLEdBQUcsS0FBVjs7QUFSdUcsd0JBU2hGLHdCQUFLLEtBQUszRixRQUFMLENBQWNDLElBQW5CLEVBQXlCLENBQUMsR0FBRCxFQUFNLElBQU4sRUFBWW9ELE9BQVosQ0FBekIsQ0FUZ0Y7QUFBQSxVQVNoR25ELE1BVGdHLFNBU2hHQSxNQVRnRzs7QUFBQTtBQUFBO0FBQUE7O0FBQUE7QUFVdkcsNEJBQW1CQSxNQUFNLENBQUNHLEtBQVAsQ0FBYSxJQUFiLENBQW5CLG1JQUF1QztBQUFBLGNBQTVCTSxJQUE0Qjs7QUFDckMsWUFBSSxDQUFDZ0YsR0FBRCxJQUFRaEYsSUFBSSxDQUFDaUYsUUFBTCxDQUFjLG1CQUFkLENBQVosRUFBZ0Q7QUFDOUNELFVBQUFBLEdBQUcsR0FBRyxJQUFOO0FBQ0Q7O0FBQ0QsWUFBSUEsR0FBSixFQUFTO0FBQ1A5RiwwQkFBSTZGLFFBQUosRUFBYy9FLElBQWQ7QUFDRDtBQUNGO0FBakJzRztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBa0J4RyxHQWxCRDs7QUFBQSxrQkFBc0Q4RSxvQkFBdEQ7QUFBQTtBQUFBO0FBQUE7O2VBcUJlaEcsZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGV4ZWMgfSBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuaW1wb3J0IGxvZyBmcm9tICcuLi9sb2dnZXIuanMnO1xuaW1wb3J0IHtcbiAgZ2V0QW5kcm9pZFBsYXRmb3JtQW5kUGF0aCwgdW56aXBGaWxlLFxuICBnZXRBcGthbmFseXplckZvck9zLCBBUEtTX0VYVEVOU0lPTiB9IGZyb20gJy4uL2hlbHBlcnMuanMnO1xuaW1wb3J0IHsgZnMsIHppcCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB4bWxkb20gZnJvbSAneG1sZG9tJztcbmltcG9ydCB4cGF0aCBmcm9tICd4cGF0aCc7XG5pbXBvcnQgeyBxdW90ZSB9IGZyb20gJ3NoZWxsLXF1b3RlJztcblxubGV0IG1hbmlmZXN0TWV0aG9kcyA9IHt9O1xuXG4vLyBhbmRyb2lkOnByb2Nlc3M9IG1heSBiZSBkZWZpbmVkIGluIEFuZHJvaWRNYW5pZmVzdC54bWxcbi8vIGh0dHA6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vcmVmZXJlbmNlL2FuZHJvaWQvUi5hdHRyLmh0bWwjcHJvY2Vzc1xuLy8gbm90ZSB0aGF0IHRoZSBwcm9jZXNzIG5hbWUgd2hlbiB1c2VkIHdpdGggcHMgbXVzdCBiZSB0cnVuY2F0ZWQgdG8gdGhlIGxhc3QgMTUgY2hhcnNcbi8vIHBzIC1jIGNvbS5leGFtcGxlLmFuZHJvaWQuYXBpcyBiZWNvbWVzIHBzIC1jIGxlLmFuZHJvaWQuYXBpc1xubWFuaWZlc3RNZXRob2RzLnByb2Nlc3NGcm9tTWFuaWZlc3QgPSBhc3luYyBmdW5jdGlvbiBwcm9jZXNzRnJvbU1hbmlmZXN0IChsb2NhbEFwaykge1xuICBhd2FpdCB0aGlzLmluaXRBYXB0KCk7XG4gIGxvZy5pbmZvKCdSZXRyaWV2aW5nIHByb2Nlc3MgZnJvbSBtYW5pZmVzdCcpO1xuICBsZXQgYXJncyA9IFsnZHVtcCcsICd4bWx0cmVlJywgbG9jYWxBcGssICdBbmRyb2lkTWFuaWZlc3QueG1sJ107XG4gIGxldCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWModGhpcy5iaW5hcmllcy5hYXB0LCBhcmdzKTtcbiAgbGV0IHJlc3VsdCA9IG51bGw7XG4gIGxldCBsaW5lcyA9IHN0ZG91dC5zcGxpdCgnXFxuJyk7XG4gIGxldCBhcHBsaWNhdGlvblJlZ2V4ID0gbmV3IFJlZ0V4cCgvXFxzK0U6IGFwcGxpY2F0aW9uIFxcKGxpbmU9XFxkK1xcKS4qLyk7XG4gIGxldCBhcHBsaWNhdGlvbkZvdW5kID0gZmFsc2U7XG4gIGxldCBhdHRyaWJ1dGVSZWdleCA9IG5ldyBSZWdFeHAoL1xccytBOiAuKy8pO1xuICBsZXQgcHJvY2Vzc1JlZ2V4ID0gbmV3IFJlZ0V4cCgvXFxzK0E6IGFuZHJvaWQ6cHJvY2Vzc1xcKDB4MDEwMTAwMTFcXCk9XCIoW15cIl0rKS4qXCIvKTtcbiAgZm9yIChsZXQgbGluZSBvZiBsaW5lcykge1xuICAgIGlmICghYXBwbGljYXRpb25Gb3VuZCkge1xuICAgICAgaWYgKGFwcGxpY2F0aW9uUmVnZXgudGVzdChsaW5lKSkge1xuICAgICAgICBhcHBsaWNhdGlvbkZvdW5kID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IG5vdEF0dHJpYnV0ZSA9ICFhdHRyaWJ1dGVSZWdleC50ZXN0KGxpbmUpO1xuICAgICAgLy8gcHJvY2VzcyBtdXN0IGJlIGFuIGF0dHJpYnV0ZSBhZnRlciBhcHBsaWNhdGlvbi5cbiAgICAgIGlmIChub3RBdHRyaWJ1dGUpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBsZXQgcHJvY2VzcyA9IHByb2Nlc3NSZWdleC5leGVjKGxpbmUpO1xuICAgICAgLy8gdGhpcyBpcyBhbiBhcHBsaWNhdGlvbiBhdHRyaWJ1dGUgcHJvY2Vzcy5cbiAgICAgIGlmIChwcm9jZXNzICYmIHByb2Nlc3MubGVuZ3RoID4gMSkge1xuICAgICAgICByZXN1bHQgPSBwcm9jZXNzWzFdO1xuICAgICAgICAvLyBtdXN0IHRyaW0gdG8gbGFzdCAxNSBmb3IgYW5kcm9pZCdzIHBzIGJpbmFyeVxuICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCA+IDE1KSB7XG4gICAgICAgICAgcmVzdWx0ID0gcmVzdWx0LnN1YnN0cihyZXN1bHQubGVuZ3RoIC0gMTUpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBBUEtJbmZvXG4gKiBAcHJvcGVydHkge3N0cmluZ30gYXBrUGFja2FnZSAtIFRoZSBuYW1lIG9mIGFwcGxpY2F0aW9uIHBhY2thZ2UsIGZvciBleGFtcGxlICdjb20uYWNtZS5hcHAnLlxuICogQHByb3BlcnR5IHtzdHJpbmd9IGFwa0FjdGl2aXR5IC0gVGhlIG5hbWUgb2YgbWFpbiBhcHBsaWNhdGlvbiBhY3Rpdml0eS5cbiAqL1xuXG4vKipcbiAqIEV4dHJhY3QgcGFja2FnZSBhbmQgbWFpbiBhY3Rpdml0eSBuYW1lIGZyb20gYXBwbGljYXRpb24gbWFuaWZlc3QgdXNpbmdcbiAqIHRoZSBjdXN0b20gYXBrIHRvb2xzLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBsb2NhbEFwayAtIFRoZSBmdWxsIHBhdGggdG8gYXBwbGljYXRpb24gcGFja2FnZS5cbiAqIEBwYXJhbSB7c3RyaW5nfSBhYXB0UGF0aCAtIFRoZSBmdWxsIHBhdGggdG8gYXBwdCBiaW5hcnkuXG4gKiBAcGFyYW0ge3N0cmluZ30gamFyUGF0aCAtIFRoZSBmdWxsIHBhdGggdG8gYXBwaXVtX2Fwa190b29scy5qYXIgdXRpbGl0eVxuICogQHBhcmFtIHtzdHJpbmd9IHRtcFJvb3QgLSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBjbGFzcy13aWRlIHRlbXBvcmFyeSBmb2xkZXIuXG4gKiBAcmV0dXJuIHtBUEtJbmZvfSBUaGUgcGFyc2VkIGFwcGxpY2F0aW9uIGluZm8uXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgd2FzIGFuIGVycm9yIHdoaWxlIGdldHRpbmcgdGhlIGRhdGEgZnJvbSB0aGUgZ2l2ZW5cbiAqICAgICAgICAgICAgICAgICBhcHBsaWNhdGlvbiBwYWNrYWdlLlxuICovXG5hc3luYyBmdW5jdGlvbiBleHRyYWN0QXBrSW5mb1dpdGhBcGtUb29scyAobG9jYWxBcGssIGFhcHRQYXRoLCBqYXJQYXRoLCB0bXBSb290KSB7XG4gIGxvZy5pbmZvKCdFeHRyYWN0aW5nIHBhY2thZ2UgYW5kIGxhdW5jaCBhY3Rpdml0eSBmcm9tIG1hbmlmZXN0Jyk7XG4gIGxldCBhcmdzID0gWydkdW1wJywgJ2JhZGdpbmcnLCBsb2NhbEFwa107XG4gIGxldCBzdGRvdXQgPSAoYXdhaXQgZXhlYyhhYXB0UGF0aCwgYXJncykpLnN0ZG91dDtcbiAgbGV0IGFwa1BhY2thZ2UgPSBuZXcgUmVnRXhwKC9wYWNrYWdlOiBuYW1lPScoW14nXSspJy9nKS5leGVjKHN0ZG91dCk7XG4gIGlmICghYXBrUGFja2FnZSB8fCBhcGtQYWNrYWdlLmxlbmd0aCA8IDIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBwYXJzZSBwYWNrYWdlIG5hbWUgZnJvbSBgICtcbiAgICAgIGAnJHtfLmpvaW4oW2FhcHRQYXRoLCAnZHVtcCcsICdiYWRnaW5nJywgJ1wiJyArIGxvY2FsQXBrICsgJ1wiJ10sICcgJyl9JyBjb21tYW5kICBvdXRwdXRgKTtcbiAgfVxuICBhcGtQYWNrYWdlID0gYXBrUGFja2FnZVsxXTtcbiAgbGV0IGFwa0FjdGl2aXR5ID0gbmV3IFJlZ0V4cCgvbGF1bmNoYWJsZS1hY3Rpdml0eTogbmFtZT0nKFteJ10rKScvZykuZXhlYyhzdGRvdXQpO1xuICBpZiAoYXBrQWN0aXZpdHkgJiYgYXBrQWN0aXZpdHkubGVuZ3RoID49IDIpIHtcbiAgICBhcGtBY3Rpdml0eSA9IGFwa0FjdGl2aXR5WzFdO1xuICAgIHJldHVybiB7YXBrUGFja2FnZSwgYXBrQWN0aXZpdHl9O1xuICB9XG5cbiAgbGV0IG91dHB1dFBhdGggPSBwYXRoLnJlc29sdmUodG1wUm9vdCwgYXBrUGFja2FnZSk7XG4gIGxldCBnZXRMYXVuY2hBY3Rpdml0eSA9IFtcbiAgICAnLWphcicsIGphclBhdGgsXG4gICAgJ3ByaW50TGF1bmNoQWN0aXZpdHknLCBsb2NhbEFwayxcbiAgICBvdXRwdXRQYXRoXG4gIF07XG4gIGNvbnN0IG91dHB1dCA9IGF3YWl0IGV4ZWMoJ2phdmEnLCBnZXRMYXVuY2hBY3Rpdml0eSk7XG4gIGlmIChvdXRwdXQuc3RkZXJyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgcGFyc2UgbGF1bmNoQWN0aXZpdHkgZnJvbSBtYW5pZmVzdDogJHtvdXRwdXQuc3RkZXJyfWApO1xuICB9XG4gIHN0ZG91dCA9IG91dHB1dC5zdGRvdXQ7XG4gIGxldCBhY3QgPSBuZXcgUmVnRXhwKC9MYXVuY2ggYWN0aXZpdHkgcGFyc2VkOihbXiddKykvZykuZXhlYyhzdGRvdXQpO1xuICBpZiAoYWN0ICYmIGFjdC5sZW5ndGggPj0gMikge1xuICAgIGFwa0FjdGl2aXR5ID0gYWN0WzFdO1xuICAgIHJldHVybiB7YXBrUGFja2FnZSwgYXBrQWN0aXZpdHl9O1xuICB9XG4gIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IHBhcnNlIG1haW4gYWN0aXZpdHkgbmFtZSBmcm9tICcke3N0ZG91dH0nIGNvbW1hbmQgIG91dHB1dGApO1xufVxuXG4vKipcbiAqIEV4dHJhY3QgcGFja2FnZSBhbmQgbWFpbiBhY3Rpdml0eSBuYW1lIGZyb20gYXBwbGljYXRpb24gbWFuaWZlc3QgdXNpbmdcbiAqIGFwa2FuYWx5emVyIHRvb2wuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGxvY2FsQXBrIC0gVGhlIGZ1bGwgcGF0aCB0byBhcHBsaWNhdGlvbiBwYWNrYWdlLlxuICogQHBhcmFtIHtzdHJpbmd9IGFwa2FuYWx5emVyUGF0aCAtIFRoZSBmdWxsIHBhdGggdG8gYXBrYW5hbHl6ZXIgdG9vbC5cbiAqIEByZXR1cm4ge0FQS0luZm99IFRoZSBwYXJzZWQgYXBwbGljYXRpb24gaW5mby5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgZ2V0dGluZyB0aGUgZGF0YSBmcm9tIHRoZSBnaXZlblxuICogICAgICAgICAgICAgICAgIGFwcGxpY2F0aW9uIHBhY2thZ2Ugb3IgaWYgdGhlIHRvb2wgaXRzZWxmXG4gKiAgICAgICAgICAgICAgICAgaXMgbm90IHByZXNlbnQgb24gdGhlIGxvY2FsIGZpbGUgc3lzdGVtLlxuICovXG5hc3luYyBmdW5jdGlvbiBleHRyYWN0QXBrSW5mb1dpdGhBcGthbmFseXplciAobG9jYWxBcGssIGFwa2FuYWx5emVyUGF0aCkge1xuICBjb25zdCBhcmdzID0gWyctaCcsICdtYW5pZmVzdCcsICdwcmludCcsIGxvY2FsQXBrXTtcbiAgbG9nLmRlYnVnKGBTdGFydGluZyAnJHthcGthbmFseXplclBhdGh9JyB3aXRoIGFyZ3MgJHtKU09OLnN0cmluZ2lmeShhcmdzKX1gKTtcbiAgY29uc3QgbWFuaWZlc3RYbWwgPSAoYXdhaXQgZXhlYyhhcGthbmFseXplclBhdGgsIGFyZ3MsIHtcbiAgICBzaGVsbDogdHJ1ZSxcbiAgICBjd2Q6IHBhdGguZGlybmFtZShhcGthbmFseXplclBhdGgpXG4gIH0pKS5zdGRvdXQ7XG4gIGNvbnN0IGRvYyA9IG5ldyB4bWxkb20uRE9NUGFyc2VyKCkucGFyc2VGcm9tU3RyaW5nKG1hbmlmZXN0WG1sKTtcbiAgY29uc3QgYXBrUGFja2FnZUF0dHJpYnV0ZSA9IHhwYXRoLnNlbGVjdDEoJy8vbWFuaWZlc3QvQHBhY2thZ2UnLCBkb2MpO1xuICBpZiAoIWFwa1BhY2thZ2VBdHRyaWJ1dGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBwYXJzZSBwYWNrYWdlIG5hbWUgZnJvbSAke21hbmlmZXN0WG1sfWApO1xuICB9XG4gIGNvbnN0IGFwa1BhY2thZ2UgPSBhcGtQYWNrYWdlQXR0cmlidXRlLnZhbHVlO1xuICAvLyBMb29rIGZvciBhY3Rpdml0eSBvciBhY3Rpdml0eS1hbGlhcyB3aXRoXG4gIC8vIGFjdGlvbiA9PSBhbmRyb2lkLmludGVudC5hY3Rpb24uTUFJTiBhbmRcbiAgLy8gY2F0ZWdvcnkgPT0gYW5kcm9pZC5pbnRlbnQuY2F0ZWdvcnkuTEFVTkNIRVJcbiAgLy8gZGVzY2VuZGFudHNcbiAgY29uc3QgYXBrQWN0aXZpdHlBdHRyaWJ1dGUgPSB4cGF0aC5zZWxlY3QxKFxuICAgIFwiLy9hcHBsaWNhdGlvbi8qW3N0YXJ0cy13aXRoKG5hbWUoKSwgJ2FjdGl2aXR5JykgXCIgK1xuICAgIFwiYW5kIC4vL2FjdGlvbltAKltsb2NhbC1uYW1lKCk9J25hbWUnIGFuZCAuPSdhbmRyb2lkLmludGVudC5hY3Rpb24uTUFJTiddXSBcIiArXG4gICAgXCJhbmQgLi8vY2F0ZWdvcnlbQCpbbG9jYWwtbmFtZSgpPSduYW1lJyBhbmQgLj0nYW5kcm9pZC5pbnRlbnQuY2F0ZWdvcnkuTEFVTkNIRVInXV1dXCIgK1xuICAgIFwiL0AqW2xvY2FsLW5hbWUoKT0nbmFtZSddXCIsIGRvYyk7XG4gIGlmICghYXBrQWN0aXZpdHlBdHRyaWJ1dGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBwYXJzZSBtYWluIGFjdGl2aXR5IG5hbWUgZnJvbSAke21hbmlmZXN0WG1sfWApO1xuICB9XG4gIGNvbnN0IGFwa0FjdGl2aXR5ID0gYXBrQWN0aXZpdHlBdHRyaWJ1dGUudmFsdWU7XG4gIHJldHVybiB7YXBrUGFja2FnZSwgYXBrQWN0aXZpdHl9O1xufVxuXG4vKipcbiAqIEV4dHJhY3QgcGFja2FnZSBhbmQgbWFpbiBhY3Rpdml0eSBuYW1lIGZyb20gYXBwbGljYXRpb24gbWFuaWZlc3QuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGFwcFBhdGggLSBUaGUgZnVsbCBwYXRoIHRvIGFwcGxpY2F0aW9uIC5hcGsocykgcGFja2FnZVxuICogQHJldHVybiB7QVBLSW5mb30gVGhlIHBhcnNlZCBhcHBsaWNhdGlvbiBpbmZvLlxuICogQHRocm93cyB7ZXJyb3J9IElmIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSBnZXR0aW5nIHRoZSBkYXRhIGZyb20gdGhlIGdpdmVuXG4gKiAgICAgICAgICAgICAgICAgYXBwbGljYXRpb24gcGFja2FnZS5cbiAqL1xubWFuaWZlc3RNZXRob2RzLnBhY2thZ2VBbmRMYXVuY2hBY3Rpdml0eUZyb21NYW5pZmVzdCA9IGFzeW5jIGZ1bmN0aW9uIHBhY2thZ2VBbmRMYXVuY2hBY3Rpdml0eUZyb21NYW5pZmVzdCAoYXBwUGF0aCkge1xuICBpZiAoYXBwUGF0aC5lbmRzV2l0aChBUEtTX0VYVEVOU0lPTikpIHtcbiAgICBhcHBQYXRoID0gYXdhaXQgdGhpcy5leHRyYWN0QmFzZUFwayhhcHBQYXRoKTtcbiAgfVxuXG4gIGNvbnN0IGFwa0luZm9HZXR0ZXJzID0gW1xuICAgIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGFwa2FuYWx5emVyUGF0aCA9IGF3YWl0IGdldEFwa2FuYWx5emVyRm9yT3ModGhpcyk7XG4gICAgICByZXR1cm4gYXdhaXQgZXh0cmFjdEFwa0luZm9XaXRoQXBrYW5hbHl6ZXIoYXBwUGF0aCwgYXBrYW5hbHl6ZXJQYXRoKTtcbiAgICB9LFxuICAgIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHRoaXMuaW5pdEFhcHQoKTtcbiAgICAgIHJldHVybiBhd2FpdCBleHRyYWN0QXBrSW5mb1dpdGhBcGtUb29scyhhcHBQYXRoLFxuICAgICAgICB0aGlzLmJpbmFyaWVzLmFhcHQsIHRoaXMuamFyc1snYXBwaXVtX2Fwa190b29scy5qYXInXSwgdGhpcy50bXBEaXIpO1xuICAgIH0sXG4gIF07XG5cbiAgbGV0IHNhdmVkRXJyb3I7XG4gIGZvciAoY29uc3QgaW5mb0dldHRlciBvZiBhcGtJbmZvR2V0dGVycykge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7YXBrUGFja2FnZSwgYXBrQWN0aXZpdHl9ID0gYXdhaXQgaW5mb0dldHRlcigpO1xuICAgICAgbG9nLmluZm8oYFBhY2thZ2UgbmFtZTogJyR7YXBrUGFja2FnZX0nYCk7XG4gICAgICBsb2cuaW5mbyhgTWFpbiBhY3Rpdml0eSBuYW1lOiAnJHthcGtBY3Rpdml0eX0nYCk7XG4gICAgICByZXR1cm4ge2Fwa1BhY2thZ2UsIGFwa0FjdGl2aXR5fTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBpZiAoaW5mb0dldHRlciAhPT0gXy5sYXN0KGFwa0luZm9HZXR0ZXJzKSkge1xuICAgICAgICBsb2cuaW5mbyhgVXNpbmcgdGhlIGFsdGVybmF0aXZlIGFjdGl2aXR5IG5hbWUgZGV0ZWN0aW9uIG1ldGhvZCBiZWNhdXNlIG9mOiAke2UubWVzc2FnZX1gKTtcbiAgICAgIH1cbiAgICAgIHNhdmVkRXJyb3IgPSBlO1xuICAgIH1cbiAgfVxuICB0aHJvdyBuZXcgRXJyb3IoYHBhY2thZ2VBbmRMYXVuY2hBY3Rpdml0eUZyb21NYW5pZmVzdCBmYWlsZWQuIE9yaWdpbmFsIGVycm9yOiAke3NhdmVkRXJyb3IubWVzc2FnZX1gICtcbiAgICAgICAgICAgICAgICAgIChzYXZlZEVycm9yLnN0ZGVyciA/IGA7IFN0ZEVycjogJHtzYXZlZEVycm9yLnN0ZGVycn1gIDogJycpKTtcbn07XG5cbi8qKlxuICogRXh0cmFjdCB0YXJnZXQgU0RLIHZlcnNpb24gZnJvbSBhcHBsaWNhdGlvbiBtYW5pZmVzdC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBwUGF0aCAtIFRoZSBmdWxsIHBhdGggdG8gLmFwayhzKSBwYWNrYWdlLlxuICogQHJldHVybiB7bnVtYmVyfSBUaGUgdmVyc2lvbiBvZiB0aGUgdGFyZ2V0IFNESy5cbiAqIEB0aHJvd3Mge2Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgZ2V0dGluZyB0aGUgZGF0YSBmcm9tIHRoZSBnaXZlblxuICogICAgICAgICAgICAgICAgIGFwcGxpY2F0aW9uIHBhY2thZ2UuXG4gKi9cbm1hbmlmZXN0TWV0aG9kcy50YXJnZXRTZGtWZXJzaW9uRnJvbU1hbmlmZXN0ID0gYXN5bmMgZnVuY3Rpb24gdGFyZ2V0U2RrVmVyc2lvbkZyb21NYW5pZmVzdCAoYXBwUGF0aCkge1xuICBhd2FpdCB0aGlzLmluaXRBYXB0KCk7XG5cbiAgaWYgKGFwcFBhdGguZW5kc1dpdGgoQVBLU19FWFRFTlNJT04pKSB7XG4gICAgYXBwUGF0aCA9IGF3YWl0IHRoaXMuZXh0cmFjdEJhc2VBcGsoYXBwUGF0aCk7XG4gIH1cblxuICBsb2cuaW5mbygnRXh0cmFjdGluZyBwYWNrYWdlIGFuZCBsYXVuY2ggYWN0aXZpdHkgZnJvbSBtYW5pZmVzdCcpO1xuICBsZXQgYXJncyA9IFsnZHVtcCcsICdiYWRnaW5nJywgYXBwUGF0aF07XG4gIGxldCBvdXRwdXQ7XG4gIHRyeSB7XG4gICAgbGV0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYyh0aGlzLmJpbmFyaWVzLmFhcHQsIGFyZ3MpO1xuICAgIG91dHB1dCA9IHN0ZG91dDtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgZmV0Y2hpbmcgdGFyZ2V0U2RrVmVyc2lvbiBmcm9tIGxvY2FsIEFQSyBmYWlsZWQuIE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgfVxuICBsZXQgdGFyZ2V0U2RrVmVyc2lvbiA9IG5ldyBSZWdFeHAoL3RhcmdldFNka1ZlcnNpb246JyhbXiddKyknL2cpLmV4ZWMob3V0cHV0KTtcbiAgaWYgKCF0YXJnZXRTZGtWZXJzaW9uKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGB0YXJnZXRTZGtWZXJzaW9uIGlzIG5vdCBzcGVjaWZpZWQgaW4gdGhlIGFwcGxpY2F0aW9uLmApO1xuICB9XG4gIHJldHVybiBwYXJzZUludCh0YXJnZXRTZGtWZXJzaW9uWzFdLCAxMCk7XG59O1xuXG4vKipcbiAqIEV4dHJhY3QgdGFyZ2V0IFNESyB2ZXJzaW9uIGZyb20gcGFja2FnZSBpbmZvcm1hdGlvbi5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGtnIC0gVGhlIGNsYXNzIG5hbWUgb2YgdGhlIHBhY2thZ2UgaW5zdGFsbGVkIG9uIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqIEBwYXJhbSB7P3N0cmluZ30gY21kT3V0cHV0IC0gT3B0aW9uYWwgcGFyYW1ldGVyIGNvbnRhaW5pbmcgdGhlIG91dHB1dCBvZlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfZHVtcHN5cyBwYWNrYWdlXyBjb21tYW5kLiBJdCBtYXkgc3BlZWQgdXAgdGhlIG1ldGhvZCBleGVjdXRpb24uXG4gKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSB2ZXJzaW9uIG9mIHRoZSB0YXJnZXQgU0RLLlxuICovXG5tYW5pZmVzdE1ldGhvZHMudGFyZ2V0U2RrVmVyc2lvblVzaW5nUEtHID0gYXN5bmMgZnVuY3Rpb24gdGFyZ2V0U2RrVmVyc2lvblVzaW5nUEtHIChwa2csIGNtZE91dHB1dCA9IG51bGwpIHtcbiAgbGV0IHN0ZG91dCA9IGNtZE91dHB1dCB8fCBhd2FpdCB0aGlzLnNoZWxsKFsnZHVtcHN5cycsICdwYWNrYWdlJywgcGtnXSk7XG4gIGxldCB0YXJnZXRTZGtWZXJzaW9uID0gbmV3IFJlZ0V4cCgvdGFyZ2V0U2RrPShbXlxcc1xcc10rKS9nKS5leGVjKHN0ZG91dCk7XG4gIGlmICh0YXJnZXRTZGtWZXJzaW9uICYmIHRhcmdldFNka1ZlcnNpb24ubGVuZ3RoID49IDIpIHtcbiAgICB0YXJnZXRTZGtWZXJzaW9uID0gdGFyZ2V0U2RrVmVyc2lvblsxXTtcbiAgfSBlbHNlIHtcbiAgICAvLyB0YXJnZXRTZGsgbm90IGZvdW5kIGluIHRoZSBkdW1wLCBhc3NpZ25pbmcgMCB0byB0YXJnZXRTZGtWZXJzaW9uXG4gICAgdGFyZ2V0U2RrVmVyc2lvbiA9IDA7XG4gIH1cbiAgcmV0dXJuIHBhcnNlSW50KHRhcmdldFNka1ZlcnNpb24sIDEwKTtcbn07XG5cbi8qKlxuICogQ3JlYXRlIGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiBwYWNrYWdlIG1hbmlmZXN0ICh1c3VhbGx5IEFuZHJvaWRNYW5pZmVzdC54bWwpLlxuICogYCR7bWFuaWZlc3R9LmFwa2AgZmlsZSB3aWxsIGJlIGNyZWF0ZWQgYXMgdGhlIHJlc3VsdCBvZiB0aGlzIG1ldGhvZFxuICogY29udGFpbmluZyB0aGUgY29tcGlsZWQgbWFuaWZlc3QuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IG1hbmlmZXN0IC0gRnVsbCBwYXRoIHRvIHRoZSBpbml0aWFsIG1hbmlmZXN0IHRlbXBsYXRlXG4gKiBAcGFyYW0ge3N0cmluZ30gbWFuaWZlc3RQYWNrYWdlIC0gVGhlIG5hbWUgb2YgdGhlIG1hbmlmZXN0IHBhY2thZ2VcbiAqIEBwYXJhbSB7c3RyaW5nfSB0YXJnZXRQYWNrYWdlIC0gVGhlIG5hbWUgb2YgdGhlIGRlc3RpbmF0aW9uIHBhY2thZ2VcbiAqL1xubWFuaWZlc3RNZXRob2RzLmNvbXBpbGVNYW5pZmVzdCA9IGFzeW5jIGZ1bmN0aW9uIGNvbXBpbGVNYW5pZmVzdCAobWFuaWZlc3QsIG1hbmlmZXN0UGFja2FnZSwgdGFyZ2V0UGFja2FnZSkge1xuICBjb25zdCB7cGxhdGZvcm0sIHBsYXRmb3JtUGF0aH0gPSBhd2FpdCBnZXRBbmRyb2lkUGxhdGZvcm1BbmRQYXRoKCk7XG4gIGlmICghcGxhdGZvcm0pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBjb21waWxlIHRoZSBtYW5pZmVzdC4gVGhlIHJlcXVpcmVkIHBsYXRmb3JtIGRvZXMgbm90IGV4aXN0IChBUEkgbGV2ZWwgPj0gMTcpJyk7XG4gIH1cbiAgY29uc3QgcmVzdWx0UGF0aCA9IGAke21hbmlmZXN0fS5hcGtgO1xuICBjb25zdCBhcmdzID0gW1xuICAgICdwYWNrYWdlJyxcbiAgICAnLU0nLCBtYW5pZmVzdCxcbiAgICAnLS1yZW5hbWUtbWFuaWZlc3QtcGFja2FnZScsIG1hbmlmZXN0UGFja2FnZSxcbiAgICAnLS1yZW5hbWUtaW5zdHJ1bWVudGF0aW9uLXRhcmdldC1wYWNrYWdlJywgdGFyZ2V0UGFja2FnZSxcbiAgICAnLUknLCBwYXRoLnJlc29sdmUocGxhdGZvcm1QYXRoLCAnYW5kcm9pZC5qYXInKSxcbiAgICAnLUYnLCByZXN1bHRQYXRoLFxuICAgICctZicsXG4gIF07XG4gIHRyeSB7XG4gICAgYXdhaXQgdGhpcy5pbml0QWFwdCgpO1xuICAgIGxvZy5kZWJ1ZyhgQ29tcGlsaW5nIHRoZSBtYW5pZmVzdDogJHt0aGlzLmJpbmFyaWVzLmFhcHR9ICR7cXVvdGUoYXJncyl9YCk7XG4gICAgYXdhaXQgZXhlYyh0aGlzLmJpbmFyaWVzLmFhcHQsIGFyZ3MpO1xuICAgIGxvZy5kZWJ1ZyhgQ29tcGlsZWQgdGhlIG1hbmlmZXN0IGF0ICcke3Jlc3VsdFBhdGh9J2ApO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBjb21waWxlIHRoZSBtYW5pZmVzdC4gT3JpZ2luYWwgZXJyb3I6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbi8qKlxuICogUmVwbGFjZS9pbnNlcnQgdGhlIHNwZWNpYWxseSBwcmVjb21waWxlZCBtYW5pZmVzdCBmaWxlIGludG8gdGhlXG4gKiBwYXJ0aWN1bGFyIHBhY2thZ2UuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IG1hbmlmZXN0IC0gRnVsbCBwYXRoIHRvIHRoZSBwcmVjb21waWxlZCBtYW5pZmVzdFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlZCBieSBgY29tcGlsZU1hbmlmZXN0YCBtZXRob2QgY2FsbFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aG91dCAuYXBrIGV4dGVuc2lvblxuICogQHBhcmFtIHtzdHJpbmd9IHNyY0FwayAtIEZ1bGwgcGF0aCB0byB0aGUgZXhpc3RpbmcgdmFsaWQgYXBwbGljYXRpb24gcGFja2FnZSwgd2hlcmVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzIG1hbmlmZXN0IGhhcyB0byBiZSBpbnNldHJlZCB0by4gVGhpcyBwYWNrYWdlXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgd2lsbCBOT1QgYmUgbW9kaWZpZWQuXG4gKiBAcGFyYW0ge3N0cmluZ30gZHN0QXBrIC0gRnVsbCBwYXRoIHRvIHRoZSByZXN1bHRpbmcgcGFja2FnZS5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICBUaGUgZmlsZSB3aWxsIGJlIG92ZXJyaWRlbiBpZiBpdCBhbHJlYWR5IGV4aXN0cy5cbiAqL1xubWFuaWZlc3RNZXRob2RzLmluc2VydE1hbmlmZXN0ID0gYXN5bmMgZnVuY3Rpb24gaW5zZXJ0TWFuaWZlc3QgKG1hbmlmZXN0LCBzcmNBcGssIGRzdEFwaykge1xuICBsb2cuZGVidWcoYEluc2VydGluZyBtYW5pZmVzdCwgc3JjOiAke3NyY0Fwa30gZHN0OiAke2RzdEFwa31gKTtcbiAgYXdhaXQgdGhpcy5pbml0QWFwdCgpO1xuICBhd2FpdCB1bnppcEZpbGUoYCR7bWFuaWZlc3R9LmFwa2ApO1xuICBhd2FpdCBmcy5jb3B5RmlsZShzcmNBcGssIGRzdEFwayk7XG4gIGxvZy5kZWJ1ZygnVGVzdGluZyBuZXcgdG1wIGFwaycpO1xuICBhd2FpdCB6aXAuYXNzZXJ0VmFsaWRaaXAoZHN0QXBrKTtcbiAgbG9nLmRlYnVnKCdNb3ZpbmcgbWFuaWZlc3QnKTtcbiAgdHJ5IHtcbiAgICBhd2FpdCBleGVjKHRoaXMuYmluYXJpZXMuYWFwdCwgW1xuICAgICAgJ3JlbW92ZScsIGRzdEFwaywgcGF0aC5iYXNlbmFtZShtYW5pZmVzdClcbiAgICBdKTtcbiAgfSBjYXRjaCAoaWduKSB7fVxuICBhd2FpdCBleGVjKHRoaXMuYmluYXJpZXMuYWFwdCwgW1xuICAgICdhZGQnLCBkc3RBcGssIHBhdGguYmFzZW5hbWUobWFuaWZlc3QpXG4gIF0sIHtjd2Q6IHBhdGguZGlybmFtZShtYW5pZmVzdCl9KTtcbiAgbG9nLmRlYnVnKCdJbnNlcnRlZCBtYW5pZmVzdC4nKTtcbn07XG5cbi8qKlxuICogQ2hlY2sgd2hldGhlciBwYWNrYWdlIG1hbmlmZXN0IGNvbnRhaW5zIEludGVybmV0IHBlcm1pc3Npb25zLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcHBQYXRoIC0gVGhlIGZ1bGwgcGF0aCB0byAuYXBrKHMpIHBhY2thZ2UuXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBtYW5pZmVzdCByZXF1aXJlcyBJbnRlcm5ldCBhY2Nlc3MgcGVybWlzc2lvbi5cbiAqL1xubWFuaWZlc3RNZXRob2RzLmhhc0ludGVybmV0UGVybWlzc2lvbkZyb21NYW5pZmVzdCA9IGFzeW5jIGZ1bmN0aW9uIGhhc0ludGVybmV0UGVybWlzc2lvbkZyb21NYW5pZmVzdCAoYXBwUGF0aCkge1xuICBhd2FpdCB0aGlzLmluaXRBYXB0KCk7XG5cbiAgaWYgKGFwcFBhdGguZW5kc1dpdGgoQVBLU19FWFRFTlNJT04pKSB7XG4gICAgYXBwUGF0aCA9IGF3YWl0IHRoaXMuZXh0cmFjdEJhc2VBcGsoYXBwUGF0aCk7XG4gIH1cblxuICBsb2cuZGVidWcoYENoZWNraW5nIGlmICcke2FwcFBhdGh9JyByZXF1aXJlcyBpbnRlcm5ldCBhY2Nlc3MgcGVybWlzc2lvbiBpbiB0aGUgbWFuaWZlc3RgKTtcbiAgdHJ5IHtcbiAgICBsZXQge3N0ZG91dH0gPSBhd2FpdCBleGVjKHRoaXMuYmluYXJpZXMuYWFwdCwgWydkdW1wJywgJ2JhZGdpbmcnLCBhcHBQYXRoXSk7XG4gICAgcmV0dXJuIG5ldyBSZWdFeHAoL3VzZXMtcGVybWlzc2lvbjouKidhbmRyb2lkLnBlcm1pc3Npb24uSU5URVJORVQnLykudGVzdChzdGRvdXQpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgY2hlY2sgaWYgJyR7YXBwUGF0aH0nIHJlcXVpcmVzIGludGVybmV0IGFjY2VzcyBwZXJtaXNzaW9uLiBgICtcbiAgICAgICAgICAgICAgICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgfVxufTtcblxuLyoqXG4gKiBQcmludHMgb3V0IHRoZSBtYW5pZmVzdCBleHRyYWN0ZWQgZnJvbSB0aGUgYXBrXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGFwcFBhdGggLSBUaGUgZnVsbCBwYXRoIHRvIGFwcGxpY2F0aW9uIHBhY2thZ2UuXG4gKiBAcGFyYW0gez9zdHJpbmd9IGxvZ0xldmVsIC0gVGhlIGxldmVsIGF0IHdoaWNoIHRvIGxvZy4gRS5nLiwgJ2RlYnVnJ1xuICovXG5tYW5pZmVzdE1ldGhvZHMucHJpbnRNYW5pZmVzdEZyb21BcGsgPSBhc3luYyBmdW5jdGlvbiBwcmludE1hbmlmZXN0RnJvbUFwayAoYXBwUGF0aCwgbG9nTGV2ZWwgPSAnZGVidWcnKSB7XG4gIGF3YWl0IHRoaXMuaW5pdEFhcHQoKTtcblxuICBpZiAoYXBwUGF0aC5lbmRzV2l0aChBUEtTX0VYVEVOU0lPTikpIHtcbiAgICBhcHBQYXRoID0gYXdhaXQgdGhpcy5leHRyYWN0QmFzZUFwayhhcHBQYXRoKTtcbiAgfVxuXG4gIGxvZ1tsb2dMZXZlbF0oYEV4dHJhY3RpbmcgdGhlIG1hbmlmZXN0IGZyb20gJyR7YXBwUGF0aH0nYCk7XG4gIGxldCBvdXQgPSBmYWxzZTtcbiAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKHRoaXMuYmluYXJpZXMuYWFwdCwgWydsJywgJy1hJywgYXBwUGF0aF0pO1xuICBmb3IgKGNvbnN0IGxpbmUgb2Ygc3Rkb3V0LnNwbGl0KCdcXG4nKSkge1xuICAgIGlmICghb3V0ICYmIGxpbmUuaW5jbHVkZXMoJ0FuZHJvaWQgbWFuaWZlc3Q6JykpIHtcbiAgICAgIG91dCA9IHRydWU7XG4gICAgfVxuICAgIGlmIChvdXQpIHtcbiAgICAgIGxvZ1tsb2dMZXZlbF0obGluZSk7XG4gICAgfVxuICB9XG59O1xuXG5cbmV4cG9ydCBkZWZhdWx0IG1hbmlmZXN0TWV0aG9kcztcbiJdLCJmaWxlIjoibGliL3Rvb2xzL2FuZHJvaWQtbWFuaWZlc3QuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
