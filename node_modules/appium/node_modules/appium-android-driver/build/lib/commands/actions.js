"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.helpers = exports.commands = void 0;

require("source-map-support/register");

var _androidHelpers = _interopRequireDefault(require("../android-helpers"));

var _lodash = _interopRequireDefault(require("lodash"));

var _temp = _interopRequireDefault(require("temp"));

var _appiumSupport = require("appium-support");

var _path = _interopRequireDefault(require("path"));

var _logger = _interopRequireDefault(require("../logger"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _jimp = _interopRequireDefault(require("jimp"));

var _teen_process = require("teen_process");

const swipeStepsPerSec = 28;
const dragStepsPerSec = 40;
const CONTAINER_PATH_MARKER = '@';
const CONTAINER_PATH_PATTERN = new RegExp(`^${CONTAINER_PATH_MARKER}([^/]+)/(.+)`);
const ANDROID_MEDIA_RESCAN_INTENT = 'android.intent.action.MEDIA_SCANNER_SCAN_FILE';
let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;

commands.keyevent = async function keyevent(keycode, metastate = null) {
  _logger.default.warn('keyevent will be deprecated use pressKeyCode');

  return await this.pressKeyCode(keycode, metastate);
};

commands.pressKeyCode = async function pressKeyCode(keycode, metastate = null) {
  return await this.bootstrap.sendAction('pressKeyCode', {
    keycode,
    metastate
  });
};

commands.longPressKeyCode = async function longPressKeyCode(keycode, metastate = null) {
  return await this.bootstrap.sendAction('longPressKeyCode', {
    keycode,
    metastate
  });
};

commands.getOrientation = async function getOrientation() {
  let params = {
    naturalOrientation: !!this.opts.androidNaturalOrientation
  };
  let orientation = await this.bootstrap.sendAction('orientation', params);
  return orientation.toUpperCase();
};

commands.setOrientation = async function setOrientation(orientation) {
  orientation = orientation.toUpperCase();
  let params = {
    orientation,
    naturalOrientation: !!this.opts.androidNaturalOrientation
  };
  return await this.bootstrap.sendAction('orientation', params);
};

commands.fakeFlick = async function fakeFlick(xSpeed, ySpeed) {
  return await this.bootstrap.sendAction('flick', {
    xSpeed,
    ySpeed
  });
};

commands.fakeFlickElement = async function fakeFlickElement(elementId, xoffset, yoffset, speed) {
  let params = {
    xoffset,
    yoffset,
    speed,
    elementId
  };
  return await this.bootstrap.sendAction('element:flick', params);
};

commands.swipe = async function swipe(startX, startY, endX, endY, duration, touchCount, elId) {
  if (startX === 'null') {
    startX = 0.5;
  }

  if (startY === 'null') {
    startY = 0.5;
  }

  let swipeOpts = {
    startX,
    startY,
    endX,
    endY,
    steps: Math.round(duration * swipeStepsPerSec)
  };

  if (_appiumSupport.util.hasValue(elId)) {
    swipeOpts.elementId = elId;
  }

  return await this.doSwipe(swipeOpts);
};

commands.doSwipe = async function doSwipe(swipeOpts) {
  if (_appiumSupport.util.hasValue(swipeOpts.elementId)) {
    return await this.bootstrap.sendAction('element:swipe', swipeOpts);
  } else {
    return await this.bootstrap.sendAction('swipe', swipeOpts);
  }
};

commands.pinchClose = async function pinchClose(startX, startY, endX, endY, duration, percent, steps, elId) {
  let pinchOpts = {
    direction: 'in',
    elementId: elId,
    percent,
    steps
  };
  return await this.bootstrap.sendAction('element:pinch', pinchOpts);
};

commands.pinchOpen = async function pinchOpen(startX, startY, endX, endY, duration, percent, steps, elId) {
  let pinchOpts = {
    direction: 'out',
    elementId: elId,
    percent,
    steps
  };
  return await this.bootstrap.sendAction('element:pinch', pinchOpts);
};

commands.flick = async function flick(element, xSpeed, ySpeed, xOffset, yOffset, speed) {
  if (element) {
    await this.fakeFlickElement(element, xOffset, yOffset, speed);
  } else {
    await this.fakeFlick(xSpeed, ySpeed);
  }
};

commands.drag = async function drag(startX, startY, endX, endY, duration, touchCount, elementId, destElId) {
  let dragOpts = {
    elementId,
    destElId,
    startX,
    startY,
    endX,
    endY,
    steps: Math.round(duration * dragStepsPerSec)
  };
  return await this.doDrag(dragOpts);
};

commands.doDrag = async function doDrag(dragOpts) {
  if (_appiumSupport.util.hasValue(dragOpts.elementId)) {
    return await this.bootstrap.sendAction('element:drag', dragOpts);
  } else {
    return await this.bootstrap.sendAction('drag', dragOpts);
  }
};

commands.lock = async function lock(seconds) {
  await this.adb.lock();

  if (isNaN(seconds)) {
    return;
  }

  const floatSeconds = parseFloat(seconds);

  if (floatSeconds <= 0) {
    return;
  }

  await _bluebird.default.delay(1000 * floatSeconds);
  await this.unlock();
};

commands.isLocked = async function isLocked() {
  return await this.adb.isScreenLocked();
};

commands.unlock = async function unlock() {
  return await _androidHelpers.default.unlock(this, this.adb, this.caps);
};

commands.openNotifications = async function openNotifications() {
  return await this.bootstrap.sendAction('openNotification');
};

commands.setLocation = async function setLocation(latitude, longitude) {
  return await this.adb.sendTelnetCommand(`geo fix ${longitude} ${latitude}`);
};

function parseContainerPath(remotePath) {
  const match = CONTAINER_PATH_PATTERN.exec(remotePath);

  if (!match) {
    _logger.default.errorAndThrow(`It is expected that package identifier is separated from the relative path with a single slash. ` + `'${remotePath}' is given instead`);
  }

  return [match[1], _path.default.posix.resolve(`/data/data/${match[1]}`, match[2])];
}

commands.pullFile = async function pullFile(remotePath) {
  if (remotePath.endsWith('/')) {
    _logger.default.errorAndThrow(`It is expected that remote path points to a file and not to a folder. ` + `'${remotePath}' is given instead`);
  }

  let tmpDestination = null;

  if (remotePath.startsWith(CONTAINER_PATH_MARKER)) {
    const [packageId, pathInContainer] = parseContainerPath(remotePath);

    _logger.default.info(`Parsed package identifier '${packageId}' from '${remotePath}'. Will get the data from '${pathInContainer}'`);

    tmpDestination = `/data/local/tmp/${_path.default.posix.basename(pathInContainer)}`;

    try {
      await this.adb.shell(['run-as', packageId, `chmod 777 '${pathInContainer.replace(/'/g, '\\\'')}'`]);
      await this.adb.shell(['cp', '-f', pathInContainer, tmpDestination]);
    } catch (e) {
      _logger.default.errorAndThrow(`Cannot access the container of '${packageId}' application. ` + `Is the application installed and has 'debuggable' build option set to true? ` + `Original error: ${e.message}`);
    }
  }

  const localFile = _temp.default.path({
    prefix: 'appium',
    suffix: '.tmp'
  });

  try {
    await this.adb.pull(_lodash.default.isString(tmpDestination) ? tmpDestination : remotePath, localFile);
    const data = await _appiumSupport.fs.readFile(localFile);
    return Buffer.from(data).toString('base64');
  } finally {
    if (await _appiumSupport.fs.exists(localFile)) {
      await _appiumSupport.fs.unlink(localFile);
    }

    if (_lodash.default.isString(tmpDestination)) {
      await this.adb.shell(['rm', '-f', tmpDestination]);
    }
  }
};

commands.pushFile = async function pushFile(remotePath, base64Data) {
  if (remotePath.endsWith('/')) {
    _logger.default.errorAndThrow(`It is expected that remote path points to a file and not to a folder. ` + `'${remotePath}' is given instead`);
  }

  const localFile = _temp.default.path({
    prefix: 'appium',
    suffix: '.tmp'
  });

  if (_lodash.default.isArray(base64Data)) {
    base64Data = Buffer.from(base64Data).toString('utf8');
  }

  const content = Buffer.from(base64Data, 'base64');
  let tmpDestination = null;

  try {
    await _appiumSupport.fs.writeFile(localFile, content.toString('binary'), 'binary');

    if (remotePath.startsWith(CONTAINER_PATH_MARKER)) {
      const [packageId, pathInContainer] = parseContainerPath(remotePath);

      _logger.default.info(`Parsed package identifier '${packageId}' from '${remotePath}'. Will put the data into '${pathInContainer}'`);

      tmpDestination = `/data/local/tmp/${_path.default.posix.basename(pathInContainer)}`;

      try {
        await this.adb.shell(['run-as', packageId, `mkdir -p '${_path.default.posix.dirname(pathInContainer).replace(/'/g, '\\\'')}'`]);
        await this.adb.shell(['run-as', packageId, `touch '${pathInContainer.replace(/'/g, '\\\'')}'`]);
        await this.adb.shell(['run-as', packageId, `chmod 777 '${pathInContainer.replace(/'/g, '\\\'')}'`]);
        await this.adb.push(localFile, tmpDestination);
        await this.adb.shell(['cp', '-f', tmpDestination, pathInContainer]);
      } catch (e) {
        _logger.default.errorAndThrow(`Cannot access the container of '${packageId}' application. ` + `Is the application installed and has 'debuggable' build option set to true? ` + `Original error: ${e.message}`);
      }
    } else {
      await this.adb.push(localFile, remotePath);

      _logger.default.info('After pushing media file, broadcasting media scan intent');

      try {
        await this.adb.shell(['am', 'broadcast', '-a', ANDROID_MEDIA_RESCAN_INTENT, '-d', `file://${remotePath}`]);
      } catch (e) {
        _logger.default.warn(`Got error broadcasting media scan intent: ${e.message}; ignoring`);
      }
    }
  } finally {
    if (await _appiumSupport.fs.exists(localFile)) {
      await _appiumSupport.fs.unlink(localFile);
    }

    if (_lodash.default.isString(tmpDestination)) {
      await this.adb.shell(['rm', '-f', tmpDestination]);
    }
  }
};

commands.pullFolder = async function pullFolder(remotePath) {
  let localFolder = _temp.default.path({
    prefix: 'appium'
  });

  await this.adb.pull(remotePath, localFolder);
  return (await _appiumSupport.zip.toInMemoryZip(localFolder)).toString('base64');
};

commands.fingerprint = async function fingerprint(fingerprintId) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow('fingerprint method is only available for emulators');
  }

  await this.adb.fingerprint(fingerprintId);
};

commands.sendSMS = async function sendSMS(phoneNumber, message) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow('sendSMS method is only available for emulators');
  }

  await this.adb.sendSMS(phoneNumber, message);
};

commands.gsmCall = async function gsmCall(phoneNumber, action) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow('gsmCall method is only available for emulators');
  }

  await this.adb.gsmCall(phoneNumber, action);
};

commands.gsmSignal = async function gsmSignal(signalStrengh) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow('gsmSignal method is only available for emulators');
  }

  await this.adb.gsmSignal(signalStrengh);
};

commands.gsmVoice = async function gsmVoice(state) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow('gsmVoice method is only available for emulators');
  }

  await this.adb.gsmVoice(state);
};

commands.powerAC = async function powerAC(state) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow('powerAC method is only available for emulators');
  }

  await this.adb.powerAC(state);
};

commands.powerCapacity = async function powerCapacity(batteryPercent) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow('powerCapacity method is only available for emulators');
  }

  await this.adb.powerCapacity(batteryPercent);
};

commands.networkSpeed = async function networkSpeed(networkSpeed) {
  if (!this.isEmulator()) {
    _logger.default.errorAndThrow('networkSpeed method is only available for emulators');
  }

  await this.adb.networkSpeed(networkSpeed);
};

helpers.getScreenshotDataWithAdbShell = async function getScreenshotDataWithAdbShell(adb, opts) {
  const localFile = _temp.default.path({
    prefix: 'appium',
    suffix: '.png'
  });

  if (await _appiumSupport.fs.exists(localFile)) {
    await _appiumSupport.fs.unlink(localFile);
  }

  try {
    const pngDir = opts.androidScreenshotPath || '/data/local/tmp/';

    const png = _path.default.posix.resolve(pngDir, 'screenshot.png');

    const cmd = ['/system/bin/rm', `${png};`, '/system/bin/screencap', '-p', png];
    await adb.shell(cmd);

    if (!(await adb.fileSize(png))) {
      throw new Error('The size of the taken screenshot equals to zero.');
    }

    await adb.pull(png, localFile);
    return await _jimp.default.read(localFile);
  } finally {
    if (await _appiumSupport.fs.exists(localFile)) {
      await _appiumSupport.fs.unlink(localFile);
    }
  }
};

helpers.getScreenshotDataWithAdbExecOut = async function getScreenshotDataWithAdbExecOut(adb) {
  let {
    stdout,
    stderr,
    code
  } = await (0, _teen_process.exec)(adb.executable.path, adb.executable.defaultArgs.concat(['exec-out', '/system/bin/screencap', '-p']), {
    encoding: 'binary',
    isBuffer: true
  });

  if (code || stderr.length) {
    throw new Error(`Screenshot returned error, code: '${code}', stderr: '${stderr.toString()}'`);
  }

  if (!stdout.length) {
    throw new Error('Screenshot returned no data');
  }

  return await _jimp.default.read(stdout);
};

commands.getScreenshot = async function getScreenshot() {
  const apiLevel = await this.adb.getApiLevel();
  let image = null;

  if (apiLevel > 20) {
    try {
      image = await this.getScreenshotDataWithAdbExecOut(this.adb);
    } catch (e) {
      _logger.default.info(`Cannot get screenshot data with 'adb exec-out' because of '${e.message}'. ` + `Defaulting to 'adb shell' call`);
    }
  }

  if (!image) {
    try {
      image = await this.getScreenshotDataWithAdbShell(this.adb, this.opts);
    } catch (e) {
      const err = `Cannot get screenshot data because of '${e.message}'. ` + `Make sure the 'LayoutParams.FLAG_SECURE' is not set for ` + `the current view`;

      _logger.default.errorAndThrow(err);
    }
  }

  if (apiLevel < 23) {
    let screenOrientation = await this.adb.getScreenOrientation();

    try {
      image = await image.rotate(-90 * screenOrientation);
    } catch (err) {
      _logger.default.warn(`Could not rotate screenshot due to error: ${err}`);
    }
  }

  const getBuffer = _bluebird.default.promisify(image.getBuffer, {
    context: image
  });

  const imgBuffer = await getBuffer(_jimp.default.MIME_PNG);
  return imgBuffer.toString('base64');
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9hY3Rpb25zLmpzIl0sIm5hbWVzIjpbInN3aXBlU3RlcHNQZXJTZWMiLCJkcmFnU3RlcHNQZXJTZWMiLCJDT05UQUlORVJfUEFUSF9NQVJLRVIiLCJDT05UQUlORVJfUEFUSF9QQVRURVJOIiwiUmVnRXhwIiwiQU5EUk9JRF9NRURJQV9SRVNDQU5fSU5URU5UIiwiY29tbWFuZHMiLCJoZWxwZXJzIiwiZXh0ZW5zaW9ucyIsImtleWV2ZW50Iiwia2V5Y29kZSIsIm1ldGFzdGF0ZSIsImxvZyIsIndhcm4iLCJwcmVzc0tleUNvZGUiLCJib290c3RyYXAiLCJzZW5kQWN0aW9uIiwibG9uZ1ByZXNzS2V5Q29kZSIsImdldE9yaWVudGF0aW9uIiwicGFyYW1zIiwibmF0dXJhbE9yaWVudGF0aW9uIiwib3B0cyIsImFuZHJvaWROYXR1cmFsT3JpZW50YXRpb24iLCJvcmllbnRhdGlvbiIsInRvVXBwZXJDYXNlIiwic2V0T3JpZW50YXRpb24iLCJmYWtlRmxpY2siLCJ4U3BlZWQiLCJ5U3BlZWQiLCJmYWtlRmxpY2tFbGVtZW50IiwiZWxlbWVudElkIiwieG9mZnNldCIsInlvZmZzZXQiLCJzcGVlZCIsInN3aXBlIiwic3RhcnRYIiwic3RhcnRZIiwiZW5kWCIsImVuZFkiLCJkdXJhdGlvbiIsInRvdWNoQ291bnQiLCJlbElkIiwic3dpcGVPcHRzIiwic3RlcHMiLCJNYXRoIiwicm91bmQiLCJ1dGlsIiwiaGFzVmFsdWUiLCJkb1N3aXBlIiwicGluY2hDbG9zZSIsInBlcmNlbnQiLCJwaW5jaE9wdHMiLCJkaXJlY3Rpb24iLCJwaW5jaE9wZW4iLCJmbGljayIsImVsZW1lbnQiLCJ4T2Zmc2V0IiwieU9mZnNldCIsImRyYWciLCJkZXN0RWxJZCIsImRyYWdPcHRzIiwiZG9EcmFnIiwibG9jayIsInNlY29uZHMiLCJhZGIiLCJpc05hTiIsImZsb2F0U2Vjb25kcyIsInBhcnNlRmxvYXQiLCJCIiwiZGVsYXkiLCJ1bmxvY2siLCJpc0xvY2tlZCIsImlzU2NyZWVuTG9ja2VkIiwiYW5kcm9pZEhlbHBlcnMiLCJjYXBzIiwib3Blbk5vdGlmaWNhdGlvbnMiLCJzZXRMb2NhdGlvbiIsImxhdGl0dWRlIiwibG9uZ2l0dWRlIiwic2VuZFRlbG5ldENvbW1hbmQiLCJwYXJzZUNvbnRhaW5lclBhdGgiLCJyZW1vdGVQYXRoIiwibWF0Y2giLCJleGVjIiwiZXJyb3JBbmRUaHJvdyIsInBhdGgiLCJwb3NpeCIsInJlc29sdmUiLCJwdWxsRmlsZSIsImVuZHNXaXRoIiwidG1wRGVzdGluYXRpb24iLCJzdGFydHNXaXRoIiwicGFja2FnZUlkIiwicGF0aEluQ29udGFpbmVyIiwiaW5mbyIsImJhc2VuYW1lIiwic2hlbGwiLCJyZXBsYWNlIiwiZSIsIm1lc3NhZ2UiLCJsb2NhbEZpbGUiLCJ0ZW1wIiwicHJlZml4Iiwic3VmZml4IiwicHVsbCIsIl8iLCJpc1N0cmluZyIsImRhdGEiLCJmcyIsInJlYWRGaWxlIiwiQnVmZmVyIiwiZnJvbSIsInRvU3RyaW5nIiwiZXhpc3RzIiwidW5saW5rIiwicHVzaEZpbGUiLCJiYXNlNjREYXRhIiwiaXNBcnJheSIsImNvbnRlbnQiLCJ3cml0ZUZpbGUiLCJkaXJuYW1lIiwicHVzaCIsInB1bGxGb2xkZXIiLCJsb2NhbEZvbGRlciIsInppcCIsInRvSW5NZW1vcnlaaXAiLCJmaW5nZXJwcmludCIsImZpbmdlcnByaW50SWQiLCJpc0VtdWxhdG9yIiwic2VuZFNNUyIsInBob25lTnVtYmVyIiwiZ3NtQ2FsbCIsImFjdGlvbiIsImdzbVNpZ25hbCIsInNpZ25hbFN0cmVuZ2giLCJnc21Wb2ljZSIsInN0YXRlIiwicG93ZXJBQyIsInBvd2VyQ2FwYWNpdHkiLCJiYXR0ZXJ5UGVyY2VudCIsIm5ldHdvcmtTcGVlZCIsImdldFNjcmVlbnNob3REYXRhV2l0aEFkYlNoZWxsIiwicG5nRGlyIiwiYW5kcm9pZFNjcmVlbnNob3RQYXRoIiwicG5nIiwiY21kIiwiZmlsZVNpemUiLCJFcnJvciIsImppbXAiLCJyZWFkIiwiZ2V0U2NyZWVuc2hvdERhdGFXaXRoQWRiRXhlY091dCIsInN0ZG91dCIsInN0ZGVyciIsImNvZGUiLCJleGVjdXRhYmxlIiwiZGVmYXVsdEFyZ3MiLCJjb25jYXQiLCJlbmNvZGluZyIsImlzQnVmZmVyIiwibGVuZ3RoIiwiZ2V0U2NyZWVuc2hvdCIsImFwaUxldmVsIiwiZ2V0QXBpTGV2ZWwiLCJpbWFnZSIsImVyciIsInNjcmVlbk9yaWVudGF0aW9uIiwiZ2V0U2NyZWVuT3JpZW50YXRpb24iLCJyb3RhdGUiLCJnZXRCdWZmZXIiLCJwcm9taXNpZnkiLCJjb250ZXh0IiwiaW1nQnVmZmVyIiwiTUlNRV9QTkciLCJPYmplY3QiLCJhc3NpZ24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsTUFBTUEsZ0JBQWdCLEdBQUcsRUFBekI7QUFDQSxNQUFNQyxlQUFlLEdBQUcsRUFBeEI7QUFDQSxNQUFNQyxxQkFBcUIsR0FBRyxHQUE5QjtBQUVBLE1BQU1DLHNCQUFzQixHQUFHLElBQUlDLE1BQUosQ0FBWSxJQUFHRixxQkFBc0IsY0FBckMsQ0FBL0I7QUFDQSxNQUFNRywyQkFBMkIsR0FBRywrQ0FBcEM7QUFFQSxJQUFJQyxRQUFRLEdBQUcsRUFBZjtBQUFBLElBQW1CQyxPQUFPLEdBQUcsRUFBN0I7QUFBQSxJQUFpQ0MsVUFBVSxHQUFHLEVBQTlDOzs7O0FBRUFGLFFBQVEsQ0FBQ0csUUFBVCxHQUFvQixlQUFlQSxRQUFmLENBQXlCQyxPQUF6QixFQUFrQ0MsU0FBUyxHQUFHLElBQTlDLEVBQW9EO0FBRXRFQyxrQkFBSUMsSUFBSixDQUFTLDhDQUFUOztBQUNBLFNBQU8sTUFBTSxLQUFLQyxZQUFMLENBQWtCSixPQUFsQixFQUEyQkMsU0FBM0IsQ0FBYjtBQUNELENBSkQ7O0FBTUFMLFFBQVEsQ0FBQ1EsWUFBVCxHQUF3QixlQUFlQSxZQUFmLENBQTZCSixPQUE3QixFQUFzQ0MsU0FBUyxHQUFHLElBQWxELEVBQXdE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JztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgdGVtcCBmcm9tICd0ZW1wJztcbmltcG9ydCB7IGZzLCB1dGlsLCB6aXAgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyJztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCBqaW1wIGZyb20gJ2ppbXAnO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5cbmNvbnN0IHN3aXBlU3RlcHNQZXJTZWMgPSAyODtcbmNvbnN0IGRyYWdTdGVwc1BlclNlYyA9IDQwO1xuY29uc3QgQ09OVEFJTkVSX1BBVEhfTUFSS0VSID0gJ0AnO1xuLy8gaHR0cHM6Ly9yZWdleDEwMS5jb20vci9QTGRCMEcvMlxuY29uc3QgQ09OVEFJTkVSX1BBVEhfUEFUVEVSTiA9IG5ldyBSZWdFeHAoYF4ke0NPTlRBSU5FUl9QQVRIX01BUktFUn0oW14vXSspLyguKylgKTtcbmNvbnN0IEFORFJPSURfTUVESUFfUkVTQ0FOX0lOVEVOVCA9ICdhbmRyb2lkLmludGVudC5hY3Rpb24uTUVESUFfU0NBTk5FUl9TQ0FOX0ZJTEUnO1xuXG5sZXQgY29tbWFuZHMgPSB7fSwgaGVscGVycyA9IHt9LCBleHRlbnNpb25zID0ge307XG5cbmNvbW1hbmRzLmtleWV2ZW50ID0gYXN5bmMgZnVuY3Rpb24ga2V5ZXZlbnQgKGtleWNvZGUsIG1ldGFzdGF0ZSA9IG51bGwpIHtcbiAgLy8gVE9ETyBkZXByZWNhdGUga2V5ZXZlbnQ7IGN1cnJlbnRseSB3ZCBvbmx5IGltcGxlbWVudHMga2V5ZXZlbnRcbiAgbG9nLndhcm4oJ2tleWV2ZW50IHdpbGwgYmUgZGVwcmVjYXRlZCB1c2UgcHJlc3NLZXlDb2RlJyk7XG4gIHJldHVybiBhd2FpdCB0aGlzLnByZXNzS2V5Q29kZShrZXljb2RlLCBtZXRhc3RhdGUpO1xufTtcblxuY29tbWFuZHMucHJlc3NLZXlDb2RlID0gYXN5bmMgZnVuY3Rpb24gcHJlc3NLZXlDb2RlIChrZXljb2RlLCBtZXRhc3RhdGUgPSBudWxsKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKCdwcmVzc0tleUNvZGUnLCB7a2V5Y29kZSwgbWV0YXN0YXRlfSk7XG59O1xuXG5jb21tYW5kcy5sb25nUHJlc3NLZXlDb2RlID0gYXN5bmMgZnVuY3Rpb24gbG9uZ1ByZXNzS2V5Q29kZSAoa2V5Y29kZSwgbWV0YXN0YXRlID0gbnVsbCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignbG9uZ1ByZXNzS2V5Q29kZScsIHtrZXljb2RlLCBtZXRhc3RhdGV9KTtcbn07XG5cbmNvbW1hbmRzLmdldE9yaWVudGF0aW9uID0gYXN5bmMgZnVuY3Rpb24gZ2V0T3JpZW50YXRpb24gKCkge1xuICBsZXQgcGFyYW1zID0ge1xuICAgIG5hdHVyYWxPcmllbnRhdGlvbjogISF0aGlzLm9wdHMuYW5kcm9pZE5hdHVyYWxPcmllbnRhdGlvbixcbiAgfTtcbiAgbGV0IG9yaWVudGF0aW9uID0gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignb3JpZW50YXRpb24nLCBwYXJhbXMpO1xuICByZXR1cm4gb3JpZW50YXRpb24udG9VcHBlckNhc2UoKTtcbn07XG5cbmNvbW1hbmRzLnNldE9yaWVudGF0aW9uID0gYXN5bmMgZnVuY3Rpb24gc2V0T3JpZW50YXRpb24gKG9yaWVudGF0aW9uKSB7XG4gIG9yaWVudGF0aW9uID0gb3JpZW50YXRpb24udG9VcHBlckNhc2UoKTtcbiAgbGV0IHBhcmFtcyA9IHtcbiAgICBvcmllbnRhdGlvbixcbiAgICBuYXR1cmFsT3JpZW50YXRpb246ICEhdGhpcy5vcHRzLmFuZHJvaWROYXR1cmFsT3JpZW50YXRpb24sXG4gIH07XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKCdvcmllbnRhdGlvbicsIHBhcmFtcyk7XG59O1xuXG5jb21tYW5kcy5mYWtlRmxpY2sgPSBhc3luYyBmdW5jdGlvbiBmYWtlRmxpY2sgKHhTcGVlZCwgeVNwZWVkKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKCdmbGljaycsIHt4U3BlZWQsIHlTcGVlZH0pO1xufTtcblxuY29tbWFuZHMuZmFrZUZsaWNrRWxlbWVudCA9IGFzeW5jIGZ1bmN0aW9uIGZha2VGbGlja0VsZW1lbnQgKGVsZW1lbnRJZCwgeG9mZnNldCwgeW9mZnNldCwgc3BlZWQpIHtcbiAgbGV0IHBhcmFtcyA9IHt4b2Zmc2V0LCB5b2Zmc2V0LCBzcGVlZCwgZWxlbWVudElkfTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ2VsZW1lbnQ6ZmxpY2snLCBwYXJhbXMpO1xufTtcblxuY29tbWFuZHMuc3dpcGUgPSBhc3luYyBmdW5jdGlvbiBzd2lwZSAoc3RhcnRYLCBzdGFydFksIGVuZFgsIGVuZFksIGR1cmF0aW9uLCB0b3VjaENvdW50LCBlbElkKSB7XG4gIGlmIChzdGFydFggPT09ICdudWxsJykge1xuICAgIHN0YXJ0WCA9IDAuNTtcbiAgfVxuICBpZiAoc3RhcnRZID09PSAnbnVsbCcpIHtcbiAgICBzdGFydFkgPSAwLjU7XG4gIH1cbiAgbGV0IHN3aXBlT3B0cyA9IHtzdGFydFgsIHN0YXJ0WSwgZW5kWCwgZW5kWSxcbiAgICAgICAgICAgICAgICAgICBzdGVwczogTWF0aC5yb3VuZChkdXJhdGlvbiAqIHN3aXBlU3RlcHNQZXJTZWMpfTtcbiAgLy8gZ29pbmcgdGhlIGxvbmcgd2F5IGFuZCBjaGVja2luZyBmb3IgdW5kZWZpbmVkIGFuZCBudWxsIHNpbmNlXG4gIC8vIHdlIGNhbid0IGJlIGFzc3VyZWQgYGVsSWRgIGlzIGEgc3RyaW5nIGFuZCBub3QgYW4gaW50XG4gIGlmICh1dGlsLmhhc1ZhbHVlKGVsSWQpKSB7XG4gICAgc3dpcGVPcHRzLmVsZW1lbnRJZCA9IGVsSWQ7XG4gIH1cbiAgcmV0dXJuIGF3YWl0IHRoaXMuZG9Td2lwZShzd2lwZU9wdHMpO1xufTtcblxuY29tbWFuZHMuZG9Td2lwZSA9IGFzeW5jIGZ1bmN0aW9uIGRvU3dpcGUgKHN3aXBlT3B0cykge1xuICBpZiAodXRpbC5oYXNWYWx1ZShzd2lwZU9wdHMuZWxlbWVudElkKSkge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKCdlbGVtZW50OnN3aXBlJywgc3dpcGVPcHRzKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignc3dpcGUnLCBzd2lwZU9wdHMpO1xuICB9XG59O1xuXG5jb21tYW5kcy5waW5jaENsb3NlID0gYXN5bmMgZnVuY3Rpb24gcGluY2hDbG9zZSAoc3RhcnRYLCBzdGFydFksIGVuZFgsIGVuZFksIGR1cmF0aW9uLCBwZXJjZW50LCBzdGVwcywgZWxJZCkge1xuICBsZXQgcGluY2hPcHRzID0ge1xuICAgIGRpcmVjdGlvbjogJ2luJyxcbiAgICBlbGVtZW50SWQ6IGVsSWQsXG4gICAgcGVyY2VudCxcbiAgICBzdGVwc1xuICB9O1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignZWxlbWVudDpwaW5jaCcsIHBpbmNoT3B0cyk7XG59O1xuXG5jb21tYW5kcy5waW5jaE9wZW4gPSBhc3luYyBmdW5jdGlvbiBwaW5jaE9wZW4gKHN0YXJ0WCwgc3RhcnRZLCBlbmRYLCBlbmRZLCBkdXJhdGlvbiwgcGVyY2VudCwgc3RlcHMsIGVsSWQpIHtcbiAgbGV0IHBpbmNoT3B0cyA9IHtkaXJlY3Rpb246ICdvdXQnLCBlbGVtZW50SWQ6IGVsSWQsIHBlcmNlbnQsIHN0ZXBzfTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ2VsZW1lbnQ6cGluY2gnLCBwaW5jaE9wdHMpO1xufTtcblxuY29tbWFuZHMuZmxpY2sgPSBhc3luYyBmdW5jdGlvbiBmbGljayAoZWxlbWVudCwgeFNwZWVkLCB5U3BlZWQsIHhPZmZzZXQsIHlPZmZzZXQsIHNwZWVkKSB7XG4gIGlmIChlbGVtZW50KSB7XG4gICAgYXdhaXQgdGhpcy5mYWtlRmxpY2tFbGVtZW50KGVsZW1lbnQsIHhPZmZzZXQsIHlPZmZzZXQsIHNwZWVkKTtcbiAgfSBlbHNlIHtcbiAgICBhd2FpdCB0aGlzLmZha2VGbGljayh4U3BlZWQsIHlTcGVlZCk7XG4gIH1cbn07XG5cbmNvbW1hbmRzLmRyYWcgPSBhc3luYyBmdW5jdGlvbiBkcmFnIChzdGFydFgsIHN0YXJ0WSwgZW5kWCwgZW5kWSwgZHVyYXRpb24sIHRvdWNoQ291bnQsIGVsZW1lbnRJZCwgZGVzdEVsSWQpIHtcbiAgbGV0IGRyYWdPcHRzID0ge1xuICAgIGVsZW1lbnRJZCwgZGVzdEVsSWQsIHN0YXJ0WCwgc3RhcnRZLCBlbmRYLCBlbmRZLFxuICAgIHN0ZXBzOiBNYXRoLnJvdW5kKGR1cmF0aW9uICogZHJhZ1N0ZXBzUGVyU2VjKVxuICB9O1xuICByZXR1cm4gYXdhaXQgdGhpcy5kb0RyYWcoZHJhZ09wdHMpO1xuXG59O1xuXG5jb21tYW5kcy5kb0RyYWcgPSBhc3luYyBmdW5jdGlvbiBkb0RyYWcgKGRyYWdPcHRzKSB7XG4gIGlmICh1dGlsLmhhc1ZhbHVlKGRyYWdPcHRzLmVsZW1lbnRJZCkpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignZWxlbWVudDpkcmFnJywgZHJhZ09wdHMpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKCdkcmFnJywgZHJhZ09wdHMpO1xuICB9XG59O1xuXG5jb21tYW5kcy5sb2NrID0gYXN5bmMgZnVuY3Rpb24gbG9jayAoc2Vjb25kcykge1xuICBhd2FpdCB0aGlzLmFkYi5sb2NrKCk7XG4gIGlmIChpc05hTihzZWNvbmRzKSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGZsb2F0U2Vjb25kcyA9IHBhcnNlRmxvYXQoc2Vjb25kcyk7XG4gIGlmIChmbG9hdFNlY29uZHMgPD0gMCkge1xuICAgIHJldHVybjtcbiAgfVxuICBhd2FpdCBCLmRlbGF5KDEwMDAgKiBmbG9hdFNlY29uZHMpO1xuICBhd2FpdCB0aGlzLnVubG9jaygpO1xufTtcblxuY29tbWFuZHMuaXNMb2NrZWQgPSBhc3luYyBmdW5jdGlvbiBpc0xvY2tlZCAoKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLmFkYi5pc1NjcmVlbkxvY2tlZCgpO1xufTtcblxuY29tbWFuZHMudW5sb2NrID0gYXN5bmMgZnVuY3Rpb24gdW5sb2NrICgpIHtcbiAgcmV0dXJuIGF3YWl0IGFuZHJvaWRIZWxwZXJzLnVubG9jayh0aGlzLCB0aGlzLmFkYiwgdGhpcy5jYXBzKTtcbn07XG5cbmNvbW1hbmRzLm9wZW5Ob3RpZmljYXRpb25zID0gYXN5bmMgZnVuY3Rpb24gb3Blbk5vdGlmaWNhdGlvbnMgKCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignb3Blbk5vdGlmaWNhdGlvbicpO1xufTtcblxuY29tbWFuZHMuc2V0TG9jYXRpb24gPSBhc3luYyBmdW5jdGlvbiBzZXRMb2NhdGlvbiAobGF0aXR1ZGUsIGxvbmdpdHVkZSkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5hZGIuc2VuZFRlbG5ldENvbW1hbmQoYGdlbyBmaXggJHtsb25naXR1ZGV9ICR7bGF0aXR1ZGV9YCk7XG59O1xuXG5mdW5jdGlvbiBwYXJzZUNvbnRhaW5lclBhdGggKHJlbW90ZVBhdGgpIHtcbiAgY29uc3QgbWF0Y2ggPSBDT05UQUlORVJfUEFUSF9QQVRURVJOLmV4ZWMocmVtb3RlUGF0aCk7XG4gIGlmICghbWF0Y2gpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgSXQgaXMgZXhwZWN0ZWQgdGhhdCBwYWNrYWdlIGlkZW50aWZpZXIgaXMgc2VwYXJhdGVkIGZyb20gdGhlIHJlbGF0aXZlIHBhdGggd2l0aCBhIHNpbmdsZSBzbGFzaC4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgYCcke3JlbW90ZVBhdGh9JyBpcyBnaXZlbiBpbnN0ZWFkYCk7XG4gIH1cbiAgcmV0dXJuIFttYXRjaFsxXSwgcGF0aC5wb3NpeC5yZXNvbHZlKGAvZGF0YS9kYXRhLyR7bWF0Y2hbMV19YCwgbWF0Y2hbMl0pXTtcbn1cblxuY29tbWFuZHMucHVsbEZpbGUgPSBhc3luYyBmdW5jdGlvbiBwdWxsRmlsZSAocmVtb3RlUGF0aCkge1xuICBpZiAocmVtb3RlUGF0aC5lbmRzV2l0aCgnLycpKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coYEl0IGlzIGV4cGVjdGVkIHRoYXQgcmVtb3RlIHBhdGggcG9pbnRzIHRvIGEgZmlsZSBhbmQgbm90IHRvIGEgZm9sZGVyLiBgICtcbiAgICAgICAgICAgICAgICAgICAgICBgJyR7cmVtb3RlUGF0aH0nIGlzIGdpdmVuIGluc3RlYWRgKTtcbiAgfVxuICBsZXQgdG1wRGVzdGluYXRpb24gPSBudWxsO1xuICBpZiAocmVtb3RlUGF0aC5zdGFydHNXaXRoKENPTlRBSU5FUl9QQVRIX01BUktFUikpIHtcbiAgICBjb25zdCBbcGFja2FnZUlkLCBwYXRoSW5Db250YWluZXJdID0gcGFyc2VDb250YWluZXJQYXRoKHJlbW90ZVBhdGgpO1xuICAgIGxvZy5pbmZvKGBQYXJzZWQgcGFja2FnZSBpZGVudGlmaWVyICcke3BhY2thZ2VJZH0nIGZyb20gJyR7cmVtb3RlUGF0aH0nLiBXaWxsIGdldCB0aGUgZGF0YSBmcm9tICcke3BhdGhJbkNvbnRhaW5lcn0nYCk7XG4gICAgdG1wRGVzdGluYXRpb24gPSBgL2RhdGEvbG9jYWwvdG1wLyR7cGF0aC5wb3NpeC5iYXNlbmFtZShwYXRoSW5Db250YWluZXIpfWA7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuYWRiLnNoZWxsKFsncnVuLWFzJywgcGFja2FnZUlkLCBgY2htb2QgNzc3ICcke3BhdGhJbkNvbnRhaW5lci5yZXBsYWNlKC8nL2csICdcXFxcXFwnJyl9J2BdKTtcbiAgICAgIGF3YWl0IHRoaXMuYWRiLnNoZWxsKFsnY3AnLCAnLWYnLCBwYXRoSW5Db250YWluZXIsIHRtcERlc3RpbmF0aW9uXSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgbG9nLmVycm9yQW5kVGhyb3coYENhbm5vdCBhY2Nlc3MgdGhlIGNvbnRhaW5lciBvZiAnJHtwYWNrYWdlSWR9JyBhcHBsaWNhdGlvbi4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgICBgSXMgdGhlIGFwcGxpY2F0aW9uIGluc3RhbGxlZCBhbmQgaGFzICdkZWJ1Z2dhYmxlJyBidWlsZCBvcHRpb24gc2V0IHRvIHRydWU/IGAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgICB9XG4gIH1cbiAgY29uc3QgbG9jYWxGaWxlID0gdGVtcC5wYXRoKHtwcmVmaXg6ICdhcHBpdW0nLCBzdWZmaXg6ICcudG1wJ30pO1xuICB0cnkge1xuICAgIGF3YWl0IHRoaXMuYWRiLnB1bGwoXy5pc1N0cmluZyh0bXBEZXN0aW5hdGlvbikgPyB0bXBEZXN0aW5hdGlvbiA6IHJlbW90ZVBhdGgsIGxvY2FsRmlsZSk7XG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IGZzLnJlYWRGaWxlKGxvY2FsRmlsZSk7XG4gICAgcmV0dXJuIEJ1ZmZlci5mcm9tKGRhdGEpLnRvU3RyaW5nKCdiYXNlNjQnKTtcbiAgfSBmaW5hbGx5IHtcbiAgICBpZiAoYXdhaXQgZnMuZXhpc3RzKGxvY2FsRmlsZSkpIHtcbiAgICAgIGF3YWl0IGZzLnVubGluayhsb2NhbEZpbGUpO1xuICAgIH1cbiAgICBpZiAoXy5pc1N0cmluZyh0bXBEZXN0aW5hdGlvbikpIHtcbiAgICAgIGF3YWl0IHRoaXMuYWRiLnNoZWxsKFsncm0nLCAnLWYnLCB0bXBEZXN0aW5hdGlvbl0pO1xuICAgIH1cbiAgfVxufTtcblxuY29tbWFuZHMucHVzaEZpbGUgPSBhc3luYyBmdW5jdGlvbiBwdXNoRmlsZSAocmVtb3RlUGF0aCwgYmFzZTY0RGF0YSkge1xuICBpZiAocmVtb3RlUGF0aC5lbmRzV2l0aCgnLycpKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coYEl0IGlzIGV4cGVjdGVkIHRoYXQgcmVtb3RlIHBhdGggcG9pbnRzIHRvIGEgZmlsZSBhbmQgbm90IHRvIGEgZm9sZGVyLiBgICtcbiAgICAgICAgICAgICAgICAgICAgICBgJyR7cmVtb3RlUGF0aH0nIGlzIGdpdmVuIGluc3RlYWRgKTtcbiAgfVxuICBjb25zdCBsb2NhbEZpbGUgPSB0ZW1wLnBhdGgoe3ByZWZpeDogJ2FwcGl1bScsIHN1ZmZpeDogJy50bXAnfSk7XG4gIGlmIChfLmlzQXJyYXkoYmFzZTY0RGF0YSkpIHtcbiAgICAvLyBzb21lIGNsaWVudHMgKGFoZW0pIGphdmEsIHNlbmQgYSBieXRlIGFycmF5IGVuY29kaW5nIHV0ZjggY2hhcmFjdGVyc1xuICAgIC8vIGluc3RlYWQgb2YgYSBzdHJpbmcsIHdoaWNoIHdvdWxkIGJlIGluZmluaXRlbHkgYmV0dGVyIVxuICAgIGJhc2U2NERhdGEgPSBCdWZmZXIuZnJvbShiYXNlNjREYXRhKS50b1N0cmluZygndXRmOCcpO1xuICB9XG4gIGNvbnN0IGNvbnRlbnQgPSBCdWZmZXIuZnJvbShiYXNlNjREYXRhLCAnYmFzZTY0Jyk7XG4gIGxldCB0bXBEZXN0aW5hdGlvbiA9IG51bGw7XG4gIHRyeSB7XG4gICAgYXdhaXQgZnMud3JpdGVGaWxlKGxvY2FsRmlsZSwgY29udGVudC50b1N0cmluZygnYmluYXJ5JyksICdiaW5hcnknKTtcbiAgICBpZiAocmVtb3RlUGF0aC5zdGFydHNXaXRoKENPTlRBSU5FUl9QQVRIX01BUktFUikpIHtcbiAgICAgIGNvbnN0IFtwYWNrYWdlSWQsIHBhdGhJbkNvbnRhaW5lcl0gPSBwYXJzZUNvbnRhaW5lclBhdGgocmVtb3RlUGF0aCk7XG4gICAgICBsb2cuaW5mbyhgUGFyc2VkIHBhY2thZ2UgaWRlbnRpZmllciAnJHtwYWNrYWdlSWR9JyBmcm9tICcke3JlbW90ZVBhdGh9Jy4gV2lsbCBwdXQgdGhlIGRhdGEgaW50byAnJHtwYXRoSW5Db250YWluZXJ9J2ApO1xuICAgICAgdG1wRGVzdGluYXRpb24gPSBgL2RhdGEvbG9jYWwvdG1wLyR7cGF0aC5wb3NpeC5iYXNlbmFtZShwYXRoSW5Db250YWluZXIpfWA7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLmFkYi5zaGVsbChcbiAgICAgICAgICBbJ3J1bi1hcycsIHBhY2thZ2VJZCwgYG1rZGlyIC1wICcke3BhdGgucG9zaXguZGlybmFtZShwYXRoSW5Db250YWluZXIpLnJlcGxhY2UoLycvZywgJ1xcXFxcXCcnKX0nYF1cbiAgICAgICAgKTtcbiAgICAgICAgYXdhaXQgdGhpcy5hZGIuc2hlbGwoWydydW4tYXMnLCBwYWNrYWdlSWQsIGB0b3VjaCAnJHtwYXRoSW5Db250YWluZXIucmVwbGFjZSgvJy9nLCAnXFxcXFxcJycpfSdgXSk7XG4gICAgICAgIGF3YWl0IHRoaXMuYWRiLnNoZWxsKFsncnVuLWFzJywgcGFja2FnZUlkLCBgY2htb2QgNzc3ICcke3BhdGhJbkNvbnRhaW5lci5yZXBsYWNlKC8nL2csICdcXFxcXFwnJyl9J2BdKTtcbiAgICAgICAgYXdhaXQgdGhpcy5hZGIucHVzaChsb2NhbEZpbGUsIHRtcERlc3RpbmF0aW9uKTtcbiAgICAgICAgYXdhaXQgdGhpcy5hZGIuc2hlbGwoWydjcCcsICctZicsIHRtcERlc3RpbmF0aW9uLCBwYXRoSW5Db250YWluZXJdKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgbG9nLmVycm9yQW5kVGhyb3coYENhbm5vdCBhY2Nlc3MgdGhlIGNvbnRhaW5lciBvZiAnJHtwYWNrYWdlSWR9JyBhcHBsaWNhdGlvbi4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGBJcyB0aGUgYXBwbGljYXRpb24gaW5zdGFsbGVkIGFuZCBoYXMgJ2RlYnVnZ2FibGUnIGJ1aWxkIG9wdGlvbiBzZXQgdG8gdHJ1ZT8gYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIGFkYiBwdXNoIGNyZWF0ZXMgZm9sZGVycyBhbmQgb3ZlcndyaXRlcyBleGlzdGluZyBmaWxlcy5cbiAgICAgIGF3YWl0IHRoaXMuYWRiLnB1c2gobG9jYWxGaWxlLCByZW1vdGVQYXRoKTtcblxuICAgICAgLy8gaWYgd2UgaGF2ZSBwdXNoZWQgYSBmaWxlLCBpdCBtaWdodCBiZSBhIG1lZGlhIGZpbGUsIHNvIGVuc3VyZSB0aGF0XG4gICAgICAvLyBhcHBzIGtub3cgYWJvdXQgaXRcbiAgICAgIGxvZy5pbmZvKCdBZnRlciBwdXNoaW5nIG1lZGlhIGZpbGUsIGJyb2FkY2FzdGluZyBtZWRpYSBzY2FuIGludGVudCcpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGhpcy5hZGIuc2hlbGwoWydhbScsICdicm9hZGNhc3QnLCAnLWEnLFxuICAgICAgICAgIEFORFJPSURfTUVESUFfUkVTQ0FOX0lOVEVOVCwgJy1kJywgYGZpbGU6Ly8ke3JlbW90ZVBhdGh9YF0pO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBsb2cud2FybihgR290IGVycm9yIGJyb2FkY2FzdGluZyBtZWRpYSBzY2FuIGludGVudDogJHtlLm1lc3NhZ2V9OyBpZ25vcmluZ2ApO1xuICAgICAgfVxuICAgIH1cbiAgfSBmaW5hbGx5IHtcbiAgICBpZiAoYXdhaXQgZnMuZXhpc3RzKGxvY2FsRmlsZSkpIHtcbiAgICAgIGF3YWl0IGZzLnVubGluayhsb2NhbEZpbGUpO1xuICAgIH1cbiAgICBpZiAoXy5pc1N0cmluZyh0bXBEZXN0aW5hdGlvbikpIHtcbiAgICAgIGF3YWl0IHRoaXMuYWRiLnNoZWxsKFsncm0nLCAnLWYnLCB0bXBEZXN0aW5hdGlvbl0pO1xuICAgIH1cbiAgfVxufTtcblxuY29tbWFuZHMucHVsbEZvbGRlciA9IGFzeW5jIGZ1bmN0aW9uIHB1bGxGb2xkZXIgKHJlbW90ZVBhdGgpIHtcbiAgbGV0IGxvY2FsRm9sZGVyID0gdGVtcC5wYXRoKHtwcmVmaXg6ICdhcHBpdW0nfSk7XG4gIGF3YWl0IHRoaXMuYWRiLnB1bGwocmVtb3RlUGF0aCwgbG9jYWxGb2xkZXIpO1xuICByZXR1cm4gKGF3YWl0IHppcC50b0luTWVtb3J5WmlwKGxvY2FsRm9sZGVyKSkudG9TdHJpbmcoJ2Jhc2U2NCcpO1xufTtcblxuY29tbWFuZHMuZmluZ2VycHJpbnQgPSBhc3luYyBmdW5jdGlvbiBmaW5nZXJwcmludCAoZmluZ2VycHJpbnRJZCkge1xuICBpZiAoIXRoaXMuaXNFbXVsYXRvcigpKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ2ZpbmdlcnByaW50IG1ldGhvZCBpcyBvbmx5IGF2YWlsYWJsZSBmb3IgZW11bGF0b3JzJyk7XG4gIH1cbiAgYXdhaXQgdGhpcy5hZGIuZmluZ2VycHJpbnQoZmluZ2VycHJpbnRJZCk7XG59O1xuXG5jb21tYW5kcy5zZW5kU01TID0gYXN5bmMgZnVuY3Rpb24gc2VuZFNNUyAocGhvbmVOdW1iZXIsIG1lc3NhZ2UpIHtcbiAgaWYgKCF0aGlzLmlzRW11bGF0b3IoKSkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KCdzZW5kU01TIG1ldGhvZCBpcyBvbmx5IGF2YWlsYWJsZSBmb3IgZW11bGF0b3JzJyk7XG4gIH1cbiAgYXdhaXQgdGhpcy5hZGIuc2VuZFNNUyhwaG9uZU51bWJlciwgbWVzc2FnZSk7XG59O1xuXG5jb21tYW5kcy5nc21DYWxsID0gYXN5bmMgZnVuY3Rpb24gZ3NtQ2FsbCAocGhvbmVOdW1iZXIsIGFjdGlvbikge1xuICBpZiAoIXRoaXMuaXNFbXVsYXRvcigpKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ2dzbUNhbGwgbWV0aG9kIGlzIG9ubHkgYXZhaWxhYmxlIGZvciBlbXVsYXRvcnMnKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYi5nc21DYWxsKHBob25lTnVtYmVyLCBhY3Rpb24pO1xufTtcblxuY29tbWFuZHMuZ3NtU2lnbmFsID0gYXN5bmMgZnVuY3Rpb24gZ3NtU2lnbmFsIChzaWduYWxTdHJlbmdoKSB7XG4gIGlmICghdGhpcy5pc0VtdWxhdG9yKCkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdygnZ3NtU2lnbmFsIG1ldGhvZCBpcyBvbmx5IGF2YWlsYWJsZSBmb3IgZW11bGF0b3JzJyk7XG4gIH1cbiAgYXdhaXQgdGhpcy5hZGIuZ3NtU2lnbmFsKHNpZ25hbFN0cmVuZ2gpO1xufTtcblxuY29tbWFuZHMuZ3NtVm9pY2UgPSBhc3luYyBmdW5jdGlvbiBnc21Wb2ljZSAoc3RhdGUpIHtcbiAgaWYgKCF0aGlzLmlzRW11bGF0b3IoKSkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KCdnc21Wb2ljZSBtZXRob2QgaXMgb25seSBhdmFpbGFibGUgZm9yIGVtdWxhdG9ycycpO1xuICB9XG4gIGF3YWl0IHRoaXMuYWRiLmdzbVZvaWNlKHN0YXRlKTtcbn07XG5cbmNvbW1hbmRzLnBvd2VyQUMgPSBhc3luYyBmdW5jdGlvbiBwb3dlckFDIChzdGF0ZSkge1xuICBpZiAoIXRoaXMuaXNFbXVsYXRvcigpKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ3Bvd2VyQUMgbWV0aG9kIGlzIG9ubHkgYXZhaWxhYmxlIGZvciBlbXVsYXRvcnMnKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYi5wb3dlckFDKHN0YXRlKTtcbn07XG5cbmNvbW1hbmRzLnBvd2VyQ2FwYWNpdHkgPSBhc3luYyBmdW5jdGlvbiBwb3dlckNhcGFjaXR5IChiYXR0ZXJ5UGVyY2VudCkge1xuICBpZiAoIXRoaXMuaXNFbXVsYXRvcigpKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ3Bvd2VyQ2FwYWNpdHkgbWV0aG9kIGlzIG9ubHkgYXZhaWxhYmxlIGZvciBlbXVsYXRvcnMnKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYi5wb3dlckNhcGFjaXR5KGJhdHRlcnlQZXJjZW50KTtcbn07XG5cbmNvbW1hbmRzLm5ldHdvcmtTcGVlZCA9IGFzeW5jIGZ1bmN0aW9uIG5ldHdvcmtTcGVlZCAobmV0d29ya1NwZWVkKSB7XG4gIGlmICghdGhpcy5pc0VtdWxhdG9yKCkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdygnbmV0d29ya1NwZWVkIG1ldGhvZCBpcyBvbmx5IGF2YWlsYWJsZSBmb3IgZW11bGF0b3JzJyk7XG4gIH1cbiAgYXdhaXQgdGhpcy5hZGIubmV0d29ya1NwZWVkKG5ldHdvcmtTcGVlZCk7XG59O1xuXG5oZWxwZXJzLmdldFNjcmVlbnNob3REYXRhV2l0aEFkYlNoZWxsID0gYXN5bmMgZnVuY3Rpb24gZ2V0U2NyZWVuc2hvdERhdGFXaXRoQWRiU2hlbGwgKGFkYiwgb3B0cykge1xuICBjb25zdCBsb2NhbEZpbGUgPSB0ZW1wLnBhdGgoe3ByZWZpeDogJ2FwcGl1bScsIHN1ZmZpeDogJy5wbmcnfSk7XG4gIGlmIChhd2FpdCBmcy5leGlzdHMobG9jYWxGaWxlKSkge1xuICAgIGF3YWl0IGZzLnVubGluayhsb2NhbEZpbGUpO1xuICB9XG4gIHRyeSB7XG4gICAgY29uc3QgcG5nRGlyID0gb3B0cy5hbmRyb2lkU2NyZWVuc2hvdFBhdGggfHwgJy9kYXRhL2xvY2FsL3RtcC8nO1xuICAgIGNvbnN0IHBuZyA9IHBhdGgucG9zaXgucmVzb2x2ZShwbmdEaXIsICdzY3JlZW5zaG90LnBuZycpO1xuICAgIGNvbnN0IGNtZCA9IFsnL3N5c3RlbS9iaW4vcm0nLCBgJHtwbmd9O2AsICcvc3lzdGVtL2Jpbi9zY3JlZW5jYXAnLCAnLXAnLCBwbmddO1xuICAgIGF3YWl0IGFkYi5zaGVsbChjbWQpO1xuICAgIGlmICghYXdhaXQgYWRiLmZpbGVTaXplKHBuZykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHNpemUgb2YgdGhlIHRha2VuIHNjcmVlbnNob3QgZXF1YWxzIHRvIHplcm8uJyk7XG4gICAgfVxuICAgIGF3YWl0IGFkYi5wdWxsKHBuZywgbG9jYWxGaWxlKTtcbiAgICByZXR1cm4gYXdhaXQgamltcC5yZWFkKGxvY2FsRmlsZSk7XG4gIH0gZmluYWxseSB7XG4gICAgaWYgKGF3YWl0IGZzLmV4aXN0cyhsb2NhbEZpbGUpKSB7XG4gICAgICBhd2FpdCBmcy51bmxpbmsobG9jYWxGaWxlKTtcbiAgICB9XG4gIH1cbn07XG5cbmhlbHBlcnMuZ2V0U2NyZWVuc2hvdERhdGFXaXRoQWRiRXhlY091dCA9IGFzeW5jIGZ1bmN0aW9uIGdldFNjcmVlbnNob3REYXRhV2l0aEFkYkV4ZWNPdXQgKGFkYikge1xuICBsZXQge3N0ZG91dCwgc3RkZXJyLCBjb2RlfSA9IGF3YWl0IGV4ZWMoYWRiLmV4ZWN1dGFibGUucGF0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkYi5leGVjdXRhYmxlLmRlZmF1bHRBcmdzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jb25jYXQoWydleGVjLW91dCcsICcvc3lzdGVtL2Jpbi9zY3JlZW5jYXAnLCAnLXAnXSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7ZW5jb2Rpbmc6ICdiaW5hcnknLCBpc0J1ZmZlcjogdHJ1ZX0pO1xuICAvLyBpZiB0aGVyZSBpcyBhbiBlcnJvciwgdGhyb3dcbiAgaWYgKGNvZGUgfHwgc3RkZXJyLmxlbmd0aCkge1xuICAgIHRocm93IG5ldyBFcnJvcihgU2NyZWVuc2hvdCByZXR1cm5lZCBlcnJvciwgY29kZTogJyR7Y29kZX0nLCBzdGRlcnI6ICcke3N0ZGVyci50b1N0cmluZygpfSdgKTtcbiAgfVxuICAvLyBpZiB3ZSBkb24ndCBnZXQgYW55dGhpbmcgYXQgYWxsLCB0aHJvd1xuICBpZiAoIXN0ZG91dC5sZW5ndGgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1NjcmVlbnNob3QgcmV0dXJuZWQgbm8gZGF0YScpO1xuICB9XG5cbiAgcmV0dXJuIGF3YWl0IGppbXAucmVhZChzdGRvdXQpO1xufTtcblxuY29tbWFuZHMuZ2V0U2NyZWVuc2hvdCA9IGFzeW5jIGZ1bmN0aW9uIGdldFNjcmVlbnNob3QgKCkge1xuICBjb25zdCBhcGlMZXZlbCA9IGF3YWl0IHRoaXMuYWRiLmdldEFwaUxldmVsKCk7XG4gIGxldCBpbWFnZSA9IG51bGw7XG4gIGlmIChhcGlMZXZlbCA+IDIwKSB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFRoaXMgc2NyZWVuc2hvdGluZyBhcHByb2FjaCBpcyB3YXkgZmFzdGVyLCBzaW5jZSBpdCByZXF1aXJlcyBsZXNzIGV4dGVybmFsIGNvbW1hbmRzXG4gICAgICAvLyB0byBiZSBleGVjdXRlZC4gVW5mb3J0dW5hdGVseSwgZXhlYy1vdXQgb3B0aW9uIGlzIG9ubHkgc3VwcG9ydGVkIGJ5IG5ld2VyIEFuZHJvaWQvU0RLIHZlcnNpb25zICg1LjAgYW5kIGxhdGVyKVxuICAgICAgaW1hZ2UgPSBhd2FpdCB0aGlzLmdldFNjcmVlbnNob3REYXRhV2l0aEFkYkV4ZWNPdXQodGhpcy5hZGIpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGxvZy5pbmZvKGBDYW5ub3QgZ2V0IHNjcmVlbnNob3QgZGF0YSB3aXRoICdhZGIgZXhlYy1vdXQnIGJlY2F1c2Ugb2YgJyR7ZS5tZXNzYWdlfScuIGAgK1xuICAgICAgICAgICAgICAgYERlZmF1bHRpbmcgdG8gJ2FkYiBzaGVsbCcgY2FsbGApO1xuICAgIH1cbiAgfVxuICBpZiAoIWltYWdlKSB7XG4gICAgdHJ5IHtcbiAgICAgIGltYWdlID0gYXdhaXQgdGhpcy5nZXRTY3JlZW5zaG90RGF0YVdpdGhBZGJTaGVsbCh0aGlzLmFkYiwgdGhpcy5vcHRzKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zdCBlcnIgPSBgQ2Fubm90IGdldCBzY3JlZW5zaG90IGRhdGEgYmVjYXVzZSBvZiAnJHtlLm1lc3NhZ2V9Jy4gYCArXG4gICAgICAgICAgICAgICAgICBgTWFrZSBzdXJlIHRoZSAnTGF5b3V0UGFyYW1zLkZMQUdfU0VDVVJFJyBpcyBub3Qgc2V0IGZvciBgICtcbiAgICAgICAgICAgICAgICAgIGB0aGUgY3VycmVudCB2aWV3YDtcbiAgICAgIGxvZy5lcnJvckFuZFRocm93KGVycik7XG4gICAgfVxuICB9XG4gIGlmIChhcGlMZXZlbCA8IDIzKSB7XG4gICAgLy8gQW5kcm9pZCBidWcgODQzMzc0MiAtIHJvdGF0ZSBzY3JlZW5zaG90IGlmIHNjcmVlbiBpcyByb3RhdGVkXG4gICAgbGV0IHNjcmVlbk9yaWVudGF0aW9uID0gYXdhaXQgdGhpcy5hZGIuZ2V0U2NyZWVuT3JpZW50YXRpb24oKTtcbiAgICB0cnkge1xuICAgICAgaW1hZ2UgPSBhd2FpdCBpbWFnZS5yb3RhdGUoLTkwICogc2NyZWVuT3JpZW50YXRpb24pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLndhcm4oYENvdWxkIG5vdCByb3RhdGUgc2NyZWVuc2hvdCBkdWUgdG8gZXJyb3I6ICR7ZXJyfWApO1xuICAgIH1cbiAgfVxuICBjb25zdCBnZXRCdWZmZXIgPSBCLnByb21pc2lmeShpbWFnZS5nZXRCdWZmZXIsIHtjb250ZXh0OiBpbWFnZX0pO1xuICBjb25zdCBpbWdCdWZmZXIgPSBhd2FpdCBnZXRCdWZmZXIoamltcC5NSU1FX1BORyk7XG4gIHJldHVybiBpbWdCdWZmZXIudG9TdHJpbmcoJ2Jhc2U2NCcpO1xufTtcblxuT2JqZWN0LmFzc2lnbihleHRlbnNpb25zLCBjb21tYW5kcywgaGVscGVycyk7XG5leHBvcnQgeyBjb21tYW5kcywgaGVscGVycyB9O1xuZXhwb3J0IGRlZmF1bHQgZXh0ZW5zaW9ucztcbiJdLCJmaWxlIjoibGliL2NvbW1hbmRzL2FjdGlvbnMuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
