"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.desiredCapValidation = desiredCapValidation;
exports.default = exports.desiredCapConstraints = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("./logger"));

const desiredCapConstraints = {
  platformName: {
    presence: true,
    isString: true,
    inclusionCaseInsensitive: ['iOS']
  },
  browserName: {
    isString: true
  },
  app: {
    isString: true
  },
  launchTimeout: {},
  calendarFormat: {
    isString: true
  },
  bundleId: {
    isString: true
  },
  udid: {
    isString: true
  },
  locationServicesEnabled: {
    isBoolean: true
  },
  locationServicesAuthorized: {
    isBoolean: true
  },
  autoAcceptAlerts: {
    isBoolean: true
  },
  autoDismissAlerts: {
    isBoolean: true
  },
  nativeInstrumentsLib: {
    isBoolean: true
  },
  nativeWebTap: {
    isBoolean: true
  },
  safariInitialUrl: {
    isString: true
  },
  safariAllowPopups: {
    isBoolean: true
  },
  safariIgnoreFraudWarning: {
    isBoolean: true
  },
  safariOpenLinksInBackground: {
    isBoolean: true
  },
  safariGarbageCollect: {
    isBoolean: true
  },
  keepKeyChains: {
    isBoolean: true
  },
  localizableStringsDir: {
    isString: true
  },
  processArguments: {},
  interKeyDelay: {
    isNumber: true
  },
  showIOSLog: {
    isBoolean: true
  },
  sendKeyStrategy: {
    isString: true,
    inclusion: ['oneByOne', 'grouped', 'setValue']
  },
  screenshotWaitTimeout: {
    isNumber: true
  },
  waitForAppScript: {
    isString: true
  },
  webviewConnectRetries: {
    isNumber: true
  },
  appName: {
    isString: true
  },
  clearSystemFiles: {
    isBoolean: true
  },
  customSSLCert: {
    isString: true
  },
  webkitResponseTimeout: {
    isNumber: true
  },
  webkitDebugProxyPort: {
    isNumber: true
  },
  remoteDebugProxy: {
    isString: true
  },
  enablePerformanceLogging: {
    isBoolean: true
  },
  enableAsyncExecuteFromHttps: {
    isBoolean: true
  },
  realDeviceLogger: {
    isString: true
  },
  fullContextList: {
    isBoolean: true
  },
  ignoreAboutBlankUrl: {
    isBoolean: true
  },
  startIWDP: {
    isBoolean: true
  },
  showIWDPLog: {
    isBoolean: true
  },
  skipLogCapture: {
    isBoolean: true
  }
};
exports.desiredCapConstraints = desiredCapConstraints;

function desiredCapValidation(caps) {
  if ((caps.browserName || '').toLowerCase() !== 'safari' && !caps.app && !caps.bundleId) {
    let msg = 'The desired capabilities must include either an app or a bundleId for iOS';

    _logger.default.errorAndThrow(msg);
  }

  if (caps.launchTimeout) {
    let msg = 'launchTimeout must be a number, object, or string JSON object';

    if (!_lodash.default.isNumber(caps.launchTimeout)) {
      if (_lodash.default.isString(caps.launchTimeout)) {
        try {
          caps.launchTimeout = JSON.parse(caps.launchTimeout);
        } catch (err) {
          _logger.default.errorAndThrow(msg);
        }
      }

      if (!_lodash.default.isObject(caps.launchTimeout)) {
        _logger.default.errorAndThrow(msg);
      }
    }
  }

  if (caps.processArguments) {
    if (_lodash.default.isString(caps.processArguments)) {
      try {
        caps.processArguments = JSON.parse(caps.processArguments);
      } catch (ign) {}
    } else if (!_lodash.default.isObject(caps.processArguments)) {
      _logger.default.errorAndThrow('processArguments must be a string, object, or a string JSON object');
    }
  }

  if (typeof caps.enablePerformanceLogging !== 'boolean' && typeof caps.loggingPrefs === 'object' && caps.loggingPrefs.performance) {
    caps.enablePerformanceLogging = !!caps.loggingPrefs.performance;
  }

  return true;
}

var _default = desiredCapConstraints;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9kZXNpcmVkLWNhcHMuanMiXSwibmFtZXMiOlsiZGVzaXJlZENhcENvbnN0cmFpbnRzIiwicGxhdGZvcm1OYW1lIiwicHJlc2VuY2UiLCJpc1N0cmluZyIsImluY2x1c2lvbkNhc2VJbnNlbnNpdGl2ZSIsImJyb3dzZXJOYW1lIiwiYXBwIiwibGF1bmNoVGltZW91dCIsImNhbGVuZGFyRm9ybWF0IiwiYnVuZGxlSWQiLCJ1ZGlkIiwibG9jYXRpb25TZXJ2aWNlc0VuYWJsZWQiLCJpc0Jvb2xlYW4iLCJsb2NhdGlvblNlcnZpY2VzQXV0aG9yaXplZCIsImF1dG9BY2NlcHRBbGVydHMiLCJhdXRvRGlzbWlzc0FsZXJ0cyIsIm5hdGl2ZUluc3RydW1lbnRzTGliIiwibmF0aXZlV2ViVGFwIiwic2FmYXJpSW5pdGlhbFVybCIsInNhZmFyaUFsbG93UG9wdXBzIiwic2FmYXJpSWdub3JlRnJhdWRXYXJuaW5nIiwic2FmYXJpT3BlbkxpbmtzSW5CYWNrZ3JvdW5kIiwic2FmYXJpR2FyYmFnZUNvbGxlY3QiLCJrZWVwS2V5Q2hhaW5zIiwibG9jYWxpemFibGVTdHJpbmdzRGlyIiwicHJvY2Vzc0FyZ3VtZW50cyIsImludGVyS2V5RGVsYXkiLCJpc051bWJlciIsInNob3dJT1NMb2ciLCJzZW5kS2V5U3RyYXRlZ3kiLCJpbmNsdXNpb24iLCJzY3JlZW5zaG90V2FpdFRpbWVvdXQiLCJ3YWl0Rm9yQXBwU2NyaXB0Iiwid2Vidmlld0Nvbm5lY3RSZXRyaWVzIiwiYXBwTmFtZSIsImNsZWFyU3lzdGVtRmlsZXMiLCJjdXN0b21TU0xDZXJ0Iiwid2Via2l0UmVzcG9uc2VUaW1lb3V0Iiwid2Via2l0RGVidWdQcm94eVBvcnQiLCJyZW1vdGVEZWJ1Z1Byb3h5IiwiZW5hYmxlUGVyZm9ybWFuY2VMb2dnaW5nIiwiZW5hYmxlQXN5bmNFeGVjdXRlRnJvbUh0dHBzIiwicmVhbERldmljZUxvZ2dlciIsImZ1bGxDb250ZXh0TGlzdCIsImlnbm9yZUFib3V0QmxhbmtVcmwiLCJzdGFydElXRFAiLCJzaG93SVdEUExvZyIsInNraXBMb2dDYXB0dXJlIiwiZGVzaXJlZENhcFZhbGlkYXRpb24iLCJjYXBzIiwidG9Mb3dlckNhc2UiLCJtc2ciLCJsb2dnZXIiLCJlcnJvckFuZFRocm93IiwiXyIsIkpTT04iLCJwYXJzZSIsImVyciIsImlzT2JqZWN0IiwiaWduIiwibG9nZ2luZ1ByZWZzIiwicGVyZm9ybWFuY2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUdBLE1BQU1BLHFCQUFxQixHQUFHO0FBQzVCQyxFQUFBQSxZQUFZLEVBQUU7QUFDWkMsSUFBQUEsUUFBUSxFQUFFLElBREU7QUFFWkMsSUFBQUEsUUFBUSxFQUFFLElBRkU7QUFHWkMsSUFBQUEsd0JBQXdCLEVBQUUsQ0FBQyxLQUFEO0FBSGQsR0FEYztBQU01QkMsRUFBQUEsV0FBVyxFQUFFO0FBQ1hGLElBQUFBLFFBQVEsRUFBRTtBQURDLEdBTmU7QUFTNUJHLEVBQUFBLEdBQUcsRUFBRTtBQUNISCxJQUFBQSxRQUFRLEVBQUU7QUFEUCxHQVR1QjtBQVk1QkksRUFBQUEsYUFBYSxFQUFFLEVBWmE7QUFnQjVCQyxFQUFBQSxjQUFjLEVBQUU7QUFDZEwsSUFBQUEsUUFBUSxFQUFFO0FBREksR0FoQlk7QUFtQjVCTSxFQUFBQSxRQUFRLEVBQUU7QUFDUk4sSUFBQUEsUUFBUSxFQUFFO0FBREYsR0FuQmtCO0FBc0I1Qk8sRUFBQUEsSUFBSSxFQUFFO0FBQ0pQLElBQUFBLFFBQVEsRUFBRTtBQUROLEdBdEJzQjtBQXlCNUJRLEVBQUFBLHVCQUF1QixFQUFFO0FBQ3ZCQyxJQUFBQSxTQUFTLEVBQUU7QUFEWSxHQXpCRztBQTRCNUJDLEVBQUFBLDBCQUEwQixFQUFFO0FBQzFCRCxJQUFBQSxTQUFTLEVBQUU7QUFEZSxHQTVCQTtBQStCNUJFLEVBQUFBLGdCQUFnQixFQUFFO0FBQ2hCRixJQUFBQSxTQUFTLEVBQUU7QUFESyxHQS9CVTtBQWtDNUJHLEVBQUFBLGlCQUFpQixFQUFFO0FBQ2pCSCxJQUFB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LElBQUksQ0FBQ3hCLGdCQUFMLEdBQXdCOEIsSUFBSSxDQUFDQyxLQUFMLENBQVdQLElBQUksQ0FBQ3hCLGdCQUFoQixDQUF4QjtBQUNELE9BSEQsQ0FHRSxPQUFPa0MsR0FBUCxFQUFZLENBRWI7QUFDRixLQVBELE1BT08sSUFBSSxDQUFDTCxnQkFBRUksUUFBRixDQUFXVCxJQUFJLENBQUN4QixnQkFBaEIsQ0FBTCxFQUF3QztBQUM3QzJCLHNCQUFPQyxhQUFQLENBQXFCLG9FQUFyQjtBQUNEO0FBQ0Y7O0FBSUQsTUFBSSxPQUFPSixJQUFJLENBQUNULHdCQUFaLEtBQXlDLFNBQXpDLElBQ0EsT0FBT1MsSUFBSSxDQUFDVyxZQUFaLEtBQTZCLFFBRDdCLElBQ3lDWCxJQUFJLENBQUNXLFlBQUwsQ0FBa0JDLFdBRC9ELEVBQzRFO0FBQzFFWixJQUFBQSxJQUFJLENBQUNULHdCQUFMLEdBQWdDLENBQUMsQ0FBQ1MsSUFBSSxDQUFDVyxZQUFMLENBQWtCQyxXQUFwRDtBQUNEOztBQUdELFNBQU8sSUFBUDtBQUNEOztlQUdjN0QscUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGxvZ2dlciBmcm9tICcuL2xvZ2dlcic7XG5cblxuY29uc3QgZGVzaXJlZENhcENvbnN0cmFpbnRzID0ge1xuICBwbGF0Zm9ybU5hbWU6IHtcbiAgICBwcmVzZW5jZTogdHJ1ZSxcbiAgICBpc1N0cmluZzogdHJ1ZSxcbiAgICBpbmNsdXNpb25DYXNlSW5zZW5zaXRpdmU6IFsnaU9TJ11cbiAgfSxcbiAgYnJvd3Nlck5hbWU6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuICBhcHA6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuICBsYXVuY2hUaW1lb3V0OiB7XG4gICAgLy8gcmVjb2duaXplIHRoZSBjYXAsXG4gICAgLy8gYnV0IHZhbGlkYXRlIGluIHRoZSBkcml2ZXIjdmFsaWRhdGVEZXNpcmVkQ2FwcyBtZXRob2RcbiAgfSxcbiAgY2FsZW5kYXJGb3JtYXQ6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuICBidW5kbGVJZDoge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIHVkaWQ6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuICBsb2NhdGlvblNlcnZpY2VzRW5hYmxlZDoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBsb2NhdGlvblNlcnZpY2VzQXV0aG9yaXplZDoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBhdXRvQWNjZXB0QWxlcnRzOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIGF1dG9EaXNtaXNzQWxlcnRzOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIG5hdGl2ZUluc3RydW1lbnRzTGliOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIG5hdGl2ZVdlYlRhcDoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBzYWZhcmlJbml0aWFsVXJsOiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgc2FmYXJpQWxsb3dQb3B1cHM6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgc2FmYXJpSWdub3JlRnJhdWRXYXJuaW5nOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIHNhZmFyaU9wZW5MaW5rc0luQmFja2dyb3VuZDoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBzYWZhcmlHYXJiYWdlQ29sbGVjdDoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBrZWVwS2V5Q2hhaW5zOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIGxvY2FsaXphYmxlU3RyaW5nc0Rpcjoge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIHByb2Nlc3NBcmd1bWVudHM6IHtcbiAgICAvLyByZWNvZ25pemUgdGhlIGNhcCxcbiAgICAvLyBidXQgdmFsaWRhdGUgaW4gdGhlIGRyaXZlciN2YWxpZGF0ZURlc2lyZWRDYXBzIG1ldGhvZFxuICB9LFxuICBpbnRlcktleURlbGF5OiB7XG4gICAgaXNOdW1iZXI6IHRydWVcbiAgfSxcbiAgc2hvd0lPU0xvZzoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBzZW5kS2V5U3RyYXRlZ3k6IHtcbiAgICBpc1N0cmluZzogdHJ1ZSxcbiAgICBpbmNsdXNpb246IFsnb25lQnlPbmUnLCAnZ3JvdXBlZCcsICdzZXRWYWx1ZSddXG4gIH0sXG4gIHNjcmVlbnNob3RXYWl0VGltZW91dDoge1xuICAgIGlzTnVtYmVyOiB0cnVlXG4gIH0sXG4gIHdhaXRGb3JBcHBTY3JpcHQ6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuICB3ZWJ2aWV3Q29ubmVjdFJldHJpZXM6IHtcbiAgICBpc051bWJlcjogdHJ1ZVxuICB9LFxuICBhcHBOYW1lOiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgY2xlYXJTeXN0ZW1GaWxlczoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBjdXN0b21TU0xDZXJ0OiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgd2Via2l0UmVzcG9uc2VUaW1lb3V0OiB7XG4gICAgaXNOdW1iZXI6IHRydWVcbiAgfSxcbiAgd2Via2l0RGVidWdQcm94eVBvcnQ6IHtcbiAgICBpc051bWJlcjogdHJ1ZVxuICB9LFxuICByZW1vdGVEZWJ1Z1Byb3h5OiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgZW5hYmxlUGVyZm9ybWFuY2VMb2dnaW5nOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIGVuYWJsZUFzeW5jRXhlY3V0ZUZyb21IdHRwczoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICByZWFsRGV2aWNlTG9nZ2VyOiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgZnVsbENvbnRleHRMaXN0OiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIGlnbm9yZUFib3V0QmxhbmtVcmw6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgc3RhcnRJV0RQOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIHNob3dJV0RQTG9nOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIHNraXBMb2dDYXB0dXJlOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG59O1xuXG5mdW5jdGlvbiBkZXNpcmVkQ2FwVmFsaWRhdGlvbiAoY2Fwcykge1xuICAvLyBtYWtlIHN1cmUgdGhhdCB0aGUgY2FwYWJpbGl0aWVzIGhhdmUgb25lIG9mIGBhcHBgIG9yIGBidW5kbGVJZGBcbiAgaWYgKChjYXBzLmJyb3dzZXJOYW1lIHx8ICcnKS50b0xvd2VyQ2FzZSgpICE9PSAnc2FmYXJpJyAmJlxuICAgICAgIWNhcHMuYXBwICYmICFjYXBzLmJ1bmRsZUlkKSB7XG4gICAgbGV0IG1zZyA9ICdUaGUgZGVzaXJlZCBjYXBhYmlsaXRpZXMgbXVzdCBpbmNsdWRlIGVpdGhlciBhbiBhcHAgb3IgYSBidW5kbGVJZCBmb3IgaU9TJztcbiAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdyhtc2cpO1xuICB9XG5cbiAgLy8gYGxhdW5jaFRpbWVvdXRgIGlzIG1vcmUgY29tcGxleCB0aGFuIHRoZSB2YWxpZGF0b3JzIGNhbiBlYXNpbHkgaGFuZGxlXG4gIC8vIGFuZCB0b28gc3BlY2lmaWMgZm9yIGEgZ2VuZXJhbGl6ZWQgdmFsaWRhdG9yIG9mIGl0cyBvd25cbiAgaWYgKGNhcHMubGF1bmNoVGltZW91dCkge1xuICAgIC8vIGl0IGNhbiBiZSBhIG51bWJlciwgYSBKU09OIHN0cmluZywgb3IgYW4gb2JqZWN0XG4gICAgbGV0IG1zZyA9ICdsYXVuY2hUaW1lb3V0IG11c3QgYmUgYSBudW1iZXIsIG9iamVjdCwgb3Igc3RyaW5nIEpTT04gb2JqZWN0JztcbiAgICBpZiAoIV8uaXNOdW1iZXIoY2Fwcy5sYXVuY2hUaW1lb3V0KSkge1xuICAgICAgaWYgKF8uaXNTdHJpbmcoY2Fwcy5sYXVuY2hUaW1lb3V0KSkge1xuICAgICAgICAvLyBpZiB0aGlzIGlzIGEgc3RyaW5nLCBpdCBtdXN0IGJlIGEgSlNPTiBzdHJpbmdcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBjaGFuZ2UgYGxhdW5jaFRpbWVvdXRgIHRvIGFuIG9iamVjdFxuICAgICAgICAgIGNhcHMubGF1bmNoVGltZW91dCA9IEpTT04ucGFyc2UoY2Fwcy5sYXVuY2hUaW1lb3V0KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgLy8gaXQgd2FzIGEgc3RyaW5nLCBidXQgbm90IHNvbWV0aGluZyBwYXJzYWJsZSBhcyBKU09OXG4gICAgICAgICAgbG9nZ2VyLmVycm9yQW5kVGhyb3cobXNnKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCFfLmlzT2JqZWN0KGNhcHMubGF1bmNoVGltZW91dCkpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yQW5kVGhyb3cobXNnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBgcHJvY2Vzc0FyZ3VtZW50c2AgaXMgbW9yZSBjb21wbGV4IGFzIGl0IGNhbiBiZSBhIHN0cmluZ1xuICAvLyBvciBhIGhhc2hcbiAgaWYgKGNhcHMucHJvY2Vzc0FyZ3VtZW50cykge1xuICAgIGlmIChfLmlzU3RyaW5nKGNhcHMucHJvY2Vzc0FyZ3VtZW50cykpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIHRyeSB0byBwYXJzZSB0aGUgc3RyaW5nIGFzIEpTT05cbiAgICAgICAgY2Fwcy5wcm9jZXNzQXJndW1lbnRzID0gSlNPTi5wYXJzZShjYXBzLnByb2Nlc3NBcmd1bWVudHMpO1xuICAgICAgfSBjYXRjaCAoaWduKSB7XG4gICAgICAgIC8vIGlmIHdlIGNhbm5vdCBwYXJzZSwganVzdCBsZWF2ZSBhcyBhIHN0cmluZ1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoIV8uaXNPYmplY3QoY2Fwcy5wcm9jZXNzQXJndW1lbnRzKSkge1xuICAgICAgbG9nZ2VyLmVycm9yQW5kVGhyb3coJ3Byb2Nlc3NBcmd1bWVudHMgbXVzdCBiZSBhIHN0cmluZywgb2JqZWN0LCBvciBhIHN0cmluZyBKU09OIG9iamVjdCcpO1xuICAgIH1cbiAgfVxuXG4gIC8vIHRoZXJlIGlzIGFuIHVuZG9jdW1lbnRlZCBsZWdhY3kgY2FwIGBsb2dnaW5nUHJlZnMucGVyZm9ybWFuY2VgIHRvIGVuYWJsZVxuICAvLyBwZXJmb3JtYW5jZSBsb2dnaW5nLiBUcmFuc2xhdGUgdG8gYGVuYWJsZVBlcmZvcm1hbmNlTG9nZ2luZ2BcbiAgaWYgKHR5cGVvZiBjYXBzLmVuYWJsZVBlcmZvcm1hbmNlTG9nZ2luZyAhPT0gJ2Jvb2xlYW4nICYmXG4gICAgICB0eXBlb2YgY2Fwcy5sb2dnaW5nUHJlZnMgPT09ICdvYmplY3QnICYmIGNhcHMubG9nZ2luZ1ByZWZzLnBlcmZvcm1hbmNlKSB7XG4gICAgY2Fwcy5lbmFibGVQZXJmb3JtYW5jZUxvZ2dpbmcgPSAhIWNhcHMubG9nZ2luZ1ByZWZzLnBlcmZvcm1hbmNlO1xuICB9XG5cbiAgLy8gZmluYWxseSwgcmV0dXJuIHRydWUgc2luY2UgdGhlIHN1cGVyY2xhc3MgY2hlY2sgcGFzc2VkLCBhcyBkaWQgdGhpc1xuICByZXR1cm4gdHJ1ZTtcbn1cblxuZXhwb3J0IHsgZGVzaXJlZENhcENvbnN0cmFpbnRzLCBkZXNpcmVkQ2FwVmFsaWRhdGlvbiB9O1xuZXhwb3J0IGRlZmF1bHQgZGVzaXJlZENhcENvbnN0cmFpbnRzO1xuIl0sImZpbGUiOiJsaWIvZGVzaXJlZC1jYXBzLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
