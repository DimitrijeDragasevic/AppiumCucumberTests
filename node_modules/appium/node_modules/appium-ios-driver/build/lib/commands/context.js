"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.WEBVIEW_BASE = exports.WEBVIEW_WIN = exports.NATIVE_WIN = exports.helpers = exports.commands = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _asyncbox = require("asyncbox");

var _appiumRemoteDebugger = require("appium-remote-debugger");

var _iosPerformanceLog = _interopRequireDefault(require("../device-log/ios-performance-log"));

var _appiumBaseDriver = require("appium-base-driver");

var _logger = _interopRequireDefault(require("../logger"));

var _appiumSupport = require("appium-support");

const NATIVE_WIN = 'NATIVE_APP';
exports.NATIVE_WIN = NATIVE_WIN;
const WEBVIEW_WIN = 'WEBVIEW';
exports.WEBVIEW_WIN = WEBVIEW_WIN;
const WEBVIEW_BASE = `${WEBVIEW_WIN}_`;
exports.WEBVIEW_BASE = WEBVIEW_BASE;
let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;

commands.getCurrentContext = async function getCurrentContext() {
  if (this.curContext && this.curContext !== NATIVE_WIN) {
    return `${WEBVIEW_BASE}${this.curContext}`;
  } else {
    return NATIVE_WIN;
  }
};

commands.getContexts = async function getContexts() {
  _logger.default.debug('Getting list of available contexts');

  let contexts = await this.getContextsAndViews(false);

  let mapFn = context => context.id.toString();

  if (this.opts.fullContextList) {
    mapFn = context => {
      return {
        id: context.id.toString(),
        title: context.view.title,
        url: context.view.url
      };
    };
  }

  return contexts.map(mapFn);
};

commands.setContext = async function setContext(name, callback, skipReadyCheck) {
  function alreadyInContext(desired, current) {
    return desired === current || desired === null && current === NATIVE_WIN || desired === NATIVE_WIN && current === null;
  }

  _logger.default.debug(`Attempting to set context to '${name}'`);

  if (alreadyInContext(name, this.curContext)) {} else if (name === NATIVE_WIN || name === null) {
    this.curContext = null;

    if (this.isRealDevice()) {
      this.remote.disconnect();
    }
  } else {
    if (_lodash.default.isUndefined(this.contexts)) {
      await this.getContexts();
    }

    let contextId = name.replace(WEBVIEW_BASE, '');

    if (contextId === '') {
      contextId = this.contexts[1];
    }

    if (!_lodash.default.includes(this.contexts, contextId)) {
      throw new _appiumBaseDriver.errors.NoSuchContextError();
    }

    if (this.isRealDevice()) {
      if (this.remote) {
        await this.remote.disconnect();
      }

      this.curContext = contextId;
      await this.remote.connect(contextId);
    } else {
      let [appIdKey, pageIdKey] = _lodash.default.map(contextId.split('.'), id => parseInt(id, 10));

      await this.remote.selectPage(appIdKey, pageIdKey, skipReadyCheck);
      this.curContext = contextId;
    }
  }

  if (this.opts.enablePerformanceLogging && this.remote) {
    _logger.default.debug(`Starting performance log on '${this.curContext}'`);

    this.logs.performance = new _iosPerformanceLog.default(this.remote);
    await this.logs.performance.startCapture();
  }
};

commands.getWindowHandle = async function getWindowHandle() {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  return this.curContext.toString();
};

commands.getWindowHandles = async function getWindowHandles() {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  this.windowHandleCache = await this.listWebFrames(false);

  const idArray = _lodash.default.map(this.windowHandleCache, 'id');

  if (!this.contexts) {
    this.contexts = idArray;
  }

  return _lodash.default.map(idArray, id => id.toString());
};

commands.setWindow = async function setWindow(name, skipReadyCheck) {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  if (!_lodash.default.includes(_lodash.default.map(this.windowHandleCache, 'id'), name)) {
    throw new _appiumBaseDriver.errors.NoSuchWindowError();
  }

  let pageIdKey = parseInt(name, 10);

  if (!this.isRealDevice()) {
    await this.remote.selectPage(pageIdKey, skipReadyCheck);
    this.curContext = this.curWindowHandle = name;
  } else {
    if (name === this.curWindowHandle) {
      _logger.default.debug(`Remote debugger is already connected to window '${name}'`);
    } else if (!_lodash.default.includes(_lodash.default.map(this.windowHandleCache, 'id'), name)) {
      throw new _appiumBaseDriver.errors.NoSuchWindowError();
    } else {
      await this.remote.disconnect();
      this.curContext = this.curWindowHandle = name;
      await this.remote.connect(name);
    }
  }
};

helpers.webContextIndex = function webContextIndex() {
  return this.curContext.replace(WEBVIEW_BASE, '') - 1;
};

extensions.initAutoWebview = async function initAutoWebview() {
  if (this.opts.autoWebview) {
    _logger.default.debug('Setting auto webview');

    await this.navToInitialWebview(this);
  }
};

extensions.getContextsAndViews = async function getContextsAndViews(useUrl = true) {
  _logger.default.debug('Retrieving contexts and views');

  let webviews = await this.listWebFrames(useUrl);
  let ctxs = [{
    id: NATIVE_WIN,
    view: {}
  }];
  this.contexts = [NATIVE_WIN];

  for (let view of webviews) {
    ctxs.push({
      id: `${WEBVIEW_BASE}${view.id}`,
      view
    });
    this.contexts.push(view.id.toString());
  }

  return ctxs;
};

extensions.getNewRemoteDebugger = async function getNewRemoteDebugger() {
  return new _appiumRemoteDebugger.RemoteDebugger({
    bundleId: this.opts.bundleId,
    useNewSafari: this.useNewSafari(),
    pageLoadMs: this.pageLoadMs,
    platformVersion: this.opts.platformVersion,
    isSafari: this.isSafari(),
    remoteDebugProxy: this.opts.remoteDebugProxy,
    garbageCollectOnExecute: _appiumSupport.util.hasValue(this.opts.safariGarbageCollect) ? !!this.opts.safariGarbageCollect : true
  });
};

extensions.listWebFrames = async function listWebFrames(useUrl = true) {
  if (!this.opts.bundleId) {
    _logger.default.errorAndThrow('Cannot enter web frame without a bundle ID');
  }

  useUrl = useUrl && !!this.getCurrentUrl();

  _logger.default.debug(`Selecting by url: ${useUrl} ${useUrl ? `(expected url: '${this.getCurrentUrl()}')` : ''}`);

  let currentUrl = useUrl ? this.getCurrentUrl() : undefined;
  let pageArray;

  if (this.isRealDevice() && this.remote && this.opts.bundleId) {
    pageArray = await this.remote.pageArrayFromJson(this.opts.ignoreAboutBlankUrl);
  } else if (this.remote && this.remote.appIdKey) {
    pageArray = await this.remote.selectApp(currentUrl, this.opts.webviewConnectRetries, this.opts.ignoreAboutBlankUrl);
  } else if (this.isRealDevice()) {
    try {
      this.remote = new _appiumRemoteDebugger.WebKitRemoteDebugger({
        port: this.opts.webkitDebugProxyPort,
        webkitResponseTimeout: this.opts.webkitResponseTimeout,
        platformVersion: this.opts.platformVersion,
        isSafari: this.isSafari()
      });
      pageArray = await this.remote.pageArrayFromJson(this.opts.ignoreAboutBlankUrl);
    } catch (err) {
      if (!_lodash.default.includes(err.message, 'connect ECONNREFUSED')) throw err;

      _logger.default.warn('Attempted to get a list of webview contexts but could not connect to ' + 'ios-webkit-debug-proxy. If you expect to find webviews, please ensure ' + 'that the proxy is running and accessible');

      this.remote = null;
      pageArray = [];
    }
  } else {
    this.remote = await this.getNewRemoteDebugger();
    let appInfo = await this.remote.connect();

    if (!appInfo) {
      _logger.default.debug('Unable to connect to the remote debugger.');

      return [];
    }

    pageArray = await this.remote.selectApp(currentUrl, this.opts.webviewConnectRetries, this.opts.ignoreAboutBlankUrl);
    this.remote.on(_appiumRemoteDebugger.RemoteDebugger.EVENT_PAGE_CHANGE, this.onPageChange.bind(this));
    this.remote.on(_appiumRemoteDebugger.RemoteDebugger.EVENT_FRAMES_DETACHED, () => {
      if (!_lodash.default.isEmpty(this.curWebFrames)) {
        _logger.default.debug(`Clearing ${this.curWebFrames.length} frames: ${this.curWebFrames.join(', ')}`);
      }

      this.curWebFrames = [];
    });

    let tryClosingAlert = async () => {
      let didDismiss = await this.closeAlertBeforeTest();

      if (!didDismiss) {
        throw new Error('Close alert failed. Retry.');
      }
    };

    try {
      await (0, _asyncbox.retryInterval)(3, 4000, tryClosingAlert);
    } catch (err) {
      if (err.message !== 'Close alert failed. Retry.') {
        _logger.default.errorAndThrow(err);
      }
    }
  }

  if (pageArray.length === 0) {
    _logger.default.debug('No web frames found.');
  }

  return pageArray;
};

extensions.onPageChange = async function onPageChange(pageChangeNotification) {
  _logger.default.debug(`Remote debugger notified us of a new page listing: ${JSON.stringify(pageChangeNotification)}`);

  if (this.selectingNewPage) {
    _logger.default.debug('We are in the middle of selecting a page, ignoring');

    return;
  }

  if (!this.remote || !this.remote.isConnected()) {
    _logger.default.debug('We have not yet connected, ignoring');

    return;
  }

  const {
    appIdKey,
    pageArray
  } = pageChangeNotification;
  let newIds = [];
  let newPages = [];
  let keyId = null;

  for (const page of pageArray) {
    const id = page.id.toString();
    newIds.push(id);

    if (page.isKey) {
      keyId = id;
    }

    const contextId = `${appIdKey}.${id}`;

    if (!_lodash.default.includes(this.contexts, contextId)) {
      newPages.push(id);
      this.contexts.push(contextId);
    }
  }

  if (!keyId) {
    _logger.default.debug('No key id found. Choosing first id from page array');

    keyId = newIds[0] || null;
  }

  if (!_appiumSupport.util.hasValue(this.curContext)) {
    _logger.default.debug('We do not appear to have window set yet, ignoring');

    return;
  }

  const [curAppIdKey, curPageIdKey] = this.curContext.split('.');

  if (curAppIdKey !== appIdKey) {
    _logger.default.debug('Page change not referring to currently selected app, ignoring.');

    return;
  }

  let newPage = null;

  if (newPages.length) {
    newPage = _lodash.default.last(newPages);

    _logger.default.debug(`We have new pages, selecting page '${newPage}'`);
  } else if (!_lodash.default.includes(newIds, curPageIdKey)) {
    _logger.default.debug('New page listing from remote debugger does not contain ' + 'current window; assuming it is closed');

    if (!_appiumSupport.util.hasValue(keyId)) {
      _logger.default.error('Do not have our current window anymore, and there ' + 'are not any more to load! Doing nothing...');

      this.setCurrentUrl(undefined);
      return;
    }

    _logger.default.debug(`Debugger already selected page '${keyId}', ` + `confirming that choice.`);

    this.curContext = `${appIdKey}.${keyId}`;
    newPage = keyId;
  } else {
    _logger.default.debug('Checking if page needs to load');

    const needsPageLoad = (() => {
      const contextArray = _lodash.default.map(pageArray, page => `${appIdKey}.${page.id}`);

      return !_lodash.default.isEqual(_lodash.default.find(this.contexts, this.curContext), _lodash.default.find(contextArray, this.curContext));
    })();

    if (needsPageLoad) {
      _logger.default.debug('Page load needed. Loading...');

      await this.remote.pageLoad();
    }

    _logger.default.debug('New page listing is same as old, doing nothing');
  }

  if (_appiumSupport.util.hasValue(this.curContext)) {
    let currentPageId = parseInt(_lodash.default.last(this.curContext.split('.')), 10);

    let page = _lodash.default.find(pageArray, p => parseInt(p.id, 10) === currentPageId);

    if (page && page.url !== this.getCurrentUrl()) {
      _logger.default.debug(`Redirected from '${this.getCurrentUrl()}' to '${page.url}'`);

      this.setCurrentUrl(page.url);
    }
  }

  if (_appiumSupport.util.hasValue(newPage)) {
    this.selectingNewPage = true;
    await this.remote.selectPage(appIdKey, parseInt(newPage, 10));
    this.selectingNewPage = false;
    this.curContext = `${appIdKey}.${newPage}`;
  }

  this.windowHandleCache = pageArray;
};

extensions.getLatestWebviewContextForTitle = async function getLatestWebviewContextForTitle(regExp) {
  let contexts = await this.getContextsAndViews();
  let matchingCtx;

  for (let ctx of contexts) {
    if (ctx.view && (ctx.view.title && ctx.view.title.match(regExp) || ctx.view.url && ctx.view.url.match(regExp))) {
      if (ctx.view.url !== 'about:blank') {
        matchingCtx = ctx;
      } else {
        if (parseFloat(this.iosSdkVersion) < 7 || parseFloat(this.iosSdkVersion) >= 9 || this.opts.platformVersion === '7.1' && this.opts.app && this.opts.app.toLowerCase() !== 'safari') {
          matchingCtx = ctx;
        }
      }

      break;
    }
  }

  return matchingCtx ? matchingCtx.id : undefined;
};

extensions.useNewSafari = function useNewSafari() {
  return parseFloat(this.iosSdkVersion) >= 8.1 && parseFloat(this.opts.platformVersion) >= 8.1 && !this.isRealDevice() && this.opts.safari;
};

extensions.navToInitialWebview = async function navToInitialWebview() {
  let timeout = 0;

  if (this.isRealDevice()) {
    timeout = 3000;

    _logger.default.debug(`Waiting for ${timeout} ms before navigating to view.`);
  }

  await _bluebird.default.delay(timeout);

  if (this.useNewSafari()) {
    await this.typeAndNavToUrl();
  } else if (parseInt(this.iosSdkVersion, 10) >= 7 && !this.isRealDevice() && this.opts.safari) {
    await this.navToViewThroughFavorites();
  } else {
    await this.navToViewWithTitle(/.*/);
  }
};

async function openNewPage() {
  let newPageButton = await this.findElement('xpath', "//UIAButton[contains(@name,'New page')]");
  await this.nativeTap(newPageButton.ELEMENT);
}

extensions.typeAndNavToUrl = async function typeAndNavToUrl() {
  let address = this.opts.address ? this.opts.address : '127.0.0.1';
  this.setCurrentUrl(this.caps.safariInitialUrl || `http://${address}:${this.opts.port}/welcome`);
  let tries = 0;
  const MAX_TRIES = 2;

  let navigate = async () => {
    let oldImpWait = this.implicitWaitMs;
    this.implicitWaitMs = 7000;
    let el = await (0, _asyncbox.retryInterval)(3, 1000, async () => {
      return await this.findElement('accessibility id', 'URL');
    });
    this.implicitWaitMs = oldImpWait;

    try {
      await this.nativeTap(el.ELEMENT);
    } catch (err) {
      if (_lodash.default.includes(err.message, 'could not be tapped')) {
        if (tries++ >= MAX_TRIES) throw err;
        await openNewPage();
        return await navigate();
      } else {
        throw err;
      }
    }

    try {
      let el = await this.findElement('class name', 'UIATextField');
      await this.setValueImmediate(this.getCurrentUrl(), el);
    } catch (err) {
      if (tries++ >= MAX_TRIES) throw err;
      return await navigate();
    }

    try {
      el = await this.findElement('accessibility id', 'Go');
      await this.nativeTap(el.ELEMENT);
    } catch (err) {
      if (_lodash.default.includes(err.message, 'could not be tapped')) {
        _logger.default.error('Unable to submit URL because \'Go\' button could not be tapped. ' + 'Please make sure your keyboard is toggled on.');
      }

      throw err;
    }

    await this.navToViewWithTitle(undefined, new RegExp(this.getCurrentUrl(), 'i'));
    await this.remote.pageUnload();
  };

  await navigate();
};

extensions.navToViewThroughFavorites = async function navToViewThroughFavorites() {
  _logger.default.debug('We are on iOS7+ simulator: clicking apple button to get into a webview');

  let oldImpWait = this.implicitWaitMs;
  this.implicitWaitMs = 7000;
  let el;

  try {
    el = await this.findElement('xpath', '//UIAScrollView[1]/UIAButton[1]');
  } catch (err) {
    let msg = 'Could not find button to click to get into webview. ' + 'Proceeding on the assumption we have a working one.';

    _logger.default.error(msg);

    this.implicitWaitMs = oldImpWait;
    return await this.navToViewWithTitle(/.*/i);
  }

  this.implicitWaitMs = oldImpWait;

  try {
    await this.nativeTap(el.ELEMENT);
  } catch (err) {
    let msg = 'Could not click button to get into webview. ' + 'Proceeding on the assumption we have a working one.';

    _logger.default.error(msg);
  }

  await this.navToViewWithTitle(/apple/i);
};

extensions.navToViewWithTitle = async function navToViewWithTitle(titleRegex, urlRegExp) {
  _logger.default.debug('Navigating to most recently opened webview');

  let start = Date.now();
  let spinTime = 500;

  let spinHandles = async () => {
    let res;

    try {
      res = await this.getLatestWebviewContextForTitle(titleRegex || urlRegExp);
    } catch (err) {
      if (!err.message.includes('Could not connect to a valid app after')) {
        const error = new Error(`Could not navigate to webview! Err: ${err.message}`);
        error.stack += `\nCaused by: ${err.stack}`;
        throw error;
      }

      _logger.default.debug('Could not navigate to webview. Retrying if possible.');
    }

    if (res) {
      let latestWindow = res;

      _logger.default.debug(`Picking webview '${latestWindow}'`);

      await this.setContext(latestWindow);
      await this.remote.cancelPageLoad();
      return;
    }

    if (Date.now() - start >= 90000) {
      throw new Error('Could not navigate to webview; there are none!');
    }

    _logger.default.warn('Could not find any webviews yet, refreshing/retrying');

    if (this.isRealDevice() || !this.opts.safari) {
      await _bluebird.default.delay(spinTime);
      return await spinHandles();
    }

    let element;

    try {
      _logger.default.debug('Finding and tapping reload button');

      element = await this.findUIElementOrElements('accessibility id', 'ReloadButton', '', false);
      await this.nativeTap(element.ELEMENT);
    } catch (err) {
      _logger.default.warn(`Error finding and tapping reload button: ${err.message}`);

      _logger.default.warn('Retrying.');

      await _bluebird.default.delay(spinTime);
    }

    return await spinHandles();
  };

  await spinHandles();
};

helpers.closeAlertBeforeTest = async function closeAlertBeforeTest() {
  let present = await this.uiAutoClient.sendCommand('au.alertIsPresent()');

  if (!present) {
    return false;
  }

  _logger.default.debug('Alert present before starting test, let us banish it');

  await this.uiAutoClient.sendCommand('au.dismissAlert()');

  _logger.default.debug('Alert banished!');

  return true;
};

helpers.stopRemote = async function stopRemote(closeWindowBeforeDisconnecting = false) {
  if (!this.remote) {
    _logger.default.errorAndThrow('Tried to leave a web frame but were not in one');
  }

  if (closeWindowBeforeDisconnecting) {
    await this.closeWindow();
  }

  await this.remote.disconnect();
  this.curContext = null;
  this.curWebFrames = [];
  this.curWebCoords = null;
  this.remote = null;
};

helpers.isWebContext = function isWebContext() {
  return !!this.curContext && this.curContext !== NATIVE_WIN;
};

helpers.setCurrentUrl = function setCurrentUrl(url) {
  this._currentUrl = url;
};

helpers.getCurrentUrl = function getCurrentUrl() {
  return this._currentUrl;
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9jb250ZXh0LmpzIl0sIm5hbWVzIjpbIk5BVElWRV9XSU4iLCJXRUJWSUVXX1dJTiIsIldFQlZJRVdfQkFTRSIsImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJnZXRDdXJyZW50Q29udGV4dCIsImN1ckNvbnRleHQiLCJnZXRDb250ZXh0cyIsImxvZ2dlciIsImRlYnVnIiwiY29udGV4dHMiLCJnZXRDb250ZXh0c0FuZFZpZXdzIiwibWFwRm4iLCJjb250ZXh0IiwiaWQiLCJ0b1N0cmluZyIsIm9wdHMiLCJmdWxsQ29udGV4dExpc3QiLCJ0aXRsZSIsInZpZXciLCJ1cmwiLCJtYXAiLCJzZXRDb250ZXh0IiwibmFtZSIsImNhbGxiYWNrIiwic2tpcFJlYWR5Q2hlY2siLCJhbHJlYWR5SW5Db250ZXh0IiwiZGVzaXJlZCIsImN1cnJlbnQiLCJpc1JlYWxEZXZpY2UiLCJyZW1vdGUiLCJkaXNjb25uZWN0IiwiXyIsImlzVW5kZWZpbmVkIiwiY29udGV4dElkIiwicmVwbGFjZSIsImluY2x1ZGVzIiwiZXJyb3JzIiwiTm9TdWNoQ29udGV4dEVycm9yIiwiY29ubmVjdCIsImFwcElkS2V5IiwicGFnZUlkS2V5Iiwic3BsaXQiLCJwYXJzZUludCIsInNlbGVjdFBhZ2UiLCJlbmFibGVQZXJmb3JtYW5jZUxvZ2dpbmciLCJsb2dzIiwicGVyZm9ybWFuY2UiLCJJT1NQZXJmb3JtYW5jZUxvZyIsInN0YXJ0Q2FwdHVyZSIsImdldFdpbmRvd0hhbmRsZSIsImlzV2ViQ29udGV4dCIsIk5vdEltcGxlbWVudGVkRXJyb3IiLCJnZXRXaW5kb3dIYW5kbGVzIiwid2luZG93SGFuZGxlQ2FjaGUiLCJsaXN0V2ViRnJhbWVzIiwiaWRBcnJheSIsInNldFdpbmRvdyIsIk5vU3VjaFdpbmRvd0Vycm9yIiwiY3VyV2luZG93SGFuZGxlIiwid2ViQ29udGV4dEluZGV4IiwiaW5pdEF1dG9XZWJ2aWV3IiwiYXV0b1dlYnZpZXciLCJuYXZUb0luaXRpYWxXZWJ2aWV3IiwidXNlVXJsIiwid2Vidmlld3MiLCJjdHhzIiwicHVzaCIsImdldE5ld1JlbW90ZURlYnVnZ2VyIiwiUmVtb3RlRGVidWdnZXIiLCJidW5kbGVJZCIsInVzZU5ld1NhZmFyaSIsInBhZ2VMb2FkTXMiLCJwbGF0Zm9ybVZlcnNpb24iLCJpc1NhZmFyaSIsInJlbW90ZURlYnVnUHJveHkiLCJnYXJiYWdlQ29sbGVjdE9uRXhlY3V0ZSIsInV0aWwiLCJoYXNWYWx1ZSIsInNhZmFyaUdhcmJhZ2VDb2xsZWN0IiwiZXJyb3JBbmRUaHJvdyIsImdldEN1cnJlbnRVcmwiLCJjdXJyZW50VXJsIiwidW5kZWZpbmVkIiwicGFnZUFycmF5IiwicGFnZUFycmF5RnJvbUpzb24iLCJpZ25vcmVBYm91dEJsYW5rVXJsIiwic2VsZWN0QXBwIiwid2Vidmlld0Nvbm5lY3RSZXRyaWVzIiwiV2ViS2l0UmVtb3RlRGVidWdnZXIiLCJwb3J0Iiwid2Via2l0RGVidWdQcm94eVBvcnQiLCJ3ZWJraXRSZXNwb25zZVRpbWVvdXQiLCJlcnIiLCJtZXNzYWdlIiwid2FybiIsImFwcEluZm8iLCJvbiIsIkVWRU5UX1BBR0VfQ0hBTkdFIiwib25QYWdlQ2hhbmdlIiwiYmluZCIsIkVWRU5UX0ZSQU1FU19ERVRBQ0hFRCIsImlzRW1wdHkiLCJjdXJXZWJGcmFtZXMiLCJsZW5ndGgiLCJqb2luIiwidHJ5Q2xvc2luZ0FsZXJ0IiwiZGlkRGlzbWlzcyIsImNsb3NlQWxlcnRCZWZvcmVUZXN0IiwiRXJyb3IiLCJwYWdlQ2hhbmdlTm90aWZpY2F0aW9uIiwiSlNPTiIsInN0cmluZ2lmeSIsInNlbGVjdGluZ05ld1BhZ2UiLCJpc0Nvbm5lY3RlZCIsIm5ld0lkcyIsIm5ld1BhZ2VzIiwia2V5SWQiLCJwYWdlIiwiaXNLZXkiLCJjdXJBcHBJZEtleSIsImN1clBhZ2VJZEtleSIsIm5ld1BhZ2UiLCJsYXN0IiwiZXJyb3IiLCJzZXRDdXJyZW50VXJsIiwibmVlZHNQYWdlTG9hZCIsImNvbnRleHRBcnJheSIsImlzRXF1YWwiLCJmaW5kIiwicGFnZUxvYWQiLCJjdXJyZW50UGFnZUlkIiwicCIsImdldExhdGVzdFdlYnZpZXdDb250ZXh0Rm9yVGl0bGUiLCJyZWdFeHAiLCJtYXRjaGluZ0N0eCIsImN0eCIsIm1hdGNoIiwicGFyc2VGbG9hdCIsImlvc1Nka1ZlcnNpb24iLCJhcHAiLCJ0b0xvd2VyQ2FzZSIsInNhZmFyaSIsInRpbWVvdXQiLCJCIiwiZGVsYXkiLCJ0eXBlQW5kTmF2VG9VcmwiLCJuYXZUb1ZpZXdUaHJvdWdoRmF2b3JpdGVzIiwibmF2VG9WaWV3V2l0aFRpdGxlIiwib3Blbk5ld1BhZ2UiLCJuZXdQYWdlQnV0dG9uIiwiZmluZEVsZW1lbnQiLCJuYXRpdmVUYXAiLCJFTEVNRU5UIiwiYWRkcmVzcyIsImNhcHMiLCJzYWZhcmlJbml0aWFsVXJsIiwidHJpZXMiLCJNQVhfVFJJRVMiLCJuYXZpZ2F0ZSIsIm9sZEltcFdhaXQiLCJpbXBsaWNpdFdhaXRNcyIsImVsIiwic2V0VmFsdWVJbW1lZGlhdGUiLCJSZWdFeHAiLCJwYWdlVW5sb2FkIiwibXNnIiwidGl0bGVSZWdleCIsInVybFJlZ0V4cCIsInN0YXJ0IiwiRGF0ZSIsIm5vdyIsInNwaW5UaW1lIiwic3BpbkhhbmRsZXMiLCJyZXMiLCJzdGFjayIsImxhdGVzdFdpbmRvdyIsImNhbmNlbFBhZ2VMb2FkIiwiZWxlbWVudCIsImZpbmRVSUVsZW1lbnRPckVsZW1lbnRzIiwicHJlc2VudCIsInVpQXV0b0NsaWVudCIsInNlbmRDb21tYW5kIiwic3RvcFJlbW90ZSIsImNsb3NlV2luZG93QmVmb3JlRGlzY29ubmVjdGluZyIsImNsb3NlV2luZG93IiwiY3VyV2ViQ29vcmRzIiwiX2N1cnJlbnRVcmwiLCJPYmplY3QiLCJhc3NpZ24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0EsTUFBTUEsVUFBVSxHQUFHLFlBQW5COztBQUNBLE1BQU1DLFdBQVcsR0FBRyxTQUFw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QUFDQSxPQUFLaUcsWUFBTCxHQUFvQixFQUFwQjtBQUNBLE9BQUttRixZQUFMLEdBQW9CLElBQXBCO0FBQ0EsT0FBSzVKLE1BQUwsR0FBYyxJQUFkO0FBQ0QsQ0FiRDs7QUFlQTNCLE9BQU8sQ0FBQ2dELFlBQVIsR0FBdUIsU0FBU0EsWUFBVCxHQUF5QjtBQUM5QyxTQUFPLENBQUMsQ0FBQyxLQUFLN0MsVUFBUCxJQUFxQixLQUFLQSxVQUFMLEtBQW9CUCxVQUFoRDtBQUNELENBRkQ7O0FBSUFJLE9BQU8sQ0FBQzBILGFBQVIsR0FBd0IsU0FBU0EsYUFBVCxDQUF3QnpHLEdBQXhCLEVBQTZCO0FBQ25ELE9BQUt1SyxXQUFMLEdBQW1CdkssR0FBbkI7QUFDRCxDQUZEOztBQUlBakIsT0FBTyxDQUFDOEUsYUFBUixHQUF3QixTQUFTQSxhQUFULEdBQTBCO0FBQ2hELFNBQU8sS0FBSzBHLFdBQVo7QUFDRCxDQUZEOztBQUtBQyxNQUFNLENBQUNDLE1BQVAsQ0FBY3pMLFVBQWQsRUFBMEJGLFFBQTFCLEVBQW9DQyxPQUFwQztlQUVlQyxVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCB7IHJldHJ5SW50ZXJ2YWwgfSBmcm9tICdhc3luY2JveCc7XG5pbXBvcnQgeyBSZW1vdGVEZWJ1Z2dlciwgV2ViS2l0UmVtb3RlRGVidWdnZXIgfSBmcm9tICdhcHBpdW0tcmVtb3RlLWRlYnVnZ2VyJztcbmltcG9ydCBJT1NQZXJmb3JtYW5jZUxvZyBmcm9tICcuLi9kZXZpY2UtbG9nL2lvcy1wZXJmb3JtYW5jZS1sb2cnO1xuaW1wb3J0IHsgZXJyb3JzIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCBsb2dnZXIgZnJvbSAnLi4vbG9nZ2VyJztcbmltcG9ydCB7IHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5cblxuY29uc3QgTkFUSVZFX1dJTiA9ICdOQVRJVkVfQVBQJztcbmNvbnN0IFdFQlZJRVdfV0lOID0gJ1dFQlZJRVcnO1xuY29uc3QgV0VCVklFV19CQVNFID0gYCR7V0VCVklFV19XSU59X2A7XG5cbmxldCBjb21tYW5kcyA9IHt9LCBoZWxwZXJzID0ge30sIGV4dGVuc2lvbnMgPSB7fTtcblxuY29tbWFuZHMuZ2V0Q3VycmVudENvbnRleHQgPSBhc3luYyBmdW5jdGlvbiBnZXRDdXJyZW50Q29udGV4dCAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICBpZiAodGhpcy5jdXJDb250ZXh0ICYmIHRoaXMuY3VyQ29udGV4dCAhPT0gTkFUSVZFX1dJTikge1xuICAgIHJldHVybiBgJHtXRUJWSUVXX0JBU0V9JHt0aGlzLmN1ckNvbnRleHR9YDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gTkFUSVZFX1dJTjtcbiAgfVxufTtcblxuY29tbWFuZHMuZ2V0Q29udGV4dHMgPSBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXh0cyAoKSB7XG4gIGxvZ2dlci5kZWJ1ZygnR2V0dGluZyBsaXN0IG9mIGF2YWlsYWJsZSBjb250ZXh0cycpO1xuICBsZXQgY29udGV4dHMgPSBhd2FpdCB0aGlzLmdldENvbnRleHRzQW5kVmlld3MoZmFsc2UpO1xuXG4gIGxldCBtYXBGbiA9IChjb250ZXh0KSA9PiBjb250ZXh0LmlkLnRvU3RyaW5nKCk7XG4gIGlmICh0aGlzLm9wdHMuZnVsbENvbnRleHRMaXN0KSB7XG4gICAgbWFwRm4gPSAoY29udGV4dCkgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaWQ6IGNvbnRleHQuaWQudG9TdHJpbmcoKSxcbiAgICAgICAgdGl0bGU6IGNvbnRleHQudmlldy50aXRsZSxcbiAgICAgICAgdXJsOiBjb250ZXh0LnZpZXcudXJsLFxuICAgICAgfTtcbiAgICB9O1xuICB9XG4gIHJldHVybiBjb250ZXh0cy5tYXAobWFwRm4pO1xufTtcblxuY29tbWFuZHMuc2V0Q29udGV4dCA9IGFzeW5jIGZ1bmN0aW9uIHNldENvbnRleHQgKG5hbWUsIGNhbGxiYWNrLCBza2lwUmVhZHlDaGVjaykge1xuICBmdW5jdGlvbiBhbHJlYWR5SW5Db250ZXh0IChkZXNpcmVkLCBjdXJyZW50KSB7XG4gICAgcmV0dXJuIChkZXNpcmVkID09PSBjdXJyZW50IHx8XG4gICAgICAgICAgIChkZXNpcmVkID09PSBudWxsICYmIGN1cnJlbnQgPT09IE5BVElWRV9XSU4pIHx8XG4gICAgICAgICAgIChkZXNpcmVkID09PSBOQVRJVkVfV0lOICYmIGN1cnJlbnQgPT09IG51bGwpKTtcbiAgfVxuXG4gIGxvZ2dlci5kZWJ1ZyhgQXR0ZW1wdGluZyB0byBzZXQgY29udGV4dCB0byAnJHtuYW1lfSdgKTtcbiAgaWYgKGFscmVhZHlJbkNvbnRleHQobmFtZSwgdGhpcy5jdXJDb250ZXh0KSkge1xuICAgIC8vIGFscmVhZHkgaW4gdGhlIG5hbWVkIGNvbnRleHQsIG5vIG5lZWQgdG8gZG8gYW55dGhpbmdcbiAgfSBlbHNlIGlmIChuYW1lID09PSBOQVRJVkVfV0lOIHx8IG5hbWUgPT09IG51bGwpIHtcbiAgICAvLyBzd2l0Y2hpbmcgaW50byB0aGUgbmF0aXZlIGNvbnRleHRcbiAgICB0aGlzLmN1ckNvbnRleHQgPSBudWxsO1xuICAgIGlmICh0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgICB0aGlzLnJlbW90ZS5kaXNjb25uZWN0KCk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIC8vIHN3aXRjaGluZyBpbnRvIGEgd2VidmlldyBjb250ZXh0XG5cbiAgICAvLyBpZiBjb250ZXh0cyBoYXZlIG5vdCBhbHJlYWR5IGJlZW4gcmV0cmlldmVkLCBnZXQgdGhlbVxuICAgIGlmIChfLmlzVW5kZWZpbmVkKHRoaXMuY29udGV4dHMpKSB7XG4gICAgICBhd2FpdCB0aGlzLmdldENvbnRleHRzKCk7XG4gICAgfVxuXG4gICAgbGV0IGNvbnRleHRJZCA9IG5hbWUucmVwbGFjZShXRUJWSUVXX0JBU0UsICcnKTtcbiAgICBpZiAoY29udGV4dElkID09PSAnJykge1xuICAgICAgLy8gYWxsb3cgdXNlciB0byBwYXNzIGluIFwiV0VCVklFV1wiIHdpdGhvdXQgYW4gaW5kZXhcbiAgICAgIC8vIHRoZSBzZWNvbmQgY29udGV4dCB3aWxsIGJlIHRoZSBmaXJzdCB3ZWJ2aWV3IGFzXG4gICAgICAvLyB0aGUgZmlyc3QgaXMgYWx3YXlzIE5BVElWRV9BUFBcbiAgICAgIGNvbnRleHRJZCA9IHRoaXMuY29udGV4dHNbMV07XG4gICAgfVxuICAgIGlmICghXy5pbmNsdWRlcyh0aGlzLmNvbnRleHRzLCBjb250ZXh0SWQpKSB7XG4gICAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaENvbnRleHRFcnJvcigpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgICBpZiAodGhpcy5yZW1vdGUpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5yZW1vdGUuZGlzY29ubmVjdCgpO1xuICAgICAgfVxuICAgICAgdGhpcy5jdXJDb250ZXh0ID0gY29udGV4dElkO1xuICAgICAgYXdhaXQgdGhpcy5yZW1vdGUuY29ubmVjdChjb250ZXh0SWQpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBgY29udGV4dElkYCB3aWxsIGJlIGluIHRoZSBmb3JtIG9mIGBhcHBJZC5wYWdlSWRgIGluIHRoaXMgY2FzZVxuICAgICAgbGV0IFthcHBJZEtleSwgcGFnZUlkS2V5XSA9IF8ubWFwKGNvbnRleHRJZC5zcGxpdCgnLicpLCAoaWQpID0+IHBhcnNlSW50KGlkLCAxMCkpO1xuICAgICAgYXdhaXQgdGhpcy5yZW1vdGUuc2VsZWN0UGFnZShhcHBJZEtleSwgcGFnZUlkS2V5LCBza2lwUmVhZHlDaGVjayk7XG4gICAgICB0aGlzLmN1ckNvbnRleHQgPSBjb250ZXh0SWQ7XG4gICAgfVxuICB9XG5cbiAgLy8gYXR0ZW1wdCB0byBzdGFydCBwZXJmb3JtYW5jZSBsb2dnaW5nLCBpZiByZXF1ZXN0ZWRcbiAgaWYgKHRoaXMub3B0cy5lbmFibGVQZXJmb3JtYW5jZUxvZ2dpbmcgJiYgdGhpcy5yZW1vdGUpIHtcbiAgICBsb2dnZXIuZGVidWcoYFN0YXJ0aW5nIHBlcmZvcm1hbmNlIGxvZyBvbiAnJHt0aGlzLmN1ckNvbnRleHR9J2ApO1xuICAgIHRoaXMubG9ncy5wZXJmb3JtYW5jZSA9IG5ldyBJT1NQZXJmb3JtYW5jZUxvZyh0aGlzLnJlbW90ZSk7XG4gICAgYXdhaXQgdGhpcy5sb2dzLnBlcmZvcm1hbmNlLnN0YXJ0Q2FwdHVyZSgpO1xuICB9XG59O1xuXG5jb21tYW5kcy5nZXRXaW5kb3dIYW5kbGUgPSBhc3luYyBmdW5jdGlvbiBnZXRXaW5kb3dIYW5kbGUgKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob3RJbXBsZW1lbnRlZEVycm9yKCk7XG4gIH1cbiAgcmV0dXJuIHRoaXMuY3VyQ29udGV4dC50b1N0cmluZygpO1xufTtcblxuY29tbWFuZHMuZ2V0V2luZG93SGFuZGxlcyA9IGFzeW5jIGZ1bmN0aW9uIGdldFdpbmRvd0hhbmRsZXMgKCkge1xuICBpZiAoIXRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vdEltcGxlbWVudGVkRXJyb3IoKTtcbiAgfVxuXG4gIHRoaXMud2luZG93SGFuZGxlQ2FjaGUgPSBhd2FpdCB0aGlzLmxpc3RXZWJGcmFtZXMoZmFsc2UpO1xuICBjb25zdCBpZEFycmF5ID0gXy5tYXAodGhpcy53aW5kb3dIYW5kbGVDYWNoZSwgJ2lkJyk7XG4gIC8vIHNpbmNlIHdlIHVzZSB0aGlzLmNvbnRleHRzIHRvIG1hbmFnZSBzZWxlY3RpbmcgZGVidWdnZXIgcGFnZXMsIG1ha2VcbiAgLy8gc3VyZSBpdCBnZXRzIHBvcHVsYXRlZCBldmVuIGlmIHNvbWVvbmUgZGlkIG5vdCB1c2UgdGhlXG4gIC8vIGdldENvbnRleHRzIG1ldGhvZFxuICBpZiAoIXRoaXMuY29udGV4dHMpIHtcbiAgICB0aGlzLmNvbnRleHRzID0gaWRBcnJheTtcbiAgfVxuICByZXR1cm4gXy5tYXAoaWRBcnJheSwgKGlkKSA9PiBpZC50b1N0cmluZygpKTtcbn07XG5cbmNvbW1hbmRzLnNldFdpbmRvdyA9IGFzeW5jIGZ1bmN0aW9uIHNldFdpbmRvdyAobmFtZSwgc2tpcFJlYWR5Q2hlY2spIHtcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob3RJbXBsZW1lbnRlZEVycm9yKCk7XG4gIH1cblxuICBpZiAoIV8uaW5jbHVkZXMoXy5tYXAodGhpcy53aW5kb3dIYW5kbGVDYWNoZSwgJ2lkJyksIG5hbWUpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob1N1Y2hXaW5kb3dFcnJvcigpO1xuICB9XG4gIGxldCBwYWdlSWRLZXkgPSBwYXJzZUludChuYW1lLCAxMCk7XG4gIGlmICghdGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgIGF3YWl0IHRoaXMucmVtb3RlLnNlbGVjdFBhZ2UocGFnZUlkS2V5LCBza2lwUmVhZHlDaGVjayk7XG4gICAgdGhpcy5jdXJDb250ZXh0ID0gdGhpcy5jdXJXaW5kb3dIYW5kbGUgPSBuYW1lO1xuICB9IGVsc2Uge1xuICAgIGlmIChuYW1lID09PSB0aGlzLmN1cldpbmRvd0hhbmRsZSkge1xuICAgICAgbG9nZ2VyLmRlYnVnKGBSZW1vdGUgZGVidWdnZXIgaXMgYWxyZWFkeSBjb25uZWN0ZWQgdG8gd2luZG93ICcke25hbWV9J2ApO1xuICAgIH0gZWxzZSBpZiAoIV8uaW5jbHVkZXMoXy5tYXAodGhpcy53aW5kb3dIYW5kbGVDYWNoZSwgJ2lkJyksIG5hbWUpKSB7XG4gICAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaFdpbmRvd0Vycm9yKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGF3YWl0IHRoaXMucmVtb3RlLmRpc2Nvbm5lY3QoKTtcbiAgICAgIHRoaXMuY3VyQ29udGV4dCA9IHRoaXMuY3VyV2luZG93SGFuZGxlID0gbmFtZTtcbiAgICAgIGF3YWl0IHRoaXMucmVtb3RlLmNvbm5lY3QobmFtZSk7XG4gICAgfVxuICB9XG59O1xuXG5oZWxwZXJzLndlYkNvbnRleHRJbmRleCA9IGZ1bmN0aW9uIHdlYkNvbnRleHRJbmRleCAoKSB7XG4gIHJldHVybiB0aGlzLmN1ckNvbnRleHQucmVwbGFjZShXRUJWSUVXX0JBU0UsICcnKSAtIDE7XG59O1xuXG5leHRlbnNpb25zLmluaXRBdXRvV2VidmlldyA9IGFzeW5jIGZ1bmN0aW9uIGluaXRBdXRvV2VidmlldyAoKSB7XG4gIGlmICh0aGlzLm9wdHMuYXV0b1dlYnZpZXcpIHtcbiAgICBsb2dnZXIuZGVidWcoJ1NldHRpbmcgYXV0byB3ZWJ2aWV3Jyk7XG4gICAgYXdhaXQgdGhpcy5uYXZUb0luaXRpYWxXZWJ2aWV3KHRoaXMpO1xuICB9XG59O1xuXG5leHRlbnNpb25zLmdldENvbnRleHRzQW5kVmlld3MgPSBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXh0c0FuZFZpZXdzICh1c2VVcmwgPSB0cnVlKSB7XG4gIGxvZ2dlci5kZWJ1ZygnUmV0cmlldmluZyBjb250ZXh0cyBhbmQgdmlld3MnKTtcbiAgbGV0IHdlYnZpZXdzID0gYXdhaXQgdGhpcy5saXN0V2ViRnJhbWVzKHVzZVVybCk7XG5cbiAgbGV0IGN0eHMgPSBbe2lkOiBOQVRJVkVfV0lOLCB2aWV3OiB7fX1dO1xuICB0aGlzLmNvbnRleHRzID0gW05BVElWRV9XSU5dO1xuICBmb3IgKGxldCB2aWV3IG9mIHdlYnZpZXdzKSB7XG4gICAgY3R4cy5wdXNoKHtpZDogYCR7V0VCVklFV19CQVNFfSR7dmlldy5pZH1gLCB2aWV3fSk7XG4gICAgdGhpcy5jb250ZXh0cy5wdXNoKHZpZXcuaWQudG9TdHJpbmcoKSk7XG4gIH1cbiAgcmV0dXJuIGN0eHM7XG59O1xuXG5leHRlbnNpb25zLmdldE5ld1JlbW90ZURlYnVnZ2VyID0gYXN5bmMgZnVuY3Rpb24gZ2V0TmV3UmVtb3RlRGVidWdnZXIgKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgcmV0dXJuIG5ldyBSZW1vdGVEZWJ1Z2dlcih7XG4gICAgYnVuZGxlSWQ6IHRoaXMub3B0cy5idW5kbGVJZCxcbiAgICB1c2VOZXdTYWZhcmk6IHRoaXMudXNlTmV3U2FmYXJpKCksXG4gICAgcGFnZUxvYWRNczogdGhpcy5wYWdlTG9hZE1zLFxuICAgIHBsYXRmb3JtVmVyc2lvbjogdGhpcy5vcHRzLnBsYXRmb3JtVmVyc2lvbixcbiAgICBpc1NhZmFyaTogdGhpcy5pc1NhZmFyaSgpLFxuICAgIHJlbW90ZURlYnVnUHJveHk6IHRoaXMub3B0cy5yZW1vdGVEZWJ1Z1Byb3h5LFxuICAgIGdhcmJhZ2VDb2xsZWN0T25FeGVjdXRlOiB1dGlsLmhhc1ZhbHVlKHRoaXMub3B0cy5zYWZhcmlHYXJiYWdlQ29sbGVjdClcbiAgICAgID8gISF0aGlzLm9wdHMuc2FmYXJpR2FyYmFnZUNvbGxlY3RcbiAgICAgIDogdHJ1ZSxcbiAgfSk7XG59O1xuXG5leHRlbnNpb25zLmxpc3RXZWJGcmFtZXMgPSBhc3luYyBmdW5jdGlvbiBsaXN0V2ViRnJhbWVzICh1c2VVcmwgPSB0cnVlKSB7XG4gIGlmICghdGhpcy5vcHRzLmJ1bmRsZUlkKSB7XG4gICAgbG9nZ2VyLmVycm9yQW5kVGhyb3coJ0Nhbm5vdCBlbnRlciB3ZWIgZnJhbWUgd2l0aG91dCBhIGJ1bmRsZSBJRCcpO1xuICB9XG5cbiAgdXNlVXJsID0gdXNlVXJsICYmICEhdGhpcy5nZXRDdXJyZW50VXJsKCk7XG4gIGxvZ2dlci5kZWJ1ZyhgU2VsZWN0aW5nIGJ5IHVybDogJHt1c2VVcmx9ICR7dXNlVXJsID8gYChleHBlY3RlZCB1cmw6ICcke3RoaXMuZ2V0Q3VycmVudFVybCgpfScpYCA6ICcnfWApO1xuXG4gIGxldCBjdXJyZW50VXJsID0gdXNlVXJsID8gdGhpcy5nZXRDdXJyZW50VXJsKCkgOiB1bmRlZmluZWQ7XG4gIGxldCBwYWdlQXJyYXk7XG4gIGlmICh0aGlzLmlzUmVhbERldmljZSgpICYmIHRoaXMucmVtb3RlICYmIHRoaXMub3B0cy5idW5kbGVJZCkge1xuICAgIC8vIHJlYWwgZGV2aWNlLCBhbmQgYWxyZWFkeSBjb25uZWN0ZWRcbiAgICBwYWdlQXJyYXkgPSBhd2FpdCB0aGlzLnJlbW90ZS5wYWdlQXJyYXlGcm9tSnNvbih0aGlzLm9wdHMuaWdub3JlQWJvdXRCbGFua1VybCk7XG4gIH0gZWxzZSBpZiAodGhpcy5yZW1vdGUgJiYgdGhpcy5yZW1vdGUuYXBwSWRLZXkpIHtcbiAgICAvLyBzaW11bGF0b3IsIGFuZCBhbHJlYWR5IGNvbm5lY3RlZFxuICAgIHBhZ2VBcnJheSA9IGF3YWl0IHRoaXMucmVtb3RlLnNlbGVjdEFwcChjdXJyZW50VXJsLCB0aGlzLm9wdHMud2Vidmlld0Nvbm5lY3RSZXRyaWVzLCB0aGlzLm9wdHMuaWdub3JlQWJvdXRCbGFua1VybCk7XG4gIH0gZWxzZSBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgIC8vIHJlYWwgZGV2aWNlLCBhbmQgbm90IGNvbm5lY3RlZFxuICAgIHRyeSB7XG4gICAgICB0aGlzLnJlbW90ZSA9IG5ldyBXZWJLaXRSZW1vdGVEZWJ1Z2dlcih7XG4gICAgICAgIHBvcnQ6IHRoaXMub3B0cy53ZWJraXREZWJ1Z1Byb3h5UG9ydCxcbiAgICAgICAgd2Via2l0UmVzcG9uc2VUaW1lb3V0OiB0aGlzLm9wdHMud2Via2l0UmVzcG9uc2VUaW1lb3V0LFxuICAgICAgICBwbGF0Zm9ybVZlcnNpb246IHRoaXMub3B0cy5wbGF0Zm9ybVZlcnNpb24sXG4gICAgICAgIGlzU2FmYXJpOiB0aGlzLmlzU2FmYXJpKCksXG4gICAgICB9KTtcbiAgICAgIHBhZ2VBcnJheSA9IGF3YWl0IHRoaXMucmVtb3RlLnBhZ2VBcnJheUZyb21Kc29uKHRoaXMub3B0cy5pZ25vcmVBYm91dEJsYW5rVXJsKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIC8vIGl0IGlzIHJlYXNvbmFibGUgdG8gZXhwZWN0IHRoYXQgdGhpcyBtaWdodCBiZSBjYWxsZWQgd2hlbiB0aGVyZSBpcyBub1xuICAgICAgLy8gd2Via2l0IHJlbW90ZSBkZWJ1Z2dlciB0byBjb25uZWN0IHRvXG4gICAgICBpZiAoIV8uaW5jbHVkZXMoZXJyLm1lc3NhZ2UsICdjb25uZWN0IEVDT05OUkVGVVNFRCcpKSB0aHJvdyBlcnI7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY3VybHlcblxuICAgICAgbG9nZ2VyLndhcm4oJ0F0dGVtcHRlZCB0byBnZXQgYSBsaXN0IG9mIHdlYnZpZXcgY29udGV4dHMgYnV0IGNvdWxkIG5vdCBjb25uZWN0IHRvICcgK1xuICAgICAgICAgICAgICAgICAgJ2lvcy13ZWJraXQtZGVidWctcHJveHkuIElmIHlvdSBleHBlY3QgdG8gZmluZCB3ZWJ2aWV3cywgcGxlYXNlIGVuc3VyZSAnICtcbiAgICAgICAgICAgICAgICAgICd0aGF0IHRoZSBwcm94eSBpcyBydW5uaW5nIGFuZCBhY2Nlc3NpYmxlJyk7XG4gICAgICB0aGlzLnJlbW90ZSA9IG51bGw7XG4gICAgICBwYWdlQXJyYXkgPSBbXTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgLy8gc2ltdWxhdG9yLCBhbmQgbm90IGNvbm5lY3RlZFxuICAgIHRoaXMucmVtb3RlID0gYXdhaXQgdGhpcy5nZXROZXdSZW1vdGVEZWJ1Z2dlcigpO1xuXG4gICAgbGV0IGFwcEluZm8gPSBhd2FpdCB0aGlzLnJlbW90ZS5jb25uZWN0KCk7XG4gICAgaWYgKCFhcHBJbmZvKSB7XG4gICAgICBsb2dnZXIuZGVidWcoJ1VuYWJsZSB0byBjb25uZWN0IHRvIHRoZSByZW1vdGUgZGVidWdnZXIuJyk7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIHBhZ2VBcnJheSA9IGF3YWl0IHRoaXMucmVtb3RlLnNlbGVjdEFwcChjdXJyZW50VXJsLCB0aGlzLm9wdHMud2Vidmlld0Nvbm5lY3RSZXRyaWVzLCB0aGlzLm9wdHMuaWdub3JlQWJvdXRCbGFua1VybCk7XG4gICAgdGhpcy5yZW1vdGUub24oUmVtb3RlRGVidWdnZXIuRVZFTlRfUEFHRV9DSEFOR0UsIHRoaXMub25QYWdlQ2hhbmdlLmJpbmQodGhpcykpO1xuICAgIHRoaXMucmVtb3RlLm9uKFJlbW90ZURlYnVnZ2VyLkVWRU5UX0ZSQU1FU19ERVRBQ0hFRCwgKCkgPT4ge1xuICAgICAgaWYgKCFfLmlzRW1wdHkodGhpcy5jdXJXZWJGcmFtZXMpKSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhgQ2xlYXJpbmcgJHt0aGlzLmN1cldlYkZyYW1lcy5sZW5ndGh9IGZyYW1lczogJHt0aGlzLmN1cldlYkZyYW1lcy5qb2luKCcsICcpfWApO1xuICAgICAgfVxuICAgICAgdGhpcy5jdXJXZWJGcmFtZXMgPSBbXTtcbiAgICB9KTtcblxuICAgIGxldCB0cnlDbG9zaW5nQWxlcnQgPSBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgZGlkRGlzbWlzcyA9IGF3YWl0IHRoaXMuY2xvc2VBbGVydEJlZm9yZVRlc3QoKTtcbiAgICAgIGlmICghZGlkRGlzbWlzcykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nsb3NlIGFsZXJ0IGZhaWxlZC4gUmV0cnkuJyk7XG4gICAgICB9XG4gICAgfTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgcmV0cnlJbnRlcnZhbCgzLCA0MDAwLCB0cnlDbG9zaW5nQWxlcnQpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgLy8gaWYgdGhlIGxvb3AgdG8gY2xvc2UgYWxlcnRzIGZhaWxlZCB0byBkaXNtaXNzLCBpZ25vcmUsXG4gICAgICAvLyBvdGhlcndpc2UgbG9nIGFuZCB0aHJvdyB0aGUgZXJyb3JcbiAgICAgIGlmIChlcnIubWVzc2FnZSAhPT0gJ0Nsb3NlIGFsZXJ0IGZhaWxlZC4gUmV0cnkuJykge1xuICAgICAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdyhlcnIpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGlmIChwYWdlQXJyYXkubGVuZ3RoID09PSAwKSB7XG4gICAgLy8gd2UgaGF2ZSBubyB3ZWIgZnJhbWVzLCBidXQgY29udGludWUgYW55d2F5XG4gICAgbG9nZ2VyLmRlYnVnKCdObyB3ZWIgZnJhbWVzIGZvdW5kLicpO1xuICB9XG4gIHJldHVybiBwYWdlQXJyYXk7XG59O1xuXG5leHRlbnNpb25zLm9uUGFnZUNoYW5nZSA9IGFzeW5jIGZ1bmN0aW9uIG9uUGFnZUNoYW5nZSAocGFnZUNoYW5nZU5vdGlmaWNhdGlvbikge1xuICBsb2dnZXIuZGVidWcoYFJlbW90ZSBkZWJ1Z2dlciBub3RpZmllZCB1cyBvZiBhIG5ldyBwYWdlIGxpc3Rpbmc6ICR7SlNPTi5zdHJpbmdpZnkocGFnZUNoYW5nZU5vdGlmaWNhdGlvbil9YCk7XG4gIGlmICh0aGlzLnNlbGVjdGluZ05ld1BhZ2UpIHtcbiAgICBsb2dnZXIuZGVidWcoJ1dlIGFyZSBpbiB0aGUgbWlkZGxlIG9mIHNlbGVjdGluZyBhIHBhZ2UsIGlnbm9yaW5nJyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmICghdGhpcy5yZW1vdGUgfHwgIXRoaXMucmVtb3RlLmlzQ29ubmVjdGVkKCkpIHtcbiAgICBsb2dnZXIuZGVidWcoJ1dlIGhhdmUgbm90IHlldCBjb25uZWN0ZWQsIGlnbm9yaW5nJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qge2FwcElkS2V5LCBwYWdlQXJyYXl9ID0gcGFnZUNoYW5nZU5vdGlmaWNhdGlvbjtcblxuICBsZXQgbmV3SWRzID0gW107XG4gIGxldCBuZXdQYWdlcyA9IFtdO1xuICBsZXQga2V5SWQgPSBudWxsO1xuICBmb3IgKGNvbnN0IHBhZ2Ugb2YgcGFnZUFycmF5KSB7XG4gICAgY29uc3QgaWQgPSBwYWdlLmlkLnRvU3RyaW5nKCk7XG4gICAgbmV3SWRzLnB1c2goaWQpO1xuICAgIGlmIChwYWdlLmlzS2V5KSB7XG4gICAgICBrZXlJZCA9IGlkO1xuICAgIH1cbiAgICBjb25zdCBjb250ZXh0SWQgPSBgJHthcHBJZEtleX0uJHtpZH1gO1xuXG4gICAgLy8gYWRkIGlmIHRoaXMgaXMgYSBuZXcgcGFnZVxuICAgIGlmICghXy5pbmNsdWRlcyh0aGlzLmNvbnRleHRzLCBjb250ZXh0SWQpKSB7XG4gICAgICBuZXdQYWdlcy5wdXNoKGlkKTtcbiAgICAgIHRoaXMuY29udGV4dHMucHVzaChjb250ZXh0SWQpO1xuICAgIH1cbiAgfVxuXG4gIGlmICgha2V5SWQpIHtcbiAgICAvLyBpZiB0aGVyZSBpcyBubyBrZXkgaWQsIHB1bGwgdGhlIGZpcnN0IGlkIGZyb20gdGhlIHBhZ2UgYXJyYXkgYW5kIHVzZSB0aGF0XG4gICAgLy8gYXMgYSBzdGFuZCBpblxuICAgIGxvZ2dlci5kZWJ1ZygnTm8ga2V5IGlkIGZvdW5kLiBDaG9vc2luZyBmaXJzdCBpZCBmcm9tIHBhZ2UgYXJyYXknKTtcbiAgICBrZXlJZCA9IG5ld0lkc1swXSB8fCBudWxsO1xuICB9XG5cbiAgaWYgKCF1dGlsLmhhc1ZhbHVlKHRoaXMuY3VyQ29udGV4dCkpIHtcbiAgICBsb2dnZXIuZGVidWcoJ1dlIGRvIG5vdCBhcHBlYXIgdG8gaGF2ZSB3aW5kb3cgc2V0IHlldCwgaWdub3JpbmcnKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBbY3VyQXBwSWRLZXksIGN1clBhZ2VJZEtleV0gPSB0aGlzLmN1ckNvbnRleHQuc3BsaXQoJy4nKTtcblxuICBpZiAoY3VyQXBwSWRLZXkgIT09IGFwcElkS2V5KSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdQYWdlIGNoYW5nZSBub3QgcmVmZXJyaW5nIHRvIGN1cnJlbnRseSBzZWxlY3RlZCBhcHAsIGlnbm9yaW5nLicpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxldCBuZXdQYWdlID0gbnVsbDtcbiAgaWYgKG5ld1BhZ2VzLmxlbmd0aCkge1xuICAgIG5ld1BhZ2UgPSBfLmxhc3QobmV3UGFnZXMpO1xuICAgIGxvZ2dlci5kZWJ1ZyhgV2UgaGF2ZSBuZXcgcGFnZXMsIHNlbGVjdGluZyBwYWdlICcke25ld1BhZ2V9J2ApO1xuICB9IGVsc2UgaWYgKCFfLmluY2x1ZGVzKG5ld0lkcywgY3VyUGFnZUlkS2V5KSkge1xuICAgIGxvZ2dlci5kZWJ1ZygnTmV3IHBhZ2UgbGlzdGluZyBmcm9tIHJlbW90ZSBkZWJ1Z2dlciBkb2VzIG5vdCBjb250YWluICcgK1xuICAgICAgICAgICAgICAgICAnY3VycmVudCB3aW5kb3c7IGFzc3VtaW5nIGl0IGlzIGNsb3NlZCcpO1xuICAgIGlmICghdXRpbC5oYXNWYWx1ZShrZXlJZCkpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRG8gbm90IGhhdmUgb3VyIGN1cnJlbnQgd2luZG93IGFueW1vcmUsIGFuZCB0aGVyZSAnICtcbiAgICAgICAgICAgICAgICAgICAnYXJlIG5vdCBhbnkgbW9yZSB0byBsb2FkISBEb2luZyBub3RoaW5nLi4uJyk7XG4gICAgICB0aGlzLnNldEN1cnJlbnRVcmwodW5kZWZpbmVkKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsb2dnZXIuZGVidWcoYERlYnVnZ2VyIGFscmVhZHkgc2VsZWN0ZWQgcGFnZSAnJHtrZXlJZH0nLCBgICtcbiAgICAgICAgICAgICAgICAgYGNvbmZpcm1pbmcgdGhhdCBjaG9pY2UuYCk7XG4gICAgdGhpcy5jdXJDb250ZXh0ID0gYCR7YXBwSWRLZXl9LiR7a2V5SWR9YDtcbiAgICBuZXdQYWdlID0ga2V5SWQ7XG4gIH0gZWxzZSB7XG4gICAgLy8gYXQgdGhpcyBwb2ludCwgdGhlcmUgYXJlIG5vIG5ldyBwYWdlcywgYW5kIHRoZSBjdXJyZW50IHBhZ2Ugc3RpbGwgZXhpc3RzXG4gICAgbG9nZ2VyLmRlYnVnKCdDaGVja2luZyBpZiBwYWdlIG5lZWRzIHRvIGxvYWQnKTtcbiAgICAvLyBJZiBhIHdpbmRvdyBuYXZpZ2F0ZXMgdG8gYW4gYW5jaG9yIGl0IGRvZXNuJ3QgYWx3YXlzIGZpcmUgYSBwYWdlXG4gICAgLy8gY2FsbGJhY2sgZXZlbnQuIExldCdzIGNoZWNrIGlmIHdlIHdvdW5kIHVwIGluIHN1Y2ggYSBzaXR1YXRpb24uXG4gICAgY29uc3QgbmVlZHNQYWdlTG9hZCA9ICgoKSA9PiB7XG4gICAgICAvLyBuZWVkIHRvIG1hcCB0aGUgcGFnZSBpZHMgdG8gY29udGV4dCBpZHNcbiAgICAgIGNvbnN0IGNvbnRleHRBcnJheSA9IF8ubWFwKHBhZ2VBcnJheSwgKHBhZ2UpID0+IGAke2FwcElkS2V5fS4ke3BhZ2UuaWR9YCk7XG4gICAgICAvLyBjaGVjayBpZiB0aGUgY3VycmVudCBjb250ZXh0IGV4aXN0cyBpbiBib3RoIG91ciByZWNvcmRlZCBjb250ZXh0cyxcbiAgICAgIC8vIGFuZCB0aGUgcGFnZSBhcnJheVxuICAgICAgcmV0dXJuICFfLmlzRXF1YWwoXy5maW5kKHRoaXMuY29udGV4dHMsIHRoaXMuY3VyQ29udGV4dCksIF8uZmluZChjb250ZXh0QXJyYXksIHRoaXMuY3VyQ29udGV4dCkpO1xuICAgIH0pKCk7XG5cbiAgICBpZiAobmVlZHNQYWdlTG9hZCkge1xuICAgICAgbG9nZ2VyLmRlYnVnKCdQYWdlIGxvYWQgbmVlZGVkLiBMb2FkaW5nLi4uJyk7XG4gICAgICBhd2FpdCB0aGlzLnJlbW90ZS5wYWdlTG9hZCgpO1xuICAgIH1cblxuICAgIGxvZ2dlci5kZWJ1ZygnTmV3IHBhZ2UgbGlzdGluZyBpcyBzYW1lIGFzIG9sZCwgZG9pbmcgbm90aGluZycpO1xuICB9XG5cbiAgLy8gbWFrZSBzdXJlIHRoYXQgdGhlIHBhZ2UgbGlzdGluZyBpc24ndCBpbmRpY2F0aW5nIGEgcmVkaXJlY3RcbiAgaWYgKHV0aWwuaGFzVmFsdWUodGhpcy5jdXJDb250ZXh0KSkge1xuICAgIGxldCBjdXJyZW50UGFnZUlkID0gcGFyc2VJbnQoXy5sYXN0KHRoaXMuY3VyQ29udGV4dC5zcGxpdCgnLicpKSwgMTApO1xuICAgIGxldCBwYWdlID0gXy5maW5kKHBhZ2VBcnJheSwgKHApID0+IHBhcnNlSW50KHAuaWQsIDEwKSA9PT0gY3VycmVudFBhZ2VJZCk7XG4gICAgaWYgKHBhZ2UgJiYgcGFnZS51cmwgIT09IHRoaXMuZ2V0Q3VycmVudFVybCgpKSB7XG4gICAgICBsb2dnZXIuZGVidWcoYFJlZGlyZWN0ZWQgZnJvbSAnJHt0aGlzLmdldEN1cnJlbnRVcmwoKX0nIHRvICcke3BhZ2UudXJsfSdgKTtcbiAgICAgIHRoaXMuc2V0Q3VycmVudFVybChwYWdlLnVybCk7XG4gICAgfVxuICB9XG5cbiAgaWYgKHV0aWwuaGFzVmFsdWUobmV3UGFnZSkpIHtcbiAgICB0aGlzLnNlbGVjdGluZ05ld1BhZ2UgPSB0cnVlO1xuICAgIGF3YWl0IHRoaXMucmVtb3RlLnNlbGVjdFBhZ2UoYXBwSWRLZXksIHBhcnNlSW50KG5ld1BhZ2UsIDEwKSk7XG4gICAgdGhpcy5zZWxlY3RpbmdOZXdQYWdlID0gZmFsc2U7XG4gICAgdGhpcy5jdXJDb250ZXh0ID0gYCR7YXBwSWRLZXl9LiR7bmV3UGFnZX1gO1xuICB9XG4gIHRoaXMud2luZG93SGFuZGxlQ2FjaGUgPSBwYWdlQXJyYXk7XG59O1xuXG5leHRlbnNpb25zLmdldExhdGVzdFdlYnZpZXdDb250ZXh0Rm9yVGl0bGUgPSBhc3luYyBmdW5jdGlvbiBnZXRMYXRlc3RXZWJ2aWV3Q29udGV4dEZvclRpdGxlIChyZWdFeHApIHtcbiAgbGV0IGNvbnRleHRzID0gYXdhaXQgdGhpcy5nZXRDb250ZXh0c0FuZFZpZXdzKCk7XG4gIGxldCBtYXRjaGluZ0N0eDtcbiAgZm9yIChsZXQgY3R4IG9mIGNvbnRleHRzKSB7XG4gICAgaWYgKGN0eC52aWV3ICYmICgoY3R4LnZpZXcudGl0bGUgJiYgY3R4LnZpZXcudGl0bGUubWF0Y2gocmVnRXhwKSkgfHwgKGN0eC52aWV3LnVybCAmJiBjdHgudmlldy51cmwubWF0Y2gocmVnRXhwKSkpKSB7XG4gICAgICBpZiAoY3R4LnZpZXcudXJsICE9PSAnYWJvdXQ6YmxhbmsnKSB7XG4gICAgICAgIG1hdGNoaW5nQ3R4ID0gY3R4O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gaW4gdGhlIGNhc2VzIG9mIFhjb2RlIDwgNSAoaS5lLiwgaU9TIFNESyBWZXJzaW9uIGxlc3MgdGhhbiA3KVxuICAgICAgICAvLyBpT1MgNy4xLCBpT1MgOS4wICYgaU9TIDkuMSBpbiBhIHdlYnZpZXcgKG5vdCBpbiBTYWZhcmkpXG4gICAgICAgIC8vIHdlIGNhbiBoYXZlIHRoZSB1cmwgYmUgYGFib3V0OmJsYW5rYFxuICAgICAgICBpZiAocGFyc2VGbG9hdCh0aGlzLmlvc1Nka1ZlcnNpb24pIDwgNyB8fCBwYXJzZUZsb2F0KHRoaXMuaW9zU2RrVmVyc2lvbikgPj0gOSB8fFxuICAgICAgICAgICAgKHRoaXMub3B0cy5wbGF0Zm9ybVZlcnNpb24gPT09ICc3LjEnICYmIHRoaXMub3B0cy5hcHAgJiYgdGhpcy5vcHRzLmFwcC50b0xvd2VyQ2FzZSgpICE9PSAnc2FmYXJpJykpIHtcbiAgICAgICAgICBtYXRjaGluZ0N0eCA9IGN0eDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG4gIHJldHVybiBtYXRjaGluZ0N0eCA/IG1hdGNoaW5nQ3R4LmlkIDogdW5kZWZpbmVkO1xufTtcblxuLy8gUmlnaHQgbm93IHdlIGRvbid0IG5lY2Vzc2FyaWx5IHdhaXQgZm9yIHdlYnZpZXdcbi8vIGFuZCBmcmFtZSB0byBsb2FkLCB3aGljaCBsZWFkcyB0byByYWNlIGNvbmRpdGlvbnMgYW5kIGZsYWtpbmVzcyxcbi8vIGxldCdzIHNlZSBpZiB3ZSBjYW4gdHJhbnNpdGlvbiB0byBzb21ldGhpbmcgYmV0dGVyXG5leHRlbnNpb25zLnVzZU5ld1NhZmFyaSA9IGZ1bmN0aW9uIHVzZU5ld1NhZmFyaSAoKSB7XG4gIHJldHVybiBwYXJzZUZsb2F0KHRoaXMuaW9zU2RrVmVyc2lvbikgPj0gOC4xICYmXG4gICAgICAgICBwYXJzZUZsb2F0KHRoaXMub3B0cy5wbGF0Zm9ybVZlcnNpb24pID49IDguMSAmJlxuICAgICAgICAgIXRoaXMuaXNSZWFsRGV2aWNlKCkgJiZcbiAgICAgICAgIHRoaXMub3B0cy5zYWZhcmk7XG59O1xuXG5leHRlbnNpb25zLm5hdlRvSW5pdGlhbFdlYnZpZXcgPSBhc3luYyBmdW5jdGlvbiBuYXZUb0luaXRpYWxXZWJ2aWV3ICgpIHtcbiAgbGV0IHRpbWVvdXQgPSAwO1xuICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgIHRpbWVvdXQgPSAzMDAwO1xuICAgIGxvZ2dlci5kZWJ1ZyhgV2FpdGluZyBmb3IgJHt0aW1lb3V0fSBtcyBiZWZvcmUgbmF2aWdhdGluZyB0byB2aWV3LmApO1xuICB9XG4gIGF3YWl0IEIuZGVsYXkodGltZW91dCk7XG4gIGlmICh0aGlzLnVzZU5ld1NhZmFyaSgpKSB7XG4gICAgYXdhaXQgdGhpcy50eXBlQW5kTmF2VG9VcmwoKTtcbiAgfSBlbHNlIGlmIChwYXJzZUludCh0aGlzLmlvc1Nka1ZlcnNpb24sIDEwKSA+PSA3ICYmICF0aGlzLmlzUmVhbERldmljZSgpICYmIHRoaXMub3B0cy5zYWZhcmkpIHtcbiAgICBhd2FpdCB0aGlzLm5hdlRvVmlld1Rocm91Z2hGYXZvcml0ZXMoKTtcbiAgfSBlbHNlIHtcbiAgICBhd2FpdCB0aGlzLm5hdlRvVmlld1dpdGhUaXRsZSgvLiovKTtcbiAgfVxufTtcblxuYXN5bmMgZnVuY3Rpb24gb3Blbk5ld1BhZ2UgKCkge1xuICBsZXQgbmV3UGFnZUJ1dHRvbiA9IGF3YWl0IHRoaXMuZmluZEVsZW1lbnQoJ3hwYXRoJywgXCIvL1VJQUJ1dHRvbltjb250YWlucyhAbmFtZSwnTmV3IHBhZ2UnKV1cIik7XG4gIGF3YWl0IHRoaXMubmF0aXZlVGFwKG5ld1BhZ2VCdXR0b24uRUxFTUVOVCk7XG59XG5cbmV4dGVuc2lvbnMudHlwZUFuZE5hdlRvVXJsID0gYXN5bmMgZnVuY3Rpb24gdHlwZUFuZE5hdlRvVXJsICgpIHtcbiAgbGV0IGFkZHJlc3MgPSB0aGlzLm9wdHMuYWRkcmVzcyA/IHRoaXMub3B0cy5hZGRyZXNzIDogJzEyNy4wLjAuMSc7XG4gIHRoaXMuc2V0Q3VycmVudFVybCh0aGlzLmNhcHMuc2FmYXJpSW5pdGlhbFVybCB8fCBgaHR0cDovLyR7YWRkcmVzc306JHt0aGlzLm9wdHMucG9ydH0vd2VsY29tZWApO1xuXG4gIGxldCB0cmllcyA9IDA7XG4gIGNvbnN0IE1BWF9UUklFUyA9IDI7XG4gIGxldCBuYXZpZ2F0ZSA9IGFzeW5jICgpID0+IHtcbiAgICBsZXQgb2xkSW1wV2FpdCA9IHRoaXMuaW1wbGljaXRXYWl0TXM7XG4gICAgdGhpcy5pbXBsaWNpdFdhaXRNcyA9IDcwMDA7XG5cbiAgICAvLyBmaW5kIHRoZSB1cmwgYmFyLCBhbmQgdGFwIG9uIGl0LiByZXRyeSB0byBtYWtlIHN1cmUgd2UgZG9uJ3QgdHJ5XG4gICAgLy8gdG9vIHNvb24gd2hpbGUgdGhlIHZpZXcgaXMgc3RpbGwgbG9hZGluZ1xuICAgIGxldCBlbCA9IGF3YWl0IHJldHJ5SW50ZXJ2YWwoMywgMTAwMCwgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZmluZEVsZW1lbnQoJ2FjY2Vzc2liaWxpdHkgaWQnLCAnVVJMJyk7XG4gICAgfSk7XG4gICAgdGhpcy5pbXBsaWNpdFdhaXRNcyA9IG9sZEltcFdhaXQ7XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5uYXRpdmVUYXAoZWwuRUxFTUVOVCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoXy5pbmNsdWRlcyhlcnIubWVzc2FnZSwgJ2NvdWxkIG5vdCBiZSB0YXBwZWQnKSkge1xuICAgICAgICBpZiAodHJpZXMrKyA+PSBNQVhfVFJJRVMpIHRocm93IGVycjsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjdXJseVxuXG4gICAgICAgIC8vIGdlbmVyYWxseSB0aGlzIG1lYW5zIHRoYXQgU2FmYXJpIGlzIGluIHBhZ2Ugdmlld2luZyBtb2RlXG4gICAgICAgIC8vIHNvIHRyeSB0byBvcGVuIGEgbmV3IHBhZ2UgYW5kIHRoZW4gcmVkbyB0aGUgbmF2aWdhdGlvblxuICAgICAgICBhd2FpdCBvcGVuTmV3UGFnZSgpO1xuICAgICAgICByZXR1cm4gYXdhaXQgbmF2aWdhdGUoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBnZXQgdGhlIGxhc3QgYWRkcmVzcyBlbGVtZW50IGFuZCBzZXQgdGhlIHVybFxuICAgIHRyeSB7XG4gICAgICBsZXQgZWwgPSBhd2FpdCB0aGlzLmZpbmRFbGVtZW50KCdjbGFzcyBuYW1lJywgJ1VJQVRleHRGaWVsZCcpO1xuICAgICAgYXdhaXQgdGhpcy5zZXRWYWx1ZUltbWVkaWF0ZSh0aGlzLmdldEN1cnJlbnRVcmwoKSwgZWwpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgLy8gdGhpcyBpcyBmbGFrZXkgb24gY2VydGFpbiBzeXN0ZW1zIHNvIHdlIHJldHJ5IHVudGlsIHdlIGdldCBzb21ldGhpbmdcbiAgICAgIC8vIGlvcyBzaW1zOiBzYWZhcmkgb3BlbnMgYnV0IHRoZSB0ZXh0IGZpZWxkIGNhbid0IGJlIGZvdW5kXG4gICAgICBpZiAodHJpZXMrKyA+PSBNQVhfVFJJRVMpIHRocm93IGVycjsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjdXJseVxuICAgICAgcmV0dXJuIGF3YWl0IG5hdmlnYXRlKCk7XG4gICAgfVxuXG4gICAgLy8gbWFrZSBpdCBoYXBwZW5cbiAgICB0cnkge1xuICAgICAgZWwgPSBhd2FpdCB0aGlzLmZpbmRFbGVtZW50KCdhY2Nlc3NpYmlsaXR5IGlkJywgJ0dvJyk7XG4gICAgICBhd2FpdCB0aGlzLm5hdGl2ZVRhcChlbC5FTEVNRU5UKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmIChfLmluY2x1ZGVzKGVyci5tZXNzYWdlLCAnY291bGQgbm90IGJlIHRhcHBlZCcpKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcignVW5hYmxlIHRvIHN1Ym1pdCBVUkwgYmVjYXVzZSBcXCdHb1xcJyBidXR0b24gY291bGQgbm90IGJlIHRhcHBlZC4gJyArXG4gICAgICAgICAgICAgICAgICAgICAnUGxlYXNlIG1ha2Ugc3VyZSB5b3VyIGtleWJvYXJkIGlzIHRvZ2dsZWQgb24uJyk7XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICAgIGF3YWl0IHRoaXMubmF2VG9WaWV3V2l0aFRpdGxlKHVuZGVmaW5lZCwgbmV3IFJlZ0V4cCh0aGlzLmdldEN1cnJlbnRVcmwoKSwgJ2knKSk7XG5cbiAgICAvLyB3YWl0IGZvciBwYWdlIHRvIGZpbmlzaCBsb2FkaW5nLlxuICAgIGF3YWl0IHRoaXMucmVtb3RlLnBhZ2VVbmxvYWQoKTtcbiAgfTtcbiAgYXdhaXQgbmF2aWdhdGUoKTtcbn07XG5cbmV4dGVuc2lvbnMubmF2VG9WaWV3VGhyb3VnaEZhdm9yaXRlcyA9IGFzeW5jIGZ1bmN0aW9uIG5hdlRvVmlld1Rocm91Z2hGYXZvcml0ZXMgKCkge1xuICBsb2dnZXIuZGVidWcoJ1dlIGFyZSBvbiBpT1M3KyBzaW11bGF0b3I6IGNsaWNraW5nIGFwcGxlIGJ1dHRvbiB0byBnZXQgaW50byBhIHdlYnZpZXcnKTtcbiAgbGV0IG9sZEltcFdhaXQgPSB0aGlzLmltcGxpY2l0V2FpdE1zO1xuICB0aGlzLmltcGxpY2l0V2FpdE1zID0gNzAwMDsgLy8gd2FpdCA3cyBmb3IgYXBwbGUgYnV0dG9uIHRvIGV4aXN0XG5cbiAgbGV0IGVsO1xuICB0cnkge1xuICAgIGVsID0gYXdhaXQgdGhpcy5maW5kRWxlbWVudCgneHBhdGgnLCAnLy9VSUFTY3JvbGxWaWV3WzFdL1VJQUJ1dHRvblsxXScpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsZXQgbXNnID0gJ0NvdWxkIG5vdCBmaW5kIGJ1dHRvbiB0byBjbGljayB0byBnZXQgaW50byB3ZWJ2aWV3LiAnICtcbiAgICAgICAgICAgICAgJ1Byb2NlZWRpbmcgb24gdGhlIGFzc3VtcHRpb24gd2UgaGF2ZSBhIHdvcmtpbmcgb25lLic7XG4gICAgbG9nZ2VyLmVycm9yKG1zZyk7XG4gICAgdGhpcy5pbXBsaWNpdFdhaXRNcyA9IG9sZEltcFdhaXQ7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMubmF2VG9WaWV3V2l0aFRpdGxlKC8uKi9pKTtcbiAgfVxuICB0aGlzLmltcGxpY2l0V2FpdE1zID0gb2xkSW1wV2FpdDtcbiAgdHJ5IHtcbiAgICBhd2FpdCB0aGlzLm5hdGl2ZVRhcChlbC5FTEVNRU5UKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbGV0IG1zZyA9ICdDb3VsZCBub3QgY2xpY2sgYnV0dG9uIHRvIGdldCBpbnRvIHdlYnZpZXcuICcgK1xuICAgICAgICAgICAgICAnUHJvY2VlZGluZyBvbiB0aGUgYXNzdW1wdGlvbiB3ZSBoYXZlIGEgd29ya2luZyBvbmUuJztcbiAgICBsb2dnZXIuZXJyb3IobXNnKTtcbiAgfVxuICBhd2FpdCB0aGlzLm5hdlRvVmlld1dpdGhUaXRsZSgvYXBwbGUvaSk7XG59O1xuXG5leHRlbnNpb25zLm5hdlRvVmlld1dpdGhUaXRsZSA9IGFzeW5jIGZ1bmN0aW9uIG5hdlRvVmlld1dpdGhUaXRsZSAodGl0bGVSZWdleCwgdXJsUmVnRXhwKSB7XG4gIGxvZ2dlci5kZWJ1ZygnTmF2aWdhdGluZyB0byBtb3N0IHJlY2VudGx5IG9wZW5lZCB3ZWJ2aWV3Jyk7XG4gIGxldCBzdGFydCA9IERhdGUubm93KCk7XG4gIGxldCBzcGluVGltZSA9IDUwMDtcbiAgbGV0IHNwaW5IYW5kbGVzID0gYXN5bmMgKCkgPT4ge1xuICAgIGxldCByZXM7XG4gICAgdHJ5IHtcbiAgICAgIHJlcyA9IGF3YWl0IHRoaXMuZ2V0TGF0ZXN0V2Vidmlld0NvbnRleHRGb3JUaXRsZSh0aXRsZVJlZ2V4IHx8IHVybFJlZ0V4cCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoIWVyci5tZXNzYWdlLmluY2x1ZGVzKCdDb3VsZCBub3QgY29ubmVjdCB0byBhIHZhbGlkIGFwcCBhZnRlcicpKSB7XG4gICAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKGBDb3VsZCBub3QgbmF2aWdhdGUgdG8gd2VidmlldyEgRXJyOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgICBlcnJvci5zdGFjayArPSBgXFxuQ2F1c2VkIGJ5OiAke2Vyci5zdGFja31gO1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cbiAgICAgIGxvZ2dlci5kZWJ1ZygnQ291bGQgbm90IG5hdmlnYXRlIHRvIHdlYnZpZXcuIFJldHJ5aW5nIGlmIHBvc3NpYmxlLicpO1xuICAgIH1cbiAgICBpZiAocmVzKSB7XG4gICAgICBsZXQgbGF0ZXN0V2luZG93ID0gcmVzO1xuICAgICAgbG9nZ2VyLmRlYnVnKGBQaWNraW5nIHdlYnZpZXcgJyR7bGF0ZXN0V2luZG93fSdgKTtcbiAgICAgIGF3YWl0IHRoaXMuc2V0Q29udGV4dChsYXRlc3RXaW5kb3cpO1xuICAgICAgYXdhaXQgdGhpcy5yZW1vdGUuY2FuY2VsUGFnZUxvYWQoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBubyB3ZWJ2aWV3IHdhcyBmb3VuZFxuICAgIGlmICgoRGF0ZS5ub3coKSAtIHN0YXJ0KSA+PSA5MDAwMCkge1xuICAgICAgLy8gdG9vIHNsb3csIGdldCBvdXRcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ291bGQgbm90IG5hdmlnYXRlIHRvIHdlYnZpZXc7IHRoZXJlIGFyZSBub25lIScpO1xuICAgIH1cblxuICAgIGxvZ2dlci53YXJuKCdDb3VsZCBub3QgZmluZCBhbnkgd2Vidmlld3MgeWV0LCByZWZyZXNoaW5nL3JldHJ5aW5nJyk7XG4gICAgaWYgKHRoaXMuaXNSZWFsRGV2aWNlKCkgfHwgIXRoaXMub3B0cy5zYWZhcmkpIHtcbiAgICAgIC8vIG9uIGEgcmVhbCBkZXZpY2UsIHdoZW4gbm90IHVzaW5nIFNhZmFyaSwgd2UganVzdCB3YW50IHRvIHRyeSBhZ2FpblxuICAgICAgYXdhaXQgQi5kZWxheShzcGluVGltZSk7XG4gICAgICByZXR1cm4gYXdhaXQgc3BpbkhhbmRsZXMoKTtcbiAgICB9XG5cbiAgICAvLyBmaW5kIHRoZSByZWxvYWQgYnV0dG9uIGFuZCB0YXAgaXQsIGlmIHBvc3NpYmxlXG4gICAgbGV0IGVsZW1lbnQ7XG4gICAgdHJ5IHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnRmluZGluZyBhbmQgdGFwcGluZyByZWxvYWQgYnV0dG9uJyk7XG4gICAgICBlbGVtZW50ID0gYXdhaXQgdGhpcy5maW5kVUlFbGVtZW50T3JFbGVtZW50cygnYWNjZXNzaWJpbGl0eSBpZCcsICdSZWxvYWRCdXR0b24nLCAnJywgZmFsc2UpO1xuICAgICAgYXdhaXQgdGhpcy5uYXRpdmVUYXAoZWxlbWVudC5FTEVNRU5UKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZ2dlci53YXJuKGBFcnJvciBmaW5kaW5nIGFuZCB0YXBwaW5nIHJlbG9hZCBidXR0b246ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICBsb2dnZXIud2FybignUmV0cnlpbmcuJyk7XG4gICAgICBhd2FpdCBCLmRlbGF5KHNwaW5UaW1lKTtcbiAgICB9XG5cbiAgICAvLyB0cnkgaXQgYWxsIGFnYWluXG4gICAgcmV0dXJuIGF3YWl0IHNwaW5IYW5kbGVzKCk7XG4gIH07XG4gIGF3YWl0IHNwaW5IYW5kbGVzKCk7XG59O1xuXG5oZWxwZXJzLmNsb3NlQWxlcnRCZWZvcmVUZXN0ID0gYXN5bmMgZnVuY3Rpb24gY2xvc2VBbGVydEJlZm9yZVRlc3QgKCkge1xuICBsZXQgcHJlc2VudCA9IGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKCdhdS5hbGVydElzUHJlc2VudCgpJyk7XG4gIGlmICghcHJlc2VudCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGxvZ2dlci5kZWJ1ZygnQWxlcnQgcHJlc2VudCBiZWZvcmUgc3RhcnRpbmcgdGVzdCwgbGV0IHVzIGJhbmlzaCBpdCcpO1xuICBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZCgnYXUuZGlzbWlzc0FsZXJ0KCknKTtcbiAgbG9nZ2VyLmRlYnVnKCdBbGVydCBiYW5pc2hlZCEnKTtcbiAgcmV0dXJuIHRydWU7XG59O1xuXG5oZWxwZXJzLnN0b3BSZW1vdGUgPSBhc3luYyBmdW5jdGlvbiBzdG9wUmVtb3RlIChjbG9zZVdpbmRvd0JlZm9yZURpc2Nvbm5lY3RpbmcgPSBmYWxzZSkge1xuICBpZiAoIXRoaXMucmVtb3RlKSB7XG4gICAgbG9nZ2VyLmVycm9yQW5kVGhyb3coJ1RyaWVkIHRvIGxlYXZlIGEgd2ViIGZyYW1lIGJ1dCB3ZXJlIG5vdCBpbiBvbmUnKTtcbiAgfVxuXG4gIGlmIChjbG9zZVdpbmRvd0JlZm9yZURpc2Nvbm5lY3RpbmcpIHtcbiAgICBhd2FpdCB0aGlzLmNsb3NlV2luZG93KCk7XG4gIH1cbiAgYXdhaXQgdGhpcy5yZW1vdGUuZGlzY29ubmVjdCgpO1xuICB0aGlzLmN1ckNvbnRleHQgPSBudWxsO1xuICB0aGlzLmN1cldlYkZyYW1lcyA9IFtdO1xuICB0aGlzLmN1cldlYkNvb3JkcyA9IG51bGw7XG4gIHRoaXMucmVtb3RlID0gbnVsbDtcbn07XG5cbmhlbHBlcnMuaXNXZWJDb250ZXh0ID0gZnVuY3Rpb24gaXNXZWJDb250ZXh0ICgpIHtcbiAgcmV0dXJuICEhdGhpcy5jdXJDb250ZXh0ICYmIHRoaXMuY3VyQ29udGV4dCAhPT0gTkFUSVZFX1dJTjtcbn07XG5cbmhlbHBlcnMuc2V0Q3VycmVudFVybCA9IGZ1bmN0aW9uIHNldEN1cnJlbnRVcmwgKHVybCkge1xuICB0aGlzLl9jdXJyZW50VXJsID0gdXJsO1xufTtcblxuaGVscGVycy5nZXRDdXJyZW50VXJsID0gZnVuY3Rpb24gZ2V0Q3VycmVudFVybCAoKSB7XG4gIHJldHVybiB0aGlzLl9jdXJyZW50VXJsO1xufTtcblxuXG5PYmplY3QuYXNzaWduKGV4dGVuc2lvbnMsIGNvbW1hbmRzLCBoZWxwZXJzKTtcbmV4cG9ydCB7IGNvbW1hbmRzLCBoZWxwZXJzLCBOQVRJVkVfV0lOLCBXRUJWSUVXX1dJTiwgV0VCVklFV19CQVNFIH07XG5leHBvcnQgZGVmYXVsdCBleHRlbnNpb25zO1xuIl0sImZpbGUiOiJsaWIvY29tbWFuZHMvY29udGV4dC5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
