"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.installApp = installApp;
exports.removeApp = removeApp;
exports.launch = launch;
exports.spawn = spawn;
exports.spawnSubProcess = spawnSubProcess;
exports.openUrl = openUrl;
exports.terminate = terminate;
exports.shutdown = shutdown;
exports.createDevice = createDevice;
exports.getAppContainer = getAppContainer;
exports.getScreenshot = getScreenshot;
exports.deleteDevice = deleteDevice;
exports.eraseDevice = eraseDevice;
exports.getDevices = getDevices;
exports.getRuntimeForPlatformVersion = getRuntimeForPlatformVersion;
exports.bootDevice = bootDevice;
exports.setPasteboard = setPasteboard;
exports.getPasteboard = getPasteboard;
exports.addMedia = addMedia;
exports.appInfo = appInfo;
exports.getDeviceTypes = getDeviceTypes;
exports.startBootMonitor = startBootMonitor;

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));

require("source-map-support/register");

var _teen_process = require("teen_process");

var _asyncbox = require("asyncbox");

var _appiumSupport = require("appium-support");

var _lodash = _interopRequireDefault(require("lodash"));

const log = _appiumSupport.logger.getLogger('simctl');

const SIM_RUNTIME_NAME = 'com.apple.CoreSimulator.SimRuntime.';

async function simCommand(command, timeout, args = [], env = {}, executingFunction = _teen_process.exec, logErrors = true) {
  args = ['simctl', command, ...args];
  env = _lodash.default.defaults(_lodash.default.mapKeys(env, (value, key) => {
    return `SIMCTL_CHILD_${key}`;
  }), process.env);

  try {
    return await executingFunction('xcrun', args, {
      timeout,
      env
    });
  } catch (e) {
    if (!logErrors) {
      throw e;
    } else if (e.stderr) {
      log.errorAndThrow(`simctl error running '${command}': ${e.stderr.trim()}`);
    } else {
      log.errorAndThrow(e);
    }
  }
}

async function simExec(command, timeout, args = [], env = {}, logErrors = true) {
  return await simCommand(command, timeout, args, env, async (c, a, ob) => {
    return await (0, _teen_process.exec)(c, a, ob);
  }, logErrors);
}

async function simSubProcess(command, timeout, args = [], env = {}) {
  return await simCommand(command, timeout, args, env, (c, a, ob) => {
    return new _teen_process.SubProcess(c, a, ob);
  });
}

async function installApp(udid, appPath) {
  await simExec('install', 0, [udid, appPath]);
}

async function bootDevice(udid) {
  try {
    await simExec('boot', 0, [udid]);
  } catch (err) {
    if ((err.message || '').indexOf('Unable to boot device in current state: Booted') === -1) {
      throw err;
    }

    log.debug(`Simulator already in 'Booted' state. Continuing`);
  }
}

async function removeApp(udid, bundleId) {
  await simExec('uninstall', 0, [udid, bundleId]);
}

async function launch(udid, bundleId, tries = 5) {
  await (0, _asyncbox.retryInterval)(tries, 1000, async () => {
    await simExec('launch', 0, [udid, bundleId]);
  });
}

async function spawn(udid, args, env = {}) {
  return await simExec('spawn', 0, [udid, ...(_lodash.default.isArray(args) ? args : [args])], env);
}

async function spawnSubProcess(udid, args, env = {}) {
  return await simSubProcess('spawn', 0, [udid, ...(_lodash.default.isArray(args) ? args : [args])], env);
}

async function openUrl(udid, url) {
  return await simExec('openurl', 0, [udid, url]);
}

async function appInfo(udid, bundleId) {
  const {
    stdout
  } = await simExec('appinfo', 0, [udid, bundleId]);
  return (stdout || '').trim();
}

async function addMedia(udid, path) {
  return await simExec('addmedia', 0, [udid, path]);
}

async function terminate(udid, bundleId) {
  await simExec('terminate', 0, [udid, bundleId]);
}

async function getAppContainer(udid, bundleId, logErrors = true, containerType = null) {
  const args = [udid, bundleId];

  if (containerType) {
    args.push(containerType);
  }

  const {
    stdout
  } = await simExec('get_app_container', 0, args, {}, logErrors);
  return (stdout || '').trim();
}

async function shutdown(udid) {
  try {
    await simExec('shutdown', 0, [udid]);
  } catch (err) {
    if (!(err + '').includes('current state: Shutdown')) {
      throw err;
    }

    log.debug(`Simulator already in 'Shutdown' state. Continuing`);
  }
}

async function createDevice(name, deviceTypeId, runtimeId, timeout = 10000) {
  let udid;

  try {
    runtimeId = await getRuntimeForPlatformVersion(runtimeId);
  } catch (err) {
    log.warn(`Unable to find runtime for iOS '${runtimeId}'. Continuing`);
  }

  log.debug(`Creating simulator with name '${name}', device type id '${deviceTypeId}' and runtime id '${runtimeId}'`);

  try {
    const out = await simExec('create', 0, [name, deviceTypeId, runtimeId]);
    udid = out.stdout.trim();
  } catch (err) {
    let reason = err.message;

    if (err.stderr) {
      reason = err.stderr.trim();
    }

    log.errorAndThrow(`Could not create simulator with name '${name}', device ` + `type id '${deviceTypeId}' and runtime id '${runtimeId}'. Reason: '${reason}'`);
  }

  let retries = parseInt(timeout / 1000, 10);
  await (0, _asyncbox.retryInterval)(retries, 1000, async () => {
    let devices = await getDevices();

    for (const deviceArr of _lodash.default.values(devices)) {
      for (const device of deviceArr) {
        if (device.udid === udid) {
          if (device.state === 'Creating') {
            throw new Error('Device still being created');
          } else {
            return;
          }
        }
      }
    }
  });
  return udid;
}

async function deleteDevice(udid) {
  await simExec('delete', 0, [udid]);
}

async function eraseDevice(udid, timeout = 1000) {
  let loopFn = async () => {
    await simExec('erase', 10000, [udid]);
  };

  let retries = parseInt(timeout / 200, 10);
  await (0, _asyncbox.retryInterval)(retries, 200, loopFn);
}

async function getDevicesByParsing(platform) {
  const {
    stdout
  } = await simExec('list', 0, ['devices']);
  const deviceSectionRe = _lodash.default.isEmpty(platform) ? new RegExp(`\\-\\-\\s+(\\S+)\\s+(\\S+)\\s+\\-\\-(\\n\\s{4}.+)*`, 'mgi') : new RegExp(`\\-\\-\\s+${_lodash.default.escapeRegExp(platform)}\\s+(\\S+)\\s+\\-\\-(\\n\\s{4}.+)*`, 'mgi');
  const matches = [];
  let match;

  while (match = deviceSectionRe.exec(stdout)) {
    matches.push(match);
  }

  if (_lodash.default.isEmpty(matches)) {
    throw new Error('Could not find device section');
  }

  const lineRe = /([^\s].+) \((\w+-.+\w+)\) \((\w+\s?\w+)\)/;
  const devices = {};

  for (match of matches) {
    const sdk = platform ? match[1] : match[2];
    devices[sdk] = devices[sdk] || [];

    for (const line of match[0].split('\n').slice(1)) {
      if (line.includes('(unavailable, ')) {
        continue;
      }

      const lineMatch = lineRe.exec(line);

      if (!lineMatch) {
        throw new Error(`Could not match line: ${line}`);
      }

      devices[sdk].push({
        name: lineMatch[1],
        udid: lineMatch[2],
        state: lineMatch[3],
        sdk,
        platform: platform || match[1]
      });
    }
  }

  return devices;
}

async function getDevices(forSdk, platform) {
  let devices = {};

  try {
    const {
      stdout
    } = await simExec('list', 0, ['devices', '-j']);
    const versionMatchRe = _lodash.default.isEmpty(platform) ? new RegExp(`^([^\\s-]+)[\\s-](\\S+)`, 'i') : new RegExp(`^${_lodash.default.escapeRegExp(platform)}[\\s-](\\S+)`, 'i');

    for (let [sdkName, entries] of _lodash.default.toPairs(JSON.parse(stdout).devices)) {
      sdkName = sdkName.replace(SIM_RUNTIME_NAME, '');
      const versionMatch = versionMatchRe.exec(sdkName);

      if (!versionMatch) {
        continue;
      }

      const sdk = (platform ? versionMatch[1] : versionMatch[2]).replace('-', '.');
      devices[sdk] = devices[sdk] || [];
      devices[sdk].push(...entries.filter(el => _lodash.default.isUndefined(el.isAvailable) || el.isAvailable).map(el => {
        delete el.availability;
        return (0, _objectSpread2.default)({
          sdk
        }, el, {
          platform: platform || versionMatch[1]
        });
      }));
    }
  } catch (err) {
    log.debug(`Unable to get JSON device list: ${err.stack}`);
    log.debug('Falling back to manual parsing');
    devices = await getDevicesByParsing(platform);
  }

  if (!forSdk) {
    return devices;
  }

  if (devices[forSdk]) {
    return devices[forSdk];
  }

  let errMsg = `'${forSdk}' does not exist in the list of simctl SDKs.`;

  const availableSDKs = _lodash.default.keys(devices);

  errMsg += availableSDKs.length ? ` Only the following Simulator SDK versions are available on your system: ${availableSDKs.join(', ')}` : ` No Simulator SDK versions are available on your system. Please install some via Xcode preferences.`;
  throw new Error(errMsg);
}

async function getRuntimeForPlatformVersion(platformVersion, platform = 'iOS') {
  try {
    const {
      stdout
    } = await simExec('list', 0, ['runtimes']);
    const runtimeRe = new RegExp(`${_lodash.default.escapeRegExp(platform)}\\s+(\\d+\\.\\d+)\\s+\\((\\d+\\.\\d+\\.*\\d*)`, 'i');

    for (const line of stdout.split('\n')) {
      const match = runtimeRe.exec(line);

      if (match && match[1] === platformVersion) {
        return match[2];
      }
    }
  } catch (ign) {}

  return platformVersion;
}

async function getScreenshot(udid) {
  let pathToScreenshotPng = await _appiumSupport.tempDir.path({
    prefix: `screenshot-${udid}`,
    suffix: '.png'
  });
  await simExec('io', 0, [udid, 'screenshot', pathToScreenshotPng]);
  let screenshotImg = await _appiumSupport.fs.readFile(pathToScreenshotPng);
  await _appiumSupport.fs.rimraf(pathToScreenshotPng);
  return screenshotImg.toString('base64');
}

async function setPasteboard(udid, content, encoding = 'utf-8') {
  const pbCopySubprocess = new _teen_process.SubProcess('xcrun', ['simctl', 'pbcopy', udid]);
  await pbCopySubprocess.start(0);
  const exitCodeVerifier = pbCopySubprocess.join();
  const stdin = pbCopySubprocess.proc.stdin;
  stdin.setEncoding(encoding);
  stdin.write(content);
  stdin.end();
  await exitCodeVerifier;
}

async function getPasteboard(udid, encoding = 'utf-8') {
  const args = ['simctl', 'pbpaste', udid];

  try {
    const {
      stdout
    } = await (0, _teen_process.exec)('xcrun', args, {
      timeout: 0,
      encoding
    });
    return stdout;
  } catch (e) {
    if (e.stderr) {
      log.errorAndThrow(`Error running 'xcrun ${args.join(' ')}': ${e.stderr.trim()}`);
    } else {
      log.errorAndThrow(e);
    }
  }
}

async function getDeviceTypes() {
  try {
    const {
      stdout
    } = await simExec('list', 0, ['devicetypes', '-j']);
    const deviceTypes = JSON.parse(stdout.trim());
    return deviceTypes.devicetypes.map(type => type.name);
  } catch (err) {
    let msg = `Unable to get list of device types: ${err.message}`;

    if (err.stderr) {
      msg = `${msg}. Stderr: ${err.stderr}`;
    }

    throw new Error(msg);
  }
}

async function startBootMonitor(udid, opts = {}) {
  const {
    timeout = 240000,
    onWaitingDataMigration,
    onWaitingSystemApp,
    onFinished,
    onError
  } = opts;
  let status = '';
  let isBootingFinished = false;
  let error = null;
  let timeoutHandler = null;
  const bootMonitor = await simSubProcess('bootstatus', 0, [udid]);
  bootMonitor.on('output', (stdout, stderr) => {
    status += stdout || stderr;

    if (stdout) {
      if (stdout.includes('Waiting on Data Migration') && onWaitingDataMigration) {
        onWaitingDataMigration();
      } else if (stdout.includes('Waiting on System App') && onWaitingSystemApp) {
        onWaitingSystemApp();
      }
    }
  });
  bootMonitor.on('exit', (code, signal) => {
    if (timeoutHandler) {
      clearTimeout(timeoutHandler);
    }

    if (code === 0) {
      if (onFinished) {
        onFinished();
      }

      isBootingFinished = true;
    } else {
      status = status || signal;
      error = new Error(status);

      if (onError) {
        onError(error);
      }
    }
  });
  await bootMonitor.start(0);

  const stopMonitor = async () => {
    if (bootMonitor.isRunning) {
      try {
        await bootMonitor.stop();
      } catch (e) {
        log.warn(e.message);
      }
    }
  };

  const timeStarted = process.hrtime();

  if (onFinished) {
    timeoutHandler = setTimeout(stopMonitor, timeout);
  } else {
    try {
      await (0, _asyncbox.waitForCondition)(() => {
        if (error) {
          throw error;
        }

        return isBootingFinished;
      }, {
        waitMs: timeout,
        intervalMs: 500
      });
    } catch (err) {
      await stopMonitor();
      throw new Error(`The simulator ${udid} has failed to finish booting after ${process.hrtime(timeStarted)[0]}s. ` + `Original status: ${status}`);
    }
  }

  return bootMonitor;
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9zaW1jdGwuanMiXSwibmFtZXMiOlsibG9nIiwibG9nZ2VyIiwiZ2V0TG9nZ2VyIiwiU0lNX1JVTlRJTUVfTkFNRSIsInNpbUNvbW1hbmQiLCJjb21tYW5kIiwidGltZW91dCIsImFyZ3MiLCJlbnYiLCJleGVjdXRpbmdGdW5jdGlvbiIsImV4ZWMiLCJsb2dFcnJvcnMiLCJfIiwiZGVmYXVsdHMiLCJtYXBLZXlzIiwidmFsdWUiLCJrZXkiLCJwcm9jZXNzIiwiZSIsInN0ZGVyciIsImVycm9yQW5kVGhyb3ciLCJ0cmltIiwic2ltRXhlYyIsImMiLCJhIiwib2IiLCJzaW1TdWJQcm9jZXNzIiwiU3ViUHJvY2VzcyIsImluc3RhbGxBcHAiLCJ1ZGlkIiwiYXBwUGF0aCIsImJvb3REZXZpY2UiLCJlcnIiLCJtZXNzYWdlIiwiaW5kZXhPZiIsImRlYnVnIiwicmVtb3ZlQXBwIiwiYnVuZGxlSWQiLCJsYXVuY2giLCJ0cmllcyIsInNwYXduIiwiaXNBcnJheSIsInNwYXduU3ViUHJvY2VzcyIsIm9wZW5VcmwiLCJ1cmwiLCJhcHBJbmZvIiwic3Rkb3V0IiwiYWRkTWVkaWEiLCJwYXRoIiwidGVybWluYXRlIiwiZ2V0QXBwQ29udGFpbmVyIiwiY29udGFpbmVyVHlwZSIsInB1c2giLCJzaHV0ZG93biIsImluY2x1ZGVzIiwiY3JlYXRlRGV2aWNlIiwibmFtZSIsImRldmljZVR5cGVJZCIsInJ1bnRpbWVJZCIsImdldFJ1bnRpbWVGb3JQbGF0Zm9ybVZlcnNpb24iLCJ3YXJuIiwib3V0IiwicmVhc29uIiwicmV0cmllcyIsInBhcnNlSW50IiwiZGV2aWNlcyIsImdldERldmljZXMiLCJkZXZpY2VBcnIiLCJ2YWx1ZXMiLCJkZXZpY2UiLCJzdGF0ZSIsIkVycm9yIiwiZGVsZXRlRGV2aWNlIiwiZXJhc2VEZXZpY2UiLCJsb29wRm4iLCJnZXREZXZpY2VzQnlQYXJzaW5nIiwicGxhdGZvcm0iLCJkZXZpY2VTZWN0aW9uUmUiLCJpc0VtcHR5IiwiUmVnRXhwIiwiZXNjYXBlUmVnRXhwIiwibWF0Y2hlcyIsIm1hdGNoIiwibGluZVJlIiwic2RrIiwibGluZSIsInNwbGl0Iiwic2xpY2UiLCJsaW5lTWF0Y2giLCJmb3JTZGsiLCJ2ZXJzaW9uTWF0Y2hSZSIsInNka05hbWUiLCJlbnRyaWVzIiwidG9QYWlycyIsIkpTT04iLCJwYXJzZSIsInJlcGxhY2UiLCJ2ZXJzaW9uTWF0Y2giLCJmaWx0ZXIiLCJlbCIsImlzVW5kZWZpbmVkIiwiaXNBdmFpbGFibGUiLCJtYXAiLCJhdmFpbGFiaWxpdHkiLCJzdGFjayIsImVyck1zZyIsImF2YWlsYWJsZVNES3MiLCJrZXlzIiwibGVuZ3RoIiwiam9pbiIsInBsYXRmb3JtVmVyc2lvbiIsInJ1bnRpbWVSZSIsImlnbiIsImdldFNjcmVlbnNob3QiLCJwYXRoVG9TY3JlZW5zaG90UG5nIiwidGVtcERpciIsInByZWZpeCIsInN1ZmZpeCIsInNjcmVlbnNob3RJbWciLCJmcyIsInJlYWRGaWxlIiwicmltcmFmIiwidG9TdHJpbmciLCJzZXRQYXN0ZWJvYXJkIiwiY29udGVudCIsImVuY29kaW5nIiwicGJDb3B5U3VicHJvY2VzcyIsInN0YXJ0IiwiZXhpdENvZGVWZXJpZmllciIsInN0ZGluIiwicHJvYyIsInNldEVuY29kaW5nIiwid3JpdGUiLCJlbmQiLCJnZXRQYXN0ZWJvYXJkIiwiZ2V0RGV2aWNlVHlwZXMiLCJkZXZpY2VUeXBlcyIsImRldmljZXR5cGVzIiwidHlwZSIsIm1zZyIsInN0YXJ0Qm9vdE1vbml0b3IiLCJvcHRzIiwib25XYWl0aW5nRGF0YU1pZ3JhdGlvbiIsIm9uV2FpdGluZ1N5c3RlbUFwcCIsIm9uRmluaXNoZWQiLCJvbkVycm9yIiwic3RhdHVzIiwiaXNCb290aW5nRmluaXNoZWQiLCJlcnJvciIsInRpbWVvdXRIYW5kbGVyIiwiYm9vdE1vbml0b3IiLCJvbiIsImNvZGUiLCJzaWduYWwiLCJjbGVhclRpbWVvdXQiLCJzdG9wTW9uaXRvciIsImlzUnVubmluZyIsInN0b3AiLCJ0aW1lU3RhcnRlZCIsImhy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QWhCRDtBQWlCQSxRQUFNRSxXQUFXLENBQUN2QixLQUFaLENBQWtCLENBQWxCLENBQU47O0FBQ0EsUUFBTTRCLFdBQVcsR0FBRyxZQUFZO0FBQzlCLFFBQUlMLFdBQVcsQ0FBQ00sU0FBaEIsRUFBMkI7QUFDekIsVUFBSTtBQUNGLGNBQU1OLFdBQVcsQ0FBQ08sSUFBWixFQUFOO0FBQ0QsT0FGRCxDQUVFLE9BQU8zSSxDQUFQLEVBQVU7QUFDVmxCLFFBQUFBLEdBQUcsQ0FBQzRELElBQUosQ0FBUzFDLENBQUMsQ0FBQ2UsT0FBWDtBQUNEO0FBQ0Y7QUFDRixHQVJEOztBQVNBLFFBQU02SCxXQUFXLEdBQUc3SSxPQUFPLENBQUM4SSxNQUFSLEVBQXBCOztBQUNBLE1BQUlmLFVBQUosRUFBZ0I7QUFDZEssSUFBQUEsY0FBYyxHQUFHVyxVQUFVLENBQUNMLFdBQUQsRUFBY3JKLE9BQWQsQ0FBM0I7QUFDRCxHQUZELE1BRU87QUFDTCxRQUFJO0FBQ0YsWUFBTSxnQ0FBaUIsTUFBTTtBQUMzQixZQUFJOEksS0FBSixFQUFXO0FBQ1QsZ0JBQU1BLEtBQU47QUFDRDs7QUFDRCxlQUFPRCxpQkFBUDtBQUNELE9BTEssRUFLSDtBQUFDYyxRQUFBQSxNQUFNLEVBQUUzSixPQUFUO0FBQWtCNEosUUFBQUEsVUFBVSxFQUFFO0FBQTlCLE9BTEcsQ0FBTjtBQU1ELEtBUEQsQ0FPRSxPQUFPbEksR0FBUCxFQUFZO0FBQ1osWUFBTTJILFdBQVcsRUFBakI7QUFDQSxZQUFNLElBQUlwRixLQUFKLENBQVcsaUJBQWdCMUMsSUFBSyx1Q0FBc0NaLE9BQU8sQ0FBQzhJLE1BQVIsQ0FBZUQsV0FBZixFQUE0QixDQUE1QixDQUErQixLQUEzRixHQUNiLG9CQUFtQlosTUFBTyxFQUR2QixDQUFOO0FBRUQ7QUFDRjs7QUFDRCxTQUFPSSxXQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBleGVjLCBTdWJQcm9jZXNzIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCB7IHJldHJ5SW50ZXJ2YWwsIHdhaXRGb3JDb25kaXRpb24gfSBmcm9tICdhc3luY2JveCc7XG5pbXBvcnQgeyBsb2dnZXIsIGZzLCB0ZW1wRGlyIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcblxuXG5jb25zdCBsb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdzaW1jdGwnKTtcblxuY29uc3QgU0lNX1JVTlRJTUVfTkFNRSA9ICdjb20uYXBwbGUuQ29yZVNpbXVsYXRvci5TaW1SdW50aW1lLic7XG5cbi8qKlxuICogRXhlY3V0ZSB0aGUgcGFydGljdWxhciBzaW1jdGwgY29tbWFuZCBhbmQgcmV0dXJuIHRoZSBvdXRwdXQuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGNvbW1hbmQgLSBPbmUgb2YgYXZhaWxhYmxlIHNpbWN0bCBzdWJjb21tYW5kcy5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgRXhlY3V0ZSBgeGNydW4gc2ltY3RsYCBpbiBUZXJtaW5hbCB0byBzZWUgdGhlIGZ1bGwgbGlzdFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICBvZiBhdmFpbGFibGUgc3ViY29tbWFuZHMuXG4gKiBAcGFyYW0ge251bWJlcn0gdGltZW91dCAtIENvbW1hbmQgZXhlY3V0aW9uIHRpbWVvdXQgaW4gbWlsbGlzZWNvbmRzLlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICBTZXQgaXQgdG8gemVybyB0byBza2lwIHdhaXRpbmcgZm9yIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhlY3V0aW9uLlxuICogQHBhcmFtIHtBcnJheS48c3RyaW5nPn0gYXJncyBbW11dIC0gVGhlIGxpc3Qgb2YgYWRkaXRpb25hbCBzdWJjb21tYW5kIGFyZ3VtZW50cy5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEl0J3MgZW1wdHkgYnkgZGVmYXVsdC5cbiAqIEBwYXJhbSB7T2JqZWN0fSBlbnYgW3t9XSAtIEVudmlyb25tZW50IHZhcmlhYmxlcyBtYXBwaW5nLiBBbGwgdGhlc2UgdmFyaWFibGVzXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWxsIGJlIHBhc3NlZCBTaW11bGF0b3IgYW5kIHVzZWQgaW4gX2V4ZWN1dGluZ0Z1bmN0aW9uXy5cbiAqIEBwYXJhbSB7RnVuY3Rpb259IGV4ZWN1dGluZ0Z1bmN0aW9uIC0gRXhlY3V0aW5nIGZ1bmN0aW9uIG9iamVjdC4gRXF1YWxzIHRvIHRlZW5fcHJvY2VzcydzXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9leGVjXyBieSBkZWZhdWx0LlxuICogQHBhcmFtIHtib29sZWFufSBsb2dFcnJvcnMgW3RydWVdIC0gU2V0IGl0IHRvIF9mYWxzZV8gdG8gdGhyb3cgZXhlY3V0aW9uIGVycm9yc1xuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1tZWRpYXRlbHkgd2l0aG91dCBsb2dnaW5nIGFueSBhZGRpdGlvbmFsIGluZm9ybWF0aW9uLlxuICogQHJldHVybiB7T2JqZWN0fSBUaGUgcmVzdWx0IG9mIF9leGVjdXRpbmdGdW5jdGlvbl8uXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmQgZXhlY3V0ZWQgYnkgX2V4ZWN1dGluZ0Z1bmN0aW9uX1xuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHNpbUNvbW1hbmQgKGNvbW1hbmQsIHRpbWVvdXQsIGFyZ3MgPSBbXSwgZW52ID0ge30sIGV4ZWN1dGluZ0Z1bmN0aW9uID0gZXhlYywgbG9nRXJyb3JzID0gdHJ1ZSkge1xuICAvLyBydW4gYSBwYXJ0aWN1bGFyIHNpbWN0bCBjb21tYW5kXG4gIGFyZ3MgPSBbJ3NpbWN0bCcsIGNvbW1hbmQsIC4uLmFyZ3NdO1xuICAvLyBQcmVmaXggYWxsIHBhc3NlZCBpbiBlbnZpcm9ubWVudCB2YXJpYWJsZXMgd2l0aCAnU0lNQ1RMX0NISUxEXycsIHNpbWN0bFxuICAvLyB3aWxsIHRoZW4gcGFzcyB0aGVzZSB0byB0aGUgY2hpbGQgKHNwYXduZWQpIHByb2Nlc3MuXG4gIGVudiA9IF8uZGVmYXVsdHMoXy5tYXBLZXlzKGVudiwgKHZhbHVlLCBrZXkpID0+IHtcbiAgICByZXR1cm4gYFNJTUNUTF9DSElMRF8ke2tleX1gO1xuICB9KSwgcHJvY2Vzcy5lbnYpO1xuXG4gIHRyeSB7XG4gICAgcmV0dXJuIGF3YWl0IGV4ZWN1dGluZ0Z1bmN0aW9uKCd4Y3J1bicsIGFyZ3MsIHt0aW1lb3V0LCBlbnZ9KTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGlmICghbG9nRXJyb3JzKSB7XG4gICAgICAvLyBpZiB3ZSBkb24ndCB3YW50IHRvIHNlZSB0aGUgZXJyb3JzLCBqdXN0IHRocm93IGFuZCBhbGxvdyB0aGUgY2FsbGluZ1xuICAgICAgLy8gY29kZSBkbyB3aGF0IGl0IHdhbnRzXG4gICAgICB0aHJvdyBlO1xuICAgIH0gZWxzZSBpZiAoZS5zdGRlcnIpIHtcbiAgICAgIGxvZy5lcnJvckFuZFRocm93KGBzaW1jdGwgZXJyb3IgcnVubmluZyAnJHtjb21tYW5kfSc6ICR7ZS5zdGRlcnIudHJpbSgpfWApO1xuICAgIH0gZWxzZSB7XG4gICAgICBsb2cuZXJyb3JBbmRUaHJvdyhlKTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBFeGVjUmVzdWx0XG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHN0ZG91dCAtIFByb2Nlc3Mgc3Rkb3V0LlxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBzdGRlcnIgLSBQcm9jZXNzIHN0ZGVyci5cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBjb2RlIC0gUHJvY2VzcyBleGl0IGNvZGUuXG4gKi9cblxuLyoqXG4gKiBFeGVjdXRlIHRoZSBwYXJ0aWN1bGFyIHNpbWN0bCBzdWJjb21tYW5kIHN5bmNocm9ub3VzbHkgYW5kXG4gKiB3YWl0IGZvciB0aGUgb3V0cHV0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBjb21tYW5kIC0gU2VlIHtAbGluayBzaW1Db21tYW5kfSBwYXJhbWV0ZXJzLlxuICogQHBhcmFtIHtudW1iZXJ9IHRpbWVvdXQgLSBTZWUge0BsaW5rIHNpbUNvbW1hbmR9IHBhcmFtZXRlcnMuXG4gKiBAcGFyYW0ge0FycmF5LjxzdHJpbmc+fSBhcmdzIFtbXV0gLSBTZWUge0BsaW5rIHNpbUNvbW1hbmR9IHBhcmFtZXRlcnMuXG4gKiBAcGFyYW0ge09iamVjdH0gZW52IFt7fV0gLSBTZWUge0BsaW5rIHNpbUNvbW1hbmR9IHBhcmFtZXRlcnMuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGxvZ0Vycm9ycyBbdHJ1ZV0gLSBTZWUge0BsaW5rIHNpbUNvbW1hbmR9IHBhcmFtZXRlcnMuXG4gKiBAcmV0dXJuIHtFeGVjUmVzdWx0fSBUaGUgcmVzdWx0IG9mIF9leGVjXyBmdW5jdGlvbi5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZCBleGVjdXRlZCBieSBleGVjXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2ltRXhlYyAoY29tbWFuZCwgdGltZW91dCwgYXJncyA9IFtdLCBlbnYgPSB7fSwgbG9nRXJyb3JzID0gdHJ1ZSkge1xuICByZXR1cm4gYXdhaXQgc2ltQ29tbWFuZChjb21tYW5kLCB0aW1lb3V0LCBhcmdzLCBlbnYsIGFzeW5jIChjLCBhLCBvYikgPT4ge1xuICAgIHJldHVybiBhd2FpdCBleGVjKGMsIGEsIG9iKTtcbiAgfSwgbG9nRXJyb3JzKTtcbn1cblxuLyoqXG4gKiBDcmF0ZSBhIHRlZW5fcHJvY2VzcydzIFN1YlByb2Nlc3MgaW5zdGFuY2UgZm9yIHRoZSBwYXJ0aWN1bGFyXG4gKiBzaW1jdGwgc3ViY29tbWFuZCBleGVjdXRpb24uIFRoaXMgbWlnaHQgYmUgbmVlZGVkIHRvIGdhaW4gYmV0dGVyXG4gKiBjb250cm9sIG92ZXIgdGhlIGV4ZWN1dGlvbiBwcm9jZXNzLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBjb21tYW5kIC0gU2VlIHtAbGluayBzaW1Db21tYW5kfSBwYXJhbWV0ZXJzLlxuICogQHBhcmFtIHtudW1iZXJ9IHRpbWVvdXQgLSBTZWUge0BsaW5rIHNpbUNvbW1hbmR9IHBhcmFtZXRlcnMuXG4gKiBAcGFyYW0ge0FycmF5LjxzdHJpbmc+fSBhcmdzIFtbXV0gLSBTZWUge0BsaW5rIHNpbUNvbW1hbmR9IHBhcmFtZXRlcnMuXG4gKiBAcGFyYW0ge09iamVjdH0gZW52IFt7fV0gLSBTZWUge0BsaW5rIHNpbUNvbW1hbmR9IHBhcmFtZXRlcnMuXG4gKiBAcmV0dXJuIHtTdWJQcm9jZXNzfSBUaGUgaW5zdGFuY2Ugb2YgdGVlbl9wcm9jZXNzJ3MgU3ViUHJvY2VzcyBjbGFzcy5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2ltU3ViUHJvY2VzcyAoY29tbWFuZCwgdGltZW91dCwgYXJncyA9IFtdLCBlbnYgPSB7fSkge1xuICByZXR1cm4gYXdhaXQgc2ltQ29tbWFuZChjb21tYW5kLCB0aW1lb3V0LCBhcmdzLCBlbnYsIChjLCBhLCBvYikgPT4ge1xuICAgIHJldHVybiBuZXcgU3ViUHJvY2VzcyhjLCBhLCBvYik7XG4gIH0pO1xufVxuXG4vKipcbiAqIEluc3RhbGwgdGhlIHBhcnRpY3VsYXIgYXBwbGljYXRpb24gcGFja2FnZSBvbiBTaW11bGF0b3IuXG4gKiBJdCBpcyByZXF1aXJlZCB0aGF0IFNpbXVsYXRvciBpcyBpbiBfYm9vdGVkXyBzdGF0ZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIFRoZSBVRElEIG9mIGFuIGV4aXN0aW5nIFNpbXVsYXRvci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBhcHBQYXRoIC0gRnVsbCBwYXRoIHRvIC5hcHAgcGFja2FnZSwgd2hpY2ggaXNcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgZ29pbmcgdG8gYmUgaW5zdGFsbGVkLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBpbnN0YWxsQXBwICh1ZGlkLCBhcHBQYXRoKSB7XG4gIGF3YWl0IHNpbUV4ZWMoJ2luc3RhbGwnLCAwLCBbdWRpZCwgYXBwUGF0aF0pO1xufVxuXG4vKipcbiAqIEJvb3QgdGhlIHBhcnRpY3VsYXIgU2ltdWxhdG9yIGlmIGl0IGlzIG5vdCBydW5uaW5nLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBib290RGV2aWNlICh1ZGlkKSB7XG4gIHRyeSB7XG4gICAgYXdhaXQgc2ltRXhlYygnYm9vdCcsIDAsIFt1ZGlkXSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGlmICgoZXJyLm1lc3NhZ2UgfHwgJycpLmluZGV4T2YoJ1VuYWJsZSB0byBib290IGRldmljZSBpbiBjdXJyZW50IHN0YXRlOiBCb290ZWQnKSA9PT0gLTEpIHtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gICAgbG9nLmRlYnVnKGBTaW11bGF0b3IgYWxyZWFkeSBpbiAnQm9vdGVkJyBzdGF0ZS4gQ29udGludWluZ2ApO1xuICB9XG59XG5cbi8qKlxuICogUmVtb3ZlIHRoZSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uIHBhY2thZ2UgZnJvbSBTaW11bGF0b3IuXG4gKiBJdCBpcyByZXF1aXJlZCB0aGF0IFNpbXVsYXRvciBpcyBpbiBfYm9vdGVkXyBzdGF0ZSBhbmRcbiAqIHRoZSBhcHBsaWNhdGlvbiB3aXRoIGdpdmVuIGJ1bmRsZSBpZGVudGlmaWVyIGlzIGFscmVhZHkgaW5zdGFsbGVkLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gQnVuZGxlIGlkZW50aWZpZXIgb2YgdGhlIGFwcGxpY2F0aW9uLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpY2ggaXMgZ29pbmcgdG8gYmUgcmVtb3ZlZC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgc3ViY29tbWFuZCBjb21tYW5kXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gcmVtb3ZlQXBwICh1ZGlkLCBidW5kbGVJZCkge1xuICBhd2FpdCBzaW1FeGVjKCd1bmluc3RhbGwnLCAwLCBbdWRpZCwgYnVuZGxlSWRdKTtcbn1cblxuLyoqXG4gKiBFeGVjdXRlIHRoZSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uIHBhY2thZ2Ugb24gU2ltdWxhdG9yLlxuICogSXQgaXMgcmVxdWlyZWQgdGhhdCBTaW11bGF0b3IgaXMgaW4gX2Jvb3RlZF8gc3RhdGUgYW5kXG4gKiB0aGUgYXBwbGljYXRpb24gd2l0aCBnaXZlbiBidW5kbGUgaWRlbnRpZmllciBpcyBhbHJlYWR5IGluc3RhbGxlZC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIFRoZSBVRElEIG9mIGFuIGV4aXN0aW5nIFNpbXVsYXRvci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIEJ1bmRsZSBpZGVudGlmaWVyIG9mIHRoZSBhcHBsaWNhdGlvbixcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWNoIGlzIGdvaW5nIHRvIGJlIHJlbW92ZWQuXG4gKiBAcGFyYW0ge251bWJlcn0gdHJpZXMgWzVdIC0gVGhlIG1heGltdW0gbnVtYmVyIG9mIHJldHJpZXMgYmVmb3JlXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dpbmcgYW4gZXhjZXB0aW9uLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBsYXVuY2ggKHVkaWQsIGJ1bmRsZUlkLCB0cmllcyA9IDUpIHtcbiAgYXdhaXQgcmV0cnlJbnRlcnZhbCh0cmllcywgMTAwMCwgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IHNpbUV4ZWMoJ2xhdW5jaCcsIDAsIFt1ZGlkLCBidW5kbGVJZF0pO1xuICB9KTtcbn1cblxuLyoqXG4gKiBTcGF3biB0aGUgcGFydGljdWxhciBwcm9jZXNzIG9uIFNpbXVsYXRvci5cbiAqIEl0IGlzIHJlcXVpcmVkIHRoYXQgU2ltdWxhdG9yIGlzIGluIF9ib290ZWRfIHN0YXRlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHBhcmFtIHtzdHJpbmd8QXJyYXk8c3RyaW5nPn0gYXJncyAtIFNwYXduIGFyZ3VtZW50c1xuICogQHBhcmFtIHtvYmplY3R9IGVudiBbe31dIC0gQWRkaXRpb25hbCBlbnZpcm9ubWVudCB2YXJpYWJsZXMgbWFwcGluZy5cbiAqIEByZXR1cm4ge0V4ZWNSZXN1bHR9IENvbW1hbmQgZXhlY3V0aW9uIHJlc3VsdC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgc3ViY29tbWFuZCBjb21tYW5kXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gc3Bhd24gKHVkaWQsIGFyZ3MsIGVudiA9IHt9KSB7XG4gIHJldHVybiBhd2FpdCBzaW1FeGVjKCdzcGF3bicsIDAsIFt1ZGlkLCAuLi4oXy5pc0FycmF5KGFyZ3MpID8gYXJncyA6IFthcmdzXSldLCBlbnYpO1xufVxuXG4vKipcbiAqIFByZXBhcmUgU3ViUHJvY2VzcyBpbnN0YW5jZSBmb3IgYSBuZXcgcHJvY2Vzcywgd2hpY2ggaXMgZ29pbmcgdG8gYmUgc3Bhd25lZFxuICogb24gU2ltdWxhdG9yLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHBhcmFtIHtzdHJpbmd8QXJyYXk8c3RyaW5nPn0gYXJncyAtIFNwYXduIGFyZ3VtZW50c1xuICogQHBhcmFtIHtvYmplY3R9IGVudiBbe31dIC0gQWRkaXRpb25hbCBlbnZpcm9ubWVudCB2YXJpYWJsZXMgbWFwcGluZy5cbiAqIEByZXR1cm4ge1N1YlByb2Nlc3N9IFRoZSBpbnN0YW5jZSBvZiB0aGUgcHJvY2VzcyB0byBiZSBzcGF3bmVkLlxuICovXG5hc3luYyBmdW5jdGlvbiBzcGF3blN1YlByb2Nlc3MgKHVkaWQsIGFyZ3MsIGVudiA9IHt9KSB7XG4gIHJldHVybiBhd2FpdCBzaW1TdWJQcm9jZXNzKCdzcGF3bicsIDAsIFt1ZGlkLCAuLi4oXy5pc0FycmF5KGFyZ3MpID8gYXJncyA6IFthcmdzXSldLCBlbnYpO1xufVxuXG4vKipcbiAqIE9wZW4gVVJMIHNjaGVtZSBvbiBTaW11bGF0b3IuIGlPUyB3aWxsIGF1dG9tYXRpY2FsbHkgdHJ5XG4gKiB0byBmaW5kIGEgbWF0Y2hpbmcgYXBwbGljYXRpb24sIHdoaWNoIHN1cHBvcnRzIHRoZSBnaXZlbiBzY2hlbWUuXG4gKiBJdCBpcyByZXF1aXJlZCB0aGF0IFNpbXVsYXRvciBpcyBpbiBfYm9vdGVkXyBzdGF0ZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIFRoZSBVRElEIG9mIGFuIGV4aXN0aW5nIFNpbXVsYXRvci5cbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSBUaGUgVVJMIHNjaGVtZSB0byBvcGVuLCBmb3IgZXhhbXBsZSBodHRwOi8vYXBwaW9tLmlvXG4gKiAgICAgICAgICAgICAgICAgICAgICAgd2lsbCBiZSBvcGVuZWQgYnkgdGhlIGJ1aWx0LWluIG1vYmlsZSBicm93c2VyLlxuICogQHJldHVybiB7RXhlY1Jlc3VsdH0gQ29tbWFuZCBleGVjdXRpb24gcmVzdWx0LlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBvcGVuVXJsICh1ZGlkLCB1cmwpIHtcbiAgcmV0dXJuIGF3YWl0IHNpbUV4ZWMoJ29wZW51cmwnLCAwLCBbdWRpZCwgdXJsXSk7XG59XG5cbi8qKlxuICogSW52b2tlIGhpZGRlbiBhcHBpbmZvIHN1YmNvbW1hbmQgdG8gZ2V0IHRoZSBpbmZvcm1hdGlvblxuICogYWJvdXQgYXBwbGljYXRpb25zIGluc3RhbGxlZCBvbiBTaW11bGF0b3IsIGluY2x1ZGluZ1xuICogc3lzdGVtIGFwcGxpY2F0aW9ucyAoe0BsaW5rIGdldEFwcENvbnRhaW5lcn0gZG9lcyBub3QgXCJzZWVcIiBzdWNoIGFwcHMpLlxuICogU2ltdWxhdG9yIHNlcnZlciBzaG91bGQgYmUgaW4gJ2Jvb3RlZCcgc3RhdGUgZm9yIHRoaXMgY2FsbCB0byB3b3JrIHByb3Blcmx5LlxuICogVGhlIHRvb2wgaXMgb25seSBhdmFpbGFibGUgc2luY2UgWGNvZGUgU0RLIDguMVxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVURJRCBvZiB0aGUgdGFyZ2V0IFNpbXVsYXRvci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIFRoZSBidW5kbGUgaWRlbnRpZmllciBvZiB0aGUgdGFyZ2V0IGFwcGxpY2F0aW9uLlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgaW5mb3JtYXRpb24gYWJvdXQgaW5zdGFsbGVkIGFwcGxpY2F0aW9uLlxuICpcbiAqIEV4YW1wbGUgb3V0cHV0IGZvciBub24tZXhpc3RpbmcgYXBwbGljYXRpb24gY29udGFpbmVyOlxuICogPHByZT5cbiAqIHtcbiAqICAgQ0ZCdW5kbGVJZGVudGlmaWVyID0gXCJjb20uYXBwbGUuTW9iaWxlU2FmYXJpXCI7XG4gKiAgIEdyb3VwQ29udGFpbmVycyA9ICAgICB7XG4gKiAgIH07XG4gKiAgIFNCQXBwVGFncyA9ICAgICAoXG4gKiAgICk7XG4gKiB9XG4gKiA8L3ByZT5cbiAqXG4gKiBFeGFtcGxlIG91dHB1dCBmb3IgYW4gZXhpc3Rpbmcgc3lzdGVtIGFwcGxpY2F0aW9uIGNvbnRhaW5lcjpcbiAqIDxwcmU+XG4gKiB7XG4gKiAgIEFwcGxpY2F0aW9uVHlwZSA9IEhpZGRlbjtcbiAqICAgQnVuZGxlID0gXCJmaWxlOi8vL0FwcGxpY2F0aW9ucy9YY29kZS1iZXRhLmFwcC9Db250ZW50cy9EZXZlbG9wZXIvUGxhdGZvcm1zL2lQaG9uZU9TLnBsYXRmb3JtL0RldmVsb3Blci9MaWJyYXJ5L0NvcmVTaW11bGF0b3IvUHJvZmlsZXMvUnVudGltZXMvaU9TLnNpbXJ1bnRpbWUvQ29udGVudHMvUmVzb3VyY2VzL1J1bnRpbWVSb290L1N5c3RlbS9MaWJyYXJ5L0NvcmVTZXJ2aWNlcy9TcHJpbmdCb2FyZC5hcHBcIjtcbiAqICAgQ0ZCdW5kbGVEaXNwbGF5TmFtZSA9IFNwcmluZ0JvYXJkO1xuICogICBDRkJ1bmRsZUV4ZWN1dGFibGUgPSBTcHJpbmdCb2FyZDtcbiAqICAgQ0ZCdW5kbGVJZGVudGlmaWVyID0gXCJjb20uYXBwbGUuc3ByaW5nYm9hcmRcIjtcbiAqICAgQ0ZCdW5kbGVOYW1lID0gU3ByaW5nQm9hcmQ7XG4gKiAgIENGQnVuZGxlVmVyc2lvbiA9IDUwO1xuICogICBHcm91cENvbnRhaW5lcnMgPSAgICAge1xuICogICB9O1xuICogICBQYXRoID0gXCIvQXBwbGljYXRpb25zL1hjb2RlLWJldGEuYXBwL0NvbnRlbnRzL0RldmVsb3Blci9QbGF0Zm9ybXMvaVBob25lT1MucGxhdGZvcm0vRGV2ZWxvcGVyL0xpYnJhcnkvQ29yZVNpbXVsYXRvci9Qcm9maWxlcy9SdW50aW1lcy9pT1Muc2ltcnVudGltZS9Db250ZW50cy9SZXNvdXJjZXMvUnVudGltZVJvb3QvU3lzdGVtL0xpYnJhcnkvQ29yZVNlcnZpY2VzL1NwcmluZ0JvYXJkLmFwcFwiO1xuICogICBTQkFwcFRhZ3MgPSAgICAgKFxuICogICApO1xuICogfVxuICogPC9wcmU+XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGFwcEluZm8gKHVkaWQsIGJ1bmRsZUlkKSB7XG4gIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgc2ltRXhlYygnYXBwaW5mbycsIDAsIFt1ZGlkLCBidW5kbGVJZF0pO1xuICByZXR1cm4gKHN0ZG91dCB8fCAnJykudHJpbSgpO1xufVxuXG4vKipcbiAqIEFkZCB0aGUgcGFydGljdWxhciBtZWRpYSBmaWxlIHRvIFNpbXVsYXRvcidzIGxpYnJhcnkuXG4gKiBJdCBpcyByZXF1aXJlZCB0aGF0IFNpbXVsYXRvciBpcyBpbiBfYm9vdGVkXyBzdGF0ZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIFRoZSBVRElEIG9mIGFuIGV4aXN0aW5nIFNpbXVsYXRvci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIC0gRnVsbCBwYXRoIHRvIGEgbWVkaWEgZmlsZSBvbiB0aGUgbG9jYWxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgZmlsZSBzeXN0ZW0uXG4gKiBAcmV0dXJuIHtFeGVjUmVzdWx0fSBDb21tYW5kIGV4ZWN1dGlvbiByZXN1bHQuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNvcnJlc3BvbmRpbmcgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZFxuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGFkZE1lZGlhICh1ZGlkLCBwYXRoKSB7XG4gIHJldHVybiBhd2FpdCBzaW1FeGVjKCdhZGRtZWRpYScsIDAsIFt1ZGlkLCBwYXRoXSk7XG59XG5cbi8qKlxuICogVGVybWluYXRlIHRoZSBnaXZlbiBydW5uaW5nIGFwcGxpY2F0aW9uIG9uIFNpbXVsYXRvci5cbiAqIEl0IGlzIHJlcXVpcmVkIHRoYXQgU2ltdWxhdG9yIGlzIGluIF9ib290ZWRfIHN0YXRlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gQnVuZGxlIGlkZW50aWZpZXIgb2YgdGhlIGFwcGxpY2F0aW9uLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpY2ggaXMgZ29pbmcgdG8gYmUgdGVybWluYXRlZC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgc3ViY29tbWFuZCBjb21tYW5kXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gdGVybWluYXRlICh1ZGlkLCBidW5kbGVJZCkge1xuICBhd2FpdCBzaW1FeGVjKCd0ZXJtaW5hdGUnLCAwLCBbdWRpZCwgYnVuZGxlSWRdKTtcbn1cblxuLyoqXG4gKiBHZXQgdGhlIGZ1bGwgcGF0aCB0byB0aGUgcGFydGljdWxhciBhcHBsaWNhdGlvbiBjb250YWluZXJcbiAqIG9uIHRoZSBsb2NhbCBmaWxlIHN5c3RlbS4gTm90ZSwgdGhhdCB0aGlzIHN1YmNvbW1hbmQgdGhyb3dzXG4gKiBhbiBlcnJvciBpZiBidW5kbGUgaWQgb2YgYSBzeXN0ZW0gYXBwbGljYXRpb24gaXMgcHJvdmlkZWQsXG4gKiBsaWtlICdjb20uYXBwbGUuc3ByaW5nYm9hcmQnLlxuICogSXQgaXMgcmVxdWlyZWQgdGhhdCBTaW11bGF0b3IgaXMgaW4gX2Jvb3RlZF8gc3RhdGUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgLSBUaGUgVURJRCBvZiBhbiBleGlzdGluZyBTaW11bGF0b3IuXG4gKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSWQgLSBCdW5kbGUgaWRlbnRpZmllciBvZiBhbiBhcHBsaWNhdGlvbi5cbiAqIEBwYXJhbSB7P2Jvb2xlYW59IGxvZ0Vycm9ycyBbdHJ1ZV0gLSBXaGV0aGVyIHRvIGluY2x1ZGUgZXhlYydzIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGRlcnIgb3V0cHV0IGludG8gZXhjZXB0aW9uIG1lc3NhZ2UgaWYgdGhyb3duLlxuICogQHBhcmFtIHs/c3RyaW5nfSBjb250YWluZXJUeXBlIC0gV2hpY2ggY29udGFpbmVyIHR5cGUgdG8gcmV0dXJuLiBQb3NzaWJsZSB2YWx1ZXNcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZSAnYXBwJywgJ2RhdGEnLCAnZ3JvdXBzJywgJzxBIHNwZWNpZmljIEFwcCBHcm91cCBjb250YWluZXI+Jy5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRoZSBkZWZhdWx0IHZhbHVlIGlzICdhcHAnLlxuICogQHJldHVybiB7c3RyaW5nfSBGdWxsIHBhdGggdG8gdGhlIGdpdmVuIGFwcGxpY2F0aW9uIGNvbnRhaW5lciBvbiB0aGUgbG9jYWxcbiAqICAgICAgICAgICAgICAgICAgZmlsZSBzeXN0ZW0uXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNvcnJlc3BvbmRpbmcgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZFxuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldEFwcENvbnRhaW5lciAodWRpZCwgYnVuZGxlSWQsIGxvZ0Vycm9ycyA9IHRydWUsIGNvbnRhaW5lclR5cGUgPSBudWxsKSB7XG4gIGNvbnN0IGFyZ3MgPSBbdWRpZCwgYnVuZGxlSWRdO1xuICBpZiAoY29udGFpbmVyVHlwZSkge1xuICAgIGFyZ3MucHVzaChjb250YWluZXJUeXBlKTtcbiAgfVxuICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IHNpbUV4ZWMoJ2dldF9hcHBfY29udGFpbmVyJywgMCwgYXJncywge30sIGxvZ0Vycm9ycyk7XG4gIHJldHVybiAoc3Rkb3V0IHx8ICcnKS50cmltKCk7XG59XG5cbi8qKlxuICogU2h1dGRvd24gdGhlIGdpdmVuIFNpbXVsYXRvciBpZiBpdCBpcyBydW5uaW5nLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBzaHV0ZG93biAodWRpZCkge1xuICB0cnkge1xuICAgIGF3YWl0IHNpbUV4ZWMoJ3NodXRkb3duJywgMCwgW3VkaWRdKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgaWYgKCEoZXJyICsgJycpLmluY2x1ZGVzKCdjdXJyZW50IHN0YXRlOiBTaHV0ZG93bicpKSB7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICAgIGxvZy5kZWJ1ZyhgU2ltdWxhdG9yIGFscmVhZHkgaW4gJ1NodXRkb3duJyBzdGF0ZS4gQ29udGludWluZ2ApO1xuICB9XG59XG5cbi8qKlxuICogQ3JlYXRlIFNpbXVsYXRvciBkZXZpY2Ugd2l0aCBnaXZlbiBuYW1lIGZvciB0aGUgcGFydGljdWxhclxuICogcGxhdGZvcm0gdHlwZSBhbmQgdmVyc2lvbi5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIFRoZSBkZXZpY2UgbmFtZSB0byBiZSBjcmVhdGVkLlxuICogQHBhcmFtIHtzdHJpbmd9IGRldmljZVR5cGVJZCAtIERldmljZSB0eXBlLCBmb3IgZXhhbXBsZSAnaVBob25lIDYnLlxuICogQHBhcmFtIHtzdHJpbmd9IHJ1bnRpbWVJZCAtIFBsYXRmb3JtIHZlcnNpb24sIGZvciBleGFtcGxlICcxMC4zJy5cbiAqIEBwYXJhbSB7bnVtYmVyfSB0aW1lb3V0IFsxMDAwMF0gLSBUaGUgbWF4aW11bSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bml0IGRldmljZSBjcmVhdGlvbiBpcyBjb21wbGV0ZWQuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBVRElEIG9mIHRoZSBuZXdseSBjcmVhdGVkIGRldmljZS5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgc3ViY29tbWFuZCBjb21tYW5kXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gY3JlYXRlRGV2aWNlIChuYW1lLCBkZXZpY2VUeXBlSWQsIHJ1bnRpbWVJZCwgdGltZW91dCA9IDEwMDAwKSB7XG4gIGxldCB1ZGlkO1xuICAvLyBmaXJzdCBtYWtlIHN1cmUgdGhhdCB0aGUgcnVudGltZSBpZCBpcyB0aGUgcmlnaHQgb25lXG4gIC8vIGluIHNvbWUgdmVyc2lvbnMgb2YgWGNvZGUgaXQgd2lsbCBiZSBhIHBhdGNoIHZlcnNpb25cbiAgdHJ5IHtcbiAgICBydW50aW1lSWQgPSBhd2FpdCBnZXRSdW50aW1lRm9yUGxhdGZvcm1WZXJzaW9uKHJ1bnRpbWVJZCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZy53YXJuKGBVbmFibGUgdG8gZmluZCBydW50aW1lIGZvciBpT1MgJyR7cnVudGltZUlkfScuIENvbnRpbnVpbmdgKTtcbiAgfVxuXG4gIGxvZy5kZWJ1ZyhgQ3JlYXRpbmcgc2ltdWxhdG9yIHdpdGggbmFtZSAnJHtuYW1lfScsIGRldmljZSB0eXBlIGlkICcke2RldmljZVR5cGVJZH0nIGFuZCBydW50aW1lIGlkICcke3J1bnRpbWVJZH0nYCk7XG4gIHRyeSB7XG4gICAgY29uc3Qgb3V0ID0gYXdhaXQgc2ltRXhlYygnY3JlYXRlJywgMCwgW25hbWUsIGRldmljZVR5cGVJZCwgcnVudGltZUlkXSk7XG4gICAgdWRpZCA9IG91dC5zdGRvdXQudHJpbSgpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsZXQgcmVhc29uID0gZXJyLm1lc3NhZ2U7XG4gICAgaWYgKGVyci5zdGRlcnIpIHtcbiAgICAgIHJlYXNvbiA9IGVyci5zdGRlcnIudHJpbSgpO1xuICAgIH1cbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgQ291bGQgbm90IGNyZWF0ZSBzaW11bGF0b3Igd2l0aCBuYW1lICcke25hbWV9JywgZGV2aWNlIGAgK1xuICAgICAgICAgICAgICAgICAgICAgIGB0eXBlIGlkICcke2RldmljZVR5cGVJZH0nIGFuZCBydW50aW1lIGlkICcke3J1bnRpbWVJZH0nLiBSZWFzb246ICcke3JlYXNvbn0nYCk7XG4gIH1cblxuICAvLyBtYWtlIHN1cmUgdGhhdCBpdCBnZXRzIG91dCBvZiB0aGUgXCJDcmVhdGluZ1wiIHN0YXRlXG4gIGxldCByZXRyaWVzID0gcGFyc2VJbnQodGltZW91dCAvIDEwMDAsIDEwKTtcbiAgYXdhaXQgcmV0cnlJbnRlcnZhbChyZXRyaWVzLCAxMDAwLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGRldmljZXMgPSBhd2FpdCBnZXREZXZpY2VzKCk7XG4gICAgZm9yIChjb25zdCBkZXZpY2VBcnIgb2YgXy52YWx1ZXMoZGV2aWNlcykpIHtcbiAgICAgIGZvciAoY29uc3QgZGV2aWNlIG9mIGRldmljZUFycikge1xuICAgICAgICBpZiAoZGV2aWNlLnVkaWQgPT09IHVkaWQpIHtcbiAgICAgICAgICBpZiAoZGV2aWNlLnN0YXRlID09PSAnQ3JlYXRpbmcnKSB7XG4gICAgICAgICAgICAvLyBuZWVkIHRvIHJldHJ5XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RldmljZSBzdGlsbCBiZWluZyBjcmVhdGVkJyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIHN0b3AgbG9va2luZywgd2UncmUgZG9uZVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIHVkaWQ7XG59XG5cbi8qKlxuICogRGVsZXRlIHRoZSBwYXJ0aWN1bGFyIFNpbXVsYXRvciBmcm9tIGF2YWlsYWJsZSBkZXZpY2VzIGxpc3QuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgLSBUaGUgVURJRCBvZiBhbiBleGlzdGluZyBTaW11bGF0b3IuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNvcnJlc3BvbmRpbmcgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZFxuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZURldmljZSAodWRpZCkge1xuICBhd2FpdCBzaW1FeGVjKCdkZWxldGUnLCAwLCBbdWRpZF0pO1xufVxuXG4vKipcbiAqIFJlc2V0IHRoZSBjb250ZW50IGFuZCBzZXR0aW5ncyBvZiB0aGUgcGFydGljdWxhciBTaW11bGF0b3IuXG4gKiBJdCBpcyByZXF1aXJlZCB0aGF0IFNpbXVsYXRvciBpcyBpbiBfc2h1dGRvd25fIHN0YXRlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHBhcmFtIHtudW1iZXJ9IHRpbWVvdXQgWzEwMDAwXSAtIFRoZSBtYXhpbXVtIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuaXQgZGV2aWNlIHJlc2V0IGlzIGNvbXBsZXRlZC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgc3ViY29tbWFuZCBjb21tYW5kXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZXJhc2VEZXZpY2UgKHVkaWQsIHRpbWVvdXQgPSAxMDAwKSB7XG4gIGxldCBsb29wRm4gPSBhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgc2ltRXhlYygnZXJhc2UnLCAxMDAwMCwgW3VkaWRdKTtcbiAgfTtcbiAgLy8gcmV0cnkgZXJhc2Ugd2l0aCBhIHNsZWVwIGluIGJldHdlZW4gYmVjYXVzZSBpdCdzIGZsYWtleVxuICBsZXQgcmV0cmllcyA9IHBhcnNlSW50KHRpbWVvdXQgLyAyMDAsIDEwKTtcbiAgYXdhaXQgcmV0cnlJbnRlcnZhbChyZXRyaWVzLCAyMDAsIGxvb3BGbik7XG59XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gRGV2aWNlSW5mb1xuICogQHByb3BlcnR5IHtzdHJpbmd9IG5hbWUgLSBUaGUgZGV2aWNlIG5hbWUuXG4gKiBAcHJvcGVydHkge3N0cmluZ30gdWRpZCAtIFRoZSBkZXZpY2UgVURJRC5cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBzdGF0ZSAtIFRoZSBjdXJyZW50IFNpbXVsYXRvciBzdGF0ZSwgZm9yIGV4YW1wbGUgJ2Jvb3RlZCcgb3IgJ3NodXRkb3duJy5cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBzZGsgLSBUaGUgU0RLIHZlcnNpb24sIGZvciBleGFtcGxlICcxMC4zJy5cbiAqL1xuXG4vKipcbiAqIFBhcnNlIHRoZSBsaXN0IG9mIGV4aXN0aW5nIFNpbXVsYXRvciBkZXZpY2VzIHRvIHJlcHJlc2VudFxuICogaXQgYXMgY29udmVuaWVudCBtYXBwaW5nLlxuICpcbiAqIEBwYXJhbSB7P3N0cmluZ30gcGxhdGZvcm0gLSBUaGUgcGxhdGZvcm0gbmFtZSwgZm9yIGV4YW1wbGUgJ3dhdGNoT1MnLlxuICogQHJldHVybiB7T2JqZWN0fSBUaGUgcmVzdWx0aW5nIG1hcHBpbmcuIEVhY2gga2V5IGlzIHBsYXRmb3JtIHZlcnNpb24sXG4gKiAgICAgICAgICAgICAgICAgIGZvciBleGFtcGxlICcxMC4zJyBhbmQgdGhlIGNvcnJlc3BvbmRpbmcgdmFsdWUgaXMgYW5cbiAqICAgICAgICAgICAgICAgICAgYXJyYXkgb2YgdGhlIG1hdGNoaW5nIHtAbGluayBEZXZpY2VJbmZvfSBpbnN0YW5jZXMuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNvcnJlc3BvbmRpbmcgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZFxuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldERldmljZXNCeVBhcnNpbmcgKHBsYXRmb3JtKSB7XG4gIC8vIGdldCB0aGUgbGlzdCBvZiBkZXZpY2VzXG4gIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgc2ltRXhlYygnbGlzdCcsIDAsIFsnZGV2aWNlcyddKTtcblxuICAvLyBleHBlY3QgdG8gZ2V0IGEgbGlzdGluZyBsaWtlXG4gIC8vIC0tIGlPUyA4LjEgLS1cbiAgLy8gICAgIGlQaG9uZSA0cyAoM0NBNkU3REQtMjIwRS00NUU1LUI3MTYtMUU5OTJCM0E0MjlDKSAoU2h1dGRvd24pXG4gIC8vICAgICAuLi5cbiAgLy8gLS0gaU9TIDguMiAtLVxuICAvLyAgICAgaVBob25lIDRzIChBOTlGRkZDMy04RTE5LTREQ0YtQjU4NS03RDlENDZCNEMxNkUpIChTaHV0ZG93bilcbiAgLy8gICAgIC4uLlxuICAvLyBzbywgZ2V0IHRoZSBgLS0gaU9TIFguWCAtLWAgbGluZSB0byBmaW5kIHRoZSBzZGsgKFguWClcbiAgLy8gYW5kIHRoZSByZXN0IG9mIHRoZSBsaXN0aW5nIGluIG9yZGVyIHRvIGxhdGVyIGZpbmQgdGhlIGRldmljZXNcbiAgY29uc3QgZGV2aWNlU2VjdGlvblJlID0gXy5pc0VtcHR5KHBsYXRmb3JtKVxuICAgID8gbmV3IFJlZ0V4cChgXFxcXC1cXFxcLVxcXFxzKyhcXFxcUyspXFxcXHMrKFxcXFxTKylcXFxccytcXFxcLVxcXFwtKFxcXFxuXFxcXHN7NH0uKykqYCwgJ21naScpXG4gICAgOiBuZXcgUmVnRXhwKGBcXFxcLVxcXFwtXFxcXHMrJHtfLmVzY2FwZVJlZ0V4cChwbGF0Zm9ybSl9XFxcXHMrKFxcXFxTKylcXFxccytcXFxcLVxcXFwtKFxcXFxuXFxcXHN7NH0uKykqYCwgJ21naScpO1xuICBjb25zdCBtYXRjaGVzID0gW107XG4gIGxldCBtYXRjaDtcbiAgLy8gbWFrZSBhbiBlbnRyeSBmb3IgZWFjaCBzZGsgdmVyc2lvblxuICB3aGlsZSAoKG1hdGNoID0gZGV2aWNlU2VjdGlvblJlLmV4ZWMoc3Rkb3V0KSkpIHtcbiAgICBtYXRjaGVzLnB1c2gobWF0Y2gpO1xuICB9XG4gIGlmIChfLmlzRW1wdHkobWF0Y2hlcykpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvdWxkIG5vdCBmaW5kIGRldmljZSBzZWN0aW9uJyk7XG4gIH1cblxuICBjb25zdCBsaW5lUmUgPSAvKFteXFxzXS4rKSBcXCgoXFx3Ky0uK1xcdyspXFwpIFxcKChcXHcrXFxzP1xcdyspXFwpLzsgLy8gaHR0cHM6Ly9yZWdleDEwMS5jb20vci9sRzdtSzYvM1xuICAvLyBnZXQgYWxsIHRoZSBkZXZpY2VzIGZvciBlYWNoIHNka1xuICBjb25zdCBkZXZpY2VzID0ge307XG4gIGZvciAobWF0Y2ggb2YgbWF0Y2hlcykge1xuICAgIGNvbnN0IHNkayA9IHBsYXRmb3JtID8gbWF0Y2hbMV0gOiBtYXRjaFsyXTtcbiAgICBkZXZpY2VzW3Nka10gPSBkZXZpY2VzW3Nka10gfHwgW107XG4gICAgLy8gc3BsaXQgdGhlIGZ1bGwgbWF0Y2ggaW50byBsaW5lcyBhbmQgcmVtb3ZlIHRoZSBmaXJzdFxuICAgIGZvciAoY29uc3QgbGluZSBvZiBtYXRjaFswXS5zcGxpdCgnXFxuJykuc2xpY2UoMSkpIHtcbiAgICAgIGlmIChsaW5lLmluY2x1ZGVzKCcodW5hdmFpbGFibGUsICcpKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgLy8gYSBsaW5lIGlzIHNvbWV0aGluZyBsaWtlXG4gICAgICAvLyAgICBpUGhvbmUgNHMgKEE5OUZGRkMzLThFMTktNERDRi1CNTg1LTdEOUQ0NkI0QzE2RSkgKFNodXRkb3duKVxuICAgICAgLy8gcmV0cmlldmU6XG4gICAgICAvLyAgIGlQaG9uZSA0c1xuICAgICAgLy8gICBBOTlGRkZDMy04RTE5LTREQ0YtQjU4NS03RDlENDZCNEMxNkVcbiAgICAgIC8vICAgU2h1dGRvd25cbiAgICAgIGNvbnN0IGxpbmVNYXRjaCA9IGxpbmVSZS5leGVjKGxpbmUpO1xuICAgICAgaWYgKCFsaW5lTWF0Y2gpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3QgbWF0Y2ggbGluZTogJHtsaW5lfWApO1xuICAgICAgfVxuICAgICAgLy8gc2F2ZSB0aGUgd2hvbGUgdGhpbmcgYXMgYWIgb2JqZWN0IGluIHRoZSBsaXN0IGZvciB0aGlzIHNka1xuICAgICAgZGV2aWNlc1tzZGtdLnB1c2goe1xuICAgICAgICBuYW1lOiBsaW5lTWF0Y2hbMV0sXG4gICAgICAgIHVkaWQ6IGxpbmVNYXRjaFsyXSxcbiAgICAgICAgc3RhdGU6IGxpbmVNYXRjaFszXSxcbiAgICAgICAgc2RrLFxuICAgICAgICBwbGF0Zm9ybTogcGxhdGZvcm0gfHwgbWF0Y2hbMV0sXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGRldmljZXM7XG59XG5cbi8qKlxuICogUGFyc2UgdGhlIGxpc3Qgb2YgZXhpc3RpbmcgU2ltdWxhdG9yIGRldmljZXMgdG8gcmVwcmVzZW50XG4gKiBpdCBhcyBjb252ZW5pZW50IG1hcHBpbmcgZm9yIHRoZSBwYXJ0aWN1bGFyIHBsYXRmb3JtIHZlcnNpb24uXG4gKlxuICogQHBhcmFtIHs/c3RyaW5nfSBmb3JTZGsgLSBUaGUgc2RrIHZlcnNpb24sXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciB3aGljaCB0aGUgZGV2aWNlcyBsaXN0IHNob3VsZCBiZSBwYXJzZWQsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBleGFtcGxlICcxMC4zJy5cbiAqIEBwYXJhbSB7P3N0cmluZ30gcGxhdGZvcm0gLSBUaGUgcGxhdGZvcm0gbmFtZSwgZm9yIGV4YW1wbGUgJ3dhdGNoT1MnLlxuICogQHJldHVybiB7T2JqZWN0fEFycmF5PERldmljZUluZm8+fSBJZiBfZm9yU2RrXyBpcyBzZXQgdGhlbiB0aGUgbGlzdFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZiBkZXZpY2VzIGZvciB0aGUgcGFydGljdWxhciBwbGF0Zm9ybSB2ZXJzaW9uLlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPdGhlcndpc2UgdGhlIHNhbWUgcmVzdWx0IGFzIGZvciB7QGxpbmsgZ2V0RGV2aWNlc0J5UGFyc2luZ31cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24uXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNvcnJlc3BvbmRpbmcgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZFxuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUgb3IgaWYgbm8gbWF0Y2hpbmdcbiAqICAgICAgICAgICAgICAgICBwbGF0Zm9ybSB2ZXJzaW9uIGlzIGZvdW5kIGluIHRoZSBzeXN0ZW0uXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldERldmljZXMgKGZvclNkaywgcGxhdGZvcm0pIHtcbiAgbGV0IGRldmljZXMgPSB7fTtcbiAgdHJ5IHtcbiAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IHNpbUV4ZWMoJ2xpc3QnLCAwLCBbJ2RldmljZXMnLCAnLWonXSk7XG4gICAgLyogSlNPTiBzaG91bGQgYmVcbiAgICAgKiB7XG4gICAgICogICBcImRldmljZXNcIiA6IHtcbiAgICAgKiAgICAgXCJpT1MgPHNkaz5cIiA6IFsgLy8gb3JcbiAgICAgKiAgICAgXCJjb20uYXBwbGUuQ29yZVNpbXVsYXRvci5TaW1SdW50aW1lLmlPUy08c2RrPiA6IFtcbiAgICAgKiAgICAgICB7XG4gICAgICogICAgICAgICBcInN0YXRlXCIgOiBcIkJvb3RlZFwiLFxuICAgICAqICAgICAgICAgXCJhdmFpbGFiaWxpdHlcIiA6IFwiKGF2YWlsYWJsZSlcIixcbiAgICAgKiAgICAgICAgIFwiaXNBdmFpbGFibGVcIiA6IHRydWUsXG4gICAgICogICAgICAgICBcIm5hbWVcIiA6IFwiaVBob25lIDZcIixcbiAgICAgKiAgICAgICAgIFwidWRpZFwiIDogXCI3NUUzNDE0MC0xOEU4LTREMUEtOUY0NS1BQUM3MzVERjc1REZcIlxuICAgICAqICAgICAgIH1cbiAgICAgKiAgICAgXVxuICAgICAqICAgfVxuICAgICAqIH1cbiAgICAgKi9cbiAgICBjb25zdCB2ZXJzaW9uTWF0Y2hSZSA9IF8uaXNFbXB0eShwbGF0Zm9ybSlcbiAgICAgID8gbmV3IFJlZ0V4cChgXihbXlxcXFxzLV0rKVtcXFxccy1dKFxcXFxTKylgLCAnaScpXG4gICAgICA6IG5ldyBSZWdFeHAoYF4ke18uZXNjYXBlUmVnRXhwKHBsYXRmb3JtKX1bXFxcXHMtXShcXFxcUyspYCwgJ2knKTtcbiAgICBmb3IgKGxldCBbc2RrTmFtZSwgZW50cmllc10gb2YgXy50b1BhaXJzKEpTT04ucGFyc2Uoc3Rkb3V0KS5kZXZpY2VzKSkge1xuICAgICAgLy8gdGhlcmUgY291bGQgYmUgYSBsb25nZXIgbmFtZSwgc28gcmVtb3ZlIGl0XG4gICAgICBzZGtOYW1lID0gc2RrTmFtZS5yZXBsYWNlKFNJTV9SVU5USU1FX05BTUUsICcnKTtcbiAgICAgIGNvbnN0IHZlcnNpb25NYXRjaCA9IHZlcnNpb25NYXRjaFJlLmV4ZWMoc2RrTmFtZSk7XG4gICAgICBpZiAoIXZlcnNpb25NYXRjaCkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgLy8gdGhlIHNkayBjYW4gaGF2ZSBkYXNoZXMgKGAxMi0yYCkgb3IgZG90cyAoYDEyLjFgKVxuICAgICAgY29uc3Qgc2RrID0gKHBsYXRmb3JtID8gdmVyc2lvbk1hdGNoWzFdIDogdmVyc2lvbk1hdGNoWzJdKS5yZXBsYWNlKCctJywgJy4nKTtcbiAgICAgIGRldmljZXNbc2RrXSA9IGRldmljZXNbc2RrXSB8fCBbXTtcbiAgICAgIGRldmljZXNbc2RrXS5wdXNoKC4uLmVudHJpZXMuZmlsdGVyKChlbCkgPT4gXy5pc1VuZGVmaW5lZChlbC5pc0F2YWlsYWJsZSkgfHwgZWwuaXNBdmFpbGFibGUpXG4gICAgICAgIC5tYXAoKGVsKSA9PiB7XG4gICAgICAgICAgZGVsZXRlIGVsLmF2YWlsYWJpbGl0eTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc2RrLFxuICAgICAgICAgICAgLi4uZWwsXG4gICAgICAgICAgICBwbGF0Zm9ybTogcGxhdGZvcm0gfHwgdmVyc2lvbk1hdGNoWzFdLFxuICAgICAgICAgIH07XG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nLmRlYnVnKGBVbmFibGUgdG8gZ2V0IEpTT04gZGV2aWNlIGxpc3Q6ICR7ZXJyLnN0YWNrfWApO1xuICAgIGxvZy5kZWJ1ZygnRmFsbGluZyBiYWNrIHRvIG1hbnVhbCBwYXJzaW5nJyk7XG4gICAgZGV2aWNlcyA9IGF3YWl0IGdldERldmljZXNCeVBhcnNpbmcocGxhdGZvcm0pO1xuICB9XG5cbiAgaWYgKCFmb3JTZGspIHtcbiAgICByZXR1cm4gZGV2aWNlcztcbiAgfVxuICAvLyBpZiBhIGBmb3JTZGtgIHdhcyBwYXNzZWQgaW4sIHJldHVybiBvbmx5IHRoZSBjb3JyZXNwb25kaW5nIGxpc3RcbiAgaWYgKGRldmljZXNbZm9yU2RrXSkge1xuICAgIHJldHVybiBkZXZpY2VzW2ZvclNka107XG4gIH1cblxuICBsZXQgZXJyTXNnID0gYCcke2ZvclNka30nIGRvZXMgbm90IGV4aXN0IGluIHRoZSBsaXN0IG9mIHNpbWN0bCBTREtzLmA7XG4gIGNvbnN0IGF2YWlsYWJsZVNES3MgPSBfLmtleXMoZGV2aWNlcyk7XG4gIGVyck1zZyArPSBhdmFpbGFibGVTREtzLmxlbmd0aFxuICAgID8gYCBPbmx5IHRoZSBmb2xsb3dpbmcgU2ltdWxhdG9yIFNESyB2ZXJzaW9ucyBhcmUgYXZhaWxhYmxlIG9uIHlvdXIgc3lzdGVtOiAke2F2YWlsYWJsZVNES3Muam9pbignLCAnKX1gXG4gICAgOiBgIE5vIFNpbXVsYXRvciBTREsgdmVyc2lvbnMgYXJlIGF2YWlsYWJsZSBvbiB5b3VyIHN5c3RlbS4gUGxlYXNlIGluc3RhbGwgc29tZSB2aWEgWGNvZGUgcHJlZmVyZW5jZXMuYDtcbiAgdGhyb3cgbmV3IEVycm9yKGVyck1zZyk7XG59XG5cblxuLyoqXG4gKiBHZXQgdGhlIHJ1bnRpbWUgZm9yIHRoZSBwYXJ0aWN1bGFyIHBsYXRmb3JtIHZlcnNpb24uXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBsYXRmb3JtVmVyc2lvbiAtIFRoZSBwbGF0Zm9ybSB2ZXJzaW9uIG5hbWUsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGV4YW1wbGUgJzEwLjMnLlxuICogQHBhcmFtIHs/c3RyaW5nfSBwbGF0Zm9ybSAtIFRoZSBwbGF0Zm9ybSBuYW1lLCBmb3IgZXhhbXBsZSAnd2F0Y2hPUycuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBjb3JyZXNwb25kaW5nIHJ1bnRpbWUgbmFtZSBmb3IgdGhlIGdpdmVuXG4gKiAgICAgICAgICAgICAgICAgIHBsYXRmb3JtIHZlcnNpb24uXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldFJ1bnRpbWVGb3JQbGF0Zm9ybVZlcnNpb24gKHBsYXRmb3JtVmVyc2lvbiwgcGxhdGZvcm0gPSAnaU9TJykge1xuICB0cnkge1xuICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgc2ltRXhlYygnbGlzdCcsIDAsIFsncnVudGltZXMnXSk7XG4gICAgLy8gaHR0cHM6Ly9yZWdleDEwMS5jb20vci9VeWtqUVovMVxuICAgIGNvbnN0IHJ1bnRpbWVSZSA9IG5ldyBSZWdFeHAoYCR7Xy5lc2NhcGVSZWdFeHAocGxhdGZvcm0pfVxcXFxzKyhcXFxcZCtcXFxcLlxcXFxkKylcXFxccytcXFxcKChcXFxcZCtcXFxcLlxcXFxkK1xcXFwuKlxcXFxkKilgLCAnaScpO1xuICAgIGZvciAoY29uc3QgbGluZSBvZiBzdGRvdXQuc3BsaXQoJ1xcbicpKSB7XG4gICAgICBjb25zdCBtYXRjaCA9IHJ1bnRpbWVSZS5leGVjKGxpbmUpO1xuICAgICAgaWYgKG1hdGNoICYmIG1hdGNoWzFdID09PSBwbGF0Zm9ybVZlcnNpb24pIHtcbiAgICAgICAgcmV0dXJuIG1hdGNoWzJdO1xuICAgICAgfVxuICAgIH1cbiAgfSBjYXRjaCAoaWduKSB7fVxuXG4gIC8vIGlmIG5vdGhpbmcgd2FzIGZvdW5kLCBwYXNzIHBsYXRmb3JtIHZlcnNpb24gYmFja1xuICByZXR1cm4gcGxhdGZvcm1WZXJzaW9uO1xufVxuXG4vKipcbiAqIEdldHMgYmFzZTY0IHNjcmVlbnNob3QgZm9yIGRldmljZSAoeGNvZGUgPj0gOC4xIG9ubHkpLlxuICogSXQgaXMgcmVxdWlyZWQgdGhhdCBTaW11bGF0b3IgaXMgaW4gX2Jvb3RlZF8gc3RhdGUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgLSBUaGUgVURJRCBvZiBhbiBleGlzdGluZyBTaW11bGF0b3IuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IEJhc2U2NC1lbmNvZGVkIFNpbXVsYXRvciBzY3JlZW5zaG90LlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRTY3JlZW5zaG90ICh1ZGlkKSB7XG4gIGxldCBwYXRoVG9TY3JlZW5zaG90UG5nID0gYXdhaXQgdGVtcERpci5wYXRoKHtwcmVmaXg6IGBzY3JlZW5zaG90LSR7dWRpZH1gLCBzdWZmaXg6ICcucG5nJ30pO1xuICBhd2FpdCBzaW1FeGVjKCdpbycsIDAsIFt1ZGlkLCAnc2NyZWVuc2hvdCcsIHBhdGhUb1NjcmVlbnNob3RQbmddKTtcbiAgbGV0IHNjcmVlbnNob3RJbWcgPSBhd2FpdCBmcy5yZWFkRmlsZShwYXRoVG9TY3JlZW5zaG90UG5nKTtcbiAgYXdhaXQgZnMucmltcmFmKHBhdGhUb1NjcmVlbnNob3RQbmcpO1xuICByZXR1cm4gc2NyZWVuc2hvdEltZy50b1N0cmluZygnYmFzZTY0Jyk7XG59XG5cbi8qKlxuICogU2V0IHRoZSBjb250ZW50IG9mIFNpbXVsYXRvciBwYXN0ZWJvYXJkICh4Y29kZSA+PSA4LjEgb25seSkuXG4gKiBJdCBpcyByZXF1aXJlZCB0aGF0IFNpbXVsYXRvciBpcyBpbiBfYm9vdGVkXyBzdGF0ZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIERldmljZSBVRElELlxuICogQHBhcmFtIHtzdHJpbmd9IGNvbnRlbnQgLSBUaGUgYWN0dWFsIHN0cmluZyBjb250ZW50IHRvIGJlIHNldC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBlbmNvZGluZyBbJ3V0Zi04J10gLSBUaGUgZW5jb2Rpbmcgb2YgdGhlIGdpdmVuIHBhc3RlYm9hcmQgY29udGVudC5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVVEYtOCBieSBkZWZhdWx0LlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBzZXRQYXN0ZWJvYXJkICh1ZGlkLCBjb250ZW50LCBlbmNvZGluZyA9ICd1dGYtOCcpIHtcbiAgY29uc3QgcGJDb3B5U3VicHJvY2VzcyA9IG5ldyBTdWJQcm9jZXNzKCd4Y3J1bicsIFsnc2ltY3RsJywgJ3BiY29weScsIHVkaWRdKTtcbiAgYXdhaXQgcGJDb3B5U3VicHJvY2Vzcy5zdGFydCgwKTtcbiAgY29uc3QgZXhpdENvZGVWZXJpZmllciA9IHBiQ29weVN1YnByb2Nlc3Muam9pbigpO1xuICBjb25zdCBzdGRpbiA9IHBiQ29weVN1YnByb2Nlc3MucHJvYy5zdGRpbjtcbiAgc3RkaW4uc2V0RW5jb2RpbmcoZW5jb2RpbmcpO1xuICBzdGRpbi53cml0ZShjb250ZW50KTtcbiAgc3RkaW4uZW5kKCk7XG4gIGF3YWl0IGV4aXRDb2RlVmVyaWZpZXI7XG59XG5cbi8qKlxuICogR2V0IHRoZSBjb250ZW50IG9mIFNpbXVsYXRvciBwYXN0ZWJvYXJkICh4Y29kZSA+PSA4LjEgb25seSkuXG4gKiBJdCBpcyByZXF1aXJlZCB0aGF0IFNpbXVsYXRvciBpcyBpbiBfYm9vdGVkXyBzdGF0ZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIERldmljZSBVRElELlxuICogQHBhcmFtIHtzdHJpbmd9IGVuY29kaW5nIFsndXRmLTgnXSAtIFRoZSBlbmNvZGluZyBvZiB0aGUgcmV0dXJuZWQgcGFzdGVib2FyZCBjb250ZW50LlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVURi04IGJ5IGRlZmF1bHQuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IEN1cnJlbnQgY29udGVudCBvZiBTaW11bGF0b3IgcGFzdGVib2FyZCBvciBhbiBlbXB0eSBzdHJpbmcuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNvcnJlc3BvbmRpbmcgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZFxuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldFBhc3RlYm9hcmQgKHVkaWQsIGVuY29kaW5nID0gJ3V0Zi04Jykge1xuICBjb25zdCBhcmdzID0gWydzaW1jdGwnLCAncGJwYXN0ZScsIHVkaWRdO1xuICB0cnkge1xuICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYygneGNydW4nLCBhcmdzLCB7dGltZW91dDogMCwgZW5jb2Rpbmd9KTtcbiAgICByZXR1cm4gc3Rkb3V0O1xuICB9IGNhdGNoIChlKSB7XG4gICAgaWYgKGUuc3RkZXJyKSB7XG4gICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgRXJyb3IgcnVubmluZyAneGNydW4gJHthcmdzLmpvaW4oJyAnKX0nOiAke2Uuc3RkZXJyLnRyaW0oKX1gKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbG9nLmVycm9yQW5kVGhyb3coZSk7XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogR2V0IHRoZSBsaXN0IG9mIGRldmljZSB0eXBlcyBhdmFpbGFibGUgaW4gdGhlIGN1cnJlbnQgWGNvZGUgaW5zdGFsbGF0aW9uXG4gKlxuICogQHJldHVybiB7QXJyYXk8c3RyaW5nPn0gTGlzdCBvZiB0aGUgdHlwZXMgb2YgZGV2aWNlcyBhdmFpbGFibGVcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgY29tbWFuZCBmYWlsc1xuICovXG5hc3luYyBmdW5jdGlvbiBnZXREZXZpY2VUeXBlcyAoKSB7XG4gIHRyeSB7XG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBzaW1FeGVjKCdsaXN0JywgMCwgWydkZXZpY2V0eXBlcycsICctaiddKTtcbiAgICAvKlxuICAgICAqIEpTT04gd2lsbCBiZSBsaWtlOlxuICAgICAqICAge1xuICAgICAqICAgICBcImRldmljZXR5cGVzXCIgOiBbXG4gICAgICogICAgICAge1xuICAgICAqICAgICAgICAgXCJuYW1lXCIgOiBcImlQaG9uZSA0c1wiLFxuICAgICAqICAgICAgICAgXCJpZGVudGlmaWVyXCIgOiBcImNvbS5hcHBsZS5Db3JlU2ltdWxhdG9yLlNpbURldmljZVR5cGUuaVBob25lLTRzXCJcbiAgICAgKiAgICAgICB9LFxuICAgICAqICAgICAgIC4uLlxuICAgICAqICAgfVxuICAgICAqL1xuICAgIGNvbnN0IGRldmljZVR5cGVzID0gSlNPTi5wYXJzZShzdGRvdXQudHJpbSgpKTtcbiAgICByZXR1cm4gZGV2aWNlVHlwZXMuZGV2aWNldHlwZXMubWFwKCh0eXBlKSA9PiB0eXBlLm5hbWUpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsZXQgbXNnID0gYFVuYWJsZSB0byBnZXQgbGlzdCBvZiBkZXZpY2UgdHlwZXM6ICR7ZXJyLm1lc3NhZ2V9YDtcbiAgICBpZiAoZXJyLnN0ZGVycikge1xuICAgICAgbXNnID0gYCR7bXNnfS4gU3RkZXJyOiAke2Vyci5zdGRlcnJ9YDtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKG1zZyk7XG4gIH1cbn1cblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBCb290TW9uaXRvck9wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7P251bWJlcn0gdGltZW91dCBbMjQwMDAwXSAtIFNpbXVsYXRvciBib290aW5nIHRpbWVvdXQgaW4gbXMuXG4gKiBAcHJvcGVydHkgez9GdW5jdGlvbn0gb25XYWl0aW5nRGF0YU1pZ3JhdGlvbiAtIFRoaXMgZXZlbnQgaXMgZmlyZWQgd2hlbiBkYXRhIG1pZ3JhdGlvbiBzdGFnZSBzdGFydHMuXG4gKiBAcHJvcGVydHkgez9GdW5jdGlvbn0gb25XYWl0aW5nU3lzdGVtQXBwIC0gVGhpcyBldmVudCBpcyBmaXJlZCB3aGVuIHN5c3RlbSBhcHAgd2FpdCBzdGFnZSBzdGFydHMuXG4gKiBAcHJvcGVydHkgez9GdW5jdGlvbn0gb25GaW5pc2hlZCAtIFRoaXMgZXZlbnQgaXMgZmlyZWQgd2hlbiBTaW11bGF0b3IgaXMgZnVsbHkgYm9vdGVkLlxuICogQHByb3BlcnR5IHs/RnVuY3Rpb259IG9uRXJyb3IgLSBUaGlzIGV2ZW50IGlzIGZpcmVkIHdoZW4gdGhlcmUgd2FzIGFuIGVycm9yIHdoaWxlIG1vbml0b3JpbmcgdGhlIGJvb3RpbmcgcHJvY2Vzc1xuICogb3Igd2hlbiB0aGUgdGltZW91dCBoYXMgZXhwaXJlZC5cbiAqL1xuXG4vKipcbiAqIFN0YXJ0IG1vbml0b3JpbmcgZm9yIGJvb3Qgc3RhdHVzIG9mIHRoZSBwYXJ0aWN1bGFyIFNpbXVsYXRvci5cbiAqIElmIG9uRmluaXNoZWQgcHJvcGVydHkgaXMgbm90IHNldCB0aGVuIHRoZSBtZXRob2Qgd2lsbCBibG9ja1xuICogdW50aWwgU2ltdWxhdG9yIGJvb3RpbmcgaXMgY29tcGxldGVkLlxuICogVGhlIG1ldGhvZCBpcyBvbmx5IGF2YWlsYWJsZSBzaW5jZSBYY29kZTguXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgLSBEZXZpY2UgVURJRC5cbiAqIEBwYXJhbSB7P0Jvb3RNb25pdG9yT3B0aW9uc30gb3B0cyAtIE1vbml0b3Jpbmcgb3B0aW9ucy5cbiAqIEByZXR1cm5zIHtTdWJQcm9jZXNzfSBUaGUgaW5zdGFuY2Ugb2YgdGhlIGNvcnJlc3BvbmRpbmcgbW9uaXRvcmluZyBwcm9jZXNzLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBTaW11bGF0b3IgZmFpbHMgdG8gZmluaXNoIGJvb3Rpbmcgd2l0aGluIHRoZSBnaXZlbiB0aW1lb3V0IGFuZCBvbkZpbmlzaGVkXG4gKiBwcm9wZXJ0eSBpcyBub3Qgc2V0LlxuICovXG5hc3luYyBmdW5jdGlvbiBzdGFydEJvb3RNb25pdG9yICh1ZGlkLCBvcHRzID0ge30pIHtcbiAgY29uc3Qge1xuICAgIHRpbWVvdXQgPSAyNDAwMDAsXG4gICAgb25XYWl0aW5nRGF0YU1pZ3JhdGlvbixcbiAgICBvbldhaXRpbmdTeXN0ZW1BcHAsXG4gICAgb25GaW5pc2hlZCxcbiAgICBvbkVycm9yLFxuICB9ID0gb3B0cztcblxuICBsZXQgc3RhdHVzID0gJyc7XG4gIGxldCBpc0Jvb3RpbmdGaW5pc2hlZCA9IGZhbHNlO1xuICBsZXQgZXJyb3IgPSBudWxsO1xuICBsZXQgdGltZW91dEhhbmRsZXIgPSBudWxsO1xuICBjb25zdCBib290TW9uaXRvciA9IGF3YWl0IHNpbVN1YlByb2Nlc3MoJ2Jvb3RzdGF0dXMnLCAwLCBbdWRpZF0pO1xuICBib290TW9uaXRvci5vbignb3V0cHV0JywgKHN0ZG91dCwgc3RkZXJyKSA9PiB7XG4gICAgc3RhdHVzICs9IHN0ZG91dCB8fCBzdGRlcnI7XG4gICAgaWYgKHN0ZG91dCkge1xuICAgICAgaWYgKHN0ZG91dC5pbmNsdWRlcygnV2FpdGluZyBvbiBEYXRhIE1pZ3JhdGlvbicpICYmIG9uV2FpdGluZ0RhdGFNaWdyYXRpb24pIHtcbiAgICAgICAgb25XYWl0aW5nRGF0YU1pZ3JhdGlvbigpO1xuICAgICAgfSBlbHNlIGlmIChzdGRvdXQuaW5jbHVkZXMoJ1dhaXRpbmcgb24gU3lzdGVtIEFwcCcpICYmIG9uV2FpdGluZ1N5c3RlbUFwcCkge1xuICAgICAgICBvbldhaXRpbmdTeXN0ZW1BcHAoKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuICBib290TW9uaXRvci5vbignZXhpdCcsIChjb2RlLCBzaWduYWwpID0+IHtcbiAgICBpZiAodGltZW91dEhhbmRsZXIpIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SGFuZGxlcik7XG4gICAgfVxuICAgIGlmIChjb2RlID09PSAwKSB7XG4gICAgICBpZiAob25GaW5pc2hlZCkge1xuICAgICAgICBvbkZpbmlzaGVkKCk7XG4gICAgICB9XG4gICAgICBpc0Jvb3RpbmdGaW5pc2hlZCA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0YXR1cyA9IHN0YXR1cyB8fCBzaWduYWw7XG4gICAgICBlcnJvciA9IG5ldyBFcnJvcihzdGF0dXMpO1xuICAgICAgaWYgKG9uRXJyb3IpIHtcbiAgICAgICAgb25FcnJvcihlcnJvcik7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgYXdhaXQgYm9vdE1vbml0b3Iuc3RhcnQoMCk7XG4gIGNvbnN0IHN0b3BNb25pdG9yID0gYXN5bmMgKCkgPT4ge1xuICAgIGlmIChib290TW9uaXRvci5pc1J1bm5pbmcpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGJvb3RNb25pdG9yLnN0b3AoKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgbG9nLndhcm4oZS5tZXNzYWdlKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IHRpbWVTdGFydGVkID0gcHJvY2Vzcy5ocnRpbWUoKTtcbiAgaWYgKG9uRmluaXNoZWQpIHtcbiAgICB0aW1lb3V0SGFuZGxlciA9IHNldFRpbWVvdXQoc3RvcE1vbml0b3IsIHRpbWVvdXQpO1xuICB9IGVsc2Uge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB3YWl0Rm9yQ29uZGl0aW9uKCgpID0+IHtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGlzQm9vdGluZ0ZpbmlzaGVkO1xuICAgICAgfSwge3dhaXRNczogdGltZW91dCwgaW50ZXJ2YWxNczogNTAwfSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBhd2FpdCBzdG9wTW9uaXRvcigpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgc2ltdWxhdG9yICR7dWRpZH0gaGFzIGZhaWxlZCB0byBmaW5pc2ggYm9vdGluZyBhZnRlciAke3Byb2Nlc3MuaHJ0aW1lKHRpbWVTdGFydGVkKVswXX1zLiBgICtcbiAgICAgICAgYE9yaWdpbmFsIHN0YXR1czogJHtzdGF0dXN9YCk7XG4gICAgfVxuICB9XG4gIHJldHVybiBib290TW9uaXRvcjtcbn1cblxuXG5leHBvcnQge1xuICBpbnN0YWxsQXBwLCByZW1vdmVBcHAsIGxhdW5jaCwgc3Bhd24sIHNwYXduU3ViUHJvY2Vzcywgb3BlblVybCwgdGVybWluYXRlLFxuICBzaHV0ZG93biwgY3JlYXRlRGV2aWNlLCBnZXRBcHBDb250YWluZXIsIGdldFNjcmVlbnNob3QsIGRlbGV0ZURldmljZSxcbiAgZXJhc2VEZXZpY2UsIGdldERldmljZXMsIGdldFJ1bnRpbWVGb3JQbGF0Zm9ybVZlcnNpb24sIGJvb3REZXZpY2UsXG4gIHNldFBhc3RlYm9hcmQsIGdldFBhc3RlYm9hcmQsIGFkZE1lZGlhLCBhcHBJbmZvLCBnZXREZXZpY2VUeXBlcyxcbiAgc3RhcnRCb290TW9uaXRvcixcbn07XG4iXSwiZmlsZSI6ImxpYi9zaW1jdGwuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
