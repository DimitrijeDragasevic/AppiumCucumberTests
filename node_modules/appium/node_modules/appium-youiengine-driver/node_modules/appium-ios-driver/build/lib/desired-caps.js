"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.desiredCapValidation = desiredCapValidation;
exports.default = exports.desiredCapConstraints = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("./logger"));

const desiredCapConstraints = {
  platformName: {
    presence: true,
    isString: true,
    inclusionCaseInsensitive: ['iOS']
  },
  browserName: {
    isString: true
  },
  app: {
    isString: true
  },
  launchTimeout: {},
  calendarFormat: {
    isString: true
  },
  bundleId: {
    isString: true
  },
  udid: {
    isString: true
  },
  locationServicesEnabled: {
    isBoolean: true
  },
  locationServicesAuthorized: {
    isBoolean: true
  },
  autoAcceptAlerts: {
    isBoolean: true
  },
  autoDismissAlerts: {
    isBoolean: true
  },
  nativeInstrumentsLib: {
    isBoolean: true
  },
  nativeWebTap: {
    isBoolean: true
  },
  safariInitialUrl: {
    isString: true
  },
  safariAllowPopups: {
    isBoolean: true
  },
  safariIgnoreFraudWarning: {
    isBoolean: true
  },
  safariOpenLinksInBackground: {
    isBoolean: true
  },
  safariGarbageCollect: {
    isBoolean: true
  },
  keepKeyChains: {
    isBoolean: true
  },
  localizableStringsDir: {
    isString: true
  },
  processArguments: {},
  interKeyDelay: {
    isNumber: true
  },
  showIOSLog: {
    isBoolean: true
  },
  sendKeyStrategy: {
    isString: true,
    inclusion: ['oneByOne', 'grouped', 'setValue']
  },
  screenshotWaitTimeout: {
    isNumber: true
  },
  waitForAppScript: {
    isString: true
  },
  webviewConnectRetries: {
    isNumber: true
  },
  appName: {
    isString: true
  },
  clearSystemFiles: {
    isBoolean: true
  },
  customSSLCert: {
    isString: true
  },
  webkitResponseTimeout: {
    isNumber: true
  },
  remoteDebugProxy: {
    isString: true
  },
  enablePerformanceLogging: {
    isBoolean: true
  },
  enableAsyncExecuteFromHttps: {
    isBoolean: true
  },
  realDeviceLogger: {
    isString: true
  },
  fullContextList: {
    isBoolean: true
  },
  ignoreAboutBlankUrl: {
    isBoolean: true
  }
};
exports.desiredCapConstraints = desiredCapConstraints;

function desiredCapValidation(caps) {
  if ((caps.browserName || '').toLowerCase() !== 'safari' && !caps.app && !caps.bundleId) {
    let msg = 'The desired capabilities must include either an app or a bundleId for iOS';

    _logger.default.errorAndThrow(msg);
  }

  if (caps.launchTimeout) {
    let msg = 'launchTimeout must be a number, object, or string JSON object';

    if (!_lodash.default.isNumber(caps.launchTimeout)) {
      if (_lodash.default.isString(caps.launchTimeout)) {
        try {
          caps.launchTimeout = JSON.parse(caps.launchTimeout);
        } catch (err) {
          _logger.default.errorAndThrow(msg);
        }
      }

      if (!_lodash.default.isObject(caps.launchTimeout)) {
        _logger.default.errorAndThrow(msg);
      }
    }
  }

  if (caps.processArguments) {
    if (_lodash.default.isString(caps.processArguments)) {
      try {
        caps.processArguments = JSON.parse(caps.processArguments);
      } catch (ign) {}
    } else if (!_lodash.default.isObject(caps.processArguments)) {
      _logger.default.errorAndThrow('processArguments must be a string, object, or a string JSON object');
    }
  }

  if (typeof caps.enablePerformanceLogging !== 'boolean' && typeof caps.loggingPrefs === 'object' && caps.loggingPrefs.performance) {
    caps.enablePerformanceLogging = !!caps.loggingPrefs.performance;
  }

  return true;
}

var _default = desiredCapConstraints;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9kZXNpcmVkLWNhcHMuanMiXSwibmFtZXMiOlsiZGVzaXJlZENhcENvbnN0cmFpbnRzIiwicGxhdGZvcm1OYW1lIiwicHJlc2VuY2UiLCJpc1N0cmluZyIsImluY2x1c2lvbkNhc2VJbnNlbnNpdGl2ZSIsImJyb3dzZXJOYW1lIiwiYXBwIiwibGF1bmNoVGltZW91dCIsImNhbGVuZGFyRm9ybWF0IiwiYnVuZGxlSWQiLCJ1ZGlkIiwibG9jYXRpb25TZXJ2aWNlc0VuYWJsZWQiLCJpc0Jvb2xlYW4iLCJsb2NhdGlvblNlcnZpY2VzQXV0aG9yaXplZCIsImF1dG9BY2NlcHRBbGVydHMiLCJhdXRvRGlzbWlzc0FsZXJ0cyIsIm5hdGl2ZUluc3RydW1lbnRzTGliIiwibmF0aXZlV2ViVGFwIiwic2FmYXJpSW5pdGlhbFVybCIsInNhZmFyaUFsbG93UG9wdXBzIiwic2FmYXJpSWdub3JlRnJhdWRXYXJuaW5nIiwic2FmYXJpT3BlbkxpbmtzSW5CYWNrZ3JvdW5kIiwic2FmYXJpR2FyYmFnZUNvbGxlY3QiLCJrZWVwS2V5Q2hhaW5zIiwibG9jYWxpemFibGVTdHJpbmdzRGlyIiwicHJvY2Vzc0FyZ3VtZW50cyIsImludGVyS2V5RGVsYXkiLCJpc051bWJlciIsInNob3dJT1NMb2ciLCJzZW5kS2V5U3RyYXRlZ3kiLCJpbmNsdXNpb24iLCJzY3JlZW5zaG90V2FpdFRpbWVvdXQiLCJ3YWl0Rm9yQXBwU2NyaXB0Iiwid2Vidmlld0Nvbm5lY3RSZXRyaWVzIiwiYXBwTmFtZSIsImNsZWFyU3lzdGVtRmlsZXMiLCJjdXN0b21TU0xDZXJ0Iiwid2Via2l0UmVzcG9uc2VUaW1lb3V0IiwicmVtb3RlRGVidWdQcm94eSIsImVuYWJsZVBlcmZvcm1hbmNlTG9nZ2luZyIsImVuYWJsZUFzeW5jRXhlY3V0ZUZyb21IdHRwcyIsInJlYWxEZXZpY2VMb2dnZXIiLCJmdWxsQ29udGV4dExpc3QiLCJpZ25vcmVBYm91dEJsYW5rVXJsIiwiZGVzaXJlZENhcFZhbGlkYXRpb24iLCJjYXBzIiwidG9Mb3dlckNhc2UiLCJtc2ciLCJsb2dnZXIiLCJlcnJvckFuZFRocm93IiwiXyIsIkpTT04iLCJwYXJzZSIsImVyciIsImlzT2JqZWN0IiwiaWduIiwibG9nZ2luZ1ByZWZzIiwicGVyZm9ybWFuY2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUdBLE1BQU1BLHFCQUFxQixHQUFHO0FBQzVCQyxFQUFBQSxZQUFZLEVBQUU7QUFDWkMsSUFBQUEsUUFBUSxFQUFFLElBREU7QUFFWkMsSUFBQUEsUUFBUSxFQUFFLElBRkU7QUFHWkMsSUFBQUEsd0JBQXdCLEVBQUUsQ0FBQyxLQUFEO0FBSGQsR0FEYztBQU01QkMsRUFBQUEsV0FBVyxFQUFFO0FBQ1hGLElBQUFBLFFBQVEsRUFBRTtBQURDLEdBTmU7QUFTNUJHLEVBQUFBLEdBQUcsRUFBRTtBQUNISCxJQUFBQSxRQUFRLEVBQUU7QUFEUCxHQVR1QjtBQWE1QkksRUFBQUEsYUFBYSxFQUFFLEVBYmE7QUFpQjVCQyxFQUFBQSxjQUFjLEVBQUU7QUFDZEwsSUFBQUEsUUFBUSxFQUFFO0FBREksR0FqQlk7QUFvQjVCTSxFQUFBQSxRQUFRLEVBQUU7QUFDUk4sSUFBQUEsUUFBUSxFQUFFO0FBREYsR0FwQmtCO0FBdUI1Qk8sRUFBQUEsSUFBSSxFQUFFO0FBQ0pQLElBQUFBLFFBQVEsRUFBRTtBQUROLEdBdkJzQjtBQTBCNUJRLEVBQUFBLHVCQUF1QixFQUFFO0FBQ3ZCQyxJQUFBQSxTQUFTLEVBQUU7QUFEWSxHQTFCRztBQTZCNUJDLEVBQUFBLDBCQUEwQixFQUFFO0FBQzFCRCxJQUFBQSxTQUFTLEVBQUU7QUFEZSxHQTdCQTtBQWdDNUJFLEVBQUFBLGdCQUFnQixFQUFFO0FBQ2hCRixJQUFBQSxTQUFTLEVBQUU7QUFESyxHQWhDVTtBQW1DNUJHLEVBQUFBLGlCQUFpQixFQUFFO0FBQ2pCSCxJQUFBQSxTQUFTLEVBQUU7QUFETSxHQW5DUztBQXNDNUJJLEVBQUFBLG9CQUFvQixFQUFFO0FBQ3BCSixJQUFBQSxTQUFT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NkIsUUFEN0IsSUFDeUNYLElBQUksQ0FBQ1csWUFBTCxDQUFrQkMsV0FEL0QsRUFDNEU7QUFDMUVaLElBQUFBLElBQUksQ0FBQ04sd0JBQUwsR0FBZ0MsQ0FBQyxDQUFDTSxJQUFJLENBQUNXLFlBQUwsQ0FBa0JDLFdBQXBEO0FBQ0Q7O0FBR0QsU0FBTyxJQUFQO0FBQ0Q7O2VBR2N6RCxxQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgbG9nZ2VyIGZyb20gJy4vbG9nZ2VyJztcblxuXG5jb25zdCBkZXNpcmVkQ2FwQ29uc3RyYWludHMgPSB7XG4gIHBsYXRmb3JtTmFtZToge1xuICAgIHByZXNlbmNlOiB0cnVlLFxuICAgIGlzU3RyaW5nOiB0cnVlLFxuICAgIGluY2x1c2lvbkNhc2VJbnNlbnNpdGl2ZTogWydpT1MnXVxuICB9LFxuICBicm93c2VyTmFtZToge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIGFwcDoge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG5cbiAgbGF1bmNoVGltZW91dDoge1xuICAgIC8vIHJlY29nbml6ZSB0aGUgY2FwLFxuICAgIC8vIGJ1dCB2YWxpZGF0ZSBpbiB0aGUgZHJpdmVyI3ZhbGlkYXRlRGVzaXJlZENhcHMgbWV0aG9kXG4gIH0sXG4gIGNhbGVuZGFyRm9ybWF0OiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgYnVuZGxlSWQ6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuICB1ZGlkOiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgbG9jYXRpb25TZXJ2aWNlc0VuYWJsZWQ6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgbG9jYXRpb25TZXJ2aWNlc0F1dGhvcml6ZWQ6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgYXV0b0FjY2VwdEFsZXJ0czoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBhdXRvRGlzbWlzc0FsZXJ0czoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBuYXRpdmVJbnN0cnVtZW50c0xpYjoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBuYXRpdmVXZWJUYXA6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgc2FmYXJpSW5pdGlhbFVybDoge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIHNhZmFyaUFsbG93UG9wdXBzOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIHNhZmFyaUlnbm9yZUZyYXVkV2FybmluZzoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBzYWZhcmlPcGVuTGlua3NJbkJhY2tncm91bmQ6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgc2FmYXJpR2FyYmFnZUNvbGxlY3Q6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAga2VlcEtleUNoYWluczoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBsb2NhbGl6YWJsZVN0cmluZ3NEaXI6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuICBwcm9jZXNzQXJndW1lbnRzOiB7XG4gICAgLy8gcmVjb2duaXplIHRoZSBjYXAsXG4gICAgLy8gYnV0IHZhbGlkYXRlIGluIHRoZSBkcml2ZXIjdmFsaWRhdGVEZXNpcmVkQ2FwcyBtZXRob2RcbiAgfSxcbiAgaW50ZXJLZXlEZWxheToge1xuICAgIGlzTnVtYmVyOiB0cnVlXG4gIH0sXG4gIHNob3dJT1NMb2c6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgc2VuZEtleVN0cmF0ZWd5OiB7XG4gICAgaXNTdHJpbmc6IHRydWUsXG4gICAgaW5jbHVzaW9uOiBbJ29uZUJ5T25lJywgJ2dyb3VwZWQnLCAnc2V0VmFsdWUnXVxuICB9LFxuICBzY3JlZW5zaG90V2FpdFRpbWVvdXQ6IHtcbiAgICBpc051bWJlcjogdHJ1ZVxuICB9LFxuICB3YWl0Rm9yQXBwU2NyaXB0OiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgd2Vidmlld0Nvbm5lY3RSZXRyaWVzOiB7XG4gICAgaXNOdW1iZXI6IHRydWVcbiAgfSxcbiAgYXBwTmFtZToge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIGNsZWFyU3lzdGVtRmlsZXM6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgY3VzdG9tU1NMQ2VydDoge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIHdlYmtpdFJlc3BvbnNlVGltZW91dDoge1xuICAgIGlzTnVtYmVyOiB0cnVlXG4gIH0sXG4gIHJlbW90ZURlYnVnUHJveHk6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuICBlbmFibGVQZXJmb3JtYW5jZUxvZ2dpbmc6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgZW5hYmxlQXN5bmNFeGVjdXRlRnJvbUh0dHBzOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIHJlYWxEZXZpY2VMb2dnZXI6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuICBmdWxsQ29udGV4dExpc3Q6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgaWdub3JlQWJvdXRCbGFua1VybDoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxufTtcblxuZnVuY3Rpb24gZGVzaXJlZENhcFZhbGlkYXRpb24gKGNhcHMpIHtcbiAgLy8gbWFrZSBzdXJlIHRoYXQgdGhlIGNhcGFiaWxpdGllcyBoYXZlIG9uZSBvZiBgYXBwYCBvciBgYnVuZGxlSWRgXG4gIGlmICgoY2Fwcy5icm93c2VyTmFtZSB8fCAnJykudG9Mb3dlckNhc2UoKSAhPT0gJ3NhZmFyaScgJiZcbiAgICAgICFjYXBzLmFwcCAmJiAhY2Fwcy5idW5kbGVJZCkge1xuICAgIGxldCBtc2cgPSAnVGhlIGRlc2lyZWQgY2FwYWJpbGl0aWVzIG11c3QgaW5jbHVkZSBlaXRoZXIgYW4gYXBwIG9yIGEgYnVuZGxlSWQgZm9yIGlPUyc7XG4gICAgbG9nZ2VyLmVycm9yQW5kVGhyb3cobXNnKTtcbiAgfVxuXG4gIC8vIGBsYXVuY2hUaW1lb3V0YCBpcyBtb3JlIGNvbXBsZXggdGhhbiB0aGUgdmFsaWRhdG9ycyBjYW4gZWFzaWx5IGhhbmRsZVxuICAvLyBhbmQgdG9vIHNwZWNpZmljIGZvciBhIGdlbmVyYWxpemVkIHZhbGlkYXRvciBvZiBpdHMgb3duXG4gIGlmIChjYXBzLmxhdW5jaFRpbWVvdXQpIHtcbiAgICAvLyBpdCBjYW4gYmUgYSBudW1iZXIsIGEgSlNPTiBzdHJpbmcsIG9yIGFuIG9iamVjdFxuICAgIGxldCBtc2cgPSAnbGF1bmNoVGltZW91dCBtdXN0IGJlIGEgbnVtYmVyLCBvYmplY3QsIG9yIHN0cmluZyBKU09OIG9iamVjdCc7XG4gICAgaWYgKCFfLmlzTnVtYmVyKGNhcHMubGF1bmNoVGltZW91dCkpIHtcbiAgICAgIGlmIChfLmlzU3RyaW5nKGNhcHMubGF1bmNoVGltZW91dCkpIHtcbiAgICAgICAgLy8gaWYgdGhpcyBpcyBhIHN0cmluZywgaXQgbXVzdCBiZSBhIEpTT04gc3RyaW5nXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLy8gY2hhbmdlIGBsYXVuY2hUaW1lb3V0YCB0byBhbiBvYmplY3RcbiAgICAgICAgICBjYXBzLmxhdW5jaFRpbWVvdXQgPSBKU09OLnBhcnNlKGNhcHMubGF1bmNoVGltZW91dCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIC8vIGl0IHdhcyBhIHN0cmluZywgYnV0IG5vdCBzb21ldGhpbmcgcGFyc2FibGUgYXMgSlNPTlxuICAgICAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KG1zZyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICghXy5pc09iamVjdChjYXBzLmxhdW5jaFRpbWVvdXQpKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KG1zZyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gYHByb2Nlc3NBcmd1bWVudHNgIGlzIG1vcmUgY29tcGxleCBhcyBpdCBjYW4gYmUgYSBzdHJpbmdcbiAgLy8gb3IgYSBoYXNoXG4gIGlmIChjYXBzLnByb2Nlc3NBcmd1bWVudHMpIHtcbiAgICBpZiAoXy5pc1N0cmluZyhjYXBzLnByb2Nlc3NBcmd1bWVudHMpKSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyB0cnkgdG8gcGFyc2UgdGhlIHN0cmluZyBhcyBKU09OXG4gICAgICAgIGNhcHMucHJvY2Vzc0FyZ3VtZW50cyA9IEpTT04ucGFyc2UoY2Fwcy5wcm9jZXNzQXJndW1lbnRzKTtcbiAgICAgIH0gY2F0Y2ggKGlnbikge1xuICAgICAgICAvLyBpZiB3ZSBjYW5ub3QgcGFyc2UsIGp1c3QgbGVhdmUgYXMgYSBzdHJpbmdcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKCFfLmlzT2JqZWN0KGNhcHMucHJvY2Vzc0FyZ3VtZW50cykpIHtcbiAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KCdwcm9jZXNzQXJndW1lbnRzIG11c3QgYmUgYSBzdHJpbmcsIG9iamVjdCwgb3IgYSBzdHJpbmcgSlNPTiBvYmplY3QnKTtcbiAgICB9XG4gIH1cblxuICAvLyB0aGVyZSBpcyBhbiB1bmRvY3VtZW50ZWQgbGVnYWN5IGNhcCBgbG9nZ2luZ1ByZWZzLnBlcmZvcm1hbmNlYCB0byBlbmFibGVcbiAgLy8gcGVyZm9ybWFuY2UgbG9nZ2luZy4gVHJhbnNsYXRlIHRvIGBlbmFibGVQZXJmb3JtYW5jZUxvZ2dpbmdgXG4gIGlmICh0eXBlb2YgY2Fwcy5lbmFibGVQZXJmb3JtYW5jZUxvZ2dpbmcgIT09ICdib29sZWFuJyAmJlxuICAgICAgdHlwZW9mIGNhcHMubG9nZ2luZ1ByZWZzID09PSAnb2JqZWN0JyAmJiBjYXBzLmxvZ2dpbmdQcmVmcy5wZXJmb3JtYW5jZSkge1xuICAgIGNhcHMuZW5hYmxlUGVyZm9ybWFuY2VMb2dnaW5nID0gISFjYXBzLmxvZ2dpbmdQcmVmcy5wZXJmb3JtYW5jZTtcbiAgfVxuXG4gIC8vIGZpbmFsbHksIHJldHVybiB0cnVlIHNpbmNlIHRoZSBzdXBlcmNsYXNzIGNoZWNrIHBhc3NlZCwgYXMgZGlkIHRoaXNcbiAgcmV0dXJuIHRydWU7XG59XG5cbmV4cG9ydCB7IGRlc2lyZWRDYXBDb25zdHJhaW50cywgZGVzaXJlZENhcFZhbGlkYXRpb24gfTtcbmV4cG9ydCBkZWZhdWx0IGRlc2lyZWRDYXBDb25zdHJhaW50cztcbiJdLCJmaWxlIjoibGliL2Rlc2lyZWQtY2Fwcy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
