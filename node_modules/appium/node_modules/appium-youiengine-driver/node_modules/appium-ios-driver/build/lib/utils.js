"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.removeInstrumentsSocket = removeInstrumentsSocket;
exports.getAndCheckXcodeVersion = getAndCheckXcodeVersion;
exports.prepareIosOpts = prepareIosOpts;
exports.appIsPackageOrBundle = appIsPackageOrBundle;
exports.getAndCheckIosSdkVersion = getAndCheckIosSdkVersion;
exports.detectUdid = detectUdid;
exports.parseLocalizableStrings = parseLocalizableStrings;
exports.setBundleIdFromApp = setBundleIdFromApp;
exports.shouldPrelaunchSimulator = shouldPrelaunchSimulator;
exports.setDeviceTypeInInfoPlist = setDeviceTypeInInfoPlist;
exports.getSimForDeviceString = getSimForDeviceString;
exports.unwrapEl = unwrapEl;
exports.clearLogs = clearLogs;
exports.rootDir = void 0;

require("source-map-support/register");

var _appiumSupport = require("appium-support");

var _appiumXcode = _interopRequireDefault(require("appium-xcode"));

var _appUtils = require("./app-utils");

var _logger = _interopRequireDefault(require("./logger"));

var _path = _interopRequireDefault(require("path"));

var _lodash = _interopRequireDefault(require("lodash"));

var _teen_process = require("teen_process");

var _safari = require("./commands/safari");

var _safariLauncher = require("./safari-launcher");

const rootDir = _path.default.resolve(__dirname, '..', '..');

exports.rootDir = rootDir;
const STRINGSDICT_RESOURCE = '.stringsdict';
const STRINGS_RESOURCE = '.strings';

async function prepareIosOpts(opts) {
  opts.backendRetries = 4;
  opts.withoutDelay = !opts.nativeInstrumentsLib;
  opts.reset = !opts.noReset;
  opts.initialOrientation = opts.deviceOrientation || opts.orientation || "PORTRAIT";
  opts.useRobot = opts.robotPort > 0;
  opts.robotUrl = opts.useRobot ? `http://${opts.robotAddress}:${opts.robotPort}` : null;

  if (opts.locationServicesAuthorized && !opts.bundleId) {
    throw new Error("You must set the bundleId cap if using locationServicesEnabled");
  }

  opts.platformVersion = opts.platformVersion || (await _appiumXcode.default.getMaxIOSSDK());
  let pv = parseFloat(opts.platformVersion);

  if (pv < 8) {
    _logger.default.warn(`iOS version ${opts.platformVersion} support has been ` + `deprecated and will be removed in a future version of ` + `Appium.`);
  }

  opts.localizableStringsDir = opts.localizableStringsDir || 'en.lproj';
  opts.autoAcceptAlerts = _lodash.default.isNull(opts.autoAcceptAlerts) || _lodash.default.isUndefined(opts.autoAcceptAlerts) ? false : opts.autoAcceptAlerts;
  opts.autoDismissAlerts = _lodash.default.isNull(opts.autoDismissAlerts) || _lodash.default.isUndefined(opts.autoDismissAlerts) ? false : opts.autoDismissAlerts;

  if ((opts.browserName || '').toLowerCase() === 'safari' || (opts.app || '').toLowerCase() === 'safari' || (opts.bundleId || '').toLowerCase() === _safari.SAFARI_BUNDLE) {
    if (opts.udid) {
      opts.app = opts.app || _safariLauncher.SAFARI_LAUNCHER_APP_FILE;
      opts.bundleId = opts.bundleId || _safariLauncher.SAFARI_LAUNCHER_BUNDLE;
    } else {
      if (parseFloat(opts.platformVersion) <= 8) {
        opts.app = 'safari';
        opts.bundleId = null;
      } else {
        opts.app = null;
        opts.bundleId = _safari.SAFARI_BUNDLE;
      }
    }

    opts.safari = true;
  }
}

function appIsPackageOrBundle(app) {
  return /^([a-zA-Z0-9\-_]+\.[a-zA-Z0-9\-_]+)+$/.test(app);
}

async function removeInstrumentsSocket(sock) {
  _logger.default.debug("Removing any remaining instruments sockets");

  await _appiumSupport.fs.rimraf(sock);

  _logger.default.debug(`Cleaned up instruments socket ${sock}`);
}

async function getAndCheckXcodeVersion(caps) {
  let version;

  try {
    version = await _appiumXcode.default.getVersion(true);
  } catch (err) {
    _logger.default.debug(err);

    _logger.default.error(`Could not determine Xcode version: ${err.message}`);

    throw err;
  }

  let minorVersion = version.versionFloat;
  let pv = parseFloat(caps.platformVersion);

  if (minorVersion < 6.3 && !(minorVersion === 6.0 && pv === 8.0)) {
    _logger.default.warn(`Xcode version '${version.versionString}'. Support for Xcode ` + `${version.versionString} has been deprecated and will be removed ` + `in a future version. Please upgrade to version 6.3 or ` + `higher (or version 6.0.1 for iOS 8.0)`);
  }

  return version;
}

async function getAndCheckIosSdkVersion() {
  let versionNumber;

  try {
    versionNumber = await _appiumXcode.default.getMaxIOSSDK();
  } catch (err) {
    _logger.default.error("Could not determine iOS SDK version");

    throw err;
  }

  return versionNumber;
}

function getSimForDeviceString(dString, availDevices) {
  let matchedDevice = null;
  let matchedUdid = null;

  _lodash.default.each(availDevices, function (device) {
    if (device.indexOf(dString) !== -1) {
      matchedDevice = device;

      try {
        matchedUdid = /.+\[([^\]]+)\]/.exec(device)[1];
      } catch (e) {
        matchedUdid = null;
      }
    }
  });

  return [matchedDevice, matchedUdid];
}

async function detectUdid(caps) {
  if (caps.udid !== null && caps.udid === "auto") {
    _logger.default.debug("Auto-detecting iOS udid...");

    let cmd,
        args = [];

    try {
      cmd = await _appiumSupport.fs.which('idevice_id');
      args.push('-l');
    } catch (err) {
      cmd = require.resolve('udidetect');
    }

    let udid;

    try {
      let {
        stdout
      } = await (0, _teen_process.exec)(cmd, args, {
        timeout: 3000
      });
      udid = stdout.split("\n")[0];
    } catch (err) {
      _logger.default.error("Error detecting udid");

      throw err;
    }

    if (udid && udid.length > 2) {
      caps.udid = udid;

      _logger.default.debug(`Detected udid as '${caps.udid}'`);
    } else {
      throw new Error("Could not detect udid.");
    }
  } else {
    _logger.default.debug("Not auto-detecting udid.");
  }
}

async function readResource(resourcePath) {
  const data = await _appiumSupport.plist.parsePlistFile(resourcePath);
  const result = {};

  for (const [key, value] of _lodash.default.toPairs(data)) {
    result[key] = _lodash.default.isString(value) ? value : JSON.stringify(value);
  }

  return result;
}

async function parseLocalizableStrings(opts) {
  const {
    app,
    language = 'en',
    localizableStringsDir,
    stringFile,
    strictMode
  } = opts;

  if (!app) {
    const message = "Strings extraction is not supported if 'app' capability is not set";

    if (strictMode) {
      throw new Error(message);
    }

    _logger.default.info(message);

    return {};
  }

  let lprojRoot;

  for (const subfolder of [`${language}.lproj`, localizableStringsDir, '']) {
    lprojRoot = _path.default.resolve(app, subfolder);

    if (await _appiumSupport.fs.exists(lprojRoot)) {
      break;
    }

    const message = `No '${lprojRoot}' resources folder has been found`;

    if (strictMode) {
      throw new Error(message);
    }

    _logger.default.debug(message);
  }

  _logger.default.info(`Will extract resource strings from '${lprojRoot}'`);

  const resourcePaths = [];

  if (stringFile) {
    const dstPath = _path.default.resolve(lprojRoot, stringFile);

    if (await _appiumSupport.fs.exists(dstPath)) {
      resourcePaths.push(dstPath);
    } else {
      const message = `No '${dstPath}' resource file has been found for '${app}'`;

      if (strictMode) {
        throw new Error(message);
      }

      _logger.default.info(message);

      _logger.default.info(`Getting all the available strings from '${lprojRoot}'`);
    }
  }

  if (_lodash.default.isEmpty(resourcePaths) && (await _appiumSupport.fs.exists(lprojRoot))) {
    const resourceFiles = (await _appiumSupport.fs.readdir(lprojRoot)).filter(name => _lodash.default.some([STRINGS_RESOURCE, STRINGSDICT_RESOURCE], x => name.endsWith(x))).map(name => _path.default.resolve(lprojRoot, name));
    resourcePaths.push(...resourceFiles);
  }

  _logger.default.info(`Got ${resourcePaths.length} resource file(s) in '${lprojRoot}'`);

  if (_lodash.default.isEmpty(resourcePaths)) {
    return {};
  }

  const resultStrings = {};

  const toAbsolutePath = function (p) {
    return _path.default.isAbsolute(p) ? p : _path.default.resolve(process.cwd(), p);
  };

  for (const resourcePath of resourcePaths) {
    if (!_appiumSupport.util.isSubPath(toAbsolutePath(resourcePath), toAbsolutePath(app))) {
      throw new Error(`'${resourcePath}' is expected to be located under '${app}'`);
    }

    try {
      const data = await readResource(resourcePath);

      _logger.default.debug(`Parsed ${_lodash.default.keys(data).length} string(s) from '${resourcePath}'`);

      _lodash.default.merge(resultStrings, data);
    } catch (e) {
      _logger.default.warn(`Cannot parse '${resourcePath}' resource. Original error: ${e.message}`);
    }
  }

  _logger.default.info(`Got ${_lodash.default.keys(resultStrings).length} string(s) from '${lprojRoot}'`);

  return resultStrings;
}

async function setBundleIdFromApp(caps) {
  if (!caps.bundleId) {
    try {
      caps.bundleId = await (0, _appUtils.extractBundleId)(caps.app);

      _logger.default.info(`Extracted bundleID: ${caps.bundleId} from app: ${caps.app}`);
    } catch (err) {
      _logger.default.error("Could not set the bundleId from app.");

      throw err;
    }
  }
}

function shouldPrelaunchSimulator(caps, iosSdkVersion) {
  let shouldPrelaunch = false;

  if (caps.defaultDevice || iosSdkVersion >= 7.1) {
    if (this.iosSdkVersion >= 7.1) {
      _logger.default.debug("We're on iOS7.1+ so forcing defaultDevice on");
    } else {
      _logger.default.debug("User specified default device, letting instruments launch it");
    }
  } else {
    shouldPrelaunch = true;
  }

  return shouldPrelaunch;
}

async function setDeviceTypeInInfoPlist(app, deviceString) {
  if (_lodash.default.isNull(app) || _lodash.default.isUndefined(app)) {
    return;
  }

  let plistFile = _path.default.resolve(app, "Info.plist");

  let isiPhone = deviceString.toLowerCase().indexOf("ipad") === -1;
  let deviceTypeCode = isiPhone ? 1 : 2;
  await _appiumSupport.plist.updatePlistFile(plistFile, {
    UIDeviceFamily: [deviceTypeCode]
  });
}

function unwrapEl(el) {
  if (typeof el === 'object' && el.ELEMENT) {
    return el.ELEMENT;
  }

  return el;
}

async function clearLogs(locations) {
  _logger.default.debug('Clearing log files');

  for (let location of locations) {
    if (await _appiumSupport.fs.exists(location)) {
      let size;

      try {
        let {
          stdout
        } = await (0, _teen_process.exec)('du', ['-sh', location]);
        size = stdout.trim().split(/\s+/)[0];
      } catch (ign) {}

      try {
        _logger.default.debug(`Deleting '${location}'. ${size ? `Freeing ${size}.` : ''}`);

        await _appiumSupport.fs.rimraf(location);
      } catch (err) {
        _logger.default.warn(`Unable to delete '${location}': ${err.message}`);
      }
    }
  }

  _logger.default.debug('Finished clearing log files');
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi91dGlscy5qcyJdLCJuYW1lcyI6WyJyb290RGlyIiwicGF0aCIsInJlc29sdmUiLCJfX2Rpcm5hbWUiLCJTVFJJTkdTRElDVF9SRVNPVVJDRSIsIlNUUklOR1NfUkVTT1VSQ0UiLCJwcmVwYXJlSW9zT3B0cyIsIm9wdHMiLCJiYWNrZW5kUmV0cmllcyIsIndpdGhvdXREZWxheSIsIm5hdGl2ZUluc3RydW1lbnRzTGliIiwicmVzZXQiLCJub1Jlc2V0IiwiaW5pdGlhbE9yaWVudGF0aW9uIiwiZGV2aWNlT3JpZW50YXRpb24iLCJvcmllbnRhdGlvbiIsInVzZVJvYm90Iiwicm9ib3RQb3J0Iiwicm9ib3RVcmwiLCJyb2JvdEFkZHJlc3MiLCJsb2NhdGlvblNlcnZpY2VzQXV0aG9yaXplZCIsImJ1bmRsZUlkIiwiRXJyb3IiLCJwbGF0Zm9ybVZlcnNpb24iLCJ4Y29kZSIsImdldE1heElPU1NESyIsInB2IiwicGFyc2VGbG9hdCIsImxvZ2dlciIsIndhcm4iLCJsb2NhbGl6YWJsZVN0cmluZ3NEaXIiLCJhdXRvQWNjZXB0QWxlcnRzIiwiXyIsImlzTnVsbCIsImlzVW5kZWZpbmVkIiwiYXV0b0Rpc21pc3NBbGVydHMiLCJicm93c2VyTmFtZSIsInRvTG93ZXJDYXNlIiwiYXBwIiwiU0FGQVJJX0JVTkRMRSIsInVkaWQiLCJTQUZBUklfTEFVTkNIRVJfQVBQX0ZJTEUiLCJTQUZBUklfTEFVTkNIRVJfQlVORExFIiwic2FmYXJpIiwiYXBwSXNQYWNrYWdlT3JCdW5kbGUiLCJ0ZXN0IiwicmVtb3ZlSW5zdHJ1bWVudHNTb2NrZXQiLCJzb2NrIiwiZGVidWciLCJmcyIsInJpbXJhZiIsImdldEFuZENoZWNrWGNvZGVWZXJzaW9uIiwiY2FwcyIsInZlcnNpb24iLCJnZXRWZXJzaW9uIiwiZXJyIiwiZXJyb3IiLCJtZXNzYWdlIiwibWlub3JWZXJzaW9uIiwidmVyc2lvbkZsb2F0IiwidmVyc2lvblN0cmluZyIsImdldEFuZENoZWNrSW9zU2RrVmVyc2lvbiIsInZlcnNpb25OdW1iZXIiLCJnZXRTaW1Gb3JEZXZpY2VTdHJpbmciLCJkU3RyaW5nIiwiYXZhaWxEZXZpY2VzIiwibWF0Y2hlZERldmljZSIsIm1hdGNoZWRVZGlkIiwiZWFjaCIsImRldmljZSIsImluZGV4T2YiLCJleGVjIiwiZSIsImRldGVjdFVkaWQiLCJjbWQiLCJhcmdzIiwid2hpY2giLCJwdXNoIiwicmVxdWlyZSIsInN0ZG91dCIsInRpbWVvdXQiLCJzcGxpdCIsImxlbmd0aCIsInJlYWRSZXNvdXJjZSIsInJlc291cmNlUGF0aCIsImRhdGEiLCJwbGlzdCIsInBhcnNlUGxpc3RGaWxlIiwicmVzdWx0Iiwia2V5IiwidmFsdWUiLCJ0b1BhaXJzIiwiaXNTdHJpbmciLCJKU09OIiwic3RyaW5naWZ5IiwicGFyc2VMb2NhbGl6YWJsZVN0cmluZ3MiLCJsYW5ndWFnZSIsInN0cmluZ0ZpbGUiLCJzdHJpY3RNb2RlIiwiaW5mbyIsImxwcm9qUm9vdCIsInN1YmZvbGRlciIsImV4aXN0cyIsInJlc291cmNlUGF0aHMiLCJkc3RQYXRoIiwiaXNFbXB0eSIsInJlc291cmNlRmlsZXMiLCJyZWFkZGlyIiwiZmlsdGVyIiwibmFtZSIsInNvbWUiLCJ4IiwiZW5kc1dpdGgiLCJtYXAiLCJyZXN1bHRTdHJpbmdzIiwidG9BYnNvbHV0ZVBhdGgiLCJwIiwiaXNBYnNvbHV0ZSIsInByb2Nlc3MiLCJjd2QiLCJ1dGlsIiwiaXNTdWJQYXRoIiwia2V5cyIsIm1lcmdlIiwic2V0QnVuZGxlSWRGcm9tQXBwIiwic2hvdWxkUHJlbGF1bmNoU2ltdWxhdG9yIiwiaW9zU2RrVmVyc2lvbiIsInNob3VsZFByZWxhdW5jaCIsImRlZmF1bHREZXZpY2UiLCJzZXREZXZpY2VUeXBlSW5JbmZvUGxpc3QiLCJkZXZpY2VTdHJpbmciLCJwbGlzdEZpbGUiLCJpc2lQaG9uZSIsImRldmljZVR5cGVDb2RlIiwidXBkYXRlUGxpc3RGaWxlIiwiVUlEZXZpY2VGYW1pbHkiLCJ1bndyYXBFbCIsImVsIiwiRUxFTUVOVCIsImNsZWFy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dUMsUUFBVixDQUFWLEVBQStCO0FBQzdCLFVBQUlDLElBQUo7O0FBQ0EsVUFBSTtBQUNGLFlBQUk7QUFBQy9ELFVBQUFBO0FBQUQsWUFBVyxNQUFNLHdCQUFLLElBQUwsRUFBVyxDQUFDLEtBQUQsRUFBUThELFFBQVIsQ0FBWCxDQUFyQjtBQUNBQyxRQUFBQSxJQUFJLEdBQUcvRCxNQUFNLENBQUNnRSxJQUFQLEdBQWM5RCxLQUFkLENBQW9CLEtBQXBCLEVBQTJCLENBQTNCLENBQVA7QUFDRCxPQUhELENBR0UsT0FBTytELEdBQVAsRUFBWSxDQUFFOztBQUNoQixVQUFJO0FBQ0ZwSCx3QkFBT29CLEtBQVAsQ0FBYyxhQUFZNkYsUUFBUyxNQUFLQyxJQUFJLEdBQUksV0FBVUEsSUFBSyxHQUFuQixHQUF3QixFQUFHLEVBQXZFOztBQUNBLGNBQU03RixrQkFBR0MsTUFBSCxDQUFVMkYsUUFBVixDQUFOO0FBQ0QsT0FIRCxDQUdFLE9BQU90RixHQUFQLEVBQVk7QUFDWjNCLHdCQUFPQyxJQUFQLENBQWEscUJBQW9CZ0gsUUFBUyxNQUFLdEYsR0FBRyxDQUFDRSxPQUFRLEVBQTNEO0FBQ0Q7QUFDRjtBQUNGOztBQUNEN0Isa0JBQU9vQixLQUFQLENBQWEsNkJBQWI7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGZzLCBwbGlzdCwgdXRpbCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCB4Y29kZSBmcm9tICdhcHBpdW0teGNvZGUnO1xuaW1wb3J0IHsgZXh0cmFjdEJ1bmRsZUlkIH0gZnJvbSAnLi9hcHAtdXRpbHMnO1xuaW1wb3J0IGxvZ2dlciBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCB7IFNBRkFSSV9CVU5ETEUgfSBmcm9tICcuL2NvbW1hbmRzL3NhZmFyaSc7XG5pbXBvcnQgeyBTQUZBUklfTEFVTkNIRVJfQVBQX0ZJTEUsIFNBRkFSSV9MQVVOQ0hFUl9CVU5ETEUgfSBmcm9tICcuL3NhZmFyaS1sYXVuY2hlcic7XG5cblxuY29uc3Qgcm9vdERpciA9IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuLicsICcuLicpO1xuY29uc3QgU1RSSU5HU0RJQ1RfUkVTT1VSQ0UgPSAnLnN0cmluZ3NkaWN0JztcbmNvbnN0IFNUUklOR1NfUkVTT1VSQ0UgPSAnLnN0cmluZ3MnO1xuXG5hc3luYyBmdW5jdGlvbiBwcmVwYXJlSW9zT3B0cyAob3B0cykge1xuICBvcHRzLmJhY2tlbmRSZXRyaWVzID0gNDtcbiAgb3B0cy53aXRob3V0RGVsYXkgPSAhb3B0cy5uYXRpdmVJbnN0cnVtZW50c0xpYjtcbiAgb3B0cy5yZXNldCA9ICFvcHRzLm5vUmVzZXQ7XG4gIG9wdHMuaW5pdGlhbE9yaWVudGF0aW9uID0gb3B0cy5kZXZpY2VPcmllbnRhdGlvbiB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdHMub3JpZW50YXRpb24gfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIlBPUlRSQUlUXCI7XG4gIG9wdHMudXNlUm9ib3QgPSBvcHRzLnJvYm90UG9ydCA+IDA7XG4gIG9wdHMucm9ib3RVcmwgPSBvcHRzLnVzZVJvYm90ID9cbiAgICBgaHR0cDovLyR7b3B0cy5yb2JvdEFkZHJlc3N9OiR7b3B0cy5yb2JvdFBvcnR9YCA6IG51bGw7XG4gIGlmIChvcHRzLmxvY2F0aW9uU2VydmljZXNBdXRob3JpemVkICYmICFvcHRzLmJ1bmRsZUlkKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiWW91IG11c3Qgc2V0IHRoZSBidW5kbGVJZCBjYXAgaWYgdXNpbmcgbG9jYXRpb25TZXJ2aWNlc0VuYWJsZWRcIik7XG4gIH1cblxuICBvcHRzLnBsYXRmb3JtVmVyc2lvbiA9IG9wdHMucGxhdGZvcm1WZXJzaW9uIHx8IGF3YWl0IHhjb2RlLmdldE1heElPU1NESygpO1xuICBsZXQgcHYgPSBwYXJzZUZsb2F0KG9wdHMucGxhdGZvcm1WZXJzaW9uKTtcbiAgaWYgKHB2IDwgOCkge1xuICAgIGxvZ2dlci53YXJuKGBpT1MgdmVyc2lvbiAke29wdHMucGxhdGZvcm1WZXJzaW9ufSBzdXBwb3J0IGhhcyBiZWVuIGAgK1xuICAgICAgICAgICAgICAgIGBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIHJlbW92ZWQgaW4gYSBmdXR1cmUgdmVyc2lvbiBvZiBgICtcbiAgICAgICAgICAgICAgICBgQXBwaXVtLmApO1xuICB9XG4gIG9wdHMubG9jYWxpemFibGVTdHJpbmdzRGlyID0gb3B0cy5sb2NhbGl6YWJsZVN0cmluZ3NEaXIgfHwgJ2VuLmxwcm9qJztcbiAgb3B0cy5hdXRvQWNjZXB0QWxlcnRzID0gXy5pc051bGwob3B0cy5hdXRvQWNjZXB0QWxlcnRzKSB8fCBfLmlzVW5kZWZpbmVkKG9wdHMuYXV0b0FjY2VwdEFsZXJ0cykgPyBmYWxzZSA6IG9wdHMuYXV0b0FjY2VwdEFsZXJ0cztcbiAgb3B0cy5hdXRvRGlzbWlzc0FsZXJ0cyA9IF8uaXNOdWxsKG9wdHMuYXV0b0Rpc21pc3NBbGVydHMpIHx8IF8uaXNVbmRlZmluZWQob3B0cy5hdXRvRGlzbWlzc0FsZXJ0cykgPyBmYWxzZSA6IG9wdHMuYXV0b0Rpc21pc3NBbGVydHM7XG5cbiAgaWYgKChvcHRzLmJyb3dzZXJOYW1lIHx8ICcnKS50b0xvd2VyQ2FzZSgpID09PSAnc2FmYXJpJyB8fFxuICAgICAgKG9wdHMuYXBwIHx8ICcnKS50b0xvd2VyQ2FzZSgpID09PSAnc2FmYXJpJyB8fFxuICAgICAgKG9wdHMuYnVuZGxlSWQgfHwgJycpLnRvTG93ZXJDYXNlKCkgPT09IFNBRkFSSV9CVU5ETEUpIHtcbiAgICAvLyBwcmVwYXJpbmcgYSBzYWZhcmkgc2Vzc2lvblxuICAgIGlmIChvcHRzLnVkaWQpIHtcbiAgICAgIC8vIG9uIGEgcmVhbCBkZXZpY2VcbiAgICAgIG9wdHMuYXBwID0gb3B0cy5hcHAgfHwgU0FGQVJJX0xBVU5DSEVSX0FQUF9GSUxFO1xuICAgICAgb3B0cy5idW5kbGVJZCA9IG9wdHMuYnVuZGxlSWQgfHwgU0FGQVJJX0xBVU5DSEVSX0JVTkRMRTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHBhcnNlRmxvYXQob3B0cy5wbGF0Zm9ybVZlcnNpb24pIDw9IDgpIHtcbiAgICAgICAgLy8gbWFrZSBzdXJlIGFyZ3MuYXBwIGhhcyBzb21ldGhpbmcgaW4gaXQgc28gd2UgZ2V0IHRvIHRoZSByaWdodCBzcG90c1xuICAgICAgICAvLyBpbiBtb3ZlQnVpbHRJbkFwcCgpXG4gICAgICAgIG9wdHMuYXBwID0gJ3NhZmFyaSc7XG4gICAgICAgIG9wdHMuYnVuZGxlSWQgPSBudWxsO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb3B0cy5hcHAgPSBudWxsO1xuICAgICAgICBvcHRzLmJ1bmRsZUlkID0gU0FGQVJJX0JVTkRMRTtcbiAgICAgIH1cbiAgICB9XG4gICAgb3B0cy5zYWZhcmkgPSB0cnVlO1xuICB9XG59XG5cbmZ1bmN0aW9uIGFwcElzUGFja2FnZU9yQnVuZGxlIChhcHApIHtcbiAgcmV0dXJuICgvXihbYS16QS1aMC05XFwtX10rXFwuW2EtekEtWjAtOVxcLV9dKykrJC8pLnRlc3QoYXBwKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gcmVtb3ZlSW5zdHJ1bWVudHNTb2NrZXQgKHNvY2spIHtcbiAgbG9nZ2VyLmRlYnVnKFwiUmVtb3ZpbmcgYW55IHJlbWFpbmluZyBpbnN0cnVtZW50cyBzb2NrZXRzXCIpO1xuICBhd2FpdCBmcy5yaW1yYWYoc29jayk7XG4gIGxvZ2dlci5kZWJ1ZyhgQ2xlYW5lZCB1cCBpbnN0cnVtZW50cyBzb2NrZXQgJHtzb2NrfWApO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbmRDaGVja1hjb2RlVmVyc2lvbiAoY2Fwcykge1xuICBsZXQgdmVyc2lvbjtcbiAgdHJ5IHtcbiAgICB2ZXJzaW9uID0gYXdhaXQgeGNvZGUuZ2V0VmVyc2lvbih0cnVlKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nZ2VyLmRlYnVnKGVycik7XG4gICAgbG9nZ2VyLmVycm9yKGBDb3VsZCBub3QgZGV0ZXJtaW5lIFhjb2RlIHZlcnNpb246ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgdGhyb3cgZXJyO1xuICB9XG4gIGxldCBtaW5vclZlcnNpb24gPSB2ZXJzaW9uLnZlcnNpb25GbG9hdDtcbiAgbGV0IHB2ID0gcGFyc2VGbG9hdChjYXBzLnBsYXRmb3JtVmVyc2lvbik7XG4gIC8vIHdlIGRlcHJlY2F0ZSBYY29kZXMgPCA2LjMsIGV4Y2VwdCBmb3IgaU9TIDguMCBpbiB3aGljaCBjYXNlIHdlXG4gIC8vIHN1cHBvcnQgWGNvZGUgNi4wIGFzIHdlbGxcbiAgaWYgKG1pbm9yVmVyc2lvbiA8IDYuMyAmJiAoIShtaW5vclZlcnNpb24gPT09IDYuMCAmJiBwdiA9PT0gOC4wKSkpIHtcbiAgICBsb2dnZXIud2FybihgWGNvZGUgdmVyc2lvbiAnJHt2ZXJzaW9uLnZlcnNpb25TdHJpbmd9Jy4gU3VwcG9ydCBmb3IgWGNvZGUgYCArXG4gICAgICAgICAgICAgICAgYCR7dmVyc2lvbi52ZXJzaW9uU3RyaW5nfSBoYXMgYmVlbiBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIHJlbW92ZWQgYCArXG4gICAgICAgICAgICAgICAgYGluIGEgZnV0dXJlIHZlcnNpb24uIFBsZWFzZSB1cGdyYWRlIHRvIHZlcnNpb24gNi4zIG9yIGAgK1xuICAgICAgICAgICAgICAgIGBoaWdoZXIgKG9yIHZlcnNpb24gNi4wLjEgZm9yIGlPUyA4LjApYCk7XG4gIH1cbiAgcmV0dXJuIHZlcnNpb247XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldEFuZENoZWNrSW9zU2RrVmVyc2lvbiAoKSB7XG4gIGxldCB2ZXJzaW9uTnVtYmVyO1xuICB0cnkge1xuICAgIHZlcnNpb25OdW1iZXIgPSBhd2FpdCB4Y29kZS5nZXRNYXhJT1NTREsoKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nZ2VyLmVycm9yKFwiQ291bGQgbm90IGRldGVybWluZSBpT1MgU0RLIHZlcnNpb25cIik7XG4gICAgdGhyb3cgZXJyO1xuICB9XG4gIHJldHVybiB2ZXJzaW9uTnVtYmVyO1xufVxuXG5mdW5jdGlvbiBnZXRTaW1Gb3JEZXZpY2VTdHJpbmcgKGRTdHJpbmcsIGF2YWlsRGV2aWNlcykge1xuICBsZXQgbWF0Y2hlZERldmljZSA9IG51bGw7XG4gIGxldCBtYXRjaGVkVWRpZCA9IG51bGw7XG4gIF8uZWFjaChhdmFpbERldmljZXMsIGZ1bmN0aW9uIChkZXZpY2UpIHtcbiAgICBpZiAoZGV2aWNlLmluZGV4T2YoZFN0cmluZykgIT09IC0xKSB7XG4gICAgICBtYXRjaGVkRGV2aWNlID0gZGV2aWNlO1xuICAgICAgdHJ5IHtcbiAgICAgICAgbWF0Y2hlZFVkaWQgPSAvLitcXFsoW15cXF1dKylcXF0vLmV4ZWMoZGV2aWNlKVsxXTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgbWF0Y2hlZFVkaWQgPSBudWxsO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIHJldHVybiBbbWF0Y2hlZERldmljZSwgbWF0Y2hlZFVkaWRdO1xufVxuXG5hc3luYyBmdW5jdGlvbiBkZXRlY3RVZGlkIChjYXBzKSB7XG4gIGlmIChjYXBzLnVkaWQgIT09IG51bGwgJiYgY2Fwcy51ZGlkID09PSBcImF1dG9cIikge1xuICAgIGxvZ2dlci5kZWJ1ZyhcIkF1dG8tZGV0ZWN0aW5nIGlPUyB1ZGlkLi4uXCIpO1xuICAgIGxldCBjbWQsIGFyZ3MgPSBbXTtcbiAgICB0cnkge1xuICAgICAgY21kID0gYXdhaXQgZnMud2hpY2goJ2lkZXZpY2VfaWQnKTtcbiAgICAgIGFyZ3MucHVzaCgnLWwnKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGNtZCA9IHJlcXVpcmUucmVzb2x2ZSgndWRpZGV0ZWN0Jyk7XG4gICAgfVxuICAgIGxldCB1ZGlkO1xuICAgIHRyeSB7XG4gICAgICBsZXQge3N0ZG91dH0gPSBhd2FpdCBleGVjKGNtZCwgYXJncywge3RpbWVvdXQ6IDMwMDB9KTtcbiAgICAgIHVkaWQgPSBzdGRvdXQuc3BsaXQoXCJcXG5cIilbMF07XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoXCJFcnJvciBkZXRlY3RpbmcgdWRpZFwiKTtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gICAgaWYgKHVkaWQgJiYgdWRpZC5sZW5ndGggPiAyKSB7XG4gICAgICBjYXBzLnVkaWQgPSB1ZGlkO1xuICAgICAgbG9nZ2VyLmRlYnVnKGBEZXRlY3RlZCB1ZGlkIGFzICcke2NhcHMudWRpZH0nYCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNvdWxkIG5vdCBkZXRlY3QgdWRpZC5cIik7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGxvZ2dlci5kZWJ1ZyhcIk5vdCBhdXRvLWRldGVjdGluZyB1ZGlkLlwiKTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiByZWFkUmVzb3VyY2UgKHJlc291cmNlUGF0aCkge1xuICBjb25zdCBkYXRhID0gYXdhaXQgcGxpc3QucGFyc2VQbGlzdEZpbGUocmVzb3VyY2VQYXRoKTtcbiAgY29uc3QgcmVzdWx0ID0ge307XG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIF8udG9QYWlycyhkYXRhKSkge1xuICAgIHJlc3VsdFtrZXldID0gXy5pc1N0cmluZyh2YWx1ZSkgPyB2YWx1ZSA6IEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5hc3luYyBmdW5jdGlvbiBwYXJzZUxvY2FsaXphYmxlU3RyaW5ncyAob3B0cykge1xuICBjb25zdCB7XG4gICAgYXBwLFxuICAgIGxhbmd1YWdlID0gJ2VuJyxcbiAgICBsb2NhbGl6YWJsZVN0cmluZ3NEaXIsXG4gICAgc3RyaW5nRmlsZSxcbiAgICBzdHJpY3RNb2RlLFxuICB9ID0gb3B0cztcblxuICBpZiAoIWFwcCkge1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBcIlN0cmluZ3MgZXh0cmFjdGlvbiBpcyBub3Qgc3VwcG9ydGVkIGlmICdhcHAnIGNhcGFiaWxpdHkgaXMgbm90IHNldFwiO1xuICAgIGlmIChzdHJpY3RNb2RlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7XG4gICAgfVxuICAgIGxvZ2dlci5pbmZvKG1lc3NhZ2UpO1xuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIGxldCBscHJvalJvb3Q7XG4gIGZvciAoY29uc3Qgc3ViZm9sZGVyIG9mIFtgJHtsYW5ndWFnZX0ubHByb2pgLCBsb2NhbGl6YWJsZVN0cmluZ3NEaXIsICcnXSkge1xuICAgIGxwcm9qUm9vdCA9IHBhdGgucmVzb2x2ZShhcHAsIHN1YmZvbGRlcik7XG4gICAgaWYgKGF3YWl0IGZzLmV4aXN0cyhscHJvalJvb3QpKSB7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgY29uc3QgbWVzc2FnZSA9IGBObyAnJHtscHJvalJvb3R9JyByZXNvdXJjZXMgZm9sZGVyIGhhcyBiZWVuIGZvdW5kYDtcbiAgICBpZiAoc3RyaWN0TW9kZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBsb2dnZXIuZGVidWcobWVzc2FnZSk7XG4gIH1cbiAgbG9nZ2VyLmluZm8oYFdpbGwgZXh0cmFjdCByZXNvdXJjZSBzdHJpbmdzIGZyb20gJyR7bHByb2pSb290fSdgKTtcblxuICBjb25zdCByZXNvdXJjZVBhdGhzID0gW107XG4gIGlmIChzdHJpbmdGaWxlKSB7XG4gICAgY29uc3QgZHN0UGF0aCA9IHBhdGgucmVzb2x2ZShscHJvalJvb3QsIHN0cmluZ0ZpbGUpO1xuICAgIGlmIChhd2FpdCBmcy5leGlzdHMoZHN0UGF0aCkpIHtcbiAgICAgIHJlc291cmNlUGF0aHMucHVzaChkc3RQYXRoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgbWVzc2FnZSA9IGBObyAnJHtkc3RQYXRofScgcmVzb3VyY2UgZmlsZSBoYXMgYmVlbiBmb3VuZCBmb3IgJyR7YXBwfSdgO1xuICAgICAgaWYgKHN0cmljdE1vZGUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpO1xuICAgICAgfVxuICAgICAgbG9nZ2VyLmluZm8obWVzc2FnZSk7XG4gICAgICBsb2dnZXIuaW5mbyhgR2V0dGluZyBhbGwgdGhlIGF2YWlsYWJsZSBzdHJpbmdzIGZyb20gJyR7bHByb2pSb290fSdgKTtcbiAgICB9XG4gIH1cblxuICBpZiAoXy5pc0VtcHR5KHJlc291cmNlUGF0aHMpICYmIGF3YWl0IGZzLmV4aXN0cyhscHJvalJvb3QpKSB7XG4gICAgY29uc3QgcmVzb3VyY2VGaWxlcyA9IChhd2FpdCBmcy5yZWFkZGlyKGxwcm9qUm9vdCkpXG4gICAgICAuZmlsdGVyKChuYW1lKSA9PiBfLnNvbWUoW1NUUklOR1NfUkVTT1VSQ0UsIFNUUklOR1NESUNUX1JFU09VUkNFXSwgKHgpID0+IG5hbWUuZW5kc1dpdGgoeCkpKVxuICAgICAgLm1hcCgobmFtZSkgPT4gcGF0aC5yZXNvbHZlKGxwcm9qUm9vdCwgbmFtZSkpO1xuICAgIHJlc291cmNlUGF0aHMucHVzaCguLi5yZXNvdXJjZUZpbGVzKTtcbiAgfVxuICBsb2dnZXIuaW5mbyhgR290ICR7cmVzb3VyY2VQYXRocy5sZW5ndGh9IHJlc291cmNlIGZpbGUocykgaW4gJyR7bHByb2pSb290fSdgKTtcblxuICBpZiAoXy5pc0VtcHR5KHJlc291cmNlUGF0aHMpKSB7XG4gICAgcmV0dXJuIHt9O1xuICB9XG5cbiAgY29uc3QgcmVzdWx0U3RyaW5ncyA9IHt9O1xuICBjb25zdCB0b0Fic29sdXRlUGF0aCA9IGZ1bmN0aW9uIChwKSB7XG4gICAgcmV0dXJuIHBhdGguaXNBYnNvbHV0ZShwKSA/IHAgOiBwYXRoLnJlc29sdmUocHJvY2Vzcy5jd2QoKSwgcCk7XG4gIH07XG4gIGZvciAoY29uc3QgcmVzb3VyY2VQYXRoIG9mIHJlc291cmNlUGF0aHMpIHtcbiAgICBpZiAoIXV0aWwuaXNTdWJQYXRoKHRvQWJzb2x1dGVQYXRoKHJlc291cmNlUGF0aCksIHRvQWJzb2x1dGVQYXRoKGFwcCkpKSB7XG4gICAgICAvLyBzZWN1cml0eSBwcmVjYXV0aW9uXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYCcke3Jlc291cmNlUGF0aH0nIGlzIGV4cGVjdGVkIHRvIGJlIGxvY2F0ZWQgdW5kZXIgJyR7YXBwfSdgKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZWFkUmVzb3VyY2UocmVzb3VyY2VQYXRoKTtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhgUGFyc2VkICR7Xy5rZXlzKGRhdGEpLmxlbmd0aH0gc3RyaW5nKHMpIGZyb20gJyR7cmVzb3VyY2VQYXRofSdgKTtcbiAgICAgIF8ubWVyZ2UocmVzdWx0U3RyaW5ncywgZGF0YSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgbG9nZ2VyLndhcm4oYENhbm5vdCBwYXJzZSAnJHtyZXNvdXJjZVBhdGh9JyByZXNvdXJjZS4gT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICAgIH1cbiAgfVxuXG4gIGxvZ2dlci5pbmZvKGBHb3QgJHtfLmtleXMocmVzdWx0U3RyaW5ncykubGVuZ3RofSBzdHJpbmcocykgZnJvbSAnJHtscHJvalJvb3R9J2ApO1xuICByZXR1cm4gcmVzdWx0U3RyaW5ncztcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2V0QnVuZGxlSWRGcm9tQXBwIChjYXBzKSB7XG4gIC8vIFRoaXMgbWV0aG9kIHdpbGwgdHJ5IHRvIGV4dHJhY3QgdGhlIGJ1bmRsZUlkIGZyb20gdGhlIGFwcFxuICBpZiAoIWNhcHMuYnVuZGxlSWQpIHtcbiAgICB0cnkge1xuICAgICAgY2Fwcy5idW5kbGVJZCA9IGF3YWl0IGV4dHJhY3RCdW5kbGVJZChjYXBzLmFwcCk7XG4gICAgICBsb2dnZXIuaW5mbyhgRXh0cmFjdGVkIGJ1bmRsZUlEOiAke2NhcHMuYnVuZGxlSWR9IGZyb20gYXBwOiAke2NhcHMuYXBwfWApO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nZ2VyLmVycm9yKFwiQ291bGQgbm90IHNldCB0aGUgYnVuZGxlSWQgZnJvbSBhcHAuXCIpO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBzaG91bGRQcmVsYXVuY2hTaW11bGF0b3IgKGNhcHMsIGlvc1Nka1ZlcnNpb24pIHtcbiAgbGV0IHNob3VsZFByZWxhdW5jaCA9IGZhbHNlO1xuXG4gIGlmIChjYXBzLmRlZmF1bHREZXZpY2UgfHwgaW9zU2RrVmVyc2lvbiA+PSA3LjEpIHtcbiAgICBpZiAodGhpcy5pb3NTZGtWZXJzaW9uID49IDcuMSkge1xuICAgICAgbG9nZ2VyLmRlYnVnKFwiV2UncmUgb24gaU9TNy4xKyBzbyBmb3JjaW5nIGRlZmF1bHREZXZpY2Ugb25cIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhcIlVzZXIgc3BlY2lmaWVkIGRlZmF1bHQgZGV2aWNlLCBsZXR0aW5nIGluc3RydW1lbnRzIGxhdW5jaCBpdFwiKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgc2hvdWxkUHJlbGF1bmNoID0gdHJ1ZTtcbiAgfVxuICByZXR1cm4gc2hvdWxkUHJlbGF1bmNoO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzZXREZXZpY2VUeXBlSW5JbmZvUGxpc3QgKGFwcCwgZGV2aWNlU3RyaW5nKSB7XG4gIGlmIChfLmlzTnVsbChhcHApIHx8IF8uaXNVbmRlZmluZWQoYXBwKSkgeyByZXR1cm47IH1cbiAgbGV0IHBsaXN0RmlsZSA9IHBhdGgucmVzb2x2ZShhcHAsIFwiSW5mby5wbGlzdFwiKTtcbiAgbGV0IGlzaVBob25lID0gZGV2aWNlU3RyaW5nLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcImlwYWRcIikgPT09IC0xO1xuICBsZXQgZGV2aWNlVHlwZUNvZGUgPSBpc2lQaG9uZSA/IDEgOiAyO1xuICBhd2FpdCBwbGlzdC51cGRhdGVQbGlzdEZpbGUocGxpc3RGaWxlLCB7VUlEZXZpY2VGYW1pbHk6IFtkZXZpY2VUeXBlQ29kZV19KTtcbn1cblxuZnVuY3Rpb24gdW53cmFwRWwgKGVsKSB7XG4gIGlmICh0eXBlb2YgZWwgPT09ICdvYmplY3QnICYmIGVsLkVMRU1FTlQpIHtcbiAgICByZXR1cm4gZWwuRUxFTUVOVDtcbiAgfVxuICByZXR1cm4gZWw7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNsZWFyTG9ncyAobG9jYXRpb25zKSB7XG4gIGxvZ2dlci5kZWJ1ZygnQ2xlYXJpbmcgbG9nIGZpbGVzJyk7XG4gIGZvciAobGV0IGxvY2F0aW9uIG9mIGxvY2F0aW9ucykge1xuICAgIGlmIChhd2FpdCBmcy5leGlzdHMobG9jYXRpb24pKSB7XG4gICAgICBsZXQgc2l6ZTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGxldCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ2R1JywgWyctc2gnLCBsb2NhdGlvbl0pO1xuICAgICAgICBzaXplID0gc3Rkb3V0LnRyaW0oKS5zcGxpdCgvXFxzKy8pWzBdO1xuICAgICAgfSBjYXRjaCAoaWduKSB7fVxuICAgICAgdHJ5IHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKGBEZWxldGluZyAnJHtsb2NhdGlvbn0nLiAke3NpemUgPyBgRnJlZWluZyAke3NpemV9LmAgOiAnJ31gKTtcbiAgICAgICAgYXdhaXQgZnMucmltcmFmKGxvY2F0aW9uKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBsb2dnZXIud2FybihgVW5hYmxlIHRvIGRlbGV0ZSAnJHtsb2NhdGlvbn0nOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBsb2dnZXIuZGVidWcoJ0ZpbmlzaGVkIGNsZWFyaW5nIGxvZyBmaWxlcycpO1xufVxuXG5leHBvcnQge1xuICByb290RGlyLCByZW1vdmVJbnN0cnVtZW50c1NvY2tldCwgZ2V0QW5kQ2hlY2tYY29kZVZlcnNpb24sIHByZXBhcmVJb3NPcHRzLFxuICBhcHBJc1BhY2thZ2VPckJ1bmRsZSwgZ2V0QW5kQ2hlY2tJb3NTZGtWZXJzaW9uLCBkZXRlY3RVZGlkLCBwYXJzZUxvY2FsaXphYmxlU3RyaW5ncyxcbiAgc2V0QnVuZGxlSWRGcm9tQXBwLCBzaG91bGRQcmVsYXVuY2hTaW11bGF0b3IsIHNldERldmljZVR5cGVJbkluZm9QbGlzdCxcbiAgZ2V0U2ltRm9yRGV2aWNlU3RyaW5nLCB1bndyYXBFbCwgY2xlYXJMb2dzLFxufTtcbiJdLCJmaWxlIjoibGliL3V0aWxzLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
