"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.installApp = installApp;
exports.removeApp = removeApp;
exports.launch = launch;
exports.spawn = spawn;
exports.spawnSubProcess = spawnSubProcess;
exports.openUrl = openUrl;
exports.terminate = terminate;
exports.shutdown = shutdown;
exports.createDevice = createDevice;
exports.getAppContainer = getAppContainer;
exports.getScreenshot = getScreenshot;
exports.deleteDevice = deleteDevice;
exports.eraseDevice = eraseDevice;
exports.getDevices = getDevices;
exports.getRuntimeForPlatformVersion = getRuntimeForPlatformVersion;
exports.bootDevice = bootDevice;
exports.setPasteboard = setPasteboard;
exports.getPasteboard = getPasteboard;
exports.addMedia = addMedia;
exports.appInfo = appInfo;
exports.getDeviceTypes = getDeviceTypes;
exports.startBootMonitor = startBootMonitor;

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));

require("source-map-support/register");

var _teen_process = require("teen_process");

var _asyncbox = require("asyncbox");

var _appiumSupport = require("appium-support");

var _lodash = _interopRequireDefault(require("lodash"));

var _appiumXcode = require("appium-xcode");

const log = _appiumSupport.logger.getLogger('simctl');

const CMDLINE_TOOLS_CLANG_FORMAT_CHANGED_VERSION = '1001.0.46';
const XCODE_FORMAT_CHANGED_VERSION = '10.2';
const SIM_RUNTIME_NAME = 'com.apple.CoreSimulator.SimRuntime.';
const SIM_RUNTIME_NAME_SUFFIX_IOS = 'iOS';
const DEFAULT_CREATE_SIMULATOR_TIMEOUT = 10000;

async function simCommand(command, timeout, args = [], env = {}, executingFunction = _teen_process.exec, logErrors = true) {
  args = ['simctl', command, ...args];
  env = _lodash.default.defaults(_lodash.default.mapKeys(env, (value, key) => {
    return `SIMCTL_CHILD_${key}`;
  }), process.env);

  try {
    return await executingFunction('xcrun', args, {
      timeout,
      env
    });
  } catch (e) {
    if (!logErrors) {
      throw e;
    } else if (e.stderr) {
      log.errorAndThrow(`simctl error running '${command}': ${e.stderr.trim()}`);
    } else {
      log.errorAndThrow(e);
    }
  }
}

async function simExec(command, timeout, args = [], env = {}, logErrors = true) {
  return await simCommand(command, timeout, args, env, async (c, a, ob) => {
    return await (0, _teen_process.exec)(c, a, ob);
  }, logErrors);
}

async function simSubProcess(command, timeout, args = [], env = {}) {
  return await simCommand(command, timeout, args, env, (c, a, ob) => {
    return new _teen_process.SubProcess(c, a, ob);
  });
}

async function installApp(udid, appPath) {
  await simExec('install', 0, [udid, appPath]);
}

async function bootDevice(udid) {
  try {
    await simExec('boot', 0, [udid]);
  } catch (err) {
    if ((err.message || '').indexOf('Unable to boot device in current state: Booted') === -1) {
      throw err;
    }

    log.debug(`Simulator already in 'Booted' state. Continuing`);
  }
}

async function removeApp(udid, bundleId) {
  await simExec('uninstall', 0, [udid, bundleId]);
}

async function launch(udid, bundleId, tries = 5) {
  await (0, _asyncbox.retryInterval)(tries, 1000, async () => {
    await simExec('launch', 0, [udid, bundleId]);
  });
}

async function spawn(udid, args, env = {}) {
  return await simExec('spawn', 0, [udid, ...(_lodash.default.isArray(args) ? args : [args])], env);
}

async function spawnSubProcess(udid, args, env = {}) {
  return await simSubProcess('spawn', 0, [udid, ...(_lodash.default.isArray(args) ? args : [args])], env);
}

async function openUrl(udid, url) {
  return await simExec('openurl', 0, [udid, url]);
}

async function appInfo(udid, bundleId) {
  const {
    stdout
  } = await simExec('appinfo', 0, [udid, bundleId]);
  return (stdout || '').trim();
}

async function addMedia(udid, path) {
  return await simExec('addmedia', 0, [udid, path]);
}

async function terminate(udid, bundleId) {
  await simExec('terminate', 0, [udid, bundleId]);
}

async function getAppContainer(udid, bundleId, logErrors = true, containerType = null) {
  const args = [udid, bundleId];

  if (containerType) {
    args.push(containerType);
  }

  const {
    stdout
  } = await simExec('get_app_container', 0, args, {}, logErrors);
  return (stdout || '').trim();
}

async function shutdown(udid) {
  try {
    await simExec('shutdown', 0, [udid]);
  } catch (err) {
    if (!(err + '').includes('current state: Shutdown')) {
      throw err;
    }

    log.debug(`Simulator already in 'Shutdown' state. Continuing`);
  }
}

async function createDevice(name, deviceTypeId, runtimeId, opts = {}) {
  const {
    platform = SIM_RUNTIME_NAME_SUFFIX_IOS,
    timeout = DEFAULT_CREATE_SIMULATOR_TIMEOUT
  } = opts;

  try {
    runtimeId = await getRuntimeForPlatformVersion(runtimeId, platform);
  } catch (err) {
    log.warn(`Unable to find runtime for iOS '${runtimeId}'. Continuing`);
  }

  const clangVersion = await (0, _appiumXcode.getClangVersion)();

  let isNewerIdFormatRequired = clangVersion && _appiumSupport.util.compareVersions(clangVersion, '>=', CMDLINE_TOOLS_CLANG_FORMAT_CHANGED_VERSION);

  if (!isNewerIdFormatRequired) {
    const xcodeVersion = await (0, _appiumXcode.getVersion)(false);
    isNewerIdFormatRequired = xcodeVersion && _appiumSupport.util.compareVersions(xcodeVersion, '>=', XCODE_FORMAT_CHANGED_VERSION);
  }

  if (isNewerIdFormatRequired) {
    runtimeId = `${SIM_RUNTIME_NAME}${platform}-${runtimeId.replace(/\./g, '-')}`;
  }

  log.debug(`Creating simulator with name '${name}', device type id '${deviceTypeId}' and runtime id '${runtimeId}'`);
  let udid;

  try {
    const out = await simExec('create', 0, [name, deviceTypeId, runtimeId]);
    udid = out.stdout.trim();
  } catch (err) {
    let reason = err.message;

    if (err.stderr) {
      reason = err.stderr.trim();
    }

    log.errorAndThrow(`Could not create simulator with name '${name}', device ` + `type id '${deviceTypeId}' and runtime id '${runtimeId}'. Reason: '${reason}'`);
  }

  let retries = parseInt(timeout / 1000, 10);
  await (0, _asyncbox.retryInterval)(retries, 1000, async () => {
    let devices = await getDevices();

    for (const deviceArr of _lodash.default.values(devices)) {
      for (const device of deviceArr) {
        if (device.udid === udid) {
          if (device.state === 'Creating') {
            throw new Error('Device still being created');
          } else {
            return;
          }
        }
      }
    }
  });
  return udid;
}

async function deleteDevice(udid) {
  await simExec('delete', 0, [udid]);
}

async function eraseDevice(udid, timeout = 1000) {
  let loopFn = async () => {
    await simExec('erase', 10000, [udid]);
  };

  let retries = parseInt(timeout / 200, 10);
  await (0, _asyncbox.retryInterval)(retries, 200, loopFn);
}

async function getDevicesByParsing(platform) {
  const {
    stdout
  } = await simExec('list', 0, ['devices']);
  const deviceSectionRe = _lodash.default.isEmpty(platform) ? new RegExp(`\\-\\-\\s+(\\S+)\\s+(\\S+)\\s+\\-\\-(\\n\\s{4}.+)*`, 'mgi') : new RegExp(`\\-\\-\\s+${_lodash.default.escapeRegExp(platform)}\\s+(\\S+)\\s+\\-\\-(\\n\\s{4}.+)*`, 'mgi');
  const matches = [];
  let match;

  while (match = deviceSectionRe.exec(stdout)) {
    matches.push(match);
  }

  if (_lodash.default.isEmpty(matches)) {
    throw new Error('Could not find device section');
  }

  const lineRe = /([^\s].+) \((\w+-.+\w+)\) \((\w+\s?\w+)\)/;
  const devices = {};

  for (match of matches) {
    const sdk = platform ? match[1] : match[2];
    devices[sdk] = devices[sdk] || [];

    for (const line of match[0].split('\n').slice(1)) {
      if (line.includes('(unavailable, ')) {
        continue;
      }

      const lineMatch = lineRe.exec(line);

      if (!lineMatch) {
        throw new Error(`Could not match line: ${line}`);
      }

      devices[sdk].push({
        name: lineMatch[1],
        udid: lineMatch[2],
        state: lineMatch[3],
        sdk,
        platform: platform || match[1]
      });
    }
  }

  return devices;
}

async function getDevices(forSdk, platform) {
  let devices = {};

  try {
    const {
      stdout
    } = await simExec('list', 0, ['devices', '-j']);
    const versionMatchRe = _lodash.default.isEmpty(platform) ? new RegExp(`^([^\\s-]+)[\\s-](\\S+)`, 'i') : new RegExp(`^${_lodash.default.escapeRegExp(platform)}[\\s-](\\S+)`, 'i');

    for (let [sdkName, entries] of _lodash.default.toPairs(JSON.parse(stdout).devices)) {
      sdkName = sdkName.replace(SIM_RUNTIME_NAME, '');
      const versionMatch = versionMatchRe.exec(sdkName);

      if (!versionMatch) {
        continue;
      }

      const sdk = (platform ? versionMatch[1] : versionMatch[2]).replace('-', '.');
      devices[sdk] = devices[sdk] || [];
      devices[sdk].push(...entries.filter(el => _lodash.default.isUndefined(el.isAvailable) || el.isAvailable).map(el => {
        delete el.availability;
        return (0, _objectSpread2.default)({
          sdk
        }, el, {
          platform: platform || versionMatch[1]
        });
      }));
    }
  } catch (err) {
    log.debug(`Unable to get JSON device list: ${err.stack}`);
    log.debug('Falling back to manual parsing');
    devices = await getDevicesByParsing(platform);
  }

  if (!forSdk) {
    return devices;
  }

  if (devices[forSdk]) {
    return devices[forSdk];
  }

  let errMsg = `'${forSdk}' does not exist in the list of simctl SDKs.`;

  const availableSDKs = _lodash.default.keys(devices);

  errMsg += availableSDKs.length ? ` Only the following Simulator SDK versions are available on your system: ${availableSDKs.join(', ')}` : ` No Simulator SDK versions are available on your system. Please install some via Xcode preferences.`;
  throw new Error(errMsg);
}

async function getRuntimeForPlatformVersion(platformVersion, platform = 'iOS') {
  try {
    const {
      stdout
    } = await simExec('list', 0, ['runtimes']);
    const runtimeRe = new RegExp(`${_lodash.default.escapeRegExp(platform)}\\s+(\\d+\\.\\d+)\\s+\\((\\d+\\.\\d+\\.*\\d*)`, 'i');

    for (const line of stdout.split('\n')) {
      const match = runtimeRe.exec(line);

      if (match && match[1] === platformVersion) {
        return match[2];
      }
    }
  } catch (ign) {}

  return platformVersion;
}

async function getScreenshot(udid) {
  let pathToScreenshotPng = await _appiumSupport.tempDir.path({
    prefix: `screenshot-${udid}`,
    suffix: '.png'
  });
  await simExec('io', 0, [udid, 'screenshot', pathToScreenshotPng]);
  let screenshotImg = await _appiumSupport.fs.readFile(pathToScreenshotPng);
  await _appiumSupport.fs.rimraf(pathToScreenshotPng);
  return screenshotImg.toString('base64');
}

async function setPasteboard(udid, content, encoding = 'utf-8') {
  const pbCopySubprocess = new _teen_process.SubProcess('xcrun', ['simctl', 'pbcopy', udid]);
  await pbCopySubprocess.start(0);
  const exitCodeVerifier = pbCopySubprocess.join();
  const stdin = pbCopySubprocess.proc.stdin;
  stdin.setEncoding(encoding);
  stdin.write(content);
  stdin.end();
  await exitCodeVerifier;
}

async function getPasteboard(udid, encoding = 'utf-8') {
  const args = ['simctl', 'pbpaste', udid];

  try {
    const {
      stdout
    } = await (0, _teen_process.exec)('xcrun', args, {
      timeout: 0,
      encoding
    });
    return stdout;
  } catch (e) {
    if (e.stderr) {
      log.errorAndThrow(`Error running 'xcrun ${args.join(' ')}': ${e.stderr.trim()}`);
    } else {
      log.errorAndThrow(e);
    }
  }
}

async function getDeviceTypes() {
  try {
    const {
      stdout
    } = await simExec('list', 0, ['devicetypes', '-j']);
    const deviceTypes = JSON.parse(stdout.trim());
    return deviceTypes.devicetypes.map(type => type.name);
  } catch (err) {
    let msg = `Unable to get list of device types: ${err.message}`;

    if (err.stderr) {
      msg = `${msg}. Stderr: ${err.stderr}`;
    }

    throw new Error(msg);
  }
}

async function startBootMonitor(udid, opts = {}) {
  const {
    timeout = 240000,
    onWaitingDataMigration,
    onWaitingSystemApp,
    onFinished,
    onError
  } = opts;
  let status = '';
  let isBootingFinished = false;
  let error = null;
  let timeoutHandler = null;
  const bootMonitor = await simSubProcess('bootstatus', 0, [udid]);
  bootMonitor.on('output', (stdout, stderr) => {
    status += stdout || stderr;

    if (stdout) {
      if (stdout.includes('Waiting on Data Migration') && onWaitingDataMigration) {
        onWaitingDataMigration();
      } else if (stdout.includes('Waiting on System App') && onWaitingSystemApp) {
        onWaitingSystemApp();
      }
    }
  });
  bootMonitor.on('exit', (code, signal) => {
    if (timeoutHandler) {
      clearTimeout(timeoutHandler);
    }

    if (code === 0) {
      if (onFinished) {
        onFinished();
      }

      isBootingFinished = true;
    } else {
      status = status || signal;
      error = new Error(status);

      if (onError) {
        onError(error);
      }
    }
  });
  await bootMonitor.start(0);

  const stopMonitor = async () => {
    if (bootMonitor.isRunning) {
      try {
        await bootMonitor.stop();
      } catch (e) {
        log.warn(e.message);
      }
    }
  };

  const timeStarted = process.hrtime();

  if (onFinished) {
    timeoutHandler = setTimeout(stopMonitor, timeout);
  } else {
    try {
      await (0, _asyncbox.waitForCondition)(() => {
        if (error) {
          throw error;
        }

        return isBootingFinished;
      }, {
        waitMs: timeout,
        intervalMs: 500
      });
    } catch (err) {
      await stopMonitor();
      throw new Error(`The simulator ${udid} has failed to finish booting after ${process.hrtime(timeStarted)[0]}s. ` + `Original status: ${status}`);
    }
  }

  return bootMonitor;
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9zaW1jdGwuanMiXSwibmFtZXMiOlsibG9nIiwibG9nZ2VyIiwiZ2V0TG9nZ2VyIiwiQ01ETElORV9UT09MU19DTEFOR19GT1JNQVRfQ0hBTkdFRF9WRVJTSU9OIiwiWENPREVfRk9STUFUX0NIQU5HRURfVkVSU0lPTiIsIlNJTV9SVU5USU1FX05BTUUiLCJTSU1fUlVOVElNRV9OQU1FX1NVRkZJWF9JT1MiLCJERUZBVUxUX0NSRUFURV9TSU1VTEFUT1JfVElNRU9VVCIsInNpbUNvbW1hbmQiLCJjb21tYW5kIiwidGltZW91dCIsImFyZ3MiLCJlbnYiLCJleGVjdXRpbmdGdW5jdGlvbiIsImV4ZWMiLCJsb2dFcnJvcnMiLCJfIiwiZGVmYXVsdHMiLCJtYXBLZXlzIiwidmFsdWUiLCJrZXkiLCJwcm9jZXNzIiwiZSIsInN0ZGVyciIsImVycm9yQW5kVGhyb3ciLCJ0cmltIiwic2ltRXhlYyIsImMiLCJhIiwib2IiLCJzaW1TdWJQcm9jZXNzIiwiU3ViUHJvY2VzcyIsImluc3RhbGxBcHAiLCJ1ZGlkIiwiYXBwUGF0aCIsImJvb3REZXZpY2UiLCJlcnIiLCJtZXNzYWdlIiwiaW5kZXhPZiIsImRlYnVnIiwicmVtb3ZlQXBwIiwiYnVuZGxlSWQiLCJsYXVuY2giLCJ0cmllcyIsInNwYXduIiwiaXNBcnJheSIsInNwYXduU3ViUHJvY2VzcyIsIm9wZW5VcmwiLCJ1cmwiLCJhcHBJbmZvIiwic3Rkb3V0IiwiYWRkTWVkaWEiLCJwYXRoIiwidGVybWluYXRlIiwiZ2V0QXBwQ29udGFpbmVyIiwiY29udGFpbmVyVHlwZSIsInB1c2giLCJzaHV0ZG93biIsImluY2x1ZGVzIiwiY3JlYXRlRGV2aWNlIiwibmFtZSIsImRldmljZVR5cGVJZCIsInJ1bnRpbWVJZCIsIm9wdHMiLCJwbGF0Zm9ybSIsImdldFJ1bnRpbWVGb3JQbGF0Zm9ybVZlcnNpb24iLCJ3YXJuIiwiY2xhbmdWZXJzaW9uIiwiaXNOZXdlcklkRm9ybWF0UmVxdWlyZWQiLCJ1dGlsIiwiY29tcGFyZVZlcnNpb25zIiwieGNvZGVWZXJzaW9uIiwicmVwbGFjZSIsIm91dCIsInJlYXNvbiIsInJldHJpZXMiLCJwYXJzZUludCIsImRldmljZXMiLCJnZXREZXZpY2VzIiwiZGV2aWNlQXJyIiwidmFsdWVzIiwiZGV2aWNlIiwic3RhdGUiLCJFcnJvciIsImRlbGV0ZURldmljZSIsImVyYXNlRGV2aWNlIiwibG9vcEZuIiwiZ2V0RGV2aWNlc0J5UGFyc2luZyIsImRldmljZVNlY3Rpb25SZSIsImlzRW1wdHkiLCJSZWdFeHAiLCJlc2NhcGVSZWdFeHAiLCJtYXRjaGVzIiwibWF0Y2giLCJsaW5lUmUiLCJzZGsiLCJsaW5lIiwic3BsaXQiLCJzbGljZSIsImxpbmVNYXRjaCIsImZvclNkayIsInZlcnNpb25NYXRjaFJlIiwic2RrTmFtZSIsImVudHJpZXMiLCJ0b1BhaXJzIiwiSlNPTiIsInBhcnNlIiwidmVyc2lvbk1hdGNoIiwiZmlsdGVyIiwiZWwiLCJpc1VuZGVmaW5lZCIsImlzQXZhaWxhYmxlIiwibWFwIiwiYXZhaWxhYmlsaXR5Iiwic3RhY2siLCJlcnJNc2ciLCJhdmFpbGFibGVTREtzIiwia2V5cyIsImxlbmd0aCIsImpvaW4iLCJwbGF0Zm9ybVZlcnNpb24iLCJydW50aW1lUmUiLCJpZ24iLCJnZXRTY3JlZW5zaG90IiwicGF0aFRvU2NyZWVuc2hvdFBuZyIsInRlbXBEaXIiLCJwcmVmaXgiLCJzdWZmaXgiLCJzY3JlZW5zaG90SW1nIiwiZnMiLCJyZWFkRmlsZSIsInJpbXJhZiIsInRvU3RyaW5nIiwic2V0UGFzdGVib2FyZCIsImNvbnRlbnQiLCJlbmNvZGluZyIsInBiQ29weVN1YnByb2Nlc3MiLCJzdGFydCIsImV4aXRDb2RlVmVyaWZpZXIiLCJzdGRpbiIsInByb2MiLCJzZXRFbmNvZGluZyIsIndyaXRlIiwiZW5kIiwiZ2V0UGFzdGVib2FyZCIsImdldERldmljZVR5cGVzIiwiZGV2aWNlVHlwZXMiLCJkZXZpY2V0eXBlcyIsInR5cGUiLCJtc2ciLCJzdGFydEJvb3RNb25pdG9yIiwib25XYWl0aW5nRGF0YU1pZ3JhdGlvbiIsIm9uV2FpdGluZ1N5c3RlbUFwcCIsIm9uRmluaXNoZWQiLCJvbkVycm9yIiwic3RhdHVzIiwiaXNCb290aW5nRmluaXNoZWQiLCJlcnJvciIsInRpbWVvdXRIYW5kbGVyIiwiYm9vdE1vbml0b3IiLCJvbiIsImNvZGUiLCJzaWduYWwiLCJjbGVhclRpbWVvdXQiLCJzdG9wTW9uaXRvciIsImlzUnVubmluZyIsInN0b3AiLCJ0aW1lU3RhcnRlZCIsImhydGltZSIsInNldFRpbWVvdXQiLCJ3YWl0TXMiLCJpbnRlcnZhbE1zIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0EsTUFBTUEsR0FBRyxHQUFHQyxzQkFBT0MsU0FBUCxDQUFpQixRQUFqQixDQUFaOztBQUdBLE1BQU1DLDBDQUEwQyxHQUFHLFdBQW5EO0FBQ0EsTUFBTUMsNEJBQTRCLEdBQUcsTUFBckM7QUFFQSxNQUFNQyxnQkFBZ0IsR0FBRyxxQ0FBekI7QUFDQSxNQUFNQywyQkFBMkIsR0FBRyxLQUFwQztBQUNBLE1BQU1DLGdDQUFnQyxHQUFHLEtBQXpDOztBQXVCQSxlQUFlQyxVQUFmLENBQTJCQyxPQUEzQixFQUFvQ0MsT0FBcEMsRUFBNkNDLElBQUksR0FBRyxFQUFwRCxFQUF3REMsR0FBRyxHQUFHLEVBQTlELEVBQWtFQyxpQkFBaUIsR0FBR0Msa0JBQXRGLEVBQTRGQyxTQUFTLEdBQUcsSUFBeEcsRUFBOEc7QUFFNUdKLEVBQUFBLElBQUksR0FBRyxDQUFDLFFBQUQsRUFBV0YsT0FBWCxFQUFvQixHQUFHRSxJQUF2QixDQUFQO0FBR0FDLEVBQUFBLEdBQUcsR0FBR0ksZ0JBQUVDLFFBQUYsQ0FBV0QsZ0JBQUVFLE9BQUYsQ0FBVU4sR0FBVixFQUFlLENBQUNPLEtBQUQsRUFBUUMsR0FBUixLQUFnQjtBQUM5QyxXQUFRLGdCQUFlQSxHQUFJLEVBQTNCO0FBQ0QsR0FGZ0IsQ0FBWCxFQUVGQyxP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QkEsUUFBTUUsV0FBVyxDQUFDdEIsS0FBWixDQUFrQixDQUFsQixDQUFOOztBQUNBLFFBQU0yQixXQUFXLEdBQUcsWUFBWTtBQUM5QixRQUFJTCxXQUFXLENBQUNNLFNBQWhCLEVBQTJCO0FBQ3pCLFVBQUk7QUFDRixjQUFNTixXQUFXLENBQUNPLElBQVosRUFBTjtBQUNELE9BRkQsQ0FFRSxPQUFPaEosQ0FBUCxFQUFVO0FBQ1Z0QixRQUFBQSxHQUFHLENBQUNrRSxJQUFKLENBQVM1QyxDQUFDLENBQUNlLE9BQVg7QUFDRDtBQUNGO0FBQ0YsR0FSRDs7QUFTQSxRQUFNa0ksV0FBVyxHQUFHbEosT0FBTyxDQUFDbUosTUFBUixFQUFwQjs7QUFDQSxNQUFJZixVQUFKLEVBQWdCO0FBQ2RLLElBQUFBLGNBQWMsR0FBR1csVUFBVSxDQUFDTCxXQUFELEVBQWMxSixPQUFkLENBQTNCO0FBQ0QsR0FGRCxNQUVPO0FBQ0wsUUFBSTtBQUNGLFlBQU0sZ0NBQWlCLE1BQU07QUFDM0IsWUFBSW1KLEtBQUosRUFBVztBQUNULGdCQUFNQSxLQUFOO0FBQ0Q7O0FBQ0QsZUFBT0QsaUJBQVA7QUFDRCxPQUxLLEVBS0g7QUFBQ2MsUUFBQUEsTUFBTSxFQUFFaEssT0FBVDtBQUFrQmlLLFFBQUFBLFVBQVUsRUFBRTtBQUE5QixPQUxHLENBQU47QUFNRCxLQVBELENBT0UsT0FBT3ZJLEdBQVAsRUFBWTtBQUNaLFlBQU1nSSxXQUFXLEVBQWpCO0FBQ0EsWUFBTSxJQUFJakYsS0FBSixDQUFXLGlCQUFnQmxELElBQUssdUNBQXNDWixPQUFPLENBQUNtSixNQUFSLENBQWVELFdBQWYsRUFBNEIsQ0FBNUIsQ0FBK0IsS0FBM0YsR0FDYixvQkFBbUJaLE1BQU8sRUFEdkIsQ0FBTjtBQUVEO0FBQ0Y7O0FBQ0QsU0FBT0ksV0FBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXhlYywgU3ViUHJvY2VzcyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgeyByZXRyeUludGVydmFsLCB3YWl0Rm9yQ29uZGl0aW9uIH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IHsgbG9nZ2VyLCBmcywgdGVtcERpciwgdXRpbCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBnZXRDbGFuZ1ZlcnNpb24sIGdldFZlcnNpb24gfSBmcm9tICdhcHBpdW0teGNvZGUnO1xuXG5cbmNvbnN0IGxvZyA9IGxvZ2dlci5nZXRMb2dnZXIoJ3NpbWN0bCcpO1xuXG4vLyBjb21tYW5kIGxpbmUgdG9vbHMgYW5kIHhjb2RlIHZlcnNpb24gY2FuIGJlIGRpZmZlcmVudFxuY29uc3QgQ01ETElORV9UT09MU19DTEFOR19GT1JNQVRfQ0hBTkdFRF9WRVJTSU9OID0gJzEwMDEuMC40Nic7XG5jb25zdCBYQ09ERV9GT1JNQVRfQ0hBTkdFRF9WRVJTSU9OID0gJzEwLjInO1xuXG5jb25zdCBTSU1fUlVOVElNRV9OQU1FID0gJ2NvbS5hcHBsZS5Db3JlU2ltdWxhdG9yLlNpbVJ1bnRpbWUuJztcbmNvbnN0IFNJTV9SVU5USU1FX05BTUVfU1VGRklYX0lPUyA9ICdpT1MnO1xuY29uc3QgREVGQVVMVF9DUkVBVEVfU0lNVUxBVE9SX1RJTUVPVVQgPSAxMDAwMDtcblxuLyoqXG4gKiBFeGVjdXRlIHRoZSBwYXJ0aWN1bGFyIHNpbWN0bCBjb21tYW5kIGFuZCByZXR1cm4gdGhlIG91dHB1dC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gY29tbWFuZCAtIE9uZSBvZiBhdmFpbGFibGUgc2ltY3RsIHN1YmNvbW1hbmRzLlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICBFeGVjdXRlIGB4Y3J1biBzaW1jdGxgIGluIFRlcm1pbmFsIHRvIHNlZSB0aGUgZnVsbCBsaXN0XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mIGF2YWlsYWJsZSBzdWJjb21tYW5kcy5cbiAqIEBwYXJhbSB7bnVtYmVyfSB0aW1lb3V0IC0gQ29tbWFuZCBleGVjdXRpb24gdGltZW91dCBpbiBtaWxsaXNlY29uZHMuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgIFNldCBpdCB0byB6ZXJvIHRvIHNraXAgd2FpdGluZyBmb3IgY29tbWFuZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICBleGVjdXRpb24uXG4gKiBAcGFyYW0ge0FycmF5LjxzdHJpbmc+fSBhcmdzIFtbXV0gLSBUaGUgbGlzdCBvZiBhZGRpdGlvbmFsIHN1YmNvbW1hbmQgYXJndW1lbnRzLlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSXQncyBlbXB0eSBieSBkZWZhdWx0LlxuICogQHBhcmFtIHtPYmplY3R9IGVudiBbe31dIC0gRW52aXJvbm1lbnQgdmFyaWFibGVzIG1hcHBpbmcuIEFsbCB0aGVzZSB2YXJpYWJsZXNcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbGwgYmUgcGFzc2VkIFNpbXVsYXRvciBhbmQgdXNlZCBpbiBfZXhlY3V0aW5nRnVuY3Rpb25fLlxuICogQHBhcmFtIHtGdW5jdGlvbn0gZXhlY3V0aW5nRnVuY3Rpb24gLSBFeGVjdXRpbmcgZnVuY3Rpb24gb2JqZWN0LiBFcXVhbHMgdG8gdGVlbl9wcm9jZXNzJ3NcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2V4ZWNfIGJ5IGRlZmF1bHQuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGxvZ0Vycm9ycyBbdHJ1ZV0gLSBTZXQgaXQgdG8gX2ZhbHNlXyB0byB0aHJvdyBleGVjdXRpb24gZXJyb3JzXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbW1lZGlhdGVseSB3aXRob3V0IGxvZ2dpbmcgYW55IGFkZGl0aW9uYWwgaW5mb3JtYXRpb24uXG4gKiBAcmV0dXJuIHtPYmplY3R9IFRoZSByZXN1bHQgb2YgX2V4ZWN1dGluZ0Z1bmN0aW9uXy5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZCBleGVjdXRlZCBieSBfZXhlY3V0aW5nRnVuY3Rpb25fXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2ltQ29tbWFuZCAoY29tbWFuZCwgdGltZW91dCwgYXJncyA9IFtdLCBlbnYgPSB7fSwgZXhlY3V0aW5nRnVuY3Rpb24gPSBleGVjLCBsb2dFcnJvcnMgPSB0cnVlKSB7XG4gIC8vIHJ1biBhIHBhcnRpY3VsYXIgc2ltY3RsIGNvbW1hbmRcbiAgYXJncyA9IFsnc2ltY3RsJywgY29tbWFuZCwgLi4uYXJnc107XG4gIC8vIFByZWZpeCBhbGwgcGFzc2VkIGluIGVudmlyb25tZW50IHZhcmlhYmxlcyB3aXRoICdTSU1DVExfQ0hJTERfJywgc2ltY3RsXG4gIC8vIHdpbGwgdGhlbiBwYXNzIHRoZXNlIHRvIHRoZSBjaGlsZCAoc3Bhd25lZCkgcHJvY2Vzcy5cbiAgZW52ID0gXy5kZWZhdWx0cyhfLm1hcEtleXMoZW52LCAodmFsdWUsIGtleSkgPT4ge1xuICAgIHJldHVybiBgU0lNQ1RMX0NISUxEXyR7a2V5fWA7XG4gIH0pLCBwcm9jZXNzLmVudik7XG5cbiAgdHJ5IHtcbiAgICByZXR1cm4gYXdhaXQgZXhlY3V0aW5nRnVuY3Rpb24oJ3hjcnVuJywgYXJncywge3RpbWVvdXQsIGVudn0pO1xuICB9IGNhdGNoIChlKSB7XG4gICAgaWYgKCFsb2dFcnJvcnMpIHtcbiAgICAgIC8vIGlmIHdlIGRvbid0IHdhbnQgdG8gc2VlIHRoZSBlcnJvcnMsIGp1c3QgdGhyb3cgYW5kIGFsbG93IHRoZSBjYWxsaW5nXG4gICAgICAvLyBjb2RlIGRvIHdoYXQgaXQgd2FudHNcbiAgICAgIHRocm93IGU7XG4gICAgfSBlbHNlIGlmIChlLnN0ZGVycikge1xuICAgICAgbG9nLmVycm9yQW5kVGhyb3coYHNpbWN0bCBlcnJvciBydW5uaW5nICcke2NvbW1hbmR9JzogJHtlLnN0ZGVyci50cmltKCl9YCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZy5lcnJvckFuZFRocm93KGUpO1xuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IEV4ZWNSZXN1bHRcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gc3Rkb3V0IC0gUHJvY2VzcyBzdGRvdXQuXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHN0ZGVyciAtIFByb2Nlc3Mgc3RkZXJyLlxuICogQHByb3BlcnR5IHtudW1iZXJ9IGNvZGUgLSBQcm9jZXNzIGV4aXQgY29kZS5cbiAqL1xuXG4vKipcbiAqIEV4ZWN1dGUgdGhlIHBhcnRpY3VsYXIgc2ltY3RsIHN1YmNvbW1hbmQgc3luY2hyb25vdXNseSBhbmRcbiAqIHdhaXQgZm9yIHRoZSBvdXRwdXQuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGNvbW1hbmQgLSBTZWUge0BsaW5rIHNpbUNvbW1hbmR9IHBhcmFtZXRlcnMuXG4gKiBAcGFyYW0ge251bWJlcn0gdGltZW91dCAtIFNlZSB7QGxpbmsgc2ltQ29tbWFuZH0gcGFyYW1ldGVycy5cbiAqIEBwYXJhbSB7QXJyYXkuPHN0cmluZz59IGFyZ3MgW1tdXSAtIFNlZSB7QGxpbmsgc2ltQ29tbWFuZH0gcGFyYW1ldGVycy5cbiAqIEBwYXJhbSB7T2JqZWN0fSBlbnYgW3t9XSAtIFNlZSB7QGxpbmsgc2ltQ29tbWFuZH0gcGFyYW1ldGVycy5cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gbG9nRXJyb3JzIFt0cnVlXSAtIFNlZSB7QGxpbmsgc2ltQ29tbWFuZH0gcGFyYW1ldGVycy5cbiAqIEByZXR1cm4ge0V4ZWNSZXN1bHR9IFRoZSByZXN1bHQgb2YgX2V4ZWNfIGZ1bmN0aW9uLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBzaW1jdGwgc3ViY29tbWFuZCBjb21tYW5kIGV4ZWN1dGVkIGJ5IGV4ZWNcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBzaW1FeGVjIChjb21tYW5kLCB0aW1lb3V0LCBhcmdzID0gW10sIGVudiA9IHt9LCBsb2dFcnJvcnMgPSB0cnVlKSB7XG4gIHJldHVybiBhd2FpdCBzaW1Db21tYW5kKGNvbW1hbmQsIHRpbWVvdXQsIGFyZ3MsIGVudiwgYXN5bmMgKGMsIGEsIG9iKSA9PiB7XG4gICAgcmV0dXJuIGF3YWl0IGV4ZWMoYywgYSwgb2IpO1xuICB9LCBsb2dFcnJvcnMpO1xufVxuXG4vKipcbiAqIENyYXRlIGEgdGVlbl9wcm9jZXNzJ3MgU3ViUHJvY2VzcyBpbnN0YW5jZSBmb3IgdGhlIHBhcnRpY3VsYXJcbiAqIHNpbWN0bCBzdWJjb21tYW5kIGV4ZWN1dGlvbi4gVGhpcyBtaWdodCBiZSBuZWVkZWQgdG8gZ2FpbiBiZXR0ZXJcbiAqIGNvbnRyb2wgb3ZlciB0aGUgZXhlY3V0aW9uIHByb2Nlc3MuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGNvbW1hbmQgLSBTZWUge0BsaW5rIHNpbUNvbW1hbmR9IHBhcmFtZXRlcnMuXG4gKiBAcGFyYW0ge251bWJlcn0gdGltZW91dCAtIFNlZSB7QGxpbmsgc2ltQ29tbWFuZH0gcGFyYW1ldGVycy5cbiAqIEBwYXJhbSB7QXJyYXkuPHN0cmluZz59IGFyZ3MgW1tdXSAtIFNlZSB7QGxpbmsgc2ltQ29tbWFuZH0gcGFyYW1ldGVycy5cbiAqIEBwYXJhbSB7T2JqZWN0fSBlbnYgW3t9XSAtIFNlZSB7QGxpbmsgc2ltQ29tbWFuZH0gcGFyYW1ldGVycy5cbiAqIEByZXR1cm4ge1N1YlByb2Nlc3N9IFRoZSBpbnN0YW5jZSBvZiB0ZWVuX3Byb2Nlc3MncyBTdWJQcm9jZXNzIGNsYXNzLlxuICovXG5hc3luYyBmdW5jdGlvbiBzaW1TdWJQcm9jZXNzIChjb21tYW5kLCB0aW1lb3V0LCBhcmdzID0gW10sIGVudiA9IHt9KSB7XG4gIHJldHVybiBhd2FpdCBzaW1Db21tYW5kKGNvbW1hbmQsIHRpbWVvdXQsIGFyZ3MsIGVudiwgKGMsIGEsIG9iKSA9PiB7XG4gICAgcmV0dXJuIG5ldyBTdWJQcm9jZXNzKGMsIGEsIG9iKTtcbiAgfSk7XG59XG5cbi8qKlxuICogSW5zdGFsbCB0aGUgcGFydGljdWxhciBhcHBsaWNhdGlvbiBwYWNrYWdlIG9uIFNpbXVsYXRvci5cbiAqIEl0IGlzIHJlcXVpcmVkIHRoYXQgU2ltdWxhdG9yIGlzIGluIF9ib290ZWRfIHN0YXRlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHBhcmFtIHtzdHJpbmd9IGFwcFBhdGggLSBGdWxsIHBhdGggdG8gLmFwcCBwYWNrYWdlLCB3aGljaCBpc1xuICogICAgICAgICAgICAgICAgICAgICAgICAgICBnb2luZyB0byBiZSBpbnN0YWxsZWQuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNvcnJlc3BvbmRpbmcgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZFxuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGluc3RhbGxBcHAgKHVkaWQsIGFwcFBhdGgpIHtcbiAgYXdhaXQgc2ltRXhlYygnaW5zdGFsbCcsIDAsIFt1ZGlkLCBhcHBQYXRoXSk7XG59XG5cbi8qKlxuICogQm9vdCB0aGUgcGFydGljdWxhciBTaW11bGF0b3IgaWYgaXQgaXMgbm90IHJ1bm5pbmcuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgLSBUaGUgVURJRCBvZiBhbiBleGlzdGluZyBTaW11bGF0b3IuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNvcnJlc3BvbmRpbmcgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZFxuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGJvb3REZXZpY2UgKHVkaWQpIHtcbiAgdHJ5IHtcbiAgICBhd2FpdCBzaW1FeGVjKCdib290JywgMCwgW3VkaWRdKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgaWYgKChlcnIubWVzc2FnZSB8fCAnJykuaW5kZXhPZignVW5hYmxlIHRvIGJvb3QgZGV2aWNlIGluIGN1cnJlbnQgc3RhdGU6IEJvb3RlZCcpID09PSAtMSkge1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgICBsb2cuZGVidWcoYFNpbXVsYXRvciBhbHJlYWR5IGluICdCb290ZWQnIHN0YXRlLiBDb250aW51aW5nYCk7XG4gIH1cbn1cblxuLyoqXG4gKiBSZW1vdmUgdGhlIHBhcnRpY3VsYXIgYXBwbGljYXRpb24gcGFja2FnZSBmcm9tIFNpbXVsYXRvci5cbiAqIEl0IGlzIHJlcXVpcmVkIHRoYXQgU2ltdWxhdG9yIGlzIGluIF9ib290ZWRfIHN0YXRlIGFuZFxuICogdGhlIGFwcGxpY2F0aW9uIHdpdGggZ2l2ZW4gYnVuZGxlIGlkZW50aWZpZXIgaXMgYWxyZWFkeSBpbnN0YWxsZWQuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgLSBUaGUgVURJRCBvZiBhbiBleGlzdGluZyBTaW11bGF0b3IuXG4gKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSWQgLSBCdW5kbGUgaWRlbnRpZmllciBvZiB0aGUgYXBwbGljYXRpb24sXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGljaCBpcyBnb2luZyB0byBiZSByZW1vdmVkLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiByZW1vdmVBcHAgKHVkaWQsIGJ1bmRsZUlkKSB7XG4gIGF3YWl0IHNpbUV4ZWMoJ3VuaW5zdGFsbCcsIDAsIFt1ZGlkLCBidW5kbGVJZF0pO1xufVxuXG4vKipcbiAqIEV4ZWN1dGUgdGhlIHBhcnRpY3VsYXIgYXBwbGljYXRpb24gcGFja2FnZSBvbiBTaW11bGF0b3IuXG4gKiBJdCBpcyByZXF1aXJlZCB0aGF0IFNpbXVsYXRvciBpcyBpbiBfYm9vdGVkXyBzdGF0ZSBhbmRcbiAqIHRoZSBhcHBsaWNhdGlvbiB3aXRoIGdpdmVuIGJ1bmRsZSBpZGVudGlmaWVyIGlzIGFscmVhZHkgaW5zdGFsbGVkLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gQnVuZGxlIGlkZW50aWZpZXIgb2YgdGhlIGFwcGxpY2F0aW9uLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpY2ggaXMgZ29pbmcgdG8gYmUgcmVtb3ZlZC5cbiAqIEBwYXJhbSB7bnVtYmVyfSB0cmllcyBbNV0gLSBUaGUgbWF4aW11bSBudW1iZXIgb2YgcmV0cmllcyBiZWZvcmVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvd2luZyBhbiBleGNlcHRpb24uXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNvcnJlc3BvbmRpbmcgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZFxuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGxhdW5jaCAodWRpZCwgYnVuZGxlSWQsIHRyaWVzID0gNSkge1xuICBhd2FpdCByZXRyeUludGVydmFsKHRyaWVzLCAxMDAwLCBhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgc2ltRXhlYygnbGF1bmNoJywgMCwgW3VkaWQsIGJ1bmRsZUlkXSk7XG4gIH0pO1xufVxuXG4vKipcbiAqIFNwYXduIHRoZSBwYXJ0aWN1bGFyIHByb2Nlc3Mgb24gU2ltdWxhdG9yLlxuICogSXQgaXMgcmVxdWlyZWQgdGhhdCBTaW11bGF0b3IgaXMgaW4gX2Jvb3RlZF8gc3RhdGUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgLSBUaGUgVURJRCBvZiBhbiBleGlzdGluZyBTaW11bGF0b3IuXG4gKiBAcGFyYW0ge3N0cmluZ3xBcnJheTxzdHJpbmc+fSBhcmdzIC0gU3Bhd24gYXJndW1lbnRzXG4gKiBAcGFyYW0ge29iamVjdH0gZW52IFt7fV0gLSBBZGRpdGlvbmFsIGVudmlyb25tZW50IHZhcmlhYmxlcyBtYXBwaW5nLlxuICogQHJldHVybiB7RXhlY1Jlc3VsdH0gQ29tbWFuZCBleGVjdXRpb24gcmVzdWx0LlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBzcGF3biAodWRpZCwgYXJncywgZW52ID0ge30pIHtcbiAgcmV0dXJuIGF3YWl0IHNpbUV4ZWMoJ3NwYXduJywgMCwgW3VkaWQsIC4uLihfLmlzQXJyYXkoYXJncykgPyBhcmdzIDogW2FyZ3NdKV0sIGVudik7XG59XG5cbi8qKlxuICogUHJlcGFyZSBTdWJQcm9jZXNzIGluc3RhbmNlIGZvciBhIG5ldyBwcm9jZXNzLCB3aGljaCBpcyBnb2luZyB0byBiZSBzcGF3bmVkXG4gKiBvbiBTaW11bGF0b3IuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgLSBUaGUgVURJRCBvZiBhbiBleGlzdGluZyBTaW11bGF0b3IuXG4gKiBAcGFyYW0ge3N0cmluZ3xBcnJheTxzdHJpbmc+fSBhcmdzIC0gU3Bhd24gYXJndW1lbnRzXG4gKiBAcGFyYW0ge29iamVjdH0gZW52IFt7fV0gLSBBZGRpdGlvbmFsIGVudmlyb25tZW50IHZhcmlhYmxlcyBtYXBwaW5nLlxuICogQHJldHVybiB7U3ViUHJvY2Vzc30gVGhlIGluc3RhbmNlIG9mIHRoZSBwcm9jZXNzIHRvIGJlIHNwYXduZWQuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHNwYXduU3ViUHJvY2VzcyAodWRpZCwgYXJncywgZW52ID0ge30pIHtcbiAgcmV0dXJuIGF3YWl0IHNpbVN1YlByb2Nlc3MoJ3NwYXduJywgMCwgW3VkaWQsIC4uLihfLmlzQXJyYXkoYXJncykgPyBhcmdzIDogW2FyZ3NdKV0sIGVudik7XG59XG5cbi8qKlxuICogT3BlbiBVUkwgc2NoZW1lIG9uIFNpbXVsYXRvci4gaU9TIHdpbGwgYXV0b21hdGljYWxseSB0cnlcbiAqIHRvIGZpbmQgYSBtYXRjaGluZyBhcHBsaWNhdGlvbiwgd2hpY2ggc3VwcG9ydHMgdGhlIGdpdmVuIHNjaGVtZS5cbiAqIEl0IGlzIHJlcXVpcmVkIHRoYXQgU2ltdWxhdG9yIGlzIGluIF9ib290ZWRfIHN0YXRlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHBhcmFtIHtzdHJpbmd9IHVybCAtIFRoZSBVUkwgc2NoZW1lIHRvIG9wZW4sIGZvciBleGFtcGxlIGh0dHA6Ly9hcHBpb20uaW9cbiAqICAgICAgICAgICAgICAgICAgICAgICB3aWxsIGJlIG9wZW5lZCBieSB0aGUgYnVpbHQtaW4gbW9iaWxlIGJyb3dzZXIuXG4gKiBAcmV0dXJuIHtFeGVjUmVzdWx0fSBDb21tYW5kIGV4ZWN1dGlvbiByZXN1bHQuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNvcnJlc3BvbmRpbmcgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZFxuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIG9wZW5VcmwgKHVkaWQsIHVybCkge1xuICByZXR1cm4gYXdhaXQgc2ltRXhlYygnb3BlbnVybCcsIDAsIFt1ZGlkLCB1cmxdKTtcbn1cblxuLyoqXG4gKiBJbnZva2UgaGlkZGVuIGFwcGluZm8gc3ViY29tbWFuZCB0byBnZXQgdGhlIGluZm9ybWF0aW9uXG4gKiBhYm91dCBhcHBsaWNhdGlvbnMgaW5zdGFsbGVkIG9uIFNpbXVsYXRvciwgaW5jbHVkaW5nXG4gKiBzeXN0ZW0gYXBwbGljYXRpb25zICh7QGxpbmsgZ2V0QXBwQ29udGFpbmVyfSBkb2VzIG5vdCBcInNlZVwiIHN1Y2ggYXBwcykuXG4gKiBTaW11bGF0b3Igc2VydmVyIHNob3VsZCBiZSBpbiAnYm9vdGVkJyBzdGF0ZSBmb3IgdGhpcyBjYWxsIHRvIHdvcmsgcHJvcGVybHkuXG4gKiBUaGUgdG9vbCBpcyBvbmx5IGF2YWlsYWJsZSBzaW5jZSBYY29kZSBTREsgOC4xXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgLSBVRElEIG9mIHRoZSB0YXJnZXQgU2ltdWxhdG9yLlxuICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gVGhlIGJ1bmRsZSBpZGVudGlmaWVyIG9mIHRoZSB0YXJnZXQgYXBwbGljYXRpb24uXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBpbmZvcm1hdGlvbiBhYm91dCBpbnN0YWxsZWQgYXBwbGljYXRpb24uXG4gKlxuICogRXhhbXBsZSBvdXRwdXQgZm9yIG5vbi1leGlzdGluZyBhcHBsaWNhdGlvbiBjb250YWluZXI6XG4gKiA8cHJlPlxuICoge1xuICogICBDRkJ1bmRsZUlkZW50aWZpZXIgPSBcImNvbS5hcHBsZS5Nb2JpbGVTYWZhcmlcIjtcbiAqICAgR3JvdXBDb250YWluZXJzID0gICAgIHtcbiAqICAgfTtcbiAqICAgU0JBcHBUYWdzID0gICAgIChcbiAqICAgKTtcbiAqIH1cbiAqIDwvcHJlPlxuICpcbiAqIEV4YW1wbGUgb3V0cHV0IGZvciBhbiBleGlzdGluZyBzeXN0ZW0gYXBwbGljYXRpb24gY29udGFpbmVyOlxuICogPHByZT5cbiAqIHtcbiAqICAgQXBwbGljYXRpb25UeXBlID0gSGlkZGVuO1xuICogICBCdW5kbGUgPSBcImZpbGU6Ly8vQXBwbGljYXRpb25zL1hjb2RlLWJldGEuYXBwL0NvbnRlbnRzL0RldmVsb3Blci9QbGF0Zm9ybXMvaVBob25lT1MucGxhdGZvcm0vRGV2ZWxvcGVyL0xpYnJhcnkvQ29yZVNpbXVsYXRvci9Qcm9maWxlcy9SdW50aW1lcy9pT1Muc2ltcnVudGltZS9Db250ZW50cy9SZXNvdXJjZXMvUnVudGltZVJvb3QvU3lzdGVtL0xpYnJhcnkvQ29yZVNlcnZpY2VzL1NwcmluZ0JvYXJkLmFwcFwiO1xuICogICBDRkJ1bmRsZURpc3BsYXlOYW1lID0gU3ByaW5nQm9hcmQ7XG4gKiAgIENGQnVuZGxlRXhlY3V0YWJsZSA9IFNwcmluZ0JvYXJkO1xuICogICBDRkJ1bmRsZUlkZW50aWZpZXIgPSBcImNvbS5hcHBsZS5zcHJpbmdib2FyZFwiO1xuICogICBDRkJ1bmRsZU5hbWUgPSBTcHJpbmdCb2FyZDtcbiAqICAgQ0ZCdW5kbGVWZXJzaW9uID0gNTA7XG4gKiAgIEdyb3VwQ29udGFpbmVycyA9ICAgICB7XG4gKiAgIH07XG4gKiAgIFBhdGggPSBcIi9BcHBsaWNhdGlvbnMvWGNvZGUtYmV0YS5hcHAvQ29udGVudHMvRGV2ZWxvcGVyL1BsYXRmb3Jtcy9pUGhvbmVPUy5wbGF0Zm9ybS9EZXZlbG9wZXIvTGlicmFyeS9Db3JlU2ltdWxhdG9yL1Byb2ZpbGVzL1J1bnRpbWVzL2lPUy5zaW1ydW50aW1lL0NvbnRlbnRzL1Jlc291cmNlcy9SdW50aW1lUm9vdC9TeXN0ZW0vTGlicmFyeS9Db3JlU2VydmljZXMvU3ByaW5nQm9hcmQuYXBwXCI7XG4gKiAgIFNCQXBwVGFncyA9ICAgICAoXG4gKiAgICk7XG4gKiB9XG4gKiA8L3ByZT5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gYXBwSW5mbyAodWRpZCwgYnVuZGxlSWQpIHtcbiAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBzaW1FeGVjKCdhcHBpbmZvJywgMCwgW3VkaWQsIGJ1bmRsZUlkXSk7XG4gIHJldHVybiAoc3Rkb3V0IHx8ICcnKS50cmltKCk7XG59XG5cbi8qKlxuICogQWRkIHRoZSBwYXJ0aWN1bGFyIG1lZGlhIGZpbGUgdG8gU2ltdWxhdG9yJ3MgbGlicmFyeS5cbiAqIEl0IGlzIHJlcXVpcmVkIHRoYXQgU2ltdWxhdG9yIGlzIGluIF9ib290ZWRfIHN0YXRlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHBhcmFtIHtzdHJpbmd9IHBhdGggLSBGdWxsIHBhdGggdG8gYSBtZWRpYSBmaWxlIG9uIHRoZSBsb2NhbFxuICogICAgICAgICAgICAgICAgICAgICAgICBmaWxlIHN5c3RlbS5cbiAqIEByZXR1cm4ge0V4ZWNSZXN1bHR9IENvbW1hbmQgZXhlY3V0aW9uIHJlc3VsdC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgc3ViY29tbWFuZCBjb21tYW5kXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gYWRkTWVkaWEgKHVkaWQsIHBhdGgpIHtcbiAgcmV0dXJuIGF3YWl0IHNpbUV4ZWMoJ2FkZG1lZGlhJywgMCwgW3VkaWQsIHBhdGhdKTtcbn1cblxuLyoqXG4gKiBUZXJtaW5hdGUgdGhlIGdpdmVuIHJ1bm5pbmcgYXBwbGljYXRpb24gb24gU2ltdWxhdG9yLlxuICogSXQgaXMgcmVxdWlyZWQgdGhhdCBTaW11bGF0b3IgaXMgaW4gX2Jvb3RlZF8gc3RhdGUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgLSBUaGUgVURJRCBvZiBhbiBleGlzdGluZyBTaW11bGF0b3IuXG4gKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSWQgLSBCdW5kbGUgaWRlbnRpZmllciBvZiB0aGUgYXBwbGljYXRpb24sXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGljaCBpcyBnb2luZyB0byBiZSB0ZXJtaW5hdGVkLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiB0ZXJtaW5hdGUgKHVkaWQsIGJ1bmRsZUlkKSB7XG4gIGF3YWl0IHNpbUV4ZWMoJ3Rlcm1pbmF0ZScsIDAsIFt1ZGlkLCBidW5kbGVJZF0pO1xufVxuXG4vKipcbiAqIEdldCB0aGUgZnVsbCBwYXRoIHRvIHRoZSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uIGNvbnRhaW5lclxuICogb24gdGhlIGxvY2FsIGZpbGUgc3lzdGVtLiBOb3RlLCB0aGF0IHRoaXMgc3ViY29tbWFuZCB0aHJvd3NcbiAqIGFuIGVycm9yIGlmIGJ1bmRsZSBpZCBvZiBhIHN5c3RlbSBhcHBsaWNhdGlvbiBpcyBwcm92aWRlZCxcbiAqIGxpa2UgJ2NvbS5hcHBsZS5zcHJpbmdib2FyZCcuXG4gKiBJdCBpcyByZXF1aXJlZCB0aGF0IFNpbXVsYXRvciBpcyBpbiBfYm9vdGVkXyBzdGF0ZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIFRoZSBVRElEIG9mIGFuIGV4aXN0aW5nIFNpbXVsYXRvci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIEJ1bmRsZSBpZGVudGlmaWVyIG9mIGFuIGFwcGxpY2F0aW9uLlxuICogQHBhcmFtIHs/Ym9vbGVhbn0gbG9nRXJyb3JzIFt0cnVlXSAtIFdoZXRoZXIgdG8gaW5jbHVkZSBleGVjJ3MgY29tbWFuZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZGVyciBvdXRwdXQgaW50byBleGNlcHRpb24gbWVzc2FnZSBpZiB0aHJvd24uXG4gKiBAcGFyYW0gez9zdHJpbmd9IGNvbnRhaW5lclR5cGUgLSBXaGljaCBjb250YWluZXIgdHlwZSB0byByZXR1cm4uIFBvc3NpYmxlIHZhbHVlc1xuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJlICdhcHAnLCAnZGF0YScsICdncm91cHMnLCAnPEEgc3BlY2lmaWMgQXBwIEdyb3VwIGNvbnRhaW5lcj4nLlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhlIGRlZmF1bHQgdmFsdWUgaXMgJ2FwcCcuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IEZ1bGwgcGF0aCB0byB0aGUgZ2l2ZW4gYXBwbGljYXRpb24gY29udGFpbmVyIG9uIHRoZSBsb2NhbFxuICogICAgICAgICAgICAgICAgICBmaWxlIHN5c3RlbS5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgc3ViY29tbWFuZCBjb21tYW5kXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0QXBwQ29udGFpbmVyICh1ZGlkLCBidW5kbGVJZCwgbG9nRXJyb3JzID0gdHJ1ZSwgY29udGFpbmVyVHlwZSA9IG51bGwpIHtcbiAgY29uc3QgYXJncyA9IFt1ZGlkLCBidW5kbGVJZF07XG4gIGlmIChjb250YWluZXJUeXBlKSB7XG4gICAgYXJncy5wdXNoKGNvbnRhaW5lclR5cGUpO1xuICB9XG4gIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgc2ltRXhlYygnZ2V0X2FwcF9jb250YWluZXInLCAwLCBhcmdzLCB7fSwgbG9nRXJyb3JzKTtcbiAgcmV0dXJuIChzdGRvdXQgfHwgJycpLnRyaW0oKTtcbn1cblxuLyoqXG4gKiBTaHV0ZG93biB0aGUgZ2l2ZW4gU2ltdWxhdG9yIGlmIGl0IGlzIHJ1bm5pbmcuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgLSBUaGUgVURJRCBvZiBhbiBleGlzdGluZyBTaW11bGF0b3IuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNvcnJlc3BvbmRpbmcgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZFxuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHNodXRkb3duICh1ZGlkKSB7XG4gIHRyeSB7XG4gICAgYXdhaXQgc2ltRXhlYygnc2h1dGRvd24nLCAwLCBbdWRpZF0pO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBpZiAoIShlcnIgKyAnJykuaW5jbHVkZXMoJ2N1cnJlbnQgc3RhdGU6IFNodXRkb3duJykpIHtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gICAgbG9nLmRlYnVnKGBTaW11bGF0b3IgYWxyZWFkeSBpbiAnU2h1dGRvd24nIHN0YXRlLiBDb250aW51aW5nYCk7XG4gIH1cbn1cblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBTaW1DcmVhdGlvbk9wdHNcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBwbGF0Zm9ybSBbaU9TXSAtIFBsYXRmb3JtIG5hbWUgaW4gb3JkZXIgdG8gc3BlY2lmeSBydW50aW1lIHN1Y2ggYXMgJ2lPUycsICd0dk9TJywgJ3dhdGNoT1MnXG4gKiBAcHJvcGVydHkge251bWJlcn0gdGltZW91dCBbMTAwMDBdIC0gVGhlIG1heGltdW0gbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5pdCBkZXZpY2UgY3JlYXRpb24gaXMgY29tcGxldGVkLlxuICovXG4vKipcbiAqIENyZWF0ZSBTaW11bGF0b3IgZGV2aWNlIHdpdGggZ2l2ZW4gbmFtZSBmb3IgdGhlIHBhcnRpY3VsYXJcbiAqIHBsYXRmb3JtIHR5cGUgYW5kIHZlcnNpb24uXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgZGV2aWNlIG5hbWUgdG8gYmUgY3JlYXRlZC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBkZXZpY2VUeXBlSWQgLSBEZXZpY2UgdHlwZSwgZm9yIGV4YW1wbGUgJ2lQaG9uZSA2Jy5cbiAqIEBwYXJhbSB7c3RyaW5nfSBydW50aW1lSWQgLSBQbGF0Zm9ybSB2ZXJzaW9uLCBmb3IgZXhhbXBsZSAnMTAuMycuXG4gKiBAcGFyYW0gez9TaW1DcmVhdGlvbk9wdHN9IG9wdHMgLSBTaW11bGF0b3Igb3B0aW9ucyBmb3IgY3JlYXRpbmcgZGV2aWNlcy5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIFVESUQgb2YgdGhlIG5ld2x5IGNyZWF0ZWQgZGV2aWNlLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBjcmVhdGVEZXZpY2UgKG5hbWUsIGRldmljZVR5cGVJZCwgcnVudGltZUlkLCBvcHRzID0ge30pIHtcbiAgY29uc3Qge1xuICAgIHBsYXRmb3JtID0gU0lNX1JVTlRJTUVfTkFNRV9TVUZGSVhfSU9TLFxuICAgIHRpbWVvdXQgPSBERUZBVUxUX0NSRUFURV9TSU1VTEFUT1JfVElNRU9VVFxuICB9ID0gb3B0cztcblxuICAvLyBhdCBmaXJzdCBtYWtlIHN1cmUgdGhhdCB0aGUgcnVudGltZSBpZCBpcyB0aGUgcmlnaHQgb25lXG4gIC8vIGluIHNvbWUgdmVyc2lvbnMgb2YgWGNvZGUgaXQgd2lsbCBiZSBhIHBhdGNoIHZlcnNpb25cbiAgdHJ5IHtcbiAgICBydW50aW1lSWQgPSBhd2FpdCBnZXRSdW50aW1lRm9yUGxhdGZvcm1WZXJzaW9uKHJ1bnRpbWVJZCwgcGxhdGZvcm0pO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2cud2FybihgVW5hYmxlIHRvIGZpbmQgcnVudGltZSBmb3IgaU9TICcke3J1bnRpbWVJZH0nLiBDb250aW51aW5nYCk7XG4gIH1cblxuICBjb25zdCBjbGFuZ1ZlcnNpb24gPSBhd2FpdCBnZXRDbGFuZ1ZlcnNpb24oKTtcbiAgLy8gMXN0IGNvbXBhcmlzb246IGNsYW5nVmVyc2lvblxuICAvLyBDb21tYW5kIGxpbmUgdG9vbHMgdmVyc2lvbiBpcyAxMC4yKywgYnV0IHhjb2RlIDEwLjEgY2FuIGhhcHBlblxuICBsZXQgaXNOZXdlcklkRm9ybWF0UmVxdWlyZWQgPSBjbGFuZ1ZlcnNpb24gJiYgdXRpbC5jb21wYXJlVmVyc2lvbnMoY2xhbmdWZXJzaW9uLCAnPj0nLFxuICAgIENNRExJTkVfVE9PTFNfQ0xBTkdfRk9STUFUX0NIQU5HRURfVkVSU0lPTik7XG4gIGlmICghaXNOZXdlcklkRm9ybWF0UmVxdWlyZWQpIHtcbiAgICAvLyAybmQgY29tcGFyaXNvbjogZ2V0VmVyc2lvblxuICAgIC8vIFRoZSBvcHBvc2l0ZSBjYW4gYWxzbyBoYXBwZW4sXG4gICAgLy8gYnV0IHRoZSBjb21iaW5hdGlvbiBvZiAxMC4yIGNvbW1hbmQgbGluZSB0b29scyBhbmQgbG93ZXIgWGNvZGUgdmVyc2lvbiBoYXBwZW5zIG1vcmUgZnJlcXVlbnRseVxuICAgIGNvbnN0IHhjb2RlVmVyc2lvbiA9IGF3YWl0IGdldFZlcnNpb24oZmFsc2UpO1xuICAgIGlzTmV3ZXJJZEZvcm1hdFJlcXVpcmVkID0geGNvZGVWZXJzaW9uICYmIHV0aWwuY29tcGFyZVZlcnNpb25zKHhjb2RlVmVyc2lvbiwgJz49JyxcbiAgICAgIFhDT0RFX0ZPUk1BVF9DSEFOR0VEX1ZFUlNJT04pO1xuICB9XG4gIGlmIChpc05ld2VySWRGb3JtYXRSZXF1aXJlZCkge1xuICAgIHJ1bnRpbWVJZCA9IGAke1NJTV9SVU5USU1FX05BTUV9JHtwbGF0Zm9ybX0tJHtydW50aW1lSWQucmVwbGFjZSgvXFwuL2csICctJyl9YDtcbiAgfVxuXG4gIGxvZy5kZWJ1ZyhgQ3JlYXRpbmcgc2ltdWxhdG9yIHdpdGggbmFtZSAnJHtuYW1lfScsIGRldmljZSB0eXBlIGlkICcke2RldmljZVR5cGVJZH0nIGFuZCBydW50aW1lIGlkICcke3J1bnRpbWVJZH0nYCk7XG4gIGxldCB1ZGlkO1xuICB0cnkge1xuICAgIGNvbnN0IG91dCA9IGF3YWl0IHNpbUV4ZWMoJ2NyZWF0ZScsIDAsIFtuYW1lLCBkZXZpY2VUeXBlSWQsIHJ1bnRpbWVJZF0pO1xuICAgIHVkaWQgPSBvdXQuc3Rkb3V0LnRyaW0oKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbGV0IHJlYXNvbiA9IGVyci5tZXNzYWdlO1xuICAgIGlmIChlcnIuc3RkZXJyKSB7XG4gICAgICByZWFzb24gPSBlcnIuc3RkZXJyLnRyaW0oKTtcbiAgICB9XG4gICAgbG9nLmVycm9yQW5kVGhyb3coYENvdWxkIG5vdCBjcmVhdGUgc2ltdWxhdG9yIHdpdGggbmFtZSAnJHtuYW1lfScsIGRldmljZSBgICtcbiAgICAgICAgICAgICAgICAgICAgICBgdHlwZSBpZCAnJHtkZXZpY2VUeXBlSWR9JyBhbmQgcnVudGltZSBpZCAnJHtydW50aW1lSWR9Jy4gUmVhc29uOiAnJHtyZWFzb259J2ApO1xuICB9XG5cbiAgLy8gbWFrZSBzdXJlIHRoYXQgaXQgZ2V0cyBvdXQgb2YgdGhlIFwiQ3JlYXRpbmdcIiBzdGF0ZVxuICBsZXQgcmV0cmllcyA9IHBhcnNlSW50KHRpbWVvdXQgLyAxMDAwLCAxMCk7XG4gIGF3YWl0IHJldHJ5SW50ZXJ2YWwocmV0cmllcywgMTAwMCwgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBkZXZpY2VzID0gYXdhaXQgZ2V0RGV2aWNlcygpO1xuICAgIGZvciAoY29uc3QgZGV2aWNlQXJyIG9mIF8udmFsdWVzKGRldmljZXMpKSB7XG4gICAgICBmb3IgKGNvbnN0IGRldmljZSBvZiBkZXZpY2VBcnIpIHtcbiAgICAgICAgaWYgKGRldmljZS51ZGlkID09PSB1ZGlkKSB7XG4gICAgICAgICAgaWYgKGRldmljZS5zdGF0ZSA9PT0gJ0NyZWF0aW5nJykge1xuICAgICAgICAgICAgLy8gbmVlZCB0byByZXRyeVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdEZXZpY2Ugc3RpbGwgYmVpbmcgY3JlYXRlZCcpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBzdG9wIGxvb2tpbmcsIHdlJ3JlIGRvbmVcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiB1ZGlkO1xufVxuXG4vKipcbiAqIERlbGV0ZSB0aGUgcGFydGljdWxhciBTaW11bGF0b3IgZnJvbSBhdmFpbGFibGUgZGV2aWNlcyBsaXN0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBkZWxldGVEZXZpY2UgKHVkaWQpIHtcbiAgYXdhaXQgc2ltRXhlYygnZGVsZXRlJywgMCwgW3VkaWRdKTtcbn1cblxuLyoqXG4gKiBSZXNldCB0aGUgY29udGVudCBhbmQgc2V0dGluZ3Mgb2YgdGhlIHBhcnRpY3VsYXIgU2ltdWxhdG9yLlxuICogSXQgaXMgcmVxdWlyZWQgdGhhdCBTaW11bGF0b3IgaXMgaW4gX3NodXRkb3duXyBzdGF0ZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIFRoZSBVRElEIG9mIGFuIGV4aXN0aW5nIFNpbXVsYXRvci5cbiAqIEBwYXJhbSB7bnVtYmVyfSB0aW1lb3V0IFsxMDAwMF0gLSBUaGUgbWF4aW11bSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bml0IGRldmljZSByZXNldCBpcyBjb21wbGV0ZWQuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNvcnJlc3BvbmRpbmcgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZFxuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGVyYXNlRGV2aWNlICh1ZGlkLCB0aW1lb3V0ID0gMTAwMCkge1xuICBsZXQgbG9vcEZuID0gYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IHNpbUV4ZWMoJ2VyYXNlJywgMTAwMDAsIFt1ZGlkXSk7XG4gIH07XG4gIC8vIHJldHJ5IGVyYXNlIHdpdGggYSBzbGVlcCBpbiBiZXR3ZWVuIGJlY2F1c2UgaXQncyBmbGFrZXlcbiAgbGV0IHJldHJpZXMgPSBwYXJzZUludCh0aW1lb3V0IC8gMjAwLCAxMCk7XG4gIGF3YWl0IHJldHJ5SW50ZXJ2YWwocmV0cmllcywgMjAwLCBsb29wRm4pO1xufVxuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IERldmljZUluZm9cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBuYW1lIC0gVGhlIGRldmljZSBuYW1lLlxuICogQHByb3BlcnR5IHtzdHJpbmd9IHVkaWQgLSBUaGUgZGV2aWNlIFVESUQuXG4gKiBAcHJvcGVydHkge3N0cmluZ30gc3RhdGUgLSBUaGUgY3VycmVudCBTaW11bGF0b3Igc3RhdGUsIGZvciBleGFtcGxlICdib290ZWQnIG9yICdzaHV0ZG93bicuXG4gKiBAcHJvcGVydHkge3N0cmluZ30gc2RrIC0gVGhlIFNESyB2ZXJzaW9uLCBmb3IgZXhhbXBsZSAnMTAuMycuXG4gKi9cblxuLyoqXG4gKiBQYXJzZSB0aGUgbGlzdCBvZiBleGlzdGluZyBTaW11bGF0b3IgZGV2aWNlcyB0byByZXByZXNlbnRcbiAqIGl0IGFzIGNvbnZlbmllbnQgbWFwcGluZy5cbiAqXG4gKiBAcGFyYW0gez9zdHJpbmd9IHBsYXRmb3JtIC0gVGhlIHBsYXRmb3JtIG5hbWUsIGZvciBleGFtcGxlICd3YXRjaE9TJy5cbiAqIEByZXR1cm4ge09iamVjdH0gVGhlIHJlc3VsdGluZyBtYXBwaW5nLiBFYWNoIGtleSBpcyBwbGF0Zm9ybSB2ZXJzaW9uLFxuICogICAgICAgICAgICAgICAgICBmb3IgZXhhbXBsZSAnMTAuMycgYW5kIHRoZSBjb3JyZXNwb25kaW5nIHZhbHVlIGlzIGFuXG4gKiAgICAgICAgICAgICAgICAgIGFycmF5IG9mIHRoZSBtYXRjaGluZyB7QGxpbmsgRGV2aWNlSW5mb30gaW5zdGFuY2VzLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBnZXREZXZpY2VzQnlQYXJzaW5nIChwbGF0Zm9ybSkge1xuICAvLyBnZXQgdGhlIGxpc3Qgb2YgZGV2aWNlc1xuICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IHNpbUV4ZWMoJ2xpc3QnLCAwLCBbJ2RldmljZXMnXSk7XG5cbiAgLy8gZXhwZWN0IHRvIGdldCBhIGxpc3RpbmcgbGlrZVxuICAvLyAtLSBpT1MgOC4xIC0tXG4gIC8vICAgICBpUGhvbmUgNHMgKDNDQTZFN0RELTIyMEUtNDVFNS1CNzE2LTFFOTkyQjNBNDI5QykgKFNodXRkb3duKVxuICAvLyAgICAgLi4uXG4gIC8vIC0tIGlPUyA4LjIgLS1cbiAgLy8gICAgIGlQaG9uZSA0cyAoQTk5RkZGQzMtOEUxOS00RENGLUI1ODUtN0Q5RDQ2QjRDMTZFKSAoU2h1dGRvd24pXG4gIC8vICAgICAuLi5cbiAgLy8gc28sIGdldCB0aGUgYC0tIGlPUyBYLlggLS1gIGxpbmUgdG8gZmluZCB0aGUgc2RrIChYLlgpXG4gIC8vIGFuZCB0aGUgcmVzdCBvZiB0aGUgbGlzdGluZyBpbiBvcmRlciB0byBsYXRlciBmaW5kIHRoZSBkZXZpY2VzXG4gIGNvbnN0IGRldmljZVNlY3Rpb25SZSA9IF8uaXNFbXB0eShwbGF0Zm9ybSlcbiAgICA/IG5ldyBSZWdFeHAoYFxcXFwtXFxcXC1cXFxccysoXFxcXFMrKVxcXFxzKyhcXFxcUyspXFxcXHMrXFxcXC1cXFxcLShcXFxcblxcXFxzezR9LispKmAsICdtZ2knKVxuICAgIDogbmV3IFJlZ0V4cChgXFxcXC1cXFxcLVxcXFxzKyR7Xy5lc2NhcGVSZWdFeHAocGxhdGZvcm0pfVxcXFxzKyhcXFxcUyspXFxcXHMrXFxcXC1cXFxcLShcXFxcblxcXFxzezR9LispKmAsICdtZ2knKTtcbiAgY29uc3QgbWF0Y2hlcyA9IFtdO1xuICBsZXQgbWF0Y2g7XG4gIC8vIG1ha2UgYW4gZW50cnkgZm9yIGVhY2ggc2RrIHZlcnNpb25cbiAgd2hpbGUgKChtYXRjaCA9IGRldmljZVNlY3Rpb25SZS5leGVjKHN0ZG91dCkpKSB7XG4gICAgbWF0Y2hlcy5wdXNoKG1hdGNoKTtcbiAgfVxuICBpZiAoXy5pc0VtcHR5KG1hdGNoZXMpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdDb3VsZCBub3QgZmluZCBkZXZpY2Ugc2VjdGlvbicpO1xuICB9XG5cbiAgY29uc3QgbGluZVJlID0gLyhbXlxcc10uKykgXFwoKFxcdystLitcXHcrKVxcKSBcXCgoXFx3K1xccz9cXHcrKVxcKS87IC8vIGh0dHBzOi8vcmVnZXgxMDEuY29tL3IvbEc3bUs2LzNcbiAgLy8gZ2V0IGFsbCB0aGUgZGV2aWNlcyBmb3IgZWFjaCBzZGtcbiAgY29uc3QgZGV2aWNlcyA9IHt9O1xuICBmb3IgKG1hdGNoIG9mIG1hdGNoZXMpIHtcbiAgICBjb25zdCBzZGsgPSBwbGF0Zm9ybSA/IG1hdGNoWzFdIDogbWF0Y2hbMl07XG4gICAgZGV2aWNlc1tzZGtdID0gZGV2aWNlc1tzZGtdIHx8IFtdO1xuICAgIC8vIHNwbGl0IHRoZSBmdWxsIG1hdGNoIGludG8gbGluZXMgYW5kIHJlbW92ZSB0aGUgZmlyc3RcbiAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbWF0Y2hbMF0uc3BsaXQoJ1xcbicpLnNsaWNlKDEpKSB7XG4gICAgICBpZiAobGluZS5pbmNsdWRlcygnKHVuYXZhaWxhYmxlLCAnKSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIC8vIGEgbGluZSBpcyBzb21ldGhpbmcgbGlrZVxuICAgICAgLy8gICAgaVBob25lIDRzIChBOTlGRkZDMy04RTE5LTREQ0YtQjU4NS03RDlENDZCNEMxNkUpIChTaHV0ZG93bilcbiAgICAgIC8vIHJldHJpZXZlOlxuICAgICAgLy8gICBpUGhvbmUgNHNcbiAgICAgIC8vICAgQTk5RkZGQzMtOEUxOS00RENGLUI1ODUtN0Q5RDQ2QjRDMTZFXG4gICAgICAvLyAgIFNodXRkb3duXG4gICAgICBjb25zdCBsaW5lTWF0Y2ggPSBsaW5lUmUuZXhlYyhsaW5lKTtcbiAgICAgIGlmICghbGluZU1hdGNoKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IG1hdGNoIGxpbmU6ICR7bGluZX1gKTtcbiAgICAgIH1cbiAgICAgIC8vIHNhdmUgdGhlIHdob2xlIHRoaW5nIGFzIGFiIG9iamVjdCBpbiB0aGUgbGlzdCBmb3IgdGhpcyBzZGtcbiAgICAgIGRldmljZXNbc2RrXS5wdXNoKHtcbiAgICAgICAgbmFtZTogbGluZU1hdGNoWzFdLFxuICAgICAgICB1ZGlkOiBsaW5lTWF0Y2hbMl0sXG4gICAgICAgIHN0YXRlOiBsaW5lTWF0Y2hbM10sXG4gICAgICAgIHNkayxcbiAgICAgICAgcGxhdGZvcm06IHBsYXRmb3JtIHx8IG1hdGNoWzFdLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBkZXZpY2VzO1xufVxuXG4vKipcbiAqIFBhcnNlIHRoZSBsaXN0IG9mIGV4aXN0aW5nIFNpbXVsYXRvciBkZXZpY2VzIHRvIHJlcHJlc2VudFxuICogaXQgYXMgY29udmVuaWVudCBtYXBwaW5nIGZvciB0aGUgcGFydGljdWxhciBwbGF0Zm9ybSB2ZXJzaW9uLlxuICpcbiAqIEBwYXJhbSB7P3N0cmluZ30gZm9yU2RrIC0gVGhlIHNkayB2ZXJzaW9uLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICBmb3Igd2hpY2ggdGhlIGRldmljZXMgbGlzdCBzaG91bGQgYmUgcGFyc2VkLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgZXhhbXBsZSAnMTAuMycuXG4gKiBAcGFyYW0gez9zdHJpbmd9IHBsYXRmb3JtIC0gVGhlIHBsYXRmb3JtIG5hbWUsIGZvciBleGFtcGxlICd3YXRjaE9TJy5cbiAqIEByZXR1cm4ge09iamVjdHxBcnJheTxEZXZpY2VJbmZvPn0gSWYgX2ZvclNka18gaXMgc2V0IHRoZW4gdGhlIGxpc3RcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2YgZGV2aWNlcyBmb3IgdGhlIHBhcnRpY3VsYXIgcGxhdGZvcm0gdmVyc2lvbi5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT3RoZXJ3aXNlIHRoZSBzYW1lIHJlc3VsdCBhcyBmb3Ige0BsaW5rIGdldERldmljZXNCeVBhcnNpbmd9XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlIG9yIGlmIG5vIG1hdGNoaW5nXG4gKiAgICAgICAgICAgICAgICAgcGxhdGZvcm0gdmVyc2lvbiBpcyBmb3VuZCBpbiB0aGUgc3lzdGVtLlxuICovXG5hc3luYyBmdW5jdGlvbiBnZXREZXZpY2VzIChmb3JTZGssIHBsYXRmb3JtKSB7XG4gIGxldCBkZXZpY2VzID0ge307XG4gIHRyeSB7XG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBzaW1FeGVjKCdsaXN0JywgMCwgWydkZXZpY2VzJywgJy1qJ10pO1xuICAgIC8qIEpTT04gc2hvdWxkIGJlXG4gICAgICoge1xuICAgICAqICAgXCJkZXZpY2VzXCIgOiB7XG4gICAgICogICAgIFwiaU9TIDxzZGs+XCIgOiBbIC8vIG9yXG4gICAgICogICAgIFwiY29tLmFwcGxlLkNvcmVTaW11bGF0b3IuU2ltUnVudGltZS5pT1MtPHNkaz4gOiBbXG4gICAgICogICAgICAge1xuICAgICAqICAgICAgICAgXCJzdGF0ZVwiIDogXCJCb290ZWRcIixcbiAgICAgKiAgICAgICAgIFwiYXZhaWxhYmlsaXR5XCIgOiBcIihhdmFpbGFibGUpXCIsXG4gICAgICogICAgICAgICBcImlzQXZhaWxhYmxlXCIgOiB0cnVlLFxuICAgICAqICAgICAgICAgXCJuYW1lXCIgOiBcImlQaG9uZSA2XCIsXG4gICAgICogICAgICAgICBcInVkaWRcIiA6IFwiNzVFMzQxNDAtMThFOC00RDFBLTlGNDUtQUFDNzM1REY3NURGXCJcbiAgICAgKiAgICAgICB9XG4gICAgICogICAgIF1cbiAgICAgKiAgIH1cbiAgICAgKiB9XG4gICAgICovXG4gICAgY29uc3QgdmVyc2lvbk1hdGNoUmUgPSBfLmlzRW1wdHkocGxhdGZvcm0pXG4gICAgICA/IG5ldyBSZWdFeHAoYF4oW15cXFxccy1dKylbXFxcXHMtXShcXFxcUyspYCwgJ2knKVxuICAgICAgOiBuZXcgUmVnRXhwKGBeJHtfLmVzY2FwZVJlZ0V4cChwbGF0Zm9ybSl9W1xcXFxzLV0oXFxcXFMrKWAsICdpJyk7XG4gICAgZm9yIChsZXQgW3Nka05hbWUsIGVudHJpZXNdIG9mIF8udG9QYWlycyhKU09OLnBhcnNlKHN0ZG91dCkuZGV2aWNlcykpIHtcbiAgICAgIC8vIHRoZXJlIGNvdWxkIGJlIGEgbG9uZ2VyIG5hbWUsIHNvIHJlbW92ZSBpdFxuICAgICAgc2RrTmFtZSA9IHNka05hbWUucmVwbGFjZShTSU1fUlVOVElNRV9OQU1FLCAnJyk7XG4gICAgICBjb25zdCB2ZXJzaW9uTWF0Y2ggPSB2ZXJzaW9uTWF0Y2hSZS5leGVjKHNka05hbWUpO1xuICAgICAgaWYgKCF2ZXJzaW9uTWF0Y2gpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIC8vIHRoZSBzZGsgY2FuIGhhdmUgZGFzaGVzIChgMTItMmApIG9yIGRvdHMgKGAxMi4xYClcbiAgICAgIGNvbnN0IHNkayA9IChwbGF0Zm9ybSA/IHZlcnNpb25NYXRjaFsxXSA6IHZlcnNpb25NYXRjaFsyXSkucmVwbGFjZSgnLScsICcuJyk7XG4gICAgICBkZXZpY2VzW3Nka10gPSBkZXZpY2VzW3Nka10gfHwgW107XG4gICAgICBkZXZpY2VzW3Nka10ucHVzaCguLi5lbnRyaWVzLmZpbHRlcigoZWwpID0+IF8uaXNVbmRlZmluZWQoZWwuaXNBdmFpbGFibGUpIHx8IGVsLmlzQXZhaWxhYmxlKVxuICAgICAgICAubWFwKChlbCkgPT4ge1xuICAgICAgICAgIGRlbGV0ZSBlbC5hdmFpbGFiaWxpdHk7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNkayxcbiAgICAgICAgICAgIC4uLmVsLFxuICAgICAgICAgICAgcGxhdGZvcm06IHBsYXRmb3JtIHx8IHZlcnNpb25NYXRjaFsxXSxcbiAgICAgICAgICB9O1xuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZy5kZWJ1ZyhgVW5hYmxlIHRvIGdldCBKU09OIGRldmljZSBsaXN0OiAke2Vyci5zdGFja31gKTtcbiAgICBsb2cuZGVidWcoJ0ZhbGxpbmcgYmFjayB0byBtYW51YWwgcGFyc2luZycpO1xuICAgIGRldmljZXMgPSBhd2FpdCBnZXREZXZpY2VzQnlQYXJzaW5nKHBsYXRmb3JtKTtcbiAgfVxuXG4gIGlmICghZm9yU2RrKSB7XG4gICAgcmV0dXJuIGRldmljZXM7XG4gIH1cbiAgLy8gaWYgYSBgZm9yU2RrYCB3YXMgcGFzc2VkIGluLCByZXR1cm4gb25seSB0aGUgY29ycmVzcG9uZGluZyBsaXN0XG4gIGlmIChkZXZpY2VzW2ZvclNka10pIHtcbiAgICByZXR1cm4gZGV2aWNlc1tmb3JTZGtdO1xuICB9XG5cbiAgbGV0IGVyck1zZyA9IGAnJHtmb3JTZGt9JyBkb2VzIG5vdCBleGlzdCBpbiB0aGUgbGlzdCBvZiBzaW1jdGwgU0RLcy5gO1xuICBjb25zdCBhdmFpbGFibGVTREtzID0gXy5rZXlzKGRldmljZXMpO1xuICBlcnJNc2cgKz0gYXZhaWxhYmxlU0RLcy5sZW5ndGhcbiAgICA/IGAgT25seSB0aGUgZm9sbG93aW5nIFNpbXVsYXRvciBTREsgdmVyc2lvbnMgYXJlIGF2YWlsYWJsZSBvbiB5b3VyIHN5c3RlbTogJHthdmFpbGFibGVTREtzLmpvaW4oJywgJyl9YFxuICAgIDogYCBObyBTaW11bGF0b3IgU0RLIHZlcnNpb25zIGFyZSBhdmFpbGFibGUgb24geW91ciBzeXN0ZW0uIFBsZWFzZSBpbnN0YWxsIHNvbWUgdmlhIFhjb2RlIHByZWZlcmVuY2VzLmA7XG4gIHRocm93IG5ldyBFcnJvcihlcnJNc2cpO1xufVxuXG5cbi8qKlxuICogR2V0IHRoZSBydW50aW1lIGZvciB0aGUgcGFydGljdWxhciBwbGF0Zm9ybSB2ZXJzaW9uLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwbGF0Zm9ybVZlcnNpb24gLSBUaGUgcGxhdGZvcm0gdmVyc2lvbiBuYW1lLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBleGFtcGxlICcxMC4zJy5cbiAqIEBwYXJhbSB7P3N0cmluZ30gcGxhdGZvcm0gLSBUaGUgcGxhdGZvcm0gbmFtZSwgZm9yIGV4YW1wbGUgJ3dhdGNoT1MnLlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgY29ycmVzcG9uZGluZyBydW50aW1lIG5hbWUgZm9yIHRoZSBnaXZlblxuICogICAgICAgICAgICAgICAgICBwbGF0Zm9ybSB2ZXJzaW9uLlxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRSdW50aW1lRm9yUGxhdGZvcm1WZXJzaW9uIChwbGF0Zm9ybVZlcnNpb24sIHBsYXRmb3JtID0gJ2lPUycpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IHNpbUV4ZWMoJ2xpc3QnLCAwLCBbJ3J1bnRpbWVzJ10pO1xuICAgIC8vIGh0dHBzOi8vcmVnZXgxMDEuY29tL3IvVXlralFaLzFcbiAgICBjb25zdCBydW50aW1lUmUgPSBuZXcgUmVnRXhwKGAke18uZXNjYXBlUmVnRXhwKHBsYXRmb3JtKX1cXFxccysoXFxcXGQrXFxcXC5cXFxcZCspXFxcXHMrXFxcXCgoXFxcXGQrXFxcXC5cXFxcZCtcXFxcLipcXFxcZCopYCwgJ2knKTtcbiAgICBmb3IgKGNvbnN0IGxpbmUgb2Ygc3Rkb3V0LnNwbGl0KCdcXG4nKSkge1xuICAgICAgY29uc3QgbWF0Y2ggPSBydW50aW1lUmUuZXhlYyhsaW5lKTtcbiAgICAgIGlmIChtYXRjaCAmJiBtYXRjaFsxXSA9PT0gcGxhdGZvcm1WZXJzaW9uKSB7XG4gICAgICAgIHJldHVybiBtYXRjaFsyXTtcbiAgICAgIH1cbiAgICB9XG4gIH0gY2F0Y2ggKGlnbikge31cblxuICAvLyBpZiBub3RoaW5nIHdhcyBmb3VuZCwgcGFzcyBwbGF0Zm9ybSB2ZXJzaW9uIGJhY2tcbiAgcmV0dXJuIHBsYXRmb3JtVmVyc2lvbjtcbn1cblxuLyoqXG4gKiBHZXRzIGJhc2U2NCBzY3JlZW5zaG90IGZvciBkZXZpY2UgKHhjb2RlID49IDguMSBvbmx5KS5cbiAqIEl0IGlzIHJlcXVpcmVkIHRoYXQgU2ltdWxhdG9yIGlzIGluIF9ib290ZWRfIHN0YXRlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHJldHVybiB7c3RyaW5nfSBCYXNlNjQtZW5jb2RlZCBTaW11bGF0b3Igc2NyZWVuc2hvdC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgc3ViY29tbWFuZCBjb21tYW5kXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0U2NyZWVuc2hvdCAodWRpZCkge1xuICBsZXQgcGF0aFRvU2NyZWVuc2hvdFBuZyA9IGF3YWl0IHRlbXBEaXIucGF0aCh7cHJlZml4OiBgc2NyZWVuc2hvdC0ke3VkaWR9YCwgc3VmZml4OiAnLnBuZyd9KTtcbiAgYXdhaXQgc2ltRXhlYygnaW8nLCAwLCBbdWRpZCwgJ3NjcmVlbnNob3QnLCBwYXRoVG9TY3JlZW5zaG90UG5nXSk7XG4gIGxldCBzY3JlZW5zaG90SW1nID0gYXdhaXQgZnMucmVhZEZpbGUocGF0aFRvU2NyZWVuc2hvdFBuZyk7XG4gIGF3YWl0IGZzLnJpbXJhZihwYXRoVG9TY3JlZW5zaG90UG5nKTtcbiAgcmV0dXJuIHNjcmVlbnNob3RJbWcudG9TdHJpbmcoJ2Jhc2U2NCcpO1xufVxuXG4vKipcbiAqIFNldCB0aGUgY29udGVudCBvZiBTaW11bGF0b3IgcGFzdGVib2FyZCAoeGNvZGUgPj0gOC4xIG9ubHkpLlxuICogSXQgaXMgcmVxdWlyZWQgdGhhdCBTaW11bGF0b3IgaXMgaW4gX2Jvb3RlZF8gc3RhdGUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgLSBEZXZpY2UgVURJRC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBjb250ZW50IC0gVGhlIGFjdHVhbCBzdHJpbmcgY29udGVudCB0byBiZSBzZXQuXG4gKiBAcGFyYW0ge3N0cmluZ30gZW5jb2RpbmcgWyd1dGYtOCddIC0gVGhlIGVuY29kaW5nIG9mIHRoZSBnaXZlbiBwYXN0ZWJvYXJkIGNvbnRlbnQuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVVRGLTggYnkgZGVmYXVsdC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgc3ViY29tbWFuZCBjb21tYW5kXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2V0UGFzdGVib2FyZCAodWRpZCwgY29udGVudCwgZW5jb2RpbmcgPSAndXRmLTgnKSB7XG4gIGNvbnN0IHBiQ29weVN1YnByb2Nlc3MgPSBuZXcgU3ViUHJvY2VzcygneGNydW4nLCBbJ3NpbWN0bCcsICdwYmNvcHknLCB1ZGlkXSk7XG4gIGF3YWl0IHBiQ29weVN1YnByb2Nlc3Muc3RhcnQoMCk7XG4gIGNvbnN0IGV4aXRDb2RlVmVyaWZpZXIgPSBwYkNvcHlTdWJwcm9jZXNzLmpvaW4oKTtcbiAgY29uc3Qgc3RkaW4gPSBwYkNvcHlTdWJwcm9jZXNzLnByb2Muc3RkaW47XG4gIHN0ZGluLnNldEVuY29kaW5nKGVuY29kaW5nKTtcbiAgc3RkaW4ud3JpdGUoY29udGVudCk7XG4gIHN0ZGluLmVuZCgpO1xuICBhd2FpdCBleGl0Q29kZVZlcmlmaWVyO1xufVxuXG4vKipcbiAqIEdldCB0aGUgY29udGVudCBvZiBTaW11bGF0b3IgcGFzdGVib2FyZCAoeGNvZGUgPj0gOC4xIG9ubHkpLlxuICogSXQgaXMgcmVxdWlyZWQgdGhhdCBTaW11bGF0b3IgaXMgaW4gX2Jvb3RlZF8gc3RhdGUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgLSBEZXZpY2UgVURJRC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBlbmNvZGluZyBbJ3V0Zi04J10gLSBUaGUgZW5jb2Rpbmcgb2YgdGhlIHJldHVybmVkIHBhc3RlYm9hcmQgY29udGVudC5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVVEYtOCBieSBkZWZhdWx0LlxuICogQHJldHVybiB7c3RyaW5nfSBDdXJyZW50IGNvbnRlbnQgb2YgU2ltdWxhdG9yIHBhc3RlYm9hcmQgb3IgYW4gZW1wdHkgc3RyaW5nLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRQYXN0ZWJvYXJkICh1ZGlkLCBlbmNvZGluZyA9ICd1dGYtOCcpIHtcbiAgY29uc3QgYXJncyA9IFsnc2ltY3RsJywgJ3BicGFzdGUnLCB1ZGlkXTtcbiAgdHJ5IHtcbiAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ3hjcnVuJywgYXJncywge3RpbWVvdXQ6IDAsIGVuY29kaW5nfSk7XG4gICAgcmV0dXJuIHN0ZG91dDtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGlmIChlLnN0ZGVycikge1xuICAgICAgbG9nLmVycm9yQW5kVGhyb3coYEVycm9yIHJ1bm5pbmcgJ3hjcnVuICR7YXJncy5qb2luKCcgJyl9JzogJHtlLnN0ZGVyci50cmltKCl9YCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZy5lcnJvckFuZFRocm93KGUpO1xuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIEdldCB0aGUgbGlzdCBvZiBkZXZpY2UgdHlwZXMgYXZhaWxhYmxlIGluIHRoZSBjdXJyZW50IFhjb2RlIGluc3RhbGxhdGlvblxuICpcbiAqIEByZXR1cm4ge0FycmF5PHN0cmluZz59IExpc3Qgb2YgdGhlIHR5cGVzIG9mIGRldmljZXMgYXZhaWxhYmxlXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNvcnJlc3BvbmRpbmcgc2ltY3RsIGNvbW1hbmQgZmFpbHNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0RGV2aWNlVHlwZXMgKCkge1xuICB0cnkge1xuICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgc2ltRXhlYygnbGlzdCcsIDAsIFsnZGV2aWNldHlwZXMnLCAnLWonXSk7XG4gICAgLypcbiAgICAgKiBKU09OIHdpbGwgYmUgbGlrZTpcbiAgICAgKiAgIHtcbiAgICAgKiAgICAgXCJkZXZpY2V0eXBlc1wiIDogW1xuICAgICAqICAgICAgIHtcbiAgICAgKiAgICAgICAgIFwibmFtZVwiIDogXCJpUGhvbmUgNHNcIixcbiAgICAgKiAgICAgICAgIFwiaWRlbnRpZmllclwiIDogXCJjb20uYXBwbGUuQ29yZVNpbXVsYXRvci5TaW1EZXZpY2VUeXBlLmlQaG9uZS00c1wiXG4gICAgICogICAgICAgfSxcbiAgICAgKiAgICAgICAuLi5cbiAgICAgKiAgIH1cbiAgICAgKi9cbiAgICBjb25zdCBkZXZpY2VUeXBlcyA9IEpTT04ucGFyc2Uoc3Rkb3V0LnRyaW0oKSk7XG4gICAgcmV0dXJuIGRldmljZVR5cGVzLmRldmljZXR5cGVzLm1hcCgodHlwZSkgPT4gdHlwZS5uYW1lKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbGV0IG1zZyA9IGBVbmFibGUgdG8gZ2V0IGxpc3Qgb2YgZGV2aWNlIHR5cGVzOiAke2Vyci5tZXNzYWdlfWA7XG4gICAgaWYgKGVyci5zdGRlcnIpIHtcbiAgICAgIG1zZyA9IGAke21zZ30uIFN0ZGVycjogJHtlcnIuc3RkZXJyfWA7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihtc2cpO1xuICB9XG59XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gQm9vdE1vbml0b3JPcHRpb25zXG4gKiBAcHJvcGVydHkgez9udW1iZXJ9IHRpbWVvdXQgWzI0MDAwMF0gLSBTaW11bGF0b3IgYm9vdGluZyB0aW1lb3V0IGluIG1zLlxuICogQHByb3BlcnR5IHs/RnVuY3Rpb259IG9uV2FpdGluZ0RhdGFNaWdyYXRpb24gLSBUaGlzIGV2ZW50IGlzIGZpcmVkIHdoZW4gZGF0YSBtaWdyYXRpb24gc3RhZ2Ugc3RhcnRzLlxuICogQHByb3BlcnR5IHs/RnVuY3Rpb259IG9uV2FpdGluZ1N5c3RlbUFwcCAtIFRoaXMgZXZlbnQgaXMgZmlyZWQgd2hlbiBzeXN0ZW0gYXBwIHdhaXQgc3RhZ2Ugc3RhcnRzLlxuICogQHByb3BlcnR5IHs/RnVuY3Rpb259IG9uRmluaXNoZWQgLSBUaGlzIGV2ZW50IGlzIGZpcmVkIHdoZW4gU2ltdWxhdG9yIGlzIGZ1bGx5IGJvb3RlZC5cbiAqIEBwcm9wZXJ0eSB7P0Z1bmN0aW9ufSBvbkVycm9yIC0gVGhpcyBldmVudCBpcyBmaXJlZCB3aGVuIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSBtb25pdG9yaW5nIHRoZSBib290aW5nIHByb2Nlc3NcbiAqIG9yIHdoZW4gdGhlIHRpbWVvdXQgaGFzIGV4cGlyZWQuXG4gKi9cblxuLyoqXG4gKiBTdGFydCBtb25pdG9yaW5nIGZvciBib290IHN0YXR1cyBvZiB0aGUgcGFydGljdWxhciBTaW11bGF0b3IuXG4gKiBJZiBvbkZpbmlzaGVkIHByb3BlcnR5IGlzIG5vdCBzZXQgdGhlbiB0aGUgbWV0aG9kIHdpbGwgYmxvY2tcbiAqIHVudGlsIFNpbXVsYXRvciBib290aW5nIGlzIGNvbXBsZXRlZC5cbiAqIFRoZSBtZXRob2QgaXMgb25seSBhdmFpbGFibGUgc2luY2UgWGNvZGU4LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gRGV2aWNlIFVESUQuXG4gKiBAcGFyYW0gez9Cb290TW9uaXRvck9wdGlvbnN9IG9wdHMgLSBNb25pdG9yaW5nIG9wdGlvbnMuXG4gKiBAcmV0dXJucyB7U3ViUHJvY2Vzc30gVGhlIGluc3RhbmNlIG9mIHRoZSBjb3JyZXNwb25kaW5nIG1vbml0b3JpbmcgcHJvY2Vzcy5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgU2ltdWxhdG9yIGZhaWxzIHRvIGZpbmlzaCBib290aW5nIHdpdGhpbiB0aGUgZ2l2ZW4gdGltZW91dCBhbmQgb25GaW5pc2hlZFxuICogcHJvcGVydHkgaXMgbm90IHNldC5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gc3RhcnRCb290TW9uaXRvciAodWRpZCwgb3B0cyA9IHt9KSB7XG4gIGNvbnN0IHtcbiAgICB0aW1lb3V0ID0gMjQwMDAwLFxuICAgIG9uV2FpdGluZ0RhdGFNaWdyYXRpb24sXG4gICAgb25XYWl0aW5nU3lzdGVtQXBwLFxuICAgIG9uRmluaXNoZWQsXG4gICAgb25FcnJvcixcbiAgfSA9IG9wdHM7XG5cbiAgbGV0IHN0YXR1cyA9ICcnO1xuICBsZXQgaXNCb290aW5nRmluaXNoZWQgPSBmYWxzZTtcbiAgbGV0IGVycm9yID0gbnVsbDtcbiAgbGV0IHRpbWVvdXRIYW5kbGVyID0gbnVsbDtcbiAgY29uc3QgYm9vdE1vbml0b3IgPSBhd2FpdCBzaW1TdWJQcm9jZXNzKCdib290c3RhdHVzJywgMCwgW3VkaWRdKTtcbiAgYm9vdE1vbml0b3Iub24oJ291dHB1dCcsIChzdGRvdXQsIHN0ZGVycikgPT4ge1xuICAgIHN0YXR1cyArPSBzdGRvdXQgfHwgc3RkZXJyO1xuICAgIGlmIChzdGRvdXQpIHtcbiAgICAgIGlmIChzdGRvdXQuaW5jbHVkZXMoJ1dhaXRpbmcgb24gRGF0YSBNaWdyYXRpb24nKSAmJiBvbldhaXRpbmdEYXRhTWlncmF0aW9uKSB7XG4gICAgICAgIG9uV2FpdGluZ0RhdGFNaWdyYXRpb24oKTtcbiAgICAgIH0gZWxzZSBpZiAoc3Rkb3V0LmluY2x1ZGVzKCdXYWl0aW5nIG9uIFN5c3RlbSBBcHAnKSAmJiBvbldhaXRpbmdTeXN0ZW1BcHApIHtcbiAgICAgICAgb25XYWl0aW5nU3lzdGVtQXBwKCk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgYm9vdE1vbml0b3Iub24oJ2V4aXQnLCAoY29kZSwgc2lnbmFsKSA9PiB7XG4gICAgaWYgKHRpbWVvdXRIYW5kbGVyKSB7XG4gICAgICBjbGVhclRpbWVvdXQodGltZW91dEhhbmRsZXIpO1xuICAgIH1cbiAgICBpZiAoY29kZSA9PT0gMCkge1xuICAgICAgaWYgKG9uRmluaXNoZWQpIHtcbiAgICAgICAgb25GaW5pc2hlZCgpO1xuICAgICAgfVxuICAgICAgaXNCb290aW5nRmluaXNoZWQgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdGF0dXMgPSBzdGF0dXMgfHwgc2lnbmFsO1xuICAgICAgZXJyb3IgPSBuZXcgRXJyb3Ioc3RhdHVzKTtcbiAgICAgIGlmIChvbkVycm9yKSB7XG4gICAgICAgIG9uRXJyb3IoZXJyb3IpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIGF3YWl0IGJvb3RNb25pdG9yLnN0YXJ0KDApO1xuICBjb25zdCBzdG9wTW9uaXRvciA9IGFzeW5jICgpID0+IHtcbiAgICBpZiAoYm9vdE1vbml0b3IuaXNSdW5uaW5nKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBib290TW9uaXRvci5zdG9wKCk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGxvZy53YXJuKGUubWVzc2FnZSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCB0aW1lU3RhcnRlZCA9IHByb2Nlc3MuaHJ0aW1lKCk7XG4gIGlmIChvbkZpbmlzaGVkKSB7XG4gICAgdGltZW91dEhhbmRsZXIgPSBzZXRUaW1lb3V0KHN0b3BNb25pdG9yLCB0aW1lb3V0KTtcbiAgfSBlbHNlIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgd2FpdEZvckNvbmRpdGlvbigoKSA9PiB7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpc0Jvb3RpbmdGaW5pc2hlZDtcbiAgICAgIH0sIHt3YWl0TXM6IHRpbWVvdXQsIGludGVydmFsTXM6IDUwMH0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgYXdhaXQgc3RvcE1vbml0b3IoKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIHNpbXVsYXRvciAke3VkaWR9IGhhcyBmYWlsZWQgdG8gZmluaXNoIGJvb3RpbmcgYWZ0ZXIgJHtwcm9jZXNzLmhydGltZSh0aW1lU3RhcnRlZClbMF19cy4gYCArXG4gICAgICAgIGBPcmlnaW5hbCBzdGF0dXM6ICR7c3RhdHVzfWApO1xuICAgIH1cbiAgfVxuICByZXR1cm4gYm9vdE1vbml0b3I7XG59XG5cblxuZXhwb3J0IHtcbiAgaW5zdGFsbEFwcCwgcmVtb3ZlQXBwLCBsYXVuY2gsIHNwYXduLCBzcGF3blN1YlByb2Nlc3MsIG9wZW5VcmwsIHRlcm1pbmF0ZSxcbiAgc2h1dGRvd24sIGNyZWF0ZURldmljZSwgZ2V0QXBwQ29udGFpbmVyLCBnZXRTY3JlZW5zaG90LCBkZWxldGVEZXZpY2UsXG4gIGVyYXNlRGV2aWNlLCBnZXREZXZpY2VzLCBnZXRSdW50aW1lRm9yUGxhdGZvcm1WZXJzaW9uLCBib290RGV2aWNlLFxuICBzZXRQYXN0ZWJvYXJkLCBnZXRQYXN0ZWJvYXJkLCBhZGRNZWRpYSwgYXBwSW5mbywgZ2V0RGV2aWNlVHlwZXMsXG4gIHN0YXJ0Qm9vdE1vbml0b3IsXG59O1xuIl0sImZpbGUiOiJsaWIvc2ltY3RsLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
