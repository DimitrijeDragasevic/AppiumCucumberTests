"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _logger = _interopRequireDefault(require("../logger.js"));

var _lodash = _interopRequireDefault(require("lodash"));

const PHONE_NUMBER_PATTERN = /^[+]?[(]?[0-9]*[)]?[-\s.]?[0-9]*[-\s.]?[0-9]{2,}$/im;
let emuMethods = {};
emuMethods.POWER_AC_STATES = {
  POWER_AC_ON: 'on',
  POWER_AC_OFF: 'off'
};
emuMethods.GSM_CALL_ACTIONS = {
  GSM_CALL: 'call',
  GSM_ACCEPT: 'accept',
  GSM_CANCEL: 'cancel',
  GSM_HOLD: 'hold'
};
emuMethods.GSM_VOICE_STATES = {
  GSM_VOICE_UNREGISTERED: 'unregistered',
  GSM_VOICE_HOME: 'home',
  GSM_VOICE_ROAMING: 'roaming',
  GSM_VOICE_SEARCHING: 'searching',
  GSM_VOICE_DENIED: 'denied',
  GSM_VOICE_OFF: 'off',
  GSM_VOICE_ON: 'on'
};
emuMethods.GSM_SIGNAL_STRENGTHS = [0, 1, 2, 3, 4];
emuMethods.NETWORK_SPEED = {
  GSM: 'gsm',
  SCSD: 'scsd',
  GPRS: 'gprs',
  EDGE: 'edge',
  UMTS: 'umts',
  HSDPA: 'hsdpa',
  LTE: 'lte',
  EVDO: 'evdo',
  FULL: 'full'
};

emuMethods.isEmulatorConnected = async function () {
  let emulators = await this.getConnectedEmulators();
  return !!_lodash.default.find(emulators, x => x && x.udid === this.curDeviceId);
};

emuMethods.verifyEmulatorConnected = async function () {
  if (!(await this.isEmulatorConnected())) {
    throw new Error(`The emulator "${this.curDeviceId}" was unexpectedly disconnected`);
  }
};

emuMethods.fingerprint = async function (fingerprintId) {
  if (!fingerprintId) {
    throw new Error('Fingerprint id parameter must be defined');
  }

  let level = await this.getApiLevel();

  if (level < 23) {
    throw new Error(`Device API Level must be >= 23. Current Api level '${level}'`);
  }

  await this.adbExecEmu(['finger', 'touch', fingerprintId]);
};

emuMethods.rotate = async function () {
  await this.adbExecEmu(['rotate']);
};

emuMethods.powerAC = async function (state = 'on') {
  if (_lodash.default.values(emuMethods.POWER_AC_STATES).indexOf(state) === -1) {
    throw new Error(`Wrong power AC state sent '${state}'. Supported values: ${_lodash.default.values(emuMethods.POWER_AC_STATES)}]`);
  }

  await this.adbExecEmu(['power', 'ac', state]);
};

emuMethods.powerCapacity = async function (percent = 100) {
  percent = parseInt(percent, 10);

  if (isNaN(percent) || percent < 0 || percent > 100) {
    throw new Error(`The percentage value should be valid integer between 0 and 100`);
  }

  await this.adbExecEmu(['power', 'capacity', percent]);
};

emuMethods.powerOFF = async function () {
  await this.powerAC(emuMethods.POWER_AC_STATES.POWER_AC_OFF);
  await this.powerCapacity(0);
};

emuMethods.sendSMS = async function (phoneNumber, message = '') {
  message = message.trim();

  if (message === "") {
    throw new Error('Sending an SMS requires a message');
  }

  phoneNumber = `${phoneNumber}`.replace(/\s*/, "");

  if (!PHONE_NUMBER_PATTERN.test(phoneNumber)) {
    throw new Error(`Invalid sendSMS phoneNumber param ${phoneNumber}`);
  }

  await this.adbExecEmu(['sms', 'send', phoneNumber, message]);
};

emuMethods.gsmCall = async function (phoneNumber, action = '') {
  if (_lodash.default.values(emuMethods.GSM_CALL_ACTIONS).indexOf(action) === -1) {
    throw new Error(`Invalid gsm action param ${action}. Supported values: ${_lodash.default.values(emuMethods.GSM_CALL_ACTIONS)}`);
  }

  phoneNumber = `${phoneNumber}`.replace(/\s*/, "");

  if (!PHONE_NUMBER_PATTERN.test(phoneNumber)) {
    throw new Error(`Invalid gsmCall phoneNumber param ${phoneNumber}`);
  }

  await this.adbExecEmu(['gsm', action, phoneNumber]);
};

emuMethods.gsmSignal = async function (strength = 4) {
  strength = parseInt(strength, 10);

  if (emuMethods.GSM_SIGNAL_STRENGTHS.indexOf(strength) === -1) {
    throw new Error(`Invalid signal strength param ${strength}. Supported values: ${_lodash.default.values(emuMethods.GSM_SIGNAL_STRENGTHS)}`);
  }

  _logger.default.info('gsm signal-profile <strength> changes the reported strength on next (15s) update.');

  await this.adbExecEmu(['gsm', 'signal-profile', strength]);
};

emuMethods.gsmVoice = async function (state = 'on') {
  if (_lodash.default.values(emuMethods.GSM_VOICE_STATES).indexOf(state) === -1) {
    throw new Error(`Invalid gsm voice state param ${state}. Supported values: ${_lodash.default.values(emuMethods.GSM_VOICE_STATES)}`);
  }

  await this.adbExecEmu(['gsm', 'voice', state]);
};

emuMethods.networkSpeed = async function (speed = 'full') {
  if (_lodash.default.values(emuMethods.NETWORK_SPEED).indexOf(speed) === -1) {
    throw new Error(`Invalid network speed param ${speed}. Supported values: ${_lodash.default.values(emuMethods.NETWORK_SPEED)}`);
  }

  await this.adbExecEmu(['network', 'speed', speed]);
};

var _default = emuMethods;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi90b29scy9hZGItZW11LWNvbW1hbmRzLmpzIl0sIm5hbWVzIjpbIlBIT05FX05VTUJFUl9QQVRURVJOIiwiZW11TWV0aG9kcyIsIlBPV0VSX0FDX1NUQVRFUyIsIlBPV0VSX0FDX09OIiwiUE9XRVJfQUNfT0ZGIiwiR1NNX0NBTExfQUNUSU9OUyIsIkdTTV9DQUxMIiwiR1NNX0FDQ0VQVCIsIkdTTV9DQU5DRUwiLCJHU01fSE9MRCIsIkdTTV9WT0lDRV9TVEFURVMiLCJHU01fVk9JQ0VfVU5SRUdJU1RFUkVEIiwiR1NNX1ZPSUNFX0hPTUUiLCJHU01fVk9JQ0VfUk9BTUlORyIsIkdTTV9WT0lDRV9TRUFSQ0hJTkciLCJHU01fVk9JQ0VfREVOSUVEIiwiR1NNX1ZPSUNFX09GRiIsIkdTTV9WT0lDRV9PTiIsIkdTTV9TSUdOQUxfU1RSRU5HVEhTIiwiTkVUV09SS19TUEVFRCIsIkdTTSIsIlNDU0QiLCJHUFJTIiwiRURHRSIsIlVNVFMiLCJIU0RQQSIsIkxURSIsIkVWRE8iLCJGVUxMIiwiaXNFbXVsYXRvckNvbm5lY3RlZCIsImVtdWxhdG9ycyIsImdldENvbm5lY3RlZEVtdWxhdG9ycyIsIl8iLCJmaW5kIiwieCIsInVkaWQiLCJjdXJEZXZpY2VJZCIsInZlcmlmeUVtdWxhdG9yQ29ubmVjdGVkIiwiRXJyb3IiLCJmaW5nZXJwcmludCIsImZpbmdlcnByaW50SWQiLCJsZXZlbCIsImdldEFwaUxldmVsIiwiYWRiRXhlY0VtdSIsInJvdGF0ZSIsInBvd2VyQUMiLCJzdGF0ZSIsInZhbHVlcyIsImluZGV4T2YiLCJwb3dlckNhcGFjaXR5IiwicGVyY2VudCIsInBhcnNlSW50IiwiaXNOYU4iLCJwb3dlck9GRiIsInNlbmRTTVMiLCJwaG9uZU51bWJlciIsIm1lc3NhZ2UiLCJ0cmltIiwicmVwbGFjZSIsInRlc3QiLCJnc21DYWxsIiwiYWN0aW9uIiwiZ3NtU2lnbmFsIiwic3RyZW5ndGgiLCJsb2ciLCJpbmZvIiwiZ3NtVm9pY2UiLCJuZXR3b3JrU3Bl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eEQsTUFBSXBDLGdCQUFFZSxNQUFGLENBQVM5QyxVQUFVLENBQUNrQixhQUFwQixFQUFtQzZCLE9BQW5DLENBQTJDb0IsS0FBM0MsTUFBc0QsQ0FBQyxDQUEzRCxFQUE4RDtBQUM1RCxVQUFNLElBQUk5QixLQUFKLENBQVcsK0JBQThCOEIsS0FBTSx1QkFBc0JwQyxnQkFBRWUsTUFBRixDQUFTOUMsVUFBVSxDQUFDa0IsYUFBcEIsQ0FBbUMsRUFBeEcsQ0FBTjtBQUNEOztBQUNELFFBQU0sS0FBS3dCLFVBQUwsQ0FBZ0IsQ0FBQyxTQUFELEVBQVksT0FBWixFQUFxQnlCLEtBQXJCLENBQWhCLENBQU47QUFDRCxDQU5EOztlQVFlbkUsVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyLmpzJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cblxuY29uc3QgUEhPTkVfTlVNQkVSX1BBVFRFUk4gPSAvXlsrXT9bKF0/WzAtOV0qWyldP1stXFxzLl0/WzAtOV0qWy1cXHMuXT9bMC05XXsyLH0kL2ltO1xuXG5sZXQgZW11TWV0aG9kcyA9IHt9O1xuZW11TWV0aG9kcy5QT1dFUl9BQ19TVEFURVMgPSB7XG4gIFBPV0VSX0FDX09OOiAnb24nLFxuICBQT1dFUl9BQ19PRkY6ICdvZmYnXG59O1xuZW11TWV0aG9kcy5HU01fQ0FMTF9BQ1RJT05TID0ge1xuICBHU01fQ0FMTDogJ2NhbGwnLFxuICBHU01fQUNDRVBUOiAnYWNjZXB0JyxcbiAgR1NNX0NBTkNFTDogJ2NhbmNlbCcsXG4gIEdTTV9IT0xEOiAnaG9sZCdcbn07XG5lbXVNZXRob2RzLkdTTV9WT0lDRV9TVEFURVMgPSB7XG4gIEdTTV9WT0lDRV9VTlJFR0lTVEVSRUQ6ICd1bnJlZ2lzdGVyZWQnLFxuICBHU01fVk9JQ0VfSE9NRTogJ2hvbWUnLFxuICBHU01fVk9JQ0VfUk9BTUlORzogJ3JvYW1pbmcnLFxuICBHU01fVk9JQ0VfU0VBUkNISU5HOiAnc2VhcmNoaW5nJyxcbiAgR1NNX1ZPSUNFX0RFTklFRDogJ2RlbmllZCcsXG4gIEdTTV9WT0lDRV9PRkY6ICdvZmYnLFxuICBHU01fVk9JQ0VfT046ICdvbidcbn07XG5lbXVNZXRob2RzLkdTTV9TSUdOQUxfU1RSRU5HVEhTID0gWzAsIDEsIDIsIDMsIDRdO1xuXG5lbXVNZXRob2RzLk5FVFdPUktfU1BFRUQgPSB7XG4gIEdTTTogJ2dzbScsIC8vIEdTTS9DU0QgKHVwOiAxNC40LCBkb3duOiAxNC40KS5cbiAgU0NTRDogJ3Njc2QnLCAvLyBIU0NTRCAodXA6IDE0LjQsIGRvd246IDU3LjYpLlxuICBHUFJTOiAnZ3BycycsIC8vIEdQUlMgKHVwOiAyOC44LCBkb3duOiA1Ny42KS5cbiAgRURHRTogJ2VkZ2UnLCAvLyBFREdFL0VHUFJTICh1cDogNDczLjYsIGRvd246IDQ3My42KS5cbiAgVU1UUzogJ3VtdHMnLCAvLyBVTVRTLzNHICh1cDogMzg0LjAsIGRvd246IDM4NC4wKS5cbiAgSFNEUEE6ICdoc2RwYScsIC8vIEhTRFBBICh1cDogNTc2MC4wLCBkb3duOiAxMyw5ODAuMCkuXG4gIExURTogJ2x0ZScsIC8vIExURSAodXA6IDU4LDAwMCwgZG93bjogMTczLDAwMCkuXG4gIEVWRE86ICdldmRvJywgLy8gRVZETyAodXA6IDc1LDAwMCwgZG93bjogMjgwLDAwMCkuXG4gIEZVTEw6ICdmdWxsJyAvLyBObyBsaW1pdCwgdGhlIGRlZmF1bHQgKHVwOiAwLjAsIGRvd246IDAuMCkuXG59O1xuXG4vKipcbiAqIENoZWNrIHRoZSBlbXVsYXRvciBzdGF0ZS5cbiAqXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIEVtdWxhdG9yIGlzIHZpc2libGUgdG8gYWRiLlxuICovXG5lbXVNZXRob2RzLmlzRW11bGF0b3JDb25uZWN0ZWQgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGxldCBlbXVsYXRvcnMgPSBhd2FpdCB0aGlzLmdldENvbm5lY3RlZEVtdWxhdG9ycygpO1xuICByZXR1cm4gISFfLmZpbmQoZW11bGF0b3JzLCAoeCkgPT4geCAmJiB4LnVkaWQgPT09IHRoaXMuY3VyRGV2aWNlSWQpO1xufTtcblxuLyoqXG4gKiBWZXJpZnkgdGhlIGVtdWxhdG9yIGlzIGNvbm5lY3RlZC5cbiAqXG4gKiBAdGhyb3dzIHtlcnJvcn0gSWYgRW11bGF0b3IgaXMgbm90IHZpc2libGUgdG8gYWRiLlxuICovXG5lbXVNZXRob2RzLnZlcmlmeUVtdWxhdG9yQ29ubmVjdGVkID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICBpZiAoIShhd2FpdCB0aGlzLmlzRW11bGF0b3JDb25uZWN0ZWQoKSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBlbXVsYXRvciBcIiR7dGhpcy5jdXJEZXZpY2VJZH1cIiB3YXMgdW5leHBlY3RlZGx5IGRpc2Nvbm5lY3RlZGApO1xuICB9XG59O1xuXG4vKipcbiAqIEVtdWxhdGUgZmluZ2VycHJpbnQgdG91Y2ggZXZlbnQgb24gdGhlIGNvbm5lY3RlZCBlbXVsYXRvci5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gZmluZ2VycHJpbnRJZCAtIFRoZSBJRCBvZiB0aGUgZmluZ2VycHJpbnQuXG4gKi9cbmVtdU1ldGhvZHMuZmluZ2VycHJpbnQgPSBhc3luYyBmdW5jdGlvbiAoZmluZ2VycHJpbnRJZCkge1xuICBpZiAoIWZpbmdlcnByaW50SWQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZpbmdlcnByaW50IGlkIHBhcmFtZXRlciBtdXN0IGJlIGRlZmluZWQnKTtcbiAgfVxuICAvLyB0aGUgbWV0aG9kIHVzZWQgb25seSB3b3JrcyBmb3IgQVBJIGxldmVsIDIzIGFuZCBhYm92ZVxuICBsZXQgbGV2ZWwgPSBhd2FpdCB0aGlzLmdldEFwaUxldmVsKCk7XG4gIGlmIChsZXZlbCA8IDIzKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBEZXZpY2UgQVBJIExldmVsIG11c3QgYmUgPj0gMjMuIEN1cnJlbnQgQXBpIGxldmVsICcke2xldmVsfSdgKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYkV4ZWNFbXUoWydmaW5nZXInLCAndG91Y2gnLCBmaW5nZXJwcmludElkXSk7XG59O1xuXG4vKipcbiAqIENoYW5nZSB0aGUgZGlzcGxheSBvcmllbnRhdGlvbiBvbiB0aGUgY29ubmVjdGVkIGVtdWxhdG9yLlxuICogVGhlIG9yaWVudGF0aW9uIGlzIGNoYW5nZWQgKFBJLzIgaXMgYWRkZWQpIGV2ZXJ5IHRpbWVcbiAqIHRoaXMgbWV0aG9kIGlzIGNhbGxlZC5cbiAqL1xuZW11TWV0aG9kcy5yb3RhdGUgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGF3YWl0IHRoaXMuYWRiRXhlY0VtdShbJ3JvdGF0ZSddKTtcbn07XG5cbi8qKlxuICogRW11bGF0ZSBwb3dlciBzdGF0ZSBjaGFuZ2Ugb24gdGhlIGNvbm5lY3RlZCBlbXVsYXRvci5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RhdGUgWydvbiddIC0gRWl0aGVyICdvbicgb3IgJ29mZicuXG4gKi9cbmVtdU1ldGhvZHMucG93ZXJBQyA9IGFzeW5jIGZ1bmN0aW9uIChzdGF0ZSA9ICdvbicpIHtcbiAgaWYgKF8udmFsdWVzKGVtdU1ldGhvZHMuUE9XRVJfQUNfU1RBVEVTKS5pbmRleE9mKHN0YXRlKSA9PT0gLTEpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFdyb25nIHBvd2VyIEFDIHN0YXRlIHNlbnQgJyR7c3RhdGV9Jy4gU3VwcG9ydGVkIHZhbHVlczogJHtfLnZhbHVlcyhlbXVNZXRob2RzLlBPV0VSX0FDX1NUQVRFUyl9XWApO1xuICB9XG4gIGF3YWl0IHRoaXMuYWRiRXhlY0VtdShbJ3Bvd2VyJywgJ2FjJywgc3RhdGVdKTtcbn07XG5cbi8qKlxuICogRW11bGF0ZSBwb3dlciBjYXBhY2l0eSBjaGFuZ2Ugb24gdGhlIGNvbm5lY3RlZCBlbXVsYXRvci5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ3xudW1iZXJ9IHBlcmNlbnQgWzEwMF0gLSBQZXJjZW50YWdlIHZhbHVlIGluIHJhbmdlIFswLCAxMDBdLlxuICovXG5lbXVNZXRob2RzLnBvd2VyQ2FwYWNpdHkgPSBhc3luYyBmdW5jdGlvbiAocGVyY2VudCA9IDEwMCkge1xuICBwZXJjZW50ID0gcGFyc2VJbnQocGVyY2VudCwgMTApO1xuICBpZiAoaXNOYU4ocGVyY2VudCkgfHwgcGVyY2VudCA8IDAgfHwgcGVyY2VudCA+IDEwMCkge1xuICAgIHRocm93IG5ldyBFcnJvcihgVGhlIHBlcmNlbnRhZ2UgdmFsdWUgc2hvdWxkIGJlIHZhbGlkIGludGVnZXIgYmV0d2VlbiAwIGFuZCAxMDBgKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYkV4ZWNFbXUoWydwb3dlcicsICdjYXBhY2l0eScsIHBlcmNlbnRdKTtcbn07XG5cbi8qKlxuICogRW11bGF0ZSBwb3dlciBvZmYgZXZlbnQgb24gdGhlIGNvbm5lY3RlZCBlbXVsYXRvci5cbiAqL1xuZW11TWV0aG9kcy5wb3dlck9GRiA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgYXdhaXQgdGhpcy5wb3dlckFDKGVtdU1ldGhvZHMuUE9XRVJfQUNfU1RBVEVTLlBPV0VSX0FDX09GRik7XG4gIGF3YWl0IHRoaXMucG93ZXJDYXBhY2l0eSgwKTtcbn07XG5cbi8qKlxuICogRW11bGF0ZSBzZW5kIFNNUyBldmVudCBvbiB0aGUgY29ubmVjdGVkIGVtdWxhdG9yLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcn0gcGhvbmVOdW1iZXIgLSBUaGUgcGhvbmUgbnVtYmVyIG9mIG1lc3NhZ2Ugc2VuZGVyLlxuICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2UgWycnXSAtIFRoZSBtZXNzYWdlIGNvbnRlbnQuXG4gKiBAdGhyb3dzIHtlcnJvcn0gSWYgcGhvbmUgbnVtYmVyIGhhcyBpbnZhbGlkIGZvcm1hdC5cbiAqL1xuZW11TWV0aG9kcy5zZW5kU01TID0gYXN5bmMgZnVuY3Rpb24gKHBob25lTnVtYmVyLCBtZXNzYWdlID0gJycpIHtcbiAgbWVzc2FnZSA9IG1lc3NhZ2UudHJpbSgpO1xuICBpZiAobWVzc2FnZSA9PT0gXCJcIikge1xuICAgIHRocm93IG5ldyBFcnJvcignU2VuZGluZyBhbiBTTVMgcmVxdWlyZXMgYSBtZXNzYWdlJyk7XG4gIH1cbiAgcGhvbmVOdW1iZXIgPSBgJHtwaG9uZU51bWJlcn1gLnJlcGxhY2UoL1xccyovLCBcIlwiKTtcbiAgaWYgKCFQSE9ORV9OVU1CRVJfUEFUVEVSTi50ZXN0KHBob25lTnVtYmVyKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBzZW5kU01TIHBob25lTnVtYmVyIHBhcmFtICR7cGhvbmVOdW1iZXJ9YCk7XG4gIH1cbiAgYXdhaXQgdGhpcy5hZGJFeGVjRW11KFsnc21zJywgJ3NlbmQnLCBwaG9uZU51bWJlciwgbWVzc2FnZV0pO1xufTtcblxuLyoqXG4gKiBFbXVsYXRlIEdTTSBjYWxsIGV2ZW50IG9uIHRoZSBjb25uZWN0ZWQgZW11bGF0b3IuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSBwaG9uZU51bWJlciAtIFRoZSBwaG9uZSBudW1iZXIgb2YgdGhlIGNhbGxlci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBhY3Rpb24gWycnXSAtIE9uZSBvZiBhdmFpbGFibGUgR1NNIGNhbGwgYWN0aW9ucy5cbiAqIEB0aHJvd3Mge2Vycm9yfSBJZiBwaG9uZSBudW1iZXIgaGFzIGludmFsaWQgZm9ybWF0LlxuICogQHRocm93cyB7ZXJyb3J9IElmIF9hY3Rpb25fIHZhbHVlIGlzIGludmFsaWQuXG4gKi9cbmVtdU1ldGhvZHMuZ3NtQ2FsbCA9IGFzeW5jIGZ1bmN0aW9uIChwaG9uZU51bWJlciwgYWN0aW9uID0gJycpIHtcbiAgaWYgKF8udmFsdWVzKGVtdU1ldGhvZHMuR1NNX0NBTExfQUNUSU9OUykuaW5kZXhPZihhY3Rpb24pID09PSAtMSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBnc20gYWN0aW9uIHBhcmFtICR7YWN0aW9ufS4gU3VwcG9ydGVkIHZhbHVlczogJHtfLnZhbHVlcyhlbXVNZXRob2RzLkdTTV9DQUxMX0FDVElPTlMpfWApO1xuICB9XG4gIHBob25lTnVtYmVyID0gYCR7cGhvbmVOdW1iZXJ9YC5yZXBsYWNlKC9cXHMqLywgXCJcIik7XG4gIGlmICghUEhPTkVfTlVNQkVSX1BBVFRFUk4udGVzdChwaG9uZU51bWJlcikpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgZ3NtQ2FsbCBwaG9uZU51bWJlciBwYXJhbSAke3Bob25lTnVtYmVyfWApO1xuICB9XG4gIGF3YWl0IHRoaXMuYWRiRXhlY0VtdShbJ2dzbScsIGFjdGlvbiwgcGhvbmVOdW1iZXJdKTtcbn07XG5cbi8qKlxuICogRW11bGF0ZSBHU00gc2lnbmFsIHN0cmVuZ3RoIGNoYW5nZSBldmVudCBvbiB0aGUgY29ubmVjdGVkIGVtdWxhdG9yLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcn0gc3RyZW5ndGggWzRdIC0gQSBudW1iZXIgaW4gcmFuZ2UgWzAsIDRdO1xuICogQHRocm93cyB7ZXJyb3J9IElmIF9zdHJlbmd0aF8gdmFsdWUgaXMgaW52YWxpZC5cbiAqL1xuZW11TWV0aG9kcy5nc21TaWduYWwgPSBhc3luYyBmdW5jdGlvbiAoc3RyZW5ndGggPSA0KSB7XG4gIHN0cmVuZ3RoID0gcGFyc2VJbnQoc3RyZW5ndGgsIDEwKTtcbiAgaWYgKGVtdU1ldGhvZHMuR1NNX1NJR05BTF9TVFJFTkdUSFMuaW5kZXhPZihzdHJlbmd0aCkgPT09IC0xKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHNpZ25hbCBzdHJlbmd0aCBwYXJhbSAke3N0cmVuZ3RofS4gU3VwcG9ydGVkIHZhbHVlczogJHtfLnZhbHVlcyhlbXVNZXRob2RzLkdTTV9TSUdOQUxfU1RSRU5HVEhTKX1gKTtcbiAgfVxuICBsb2cuaW5mbygnZ3NtIHNpZ25hbC1wcm9maWxlIDxzdHJlbmd0aD4gY2hhbmdlcyB0aGUgcmVwb3J0ZWQgc3RyZW5ndGggb24gbmV4dCAoMTVzKSB1cGRhdGUuJyk7XG4gIGF3YWl0IHRoaXMuYWRiRXhlY0VtdShbJ2dzbScsICdzaWduYWwtcHJvZmlsZScsIHN0cmVuZ3RoXSk7XG59O1xuXG4vKipcbiAqIEVtdWxhdGUgR1NNIHZvaWNlIGV2ZW50IG9uIHRoZSBjb25uZWN0ZWQgZW11bGF0b3IuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHN0YXRlIFsnb24nXSAtIEVpdGhlciAnb24nIG9yICdvZmYnLlxuICogQHRocm93cyB7ZXJyb3J9IElmIF9zdGF0ZV8gdmFsdWUgaXMgaW52YWxpZC5cbiAqL1xuZW11TWV0aG9kcy5nc21Wb2ljZSA9IGFzeW5jIGZ1bmN0aW9uIChzdGF0ZSA9ICdvbicpIHtcbiAgLy8gZ3NtIHZvaWNlIDxzdGF0ZT4gYWxsb3dzIHlvdSB0byBjaGFuZ2UgdGhlIHN0YXRlIG9mIHlvdXIgR1BSUyBjb25uZWN0aW9uXG4gIGlmIChfLnZhbHVlcyhlbXVNZXRob2RzLkdTTV9WT0lDRV9TVEFURVMpLmluZGV4T2Yoc3RhdGUpID09PSAtMSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBnc20gdm9pY2Ugc3RhdGUgcGFyYW0gJHtzdGF0ZX0uIFN1cHBvcnRlZCB2YWx1ZXM6ICR7Xy52YWx1ZXMoZW11TWV0aG9kcy5HU01fVk9JQ0VfU1RBVEVTKX1gKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYkV4ZWNFbXUoWydnc20nLCAndm9pY2UnLCBzdGF0ZV0pO1xufTtcblxuLyoqXG4gKiBFbXVsYXRlIG5ldHdvcmsgc3BlZWQgY2hhbmdlIGV2ZW50IG9uIHRoZSBjb25uZWN0ZWQgZW11bGF0b3IuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHNwZWVkIFsnZnVsbCddIC0gT25lIG9mIHBvc3NpYmxlIE5FVFdPUktfU1BFRUQgdmFsdWVzLlxuICogQHRocm93cyB7ZXJyb3J9IElmIF9zcGVlZF8gdmFsdWUgaXMgaW52YWxpZC5cbiAqL1xuZW11TWV0aG9kcy5uZXR3b3JrU3BlZWQgPSBhc3luYyBmdW5jdGlvbiAoc3BlZWQgPSAnZnVsbCcpIHtcbiAgLy8gbmV0d29yayBzcGVlZCA8c3BlZWQ+IGFsbG93cyB5b3UgdG8gc2V0IHRoZSBuZXR3b3JrIHNwZWVkIGVtdWxhdGlvbi5cbiAgaWYgKF8udmFsdWVzKGVtdU1ldGhvZHMuTkVUV09SS19TUEVFRCkuaW5kZXhPZihzcGVlZCkgPT09IC0xKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIG5ldHdvcmsgc3BlZWQgcGFyYW0gJHtzcGVlZH0uIFN1cHBvcnRlZCB2YWx1ZXM6ICR7Xy52YWx1ZXMoZW11TWV0aG9kcy5ORVRXT1JLX1NQRUVEKX1gKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYkV4ZWNFbXUoWyduZXR3b3JrJywgJ3NwZWVkJywgc3BlZWRdKTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGVtdU1ldGhvZHM7XG4iXSwiZmlsZSI6ImxpYi90b29scy9hZGItZW11LWNvbW1hbmRzLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
